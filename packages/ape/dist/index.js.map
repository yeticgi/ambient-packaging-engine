{"version":3,"file":"index.js","sources":["../src/misc/Events.ts","../src/Time.ts","../src/input/Input.ts","../src/gameobject/decorators/Decorator.ts","../src/utils/ThreeUtils.ts","../src/gameobject/GameObject.ts","../src/input/XRInput.ts","../src/misc/PerformanceStats.ts","../src/utils/MiscUtils.ts","../src/utils/MathUtils.ts","../src/misc/PerformanceResolutionScalar.ts","../src/utils/WaitPromises.ts","../src/device-camera/DeviceCamera.ts","../src/physics/Physics.ts","../src/APEngineEvents.ts","../src/gameobject/decorators/CameraDecorator.ts","../src/input/PointerEventSystem.ts","../src/APEngineBuildInfo.ts","../src/scene-management/SceneRenderOperation.ts","../src/scene-management/SceneManager.ts","../src/physics/XRPhysics.ts","../src/APEngine.ts","../src/dev/ThreeDevTools.ts","../src/gameobject/decorators/AnimatorDecorator.ts","../src/gameobject/decorators/MeshDecorator.ts","../src/misc/TransformControlsGUI.ts","../src/misc/TransformTool.ts","../src/gameobject/decorators/TransformPickerDecorator.ts","../src/gameobject/decorators/CameraOrbitDecorator.ts","../src/misc/Flags.ts","../src/input/TapCode.ts","../src/device-camera/readers/DeviceCameraReader.ts","../src/device-camera/readers/DeviceCameraQRReader.ts","../src/misc/StateMachine.ts","../src/misc/PropertySpectator.ts","../src/object-pools/ObjectPool.ts","../src/resources/APEAssetTracker.ts","../src/object-pools/Object3DPool.ts","../src/resources/ResourceManager.ts","../src/resources/Resource.ts","../src/resources/AudioResource.ts","../src/resources/GLTFPrefab.ts","../src/resources/GLTFResource.ts","../src/resources/TextureResource.ts","../src/resources/ImageResource.ts","../src/resources/ResourceProgress.ts","../src/resources/APEResources.ts","../src/utils/Eases.ts","../src/utils/Stopwatch.ts"],"sourcesContent":["import { IDisposable } from './IDisposable';\n\n// [Ryan] I would love to have multiple versions of Event and Listener that support more than one generic parameter.\n// However, this is not supported by JavaScript. TypeScript's compiler complains about the class name already being declared even though\n// the generic parameters are different. This is because when transpiled to JavaScript,all generic types are stripped.\n// So the best way to handle this is if you need mutiple objects to store them in a custom JavaScript object / Typescript interface.\n\n/**\n * Event that has no arguments.\n */\nexport class Event implements IDisposable {\n    private _listeners: EventListener[] = [];\n\n    public addListener(listener: EventListener) {\n        this._listeners.push(listener);\n    }\n\n    public removeListener(listener: EventListener) {\n        const index = this._listeners.indexOf(listener);\n        if (index !== -1) {\n            this._listeners.splice(index, 1);\n        }\n    }\n\n    public removeAllListeners() {\n        this._listeners = [];\n    }\n\n    public invoke() {\n        const listeners = [...this._listeners];\n        listeners.forEach(l => {\n            l();\n        });\n    }\n\n    public dispose() {\n        this.removeAllListeners();\n    }\n}\n\n/**\n * Signature of event listener that has no arguments.\n */\nexport declare type EventListener = () => void;\n\n/**\n * Event that has no arguments and has listeners that return promises.\n */\nexport class PromiseEvent implements IDisposable {\n    private _listeners: PromiseEventListener[] = [];\n\n    public addListener(listener: PromiseEventListener) {\n        this._listeners.push(listener);\n    }\n\n    public removeListener(listener: PromiseEventListener) {\n        const index = this._listeners.indexOf(listener);\n        if (index !== -1) {\n            this._listeners.splice(index, 1);\n        }\n    }\n\n    public removeAllListeners() {\n        this._listeners = [];\n    }\n\n    public async invoke() {\n        const promises = [...this._listeners].map(l => l());\n        await Promise.all(promises);\n    }\n\n    public dispose() {\n        this.removeAllListeners();\n    }\n}\n\n/**\n * Signature of event listener that has no arguments.\n */\nexport declare type PromiseEventListener = () => Promise<void>;\n\n/**\n * Event that takes typed argument.\n */\nexport class ArgEvent<T> implements IDisposable {\n    private _listeners: ArgEventListener<T>[] = [];\n\n    public addListener(listener: ArgEventListener<T>) {\n        this._listeners.push(listener);\n    }\n\n    public removeListener(listener: ArgEventListener<T>) {\n        const index = this._listeners.indexOf(listener);\n        if (index !== -1) {\n            this._listeners.splice(index, 1);\n        }\n    }\n\n    public removeAllListeners() {\n        this._listeners = [];\n    }\n\n    public invoke(arg: T) {\n        const listeners = [...this._listeners];\n        listeners.forEach(l => {\n            l(arg);\n        });\n    }\n\n    public dispose() {\n        this.removeAllListeners();\n    }\n}\n\n/**\n * Signature of event listener that accepts typed argument.\n */\nexport declare type ArgEventListener<T> = (arg: T) => void;\n\n/**\n * Event that takes typed argument and has listeners that return promises.\n */\nexport class PromiseArgEvent<T> implements IDisposable {\n    private _listeners: PromiseArgEventListener<T>[] = [];\n\n    public addListener(listener: PromiseArgEventListener<T>) {\n        this._listeners.push(listener);\n    }\n\n    public removeListener(listener: PromiseArgEventListener<T>) {\n        const index = this._listeners.indexOf(listener);\n        if (index !== -1) {\n            this._listeners.splice(index, 1);\n        }\n    }\n\n    public removeAllListeners() {\n        this._listeners = [];\n    }\n\n    public async invoke(arg: T): Promise<void> {\n        const promises = [...this._listeners].map(l => l(arg));\n        await Promise.all(promises);\n    }\n\n    public dispose() {\n        this.removeAllListeners();\n    }\n}\n\n/**\n * Signature of promise arg event listener that accepts typed argument.\n */\nexport declare type PromiseArgEventListener<T> = (arg: T) => Promise<void>;\n\n/**\n * Shout is a global event dispatcher.  \n * Objects can listen for and dispatch global events (referred to as shouts).\n */\nexport namespace Shout {\n\n    let listenersMap: Map<string, ArgEventListener<unknown>[]> = new Map();\n\n    export function addEventListener(type: string, listener: ArgEventListener<unknown>): boolean {\n        let listeners: ArgEventListener<unknown>[] = listenersMap.get(type);\n\n        if (listeners) {\n            // Add listener to listeners array if it isnt already.\n            let listenerExists: boolean = listeners.some((l) => l === listener);\n            if (!listenerExists) {\n                listeners.push(listener);\n                return true;\n            } else {\n                // Listener already exists.\n                return false;\n            }\n        } else {\n            // Add listeners array for shout type to the Map with the new listener added.\n            listeners = [];\n            listeners.push(listener);\n            listenersMap.set(type, listeners);\n            return true;\n        }\n    }\n\n    export function removeEventListener(type:string, listener: ArgEventListener<unknown>): boolean {\n        let listeners: ArgEventListener<unknown>[] = listenersMap.get(type);\n\n        if (listeners) {\n            let index = listeners.findIndex((l) => l === listener);\n            if (index >= 0) {\n                listeners.splice(index, 1);\n                return true;\n            }\n        }\n\n        return false;\n    }\n\n    export function dispatchEvent(type: string, arg?: unknown) {\n        let listeners: ArgEventListener<unknown>[] = listenersMap.get(type);\n\n        if (listeners) {\n            // Make a shallow copy in case dispatching alters the array.\n            let listenersCopy = listeners.slice();\n            listenersCopy.forEach((l) => l(arg));\n        }\n    }\n\n    export function removeAllEventListeners(): void {\n        listenersMap = new Map();\n    }\n}\n","import { Clock } from 'three';\nimport { IDisposable } from './misc/IDisposable';\nimport { ArgEvent } from './misc/Events';\n\ninterface TimeWaitPromise { \n    resolveTime: number;\n    resolve: () => void;\n}\n\ninterface FrameWaitPromise {\n    frame: number;\n    resolve: () => void;\n}\n\nexport class Time implements IDisposable {\n\n    /**\n     * Scalar value for how fast time passes. 0 = paused, 0.5 = half speed, 1.0 = normal, 2.0 = 2x fast, 4.0 = 4x fast, etc.\n     */\n    timeScale: number = 1.0;\n\n    onUpdate: ArgEvent<Time> = new ArgEvent();\n    \n    private _frameCount: number = 0;\n    private _timeSinceStart: number = 0;\n    private _deltaTime: number = 0;\n    private _clock: Clock;\n    private _timeWaitPromises: TimeWaitPromise[] = [];\n    private _frameWaitPromises: FrameWaitPromise[] = [];\n    \n    constructor() {\n        this._frameCount = 0;\n        this._timeSinceStart = 0;\n        this._deltaTime = 0;\n        this._clock = new Clock(true);\n    }\n\n    /**\n     * Number of frames that have passed since this game view was created.\n     */\n    get frameCount(): number {\n        return this._frameCount;\n    }\n\n    /**\n     * Number of seconds that have passed since this game view was created. This is affected by timeScale.\n     */\n    get timeSinceStart(): number {\n        return this._timeSinceStart;\n    }\n\n    /**\n     * Time in seconds that has passed since the last frame. This is affected by timeScale.\n     */\n    get deltaTime(): number {\n        return this._deltaTime;\n    }\n\n    update() {\n        // Track time.\n        this._frameCount += 1;\n\n        const clockDelta = this._clock.getDelta();\n        this._deltaTime = clockDelta * this.timeScale;\n        \n        this._timeSinceStart += this._deltaTime;\n\n        // Check frame wait promises and resolve any that are complete.\n        if (this._frameWaitPromises.length > 0) {\n            this._frameWaitPromises = this._frameWaitPromises.filter((fw) => {\n                if (fw.frame <= this._frameCount) {\n                    fw.resolve();\n                    return false;\n                } else {\n                    return true;\n                }\n            });\n        }  \n\n        // Check time wait promises and resolve any that are complete.\n        if (this._timeWaitPromises.length > 0) {\n            this._timeWaitPromises = this._timeWaitPromises.filter((tw) => {\n                if (tw.resolveTime <= this._timeSinceStart) {\n                    tw.resolve();\n                    return false;\n                } else {\n                    return true;\n                }\n            });\n        }\n\n        this.onUpdate.invoke(this);\n    }\n\n    /**\n     * Return a promise that waits the given number of seconds before resolving.\n     * @param seconds Number of seconds to wait before resolving the promise.\n     */\n    async waitForSeconds(seconds: number): Promise<void> {\n        if (seconds <= 0) {\n            return;\n        }\n\n        return new Promise((resolve) => {\n            this._timeWaitPromises.push({\n                resolveTime: this._timeSinceStart + seconds,\n                resolve\n            });\n        });\n    }\n\n    /**\n     * Return a promise that resolves once the next frame has started.\n     */\n    async waitForNextFrame(): Promise<void> {\n        return new Promise((resolve) => {\n            this._frameWaitPromises.push({\n                frame: this._frameCount + 1,\n                resolve\n            });\n        });\n    }\n\n    /**\n     * Return a promise that resolves once the the given number of frames has passed.\n     */\n    async waitForFrames(frameCount: number): Promise<void> {\n        return new Promise((resolve) => {\n            this._frameWaitPromises.push({\n                frame: this._frameCount + frameCount,\n                resolve\n            });\n        });\n    }\n\n    dispose(): void {\n    }\n}\n","import { Vector2, Vector3 } from 'three';\nimport find from 'lodash/find';\nimport some from 'lodash/some';\nimport { Time } from '../Time';\nimport { IDisposable } from '../misc/IDisposable';\n\ninterface IOptions { \n    time: Time,\n    inputElement: HTMLElement,\n    canvasElement: HTMLCanvasElement,\n    getUIHtmlElements(): HTMLElement[]\n}\n\nexport class Input implements IDisposable {\n    /**\n     * Debug level for Input class.\n     * 0: Disabled, 1: Down/Up events, 2: Move events\n     */\n    public debugLevel: number = 0;\n\n    public stopTouchPropogation = true;\n\n    // Internal pointer data.\n    private _mouseData: MouseData;\n    private _touchData: TouchData[];\n    private _keyData: Map<string, KeyData>;\n    private _touchListenerCounts: Map<EventTarget, number>;\n    private _wheelData: WheelData;\n    private _targetData: TargetData;\n\n    private _options: IOptions;\n    private _inputType: InputType = InputType.Undefined;\n\n    // Keep track of the touch data for finger index 0 at all times.\n    // This gives better support to the getMouse* functions while using touch.\n    private _lastPrimaryTouchData: TouchData;\n\n    /**\n     * @returns 'mouse' or 'touch'\n     */\n    get currentInputType(): InputType {\n        return this._inputType;\n    }\n\n    /**\n     * Sets the current input type to 'mouse' or 'touch'.\n     */\n    set currentInputType(inputType: InputType) {\n        this._inputType = inputType;\n    }\n\n    /**\n     * Calculates the Three.js screen position of the mouse from the given mouse event.\n     * Unlike viewport positions, Three.js screen positions go from -1 to +1.\n     * @param event The mouse event to get the viewport position out of.\n     * @param view The HTML element that we want the position to be relative to.\n     */\n    public static screenPosition(pagePos: Vector2, view: HTMLElement) {\n        let globalPos = new Vector2(pagePos.x, pagePos.y);\n        let viewRect = view.getBoundingClientRect();\n        let viewPos = globalPos.sub(new Vector2(viewRect.left, viewRect.top));\n        return new Vector2(\n            (viewPos.x / viewRect.width) * 2 - 1,\n            -(viewPos.y / viewRect.height) * 2 + 1\n        );\n    }\n\n    /**\n     * Measures the distance between the two mouse events in pixels.\n     * @param firstPagePos The first page position.\n     * @param secondPagePos The second page position.\n     */\n    public static mouseDistance(firstPagePos: Vector2, secondPagePos: Vector2) {\n        return firstPagePos.distanceTo(secondPagePos);\n    }\n\n    /**\n     * Determines if the mouse is directly over the given HTML element.\n     * @param clientPos The client position to test.\n     * @param element The HTML element to test against.\n     */\n    public static eventIsDirectlyOverElement(\n        clientPos: Vector2,\n        element: HTMLElement\n    ): boolean {\n        let mouseOver = document.elementFromPoint(clientPos.x, clientPos.y);\n        return mouseOver === element;\n    }\n\n    /**\n     * Determines if the mouse is over the given element.\n     * @param clientPos The client position to test.\n     * @param element The HTML element to test against.\n     */\n    public static eventIsOverElement(\n        clientPos: Vector2,\n        element: HTMLElement\n    ): boolean {\n        let elements = document.elementsFromPoint(clientPos.x, clientPos.y);\n        return some(elements, e => e === element);\n    }\n\n    constructor(options: IOptions) {\n        this._options = options;\n\n        this._mouseData = {\n            leftButtonState: new InputState(),\n            rightButtonState: new InputState(),\n            middleButtonState: new InputState(),\n            screenPos: new Vector2(0, 0),\n            pagePos: new Vector2(0, 0),\n            clientPos: new Vector2(0, 0),\n        };\n        this._targetData = {\n            inputDown: null,\n            inputUp: null,\n            inputOver: null,\n        };\n        this._touchData = [];\n        this._keyData = new Map();\n        this._touchListenerCounts = new Map();\n        this._wheelData = new WheelData();\n        this._lastPrimaryTouchData = {\n            fingerIndex: 0,\n            identifier: 0,\n            clientPos: new Vector2(0, 0),\n            pagePos: new Vector2(0, 0),\n            screenPos: new Vector2(0, 0),\n            state: new InputState(),\n        };\n\n        this._handleMouseDown = this._handleMouseDown.bind(this);\n        this._handleMouseMove = this._handleMouseMove.bind(this);\n        this._handleMouseUp = this._handleMouseUp.bind(this);\n        this._handleMouseLeave = this._handleMouseLeave.bind(this);\n        this._handleWheel = this._handleWheel.bind(this);\n        this._handleTouchStart = this._handleTouchStart.bind(this);\n        this._handleTouchMove = this._handleTouchMove.bind(this);\n        this._handleTouchEnd = this._handleTouchEnd.bind(this);\n        this._handleTouchCancel = this._handleTouchCancel.bind(this);\n        this._handleContextMenu = this._handleContextMenu.bind(this);\n        this._handleKeyDown = this._handleKeyDown.bind(this);\n        this._handleKeyUp = this._handleKeyUp.bind(this);\n\n        this.setInputElement(this._options.inputElement);\n        document.addEventListener('keydown', this._handleKeyDown);\n        document.addEventListener('keyup', this._handleKeyUp);\n\n        // Context menu is only important on the view\n        this._options.canvasElement.addEventListener(\n            'contextmenu',\n            this._handleContextMenu\n        );\n    }\n\n    /**\n     * Set the element that the input module will attach it's event listeners to.\n     * By default this is usually the three js webgl canvas but sometimes you want to attach the input event listeners\n     * on to a higher order html element and that's where this function comes in handy.\n     */\n    public setInputElement(element: HTMLElement): void {\n        if (this._options.inputElement) {\n            this._options.inputElement.removeEventListener('mousedown', this._handleMouseDown);\n            this._options.inputElement.removeEventListener('mousemove', this._handleMouseMove);\n            this._options.inputElement.removeEventListener('mouseup', this._handleMouseUp);\n            this._options.inputElement.removeEventListener('mouseleave', this._handleMouseLeave);\n            this._options.inputElement.removeEventListener('wheel', this._handleWheel);\n            this._options.inputElement.removeEventListener('touchstart', this._handleTouchStart);\n        }\n\n        this._options.inputElement = element;\n        if (this._options.inputElement) {\n            this._options.inputElement.addEventListener('mousedown', this._handleMouseDown);\n            this._options.inputElement.addEventListener('mousemove', this._handleMouseMove);\n            this._options.inputElement.addEventListener('mouseup', this._handleMouseUp);\n            this._options.inputElement.addEventListener('mouseleave', this._handleMouseLeave);\n            this._options.inputElement.addEventListener('wheel', this._handleWheel);\n            this._options.inputElement.addEventListener('touchstart', this._handleTouchStart);\n        }\n    }\n\n    public dispose() {\n        console.log('[Input] dispose');\n\n        this.setInputElement(null);\n        document.removeEventListener('keydown', this._handleKeyDown);\n        document.removeEventListener('keyup', this._handleKeyUp);\n\n        // Context menu is only important on the view\n        this._options.canvasElement.removeEventListener(\n            'contextmenu',\n            this._handleContextMenu\n        );\n\n        this._options = null;\n    }\n\n    /**\n     * Determines if the input down event happened directly over the given element.\n     * @param element The element to test.\n     */\n    public isDownOnElement(element: HTMLElement): boolean {\n        const downElement = this._targetData.inputDown;\n        return Input.isElementContainedByOrEqual(downElement, element);\n    }\n\n    /**\n     * Determines if the input down event happened directly over any of the given elements.\n     * @param elements The elements to test.\n     */\n    public isDownOnAnyElements(elements: HTMLElement[]): boolean {\n        const downElement = this._targetData.inputDown;\n        const matchingElement = elements.find(e =>\n            Input.isElementContainedByOrEqual(downElement, e)\n        );\n        return !!matchingElement;\n    }\n\n    /**\n     * Determines if the input down event happened directly over any of the input elements.\n     */\n    public isDownOnAnyInputElement(): boolean {\n        const downElement = this._targetData.inputDown;\n        const inputElements = [this._options.canvasElement, ...this._options.getUIHtmlElements()];\n        const matchingElement = inputElements.find(e => \n            Input.isElementContainedByOrEqual(downElement, e)\n        );\n        return !!matchingElement;\n    }\n\n    /**\n     * Determines if the input is currently focusing the given html element.\n     * @param element The element to test.\n     */\n    public isFocusingOnElement(element: HTMLElement): boolean {\n        const overElement = this._targetData.inputOver;\n        return Input.isElementContainedByOrEqual(overElement, element);\n    }\n\n    /**\n     * Determines if the input is currently focusing any of the given html elements.\n     * @param elements The elements to test.\n     */\n    public isFocusingOnAnyElements(elements: HTMLElement[]): boolean {\n        const overElement = this._targetData.inputOver;\n        const matchingElement = elements.find(e =>\n            Input.isElementContainedByOrEqual(overElement, e)\n        );\n        return !!matchingElement;\n    }\n\n    /**\n     * Determines if the input is currently focusing on any of the input elements.\n     */\n    public isFocusingOnAnyInputElement(): boolean {\n        const overElement = this._targetData.inputOver;\n        const inputElements = [this._options.canvasElement, ...this._options.getUIHtmlElements()];\n        const matchingElement = inputElements.find(e => \n            Input.isElementContainedByOrEqual(overElement, e)\n        );\n        return !!matchingElement;\n    }\n\n    /**\n     * Determines if the given event is for any of the the given elements and should\n     * therefore be intercepted.\n     * @param event The event.\n     * @param elements The elements.\n     */\n    public isEventForAnyElement(\n        event: MouseEvent | TouchEvent,\n        elements: HTMLElement[]\n    ): boolean {\n        let el: Element;\n        if (event instanceof MouseEvent) {\n            el = document.elementFromPoint(event.clientX, event.clientY);\n        } else {\n            el = document.elementFromPoint(\n                event.changedTouches[0].clientX,\n                event.changedTouches[0].clientY\n            );\n        }\n\n        const matchingElement = elements.find(e =>\n            Input.isElementContainedByOrEqual(el, e)\n        );\n        return !!matchingElement;\n    }\n\n    /**\n     * Determines if the given HTML element is contained by the given container element.\n     * @param element The HTML element.\n     * @param container The container.\n     */\n    public static isElementContainedByOrEqual(\n        element: Element,\n        container: HTMLElement\n    ): boolean {\n        if (element === container) {\n            return true;\n        } else {\n            if (!element) {\n                return false;\n            } else {\n                return this.isElementContainedByOrEqual(\n                    element.parentElement,\n                    container\n                );\n            }\n        }\n    }\n\n    /**\n     * Returns true the frame that the button was pressed down.\n     * If on mobile device and requresing Left Button, will return for the first finger touching the screen.\n     */\n    public getMouseButtonDown(buttonId: MouseButtonId): boolean {\n        if (this._inputType == InputType.Mouse) {\n            let buttonState = this._getMouseButtonState(buttonId);\n            if (buttonState) {\n                return buttonState.isDownOnFrame(\n                    this._options.time.frameCount\n                );\n            }\n        } else if (this._inputType == InputType.Touch) {\n            if (buttonId == MouseButtonId.Left) {\n                return this._lastPrimaryTouchData.state.isDownOnFrame(\n                    this._options.time.frameCount\n                );\n            } else {\n                // TODO: Support right button with touch?\n            }\n        }\n\n        return false;\n    }\n\n    public getTouchDown(fingerIndex: number): boolean {\n        let touchData = this.getTouchData(fingerIndex);\n        if (touchData) {\n            return touchData.state.isDownOnFrame(\n                this._options.time.frameCount\n            );\n        }\n\n        return false;\n    }\n\n    /**\n     * Returns true on the frame that the key was pressed.\n     * @param key The key. See https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent/key\n     */\n    public getKeyDown(key: string): boolean {\n        let keyData = this.getKeyData(key);\n        if (keyData) {\n            return keyData.state.isDownOnFrame(this._options.time.frameCount);\n        }\n\n        return false;\n    }\n\n    /**\n     * Returns true the frame that the button was released.\n     * If on mobile device and requresing Left Button, will return for the first finger touching the screen.\n     */\n    public getMouseButtonUp(buttonId: MouseButtonId): boolean {\n        if (this._inputType == InputType.Mouse) {\n            let buttonState = this._getMouseButtonState(buttonId);\n            if (buttonState) {\n                return buttonState.isUpOnFrame(this._options.time.frameCount);\n            }\n        } else if (this._inputType == InputType.Touch) {\n            if (buttonId == MouseButtonId.Left) {\n                return this._lastPrimaryTouchData.state.isUpOnFrame(\n                    this._options.time.frameCount\n                );\n            } else {\n                // TODO: Support right button with touch?\n            }\n        }\n\n        return false;\n    }\n\n    public getTouchUp(fingerIndex: number): boolean {\n        let touchData = this.getTouchData(fingerIndex);\n        if (touchData) {\n            return touchData.state.isUpOnFrame(this._options.time.frameCount);\n        }\n\n        return false;\n    }\n\n    /**\n     * Returns true on the frame that the key was released.\n     * @param key The key. See https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent/key\n     */\n    public getKeyUp(key: string): boolean {\n        let keyData = this.getKeyData(key);\n        if (keyData) {\n            return keyData.state.isUpOnFrame(this._options.time.frameCount);\n        }\n\n        return false;\n    }\n\n    /**\n     * Retruns true every frame the button is held down.\n     * If on mobile device, will return the held state of the first finger touching the screen.\n     */\n    public getMouseButtonHeld(buttonId: MouseButtonId): boolean {\n        if (this._inputType == InputType.Mouse) {\n            let buttonState = this._getMouseButtonState(buttonId);\n            if (buttonState) {\n                return buttonState.isHeldOnFrame(\n                    this._options.time.frameCount\n                );\n            }\n        } else if (this._inputType == InputType.Touch) {\n            if (buttonId == MouseButtonId.Left) {\n                return this._lastPrimaryTouchData.state.isHeldOnFrame(\n                    this._options.time.frameCount\n                );\n            } else {\n                // TODO: Support right button with touch?\n            }\n        }\n\n        return false;\n    }\n\n    public getTouchHeld(fingerIndex: number): boolean {\n        let touchData = this.getTouchData(fingerIndex);\n        if (touchData) {\n            return touchData.state.isHeldOnFrame(\n                this._options.time.frameCount\n            );\n        }\n\n        return false;\n    }\n\n    /**\n     * Returns true every frame that the given key is held down.\n     * @param key The key. See https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent/key\n     */\n    public getKeyHeld(key: string): boolean {\n        let keyData = this.getKeyData(key);\n        if (keyData) {\n            return keyData.state.isHeldOnFrame(this._options.time.frameCount);\n        }\n        return false;\n    }\n\n    /**\n     * Return true the frame that wheel movement was detected.\n     */\n    public getWheelMoved(): boolean {\n        return (\n            this._wheelData.getFrame(this._options.time.frameCount) != null\n        );\n    }\n\n    /**\n     * The wheel data for the current frame.\n     */\n    public getWheelData(): WheelFrame {\n        // Deep clone the internal wheel data.\n        let wheelFrame = this._wheelData.getFrame(\n            this._options.time.frameCount\n        );\n        if (wheelFrame) return JSON.parse(JSON.stringify(wheelFrame));\n        else return null;\n    }\n\n    /**\n     * Return the last known screen position of the mouse.\n     * If on mobile device, will return the screen position of the first finger touching the screen.\n     */\n    public getMouseScreenPos(): Vector2 {\n        if (this._inputType == InputType.Mouse) {\n            return this._mouseData.screenPos;\n        } else if (this._inputType == InputType.Touch) {\n            return this._lastPrimaryTouchData.screenPos;\n        }\n\n        return null;\n    }\n\n    /**\n     * Return the last known page position of the mouse.\n     * If on mobile device, will return the page position of the first finger touching the screen.\n     */\n    public getMousePagePos(): Vector2 {\n        if (this._inputType == InputType.Mouse) {\n            return this._mouseData.pagePos;\n        } else if (this._inputType == InputType.Touch) {\n            return this._lastPrimaryTouchData.pagePos;\n        }\n\n        return null;\n    }\n\n    /**\n     * Return the last known client position of the mouse.\n     * If on mobile device, will return the client position of the first finger touching the screen.\n     */\n    public getMouseClientPos(): Vector2 {\n        if (this._inputType == InputType.Mouse) {\n            return this._mouseData.clientPos;\n        } else if (this._inputType == InputType.Touch) {\n            return this._lastPrimaryTouchData.clientPos;\n        }\n\n        return null;\n    }\n\n    /**\n     * Return the screen position of the touch. Will return null if touch not detected.\n     * @param fingerIndex The index of the finger (first finger: 0, second finger: 1, ...)\n     */\n    public getTouchScreenPos(fingerIndex: number): Vector2 {\n        let touchData = this.getTouchData(fingerIndex);\n        if (touchData) {\n            return touchData.screenPos;\n        }\n        return null;\n    }\n\n    /**\n     * Return the page position of the touch. Will return null if touch not detected.\n     * @param fingerIndex The index of the finger (first finger: 0, second finger: 1, ...)\n     */\n    public getTouchPagePos(fingerIndex: number): Vector2 {\n        let touchData = this.getTouchData(fingerIndex);\n        if (touchData) {\n            return touchData.pagePos;\n        }\n        return null;\n    }\n\n    /**\n     * Return the client position of the touch. Will return null if touch not detected.\n     * @param fingerIndex The index of the finger (first finger: 0, second finger: 1, ...)\n     */\n    public getTouchClientPos(fingerIndex: number): Vector2 {\n        let touchData = this.getTouchData(fingerIndex);\n        if (touchData) {\n            return touchData.clientPos;\n        }\n        return null;\n    }\n\n    /**\n     * Return how many touches are currenty active.\n     */\n    public getTouchCount(): number {\n        return this._touchData.length;\n    }\n\n    public getMouseData(): MouseData {\n        return this._mouseData;\n    }\n\n    /**\n     * Returns the matching TouchData object for the provided finger index.\n     */\n    public getTouchData(finderIndex: number): TouchData {\n        if (this._touchData.length > 0) {\n            let touchData = find(this._touchData, (d: TouchData) => {\n                return d.fingerIndex === finderIndex;\n            });\n            if (touchData) {\n                return touchData;\n            }\n        }\n        return null;\n    }\n\n    /**\n     * Returns the matching key data for the provided key value.\n     * @param key The key that the data should be found for.\n     *            See https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent/key\n     */\n    public getKeyData(key: string): KeyData {\n        return this._keyData.get(key);\n    }\n\n    /**\n     * Gets the iterable list of keys that have been used in the application.\n     * Useful to check if any keys have been pressed or released.\n     */\n    public getKeys(): Iterable<KeyData> {\n        return this._keyData.values();\n    }\n\n    /**\n     * Gets the information about what HTML elements are currently being targeted.\n     * Note that this only stores information about the last targeted elements.\n     * As such, it should only be used to tell whether touch/mouse events\n     * should be used or not.\n     */\n    public getTargetData(): TargetData {\n        return this._targetData;\n    }\n\n    /**\n     * Force all current input states to release (set the up frame to the current frame).\n     */\n    public forceReleaseInputs(): void {\n        const currentFrame = this._options.time.frameCount;\n\n        // Release currently held mouse buttons.\n        if (this._mouseData.leftButtonState.isHeldOnFrame(currentFrame)) {\n            this._mouseData.leftButtonState.setUpFrame(currentFrame);\n        }\n        if (this._mouseData.middleButtonState.isHeldOnFrame(currentFrame)) {\n            this._mouseData.middleButtonState.setUpFrame(currentFrame);\n        }\n        if (this._mouseData.rightButtonState.isHeldOnFrame(currentFrame)) {\n            this._mouseData.rightButtonState.setUpFrame(currentFrame);\n        }\n\n        // Release currenty held touches.\n        for (let i = 0; i < this._touchData.length; i++) {\n            let touchData = this._touchData[i];\n            if (touchData.state.isHeldOnFrame(currentFrame)) {\n                touchData.state.setUpFrame(currentFrame);\n            }\n        }\n    }\n\n    public update() {\n        this._cullTouchData();\n        this._wheelData.removeOldFrames(this._options.time.frameCount);\n    }\n\n    /**\n     * Loop through all current touch data and remove any that are no longer needed.\n     * Unlike the mouse, touch pointers are unique everytime they are pressed down on the screen.\n     * Remove any touch pointers that are passed their 'up' input state. No need to keep them around.\n     */\n    private _cullTouchData(): void {\n        let touchRemoved: boolean = false;\n\n        this._touchData = this._touchData.filter((t: TouchData) => {\n            let upFrame = t.state.getUpFrame();\n\n            // Up frame must have been set.\n            if (upFrame !== -1) {\n                // Current frame must be higher than the touch's up frame.\n                if (this._options.time.frameCount > upFrame) {\n                    if (this.debugLevel >= 1) {\n                        console.log(\n                            'removing touch finger: ' +\n                                t.fingerIndex +\n                                '. frame: ' +\n                                this._options.time.frameCount\n                        );\n                    }\n\n                    touchRemoved = true;\n                    return false;\n                }\n            }\n\n            return true;\n        });\n\n        if (touchRemoved && this._touchData.length > 0) {\n            // Normalize the finger index range of the remaining touch data.\n            this._touchData = this._touchData.sort(\n                (a: TouchData, b: TouchData) => {\n                    return a.fingerIndex - b.fingerIndex;\n                }\n            );\n\n            for (let i = 0; i < this._touchData.length; i++) {\n                this._touchData[i].fingerIndex = i;\n            }\n        }\n    }\n\n    private _copyToPrimaryTouchData(data: TouchData) {\n        this._lastPrimaryTouchData.fingerIndex = data.fingerIndex;\n        this._lastPrimaryTouchData.identifier = data.identifier;\n        this._lastPrimaryTouchData.clientPos = data.clientPos.clone();\n        this._lastPrimaryTouchData.pagePos = data.pagePos.clone();\n        this._lastPrimaryTouchData.screenPos = data.screenPos.clone();\n        this._lastPrimaryTouchData.state = data.state.clone();\n    }\n\n    /**\n     * Returns the matching MouseButtonData object for the provided mouse button number.\n     */\n    private _getMouseButtonState(button: MouseButtonId): InputState {\n        if (button == MouseButtonId.Left)\n            return this._mouseData.leftButtonState;\n        if (button == MouseButtonId.Right)\n            return this._mouseData.rightButtonState;\n        if (button == MouseButtonId.Middle)\n            return this._mouseData.middleButtonState;\n\n        console.warn('unsupported mouse button number: ' + button);\n        return null;\n    }\n    \n    /**\n     * Returns the matching MouseButtonData objects for the given mouse buttons number.\n     * See https://developer.mozilla.org/en-US/docs/Web/API/MouseEvent/buttons\n     * @param buttons The number that represents the buttons that are held down.\n     */\n    private _getMouseButtonStates(buttons: number): InputState[] {\n        let states = [] as InputState[];\n        if ((buttons & 1) === 1) {\n            states.push(this._getMouseButtonState(MouseButtonId.Left));\n        }\n        if ((buttons & 2) === 2) {\n            states.push(this._getMouseButtonState(MouseButtonId.Right));\n        }\n        if ((buttons & 4) === 4) {\n            states.push(this._getMouseButtonState(MouseButtonId.Middle));\n        }\n        return states;\n    }\n\n    /**\n     * Calculates the Three.js screen position of the pointer from the given pointer event.\n     * Unlike viewport positions, Three.js screen positions go from -1 to +1.\n     * @param pageX\n     * @param pageY\n     */\n    private _calculateScreenPos(pageX: number, pageY: number): Vector2 {\n        return Input.screenPosition(\n            new Vector2(pageX, pageY),\n            this._options.canvasElement\n        );\n    }\n\n    private _handleMouseDown(event: MouseEvent) {\n        if (this._inputType == InputType.Undefined)\n            this._inputType = InputType.Mouse;\n        if (this._inputType != InputType.Mouse) return;\n\n        if (\n            this.isEventForAnyElement(event, [\n                this._options.canvasElement,\n                ...this._options.getUIHtmlElements(),\n            ])\n        ) {\n            event.preventDefault();\n        }\n\n        let buttonState: InputState = this._getMouseButtonState(event.button);\n        if (buttonState) {\n            buttonState.setDownFrame(this._options.time.frameCount);\n\n            if (this.debugLevel >= 1) {\n                console.log(\n                    'mouse button ' +\n                        event.button +\n                        ' down. fireInputOnFrame: ' +\n                        this._options.time.frameCount\n                );\n            }\n\n            this._targetData.inputDown = <HTMLElement>event.target;\n            this._mouseData.clientPos = new Vector2(\n                event.clientX,\n                event.clientY\n            );\n            this._mouseData.pagePos = new Vector2(event.pageX, event.pageY);\n            this._mouseData.screenPos = this._calculateScreenPos(\n                event.pageX,\n                event.pageY\n            );\n        }\n    }\n\n    private _handleMouseUp(event: MouseEvent) {\n        if (this._inputType == InputType.Undefined)\n            this._inputType = InputType.Mouse;\n        if (this._inputType != InputType.Mouse) return;\n\n        if (\n            this.isEventForAnyElement(event, [\n                this._options.canvasElement,\n                ...this._options.getUIHtmlElements(),\n            ])\n        ) {\n            event.preventDefault();\n        }\n\n        let buttonState: InputState = this._getMouseButtonState(event.button);\n        if (buttonState) {\n            buttonState.setUpFrame(this._options.time.frameCount);\n\n            if (this.debugLevel >= 1) {\n                console.log( 'mouse button ' +\n                        event.button +\n                        ' up. fireInputOnFrame: ' +\n                        this._options.time.frameCount\n                );\n            }\n\n            this._targetData.inputUp = <HTMLElement>event.target;\n            this._mouseData.clientPos = new Vector2(event.clientX, event.pageY);\n            this._mouseData.pagePos = new Vector2(event.pageX, event.pageY);\n            this._mouseData.screenPos = this._calculateScreenPos(\n                event.pageX,\n                event.pageY\n            );\n        }\n    }\t\n    private _handleMouseLeave(event: MouseEvent) {\n        if (this._inputType == InputType.Undefined)\n            this._inputType = InputType.Mouse;\n        if (this._inputType != InputType.Mouse) return;\n\n        if (this.isEventForAnyElement(event, [\n                this._options.canvasElement,\n                ...this._options.getUIHtmlElements(),\n            ])\n        ) {\n            event.preventDefault();\n        }\n        \n        // Clear all the button states when the mouse leaves the window\n        let buttonStates: InputState[] = [\n            this._mouseData.leftButtonState,\n            this._mouseData.rightButtonState,\n            this._mouseData.middleButtonState,\n        ];\n        for (let buttonState of buttonStates) {\n            buttonState.setUpFrame(this._options.time.frameCount);\n        }\n        if (this.debugLevel >= 1) {\n            console.log('mouse button ' + event.button + ' leave. fireInputOnFrame: ' + this._options.time.frameCount);\n        }\n        this._targetData.inputUp = <HTMLElement>event.target;\n        this._mouseData.clientPos = new Vector2(event.clientX, event.pageY);\n        this._mouseData.pagePos = new Vector2(event.pageX, event.pageY);\n        this._mouseData.screenPos = this._calculateScreenPos(\n            event.pageX,\n            event.pageY\n        );\n    }\n\n    private _handleMouseMove(event: MouseEvent) {\n        if (this._inputType == InputType.Undefined)\n            this._inputType = InputType.Mouse;\n        if (this._inputType != InputType.Mouse) return;\n\n        if (\n            this.isEventForAnyElement(event, [\n                this._options.canvasElement,\n                ...this._options.getUIHtmlElements(),\n            ])\n        ) {\n            event.preventDefault();\n        }\n                \n        // Resend the mouse down events if the button is actually down\n        // but is not recorded as such.\n        const buttonStates: InputState[] = this._getMouseButtonStates(\n            event.buttons\n        );\n        let hadButtonDown = false;\n        for (let state of buttonStates) {\n            let down = state.getDownFrame();\n            let up = state.getUpFrame();\n            if (up > down || down === -1) {\n                state.setDownFrame(this._options.time.frameCount);\n                hadButtonDown = true;\n            }\n        }\n        if (hadButtonDown) {\n            if (this.debugLevel >= 1) {\n                console.log('mouse buttons ' + event.buttons + ' already down. fireInputOnFrame: ' + this._options.time.frameCount);\n            }\n        }\n\n        this._mouseData.clientPos = new Vector2(event.clientX, event.clientY);\n        this._mouseData.pagePos = new Vector2(event.pageX, event.pageY);\n        this._mouseData.screenPos = this._calculateScreenPos(\n            event.pageX,\n            event.pageY\n        );\n        this._targetData.inputOver = <HTMLElement>event.target;\n\n        if (this.debugLevel >= 2) {\n            console.log('mouse move:');\n            console.log(\n                '  screenPos: ' + JSON.stringify(this._mouseData.screenPos)\n            );\n            console.log(\n                '  pagePos: ' + JSON.stringify(this._mouseData.pagePos)\n            );\n            console.log(\n                '  clientPos: ' + JSON.stringify(this._mouseData.clientPos)\n            );\n        }\n    }\n\n    private _getKeyState(key: string) {\n        return this._keyData.get(key);\n    }\n\n    private _handleKeyUp(event: KeyboardEvent) {\n        let keyState = this._getKeyState(event.key);\n        if (keyState) {\n            keyState.state.setUpFrame(this._options.time.frameCount);\n        }\n\n        if (this.debugLevel >= 1) {\n            console.log(\n                'key ' +\n                    event.key +\n                    ' up. fireInputOnFrame: ' +\n                    this._options.time.frameCount\n            );\n        }\n    }\n\n    private _handleKeyDown(event: KeyboardEvent) {\n        let keyData = this._getKeyState(event.key);\n        if (!keyData) {\n            keyData = {\n                key: event.key,\n                state: new InputState(),\n            };\n            this._keyData.set(keyData.key, keyData);\n        }\n\n        if (!event.repeat) {\n            keyData.state.setDownFrame(this._options.time.frameCount);\n        }\n\n        if (this.debugLevel >= 1) {\n            console.log(\n                'key ' +\n                    event.key +\n                    ' down. fireInputOnFrame: ' +\n                    this._options.time.frameCount +\n                    '. repeating: ' +\n                    event.repeat\n            );\n        }\n    }\n\n    private _handleWheel(event: WheelEvent) {\n        if (this.isFocusingOnElement(this._options.canvasElement)) {\n            event.preventDefault();\n        }\n\n        let wheelFrame: WheelFrame = {\n            moveFrame: this._options.time.frameCount,\n            delta: new Vector3(event.deltaX, event.deltaY, event.deltaZ),\n            ctrl: event.ctrlKey,\n        };\n\n        this._wheelData.addFrame(wheelFrame);\n\n        if (this.debugLevel >= 2) {\n            if (wheelFrame.ctrl) {\n                console.log(\n                    `wheel w/ ctrl fireOnFrame: ${\n                        wheelFrame.moveFrame\n                    }, delta: (${wheelFrame.delta.x}, ${wheelFrame.delta.y}, ${\n                        wheelFrame.delta.z\n                    })`\n                );\n            } else {\n                console.log(\n                    `wheel fireOnFrame: ${wheelFrame.moveFrame}, delta: (${\n                        wheelFrame.delta.x\n                    }, ${wheelFrame.delta.y}, ${wheelFrame.delta.z})`\n                );\n            }\n        }\n    }\n\n    private _handleTouchStart(event: TouchEvent) {\n        if (this._inputType == InputType.Undefined)\n            this._inputType = InputType.Touch;\n        if (this._inputType != InputType.Touch) return;\n\n        const count = this._touchListenerCounts.get(event.target) || 0;\n        if (count === 0) {\n            event.target.addEventListener('touchmove', <EventListener>this._handleTouchMove);\n            event.target.addEventListener('touchend', <EventListener>this._handleTouchEnd);\n            event.target.addEventListener(\n                'touchcancel',\n                <EventListener>this._handleTouchCancel\n            );\n            this._touchListenerCounts.set(\n                event.target,\n                event.changedTouches.length\n            );\n\n            if (this.debugLevel >= 1) {\n                console.log('adding touch listeners for ', event.target);\n            }\n        } else if (count >= 0) {\n            this._touchListenerCounts.set(\n                event.target,\n                count + event.changedTouches.length\n            );\n            if (this.debugLevel >= 1) {\n                console.log(count + 1, ' touch events left for', event.target);\n            }\n        }\n\n        if (\n            this.isEventForAnyElement(event, [\n                this._options.canvasElement,\n                ...this._options.getUIHtmlElements(),\n            ])\n        ) {\n            event.preventDefault();\n        }\n\n        // For the touchstart event, it is a list of the touch points that became active with the current event.\n        let changed = event.changedTouches;\n\n        for (let i = 0; i < changed.length; i++) {\n            let touch = changed.item(i);\n\n            // Create new touch data.\n            let data: TouchData = {\n                identifier: touch.identifier,\n                fingerIndex: this.getTouchCount(),\n                state: new InputState(),\n                clientPos: new Vector2(touch.clientX, touch.clientY),\n                pagePos: new Vector2(touch.pageX, touch.pageY),\n                screenPos: this._calculateScreenPos(touch.pageX, touch.pageY),\n            };\n\n            // Set the down frame on the new touch data.\n            data.state.setDownFrame(this._options.time.frameCount);\n\n            if (data.fingerIndex === 0) {\n                this._copyToPrimaryTouchData(data);\n            }\n\n            if (this.debugLevel >= 1) {\n                console.log(\n                    'touch finger ' +\n                        data.identifier +\n                        ' ' +\n                        data.fingerIndex +\n                        ' start. fireInputOnFrame: ' +\n                        this._options.time.frameCount\n                );\n            }\n\n            this._targetData.inputDown = this._targetData.inputOver = <HTMLElement>touch.target;\n            this._touchData.push(data);\n        }\n    }\n\n    private _handleTouchMove(event: TouchEvent) {\n        if (this._inputType == InputType.Undefined)\n            this._inputType = InputType.Touch;\n        if (this._inputType != InputType.Touch) return;\n\n        if (this.stopTouchPropogation) {\n            event.stopImmediatePropagation();\n        }\n\n        if (\n            this.isEventForAnyElement(event, [\n                this._options.canvasElement,\n                ...this._options.getUIHtmlElements(),\n            ])\n        ) {\n            event.preventDefault();\n        }\n\n        // For the touchmove event, it is a list of the touch points that have changed since the last event.\n        let changed = event.changedTouches;\n\n        for (let i = 0; i < changed.length; i++) {\n            let touch = changed.item(i);\n\n            let existingTouch = find(this._touchData, d => {\n                return d.identifier === touch.identifier;\n            });\n            existingTouch.clientPos = new Vector2(touch.clientX, touch.clientY);\n            existingTouch.pagePos = new Vector2(touch.pageX, touch.pageY);\n            existingTouch.screenPos = this._calculateScreenPos(\n                touch.pageX,\n                touch.pageY\n            );\n            // Must use elementFromPoint because touch event target never changes after initial contact.\n            this._targetData.inputOver = <HTMLElement>(\n                document.elementFromPoint(touch.clientX, touch.clientY)\n            );\n\n            if (existingTouch.fingerIndex === 0) {\n                this._copyToPrimaryTouchData(existingTouch);\n            }\n\n            if (this.debugLevel >= 2) {\n                console.log('touch move:');\n                console.log('  identifier: ' + existingTouch.identifier);\n                console.log('  fingerIndex: ' + existingTouch.fingerIndex);\n                console.log(\n                    '  screenPos: ' + JSON.stringify(existingTouch.screenPos)\n                );\n                console.log(\n                    '  pagePos: ' + JSON.stringify(existingTouch.pagePos)\n                );\n                console.log(\n                    '  clientPos: ' + JSON.stringify(existingTouch.clientPos)\n                );\n            }\n        }\n    }\n\n    private _handleTouchEnd(evt: TouchEvent) {\n        if (this._inputType == InputType.Undefined)\n            this._inputType = InputType.Touch;\n        if (this._inputType != InputType.Touch) return;\n\n        if (this.stopTouchPropogation) {\n            event.stopImmediatePropagation();\n        }\n\n        const count = this._touchListenerCounts.get(evt.target) || 0;\n        if (count <= evt.changedTouches.length) {\n            evt.target.removeEventListener(\n                'touchmove',\n                <EventListener>this._handleTouchMove\n            );\n            evt.target.removeEventListener('touchend', <EventListener>this._handleTouchEnd);\n            evt.target.removeEventListener(\n                'touchcancel',\n                <EventListener>this._handleTouchCancel\n            );\n            this._touchListenerCounts.set(evt.target, 0);\n\n            if (this.debugLevel >= 1) {\n                console.log('removing touch listeners for ', evt.target);\n            }\n        } else if (count > 0) {\n            this._touchListenerCounts.set(\n                evt.target,\n                count - evt.changedTouches.length\n            );\n            if (this.debugLevel >= 1) {\n                console.log(count - 1, ' touch events left for', evt.target);\n            }\n        }\n\n        if (\n            this.isEventForAnyElement(evt, [\n                this._options.canvasElement,\n                ...this._options.getUIHtmlElements(),\n            ])\n        ) {\n            evt.preventDefault();\n        }\n\n        // For the touchend event, it is a list of the touch points that have been removed from the surface.\n        let changed = evt.changedTouches;\n\n        for (let i = 0; i < changed.length; i++) {\n            let touch = changed.item(i);\n\n            // Must use elementFromPoint because touch event target never changes after initial contact.\n            this._targetData.inputUp = this._targetData.inputOver = <HTMLElement>document.elementFromPoint(touch.clientX, touch.clientY);\n\n            let existingTouch = find(this._touchData, d => {\n                return d.identifier === touch.identifier;\n            });\n            existingTouch.state.setUpFrame(this._options.time.frameCount);\n            existingTouch.clientPos = new Vector2(touch.clientX, touch.clientY);\n            existingTouch.pagePos = new Vector2(touch.pageX, touch.pageY);\n            existingTouch.screenPos = this._calculateScreenPos(\n                touch.pageX,\n                touch.pageY\n            );\n\n            if (existingTouch.fingerIndex === 0) {\n                this._copyToPrimaryTouchData(existingTouch);\n            }\n\n            if (this.debugLevel >= 1) {\n                console.log(\n                    'touch finger ' +\n                        existingTouch.identifier +\n                        ' ' +\n                        existingTouch.fingerIndex +\n                        ' end. fireInputOnFrame: ' +\n                        this._options.time.frameCount\n                );\n            }\n        }\n    }\n\n    private _handleTouchCancel(evt: TouchEvent) {\n        if (this._inputType == InputType.Undefined)\n            this._inputType = InputType.Touch;\n        if (this._inputType != InputType.Touch) return;\n\n        if (this.stopTouchPropogation) {\n            event.stopImmediatePropagation();\n        }\n\n        const count = this._touchListenerCounts.get(evt.target) || 0;\n        if (count <= evt.changedTouches.length) {\n            evt.target.removeEventListener(\n                'touchmove',\n                <EventListener>this._handleTouchMove\n            );\n            evt.target.removeEventListener('touchend', <EventListener>this._handleTouchEnd);\n            evt.target.removeEventListener(\n                'touchcancel',\n                <EventListener>this._handleTouchCancel\n            );\n            this._touchListenerCounts.set(evt.target, 0);\n\n            if (this.debugLevel >= 1) {\n                console.log('removing touch listeners for ', evt.target);\n            }\n        } else if (count > 0) {\n            this._touchListenerCounts.set(\n                evt.target,\n                count - evt.changedTouches.length\n            );\n            if (this.debugLevel >= 1) {\n                console.log(count - 1, ' touch events left for', evt.target);\n            }\n        }\n\n        let changed = evt.changedTouches;\n\n        for (let i = 0; i < changed.length; i++) {\n            // Handle a canceled touche the same as a touch end.\n            let touch = changed.item(i);\n\n            let existingTouch = find(this._touchData, d => {\n                return d.identifier === touch.identifier;\n            });\n            existingTouch.state.setUpFrame(this._options.time.frameCount);\n            existingTouch.clientPos = new Vector2(touch.clientX, touch.clientY);\n            existingTouch.pagePos = new Vector2(touch.pageX, touch.pageY);\n            existingTouch.screenPos = this._calculateScreenPos(\n                touch.pageX,\n                touch.pageY\n            );\n\n            if (existingTouch.fingerIndex === 0) {\n                this._copyToPrimaryTouchData(existingTouch);\n            }\n\n            if (this.debugLevel >= 1) {\n                console.log(\n                    'touch finger ' +\n                        existingTouch.fingerIndex +\n                        ' canceled. fireInputOnFrame: ' +\n                        this._options.time.frameCount\n                );\n            }\n        }\n    }\n\n    private _handleContextMenu(event: MouseEvent) {\n        // Prevent context menu from triggering.\n        event.preventDefault();\n        event.stopPropagation();\n    }\n}\n\nexport enum InputType {\n    Undefined = 'undefined',\n    Mouse = 'mouse',\n    Touch = 'touch',\n}\n\nexport enum MouseButtonId {\n    Left = 0,\n    Middle = 1,\n    Right = 2,\n}\n\nexport class InputState {\n    /**\n     * The frame this input was down.\n     */\n    private _downFrame: number = -1;\n\n    /**\n     * The frame this input was up.\n     */\n    private _upFrame: number = -1;\n\n    getDownFrame(): number {\n        return this._downFrame;\n    }\n\n    setDownFrame(frame: number) {\n        this._downFrame = frame;\n    }\n\n    getUpFrame(): number {\n        return this._upFrame;\n    }\n\n    setUpFrame(frame: number) {\n        this._upFrame = frame;\n    }\n\n    /**\n     * Is the input down on the requested frame. Will only return true on the exact frame.\n     * @see isHeldOnFrame() for true result for every frame the input is down.\n     * @param frame The frame to compare against.\n     */\n    isDownOnFrame(frame: number): boolean {\n        return frame === this._downFrame;\n    }\n\n    /**\n     * Is the input held on the requested frame. Will return for every frame the input is held down.\n     * @param frame The frame to compare against.\n     */\n    isHeldOnFrame(frame: number): boolean {\n        // Down frame must have been set.\n        if (this._downFrame !== -1) {\n            // Down frame must be more recent than the up frame.\n            if (this._downFrame > this._upFrame) {\n                // Frame must be same or higher than down frame.\n                if (frame >= this._downFrame) {\n                    return true;\n                }\n            }\n        }\n\n        return false;\n    }\n\n    /**\n     * Is the input up on the requested frame. Will only return true on the exact frame.\n     * @param frame The frame to compare against.\n     */\n    isUpOnFrame(frame: number): boolean {\n        return frame === this._upFrame;\n    }\n\n    /**\n     * Returns a new InputState with the same values as this one.\n     */\n    clone(): InputState {\n        let clone = new InputState();\n        clone._downFrame = this._downFrame;\n        clone._upFrame = this._upFrame;\n\n        return clone;\n    }\n}\n\ninterface WheelFrame {\n    /**\n     * The frame that the wheel moved on.\n     */\n    moveFrame: number;\n\n    /**\n     * Wheel delta in a Vector3 format. (x, y, z)\n     */\n    delta: Vector3;\n\n    /**\n     * Is the wheel being invoked with ctrl?\n     * @see https://developer.mozilla.org/en-US/docs/Web/Events/wheel\n     * WheelEvent has a standardized hack that allows trackpad two finger pinching to be detected as WheelEvent + ctrl key.\n     * This boolean indicates whether the ctrl key was detected with the WheelEvent.\n     */\n    ctrl: boolean;\n}\n\n/**\n * Data about the HTML element that was targeted by a click.\n */\nexport interface TargetData {\n    inputDown: HTMLElement;\n    inputUp: HTMLElement;\n    inputOver: HTMLElement;\n}\n\ninterface TouchData {\n    /**\n     * The unique identifier for the touch.\n     */\n    identifier: number;\n\n    /**\n     * The index of the finger for the touch.\n     */\n    fingerIndex: number;\n\n    /**\n     * State of the touch input.\n     */\n    state: InputState;\n\n    /**\n     * Screen position of the touch.\n     */\n    screenPos: Vector2;\n\n    /**\n     * Page position of the touch.\n     */\n    pagePos: Vector2;\n\n    /**\n     * Client position of touch.\n     */\n    clientPos: Vector2;\n}\n\ninterface MouseData {\n    /**\n     * State of the left mouse button.\n     */\n    leftButtonState: InputState;\n\n    /**\n     * State of the right mouse button.\n     */\n    rightButtonState: InputState;\n\n    /**\n     * State of the middle mouse button.\n     */\n    middleButtonState: InputState;\n\n    /**\n     * Screen position of the mouse.\n     */\n    screenPos: Vector2;\n\n    /**\n     * Page position of the mouse.\n     */\n    pagePos: Vector2;\n\n    /**\n     * Client position of mouse.\n     */\n    clientPos: Vector2;\n}\n\n/**\n * Interface for data about a key.\n */\ninterface KeyData {\n    /**\n     * The key that the data is for.\n     */\n    key: string;\n\n    /**\n     * The state of the key.\n     */\n    state: InputState;\n}\n\nclass WheelData {\n    private _wheelFrames: WheelFrame[] = [];\n\n    /**\n     * Add the WheelFrame to the WheelData frame array.\n     * @param wheelFrame\n     */\n    addFrame(wheelFrame: WheelFrame): void {\n        this._wheelFrames.push(wheelFrame);\n    }\n\n    /**\n     * Returns the WheelFrame for the specified frame number.\n     * @param frame The frame number to retrieve.\n     */\n    getFrame(frame: number): WheelFrame {\n        let wheelFrame = find(this._wheelFrames, (f: WheelFrame) => {\n            return f.moveFrame === frame;\n        });\n        if (wheelFrame) return wheelFrame;\n        else return null;\n    }\n\n    /**\n     * Remove all WheelFrame objects that are older than the specified current frame.\n     * @param curFrame The current frame number.\n     */\n    removeOldFrames(curFrame: number): void {\n        if (this._wheelFrames.length === 0) return;\n        // console.log('removeOldFrames wheelFrameCount: ' + this._wheelFrames.length + ', curFrame: ' + curFrame);\n        this._wheelFrames = this._wheelFrames.filter((f: WheelFrame) => {\n            return f.moveFrame >= curFrame;\n        });\n        // console.log('removeOldFrames after filter wheelFrameCount: ' + this._wheelFrames.length);\n    }\n}\n","import { GameObject } from \"../GameObject\";\n\nexport interface IDecoratorOptions {\n}\n\nexport abstract class Decorator {\n\n    static destroy(decorator: Decorator) {\n        if (decorator._destroyed) {\n            return;\n        }\n\n        if (!decorator._willDestroy) {\n            decorator.onWillDestroy();\n        }\n\n        decorator.onDestroy();\n    }\n\n    private _configured: boolean = false;\n    private _willDestroy: boolean = false;\n    private _destroyed: boolean = false;\n    private _started: boolean = false;\n    private _gameObject: GameObject = null;\n\n    get destroyed() { \n        return this._destroyed;\n    }\n\n    get gameObject() { \n        return this._gameObject;\n    }\n\n    get started() {\n        return this._started;\n    }\n\n    configure(option: IDecoratorOptions) {\n        this._configured = true;\n    }\n\n    /**\n     * Called once when the Decorator is attached to a gameObject.\n     */\n    onAttach(gameObject: GameObject) {\n        if (!this._configured) {\n            throw new Error(`[Decorator] ${this.constructor.name} on ${this.gameObject.name} did not have configure() called before being attached to gameObject.`);\n        }\n\n        this._gameObject = gameObject;\n    }\n\n    /**\n     * Called when the GameObject that this Decorator is attached to becomes visible.\n     */\n    onVisible() {\n        // console.log(`[Decorator] ${this.constructor.name} on ${this.gameObject.name} onVisible`);\n    }\n\n    /**\n     * Called when the GameObject that this Decorator is attached to becomes invisible.\n     */\n    onInvisible() {\n        // console.log(`[Decorator] ${this.constructor.name} on ${this.gameObject.name} onInvisible`);\n    }\n\n    /**\n     * Called once when the Decorator is first started.\n     */\n    onStart() {\n        // console.log(`[Decorator] ${this.constructor.name} on ${this.gameObject.name} onStart`);\n        this._started = true;\n    }\n\n    /**\n     * Called for each three js frame.\n     */\n    onUpdate() {\n        // console.log(`[Decorator] ${this.constructor.name} on ${this.gameObject.name} onUpdate`);\n    }\n\n    /**\n     * Called for each three js frame but after all onUpdate calls have been made.\n     */\n    onLateUpdate() {\n        // console.log(`[Decorator] ${this.constructor.name} on ${this.gameObject.name} onLateUpdate`);\n    }\n\n    /**\n     * Called when the GameObject that this Decorator is attached to is marked for destruction.\n     */\n    onWillDestroy() {\n        this._willDestroy = true;\n        // console.log(`[Decorator] ${this.constructor.name} on ${this.gameObject.name} onWillDestroy`);\n    }\n\n    /**\n     * Called once when the Decorator is being destroyed.\n     */\n    protected onDestroy() {\n        this._destroyed = true;\n        // console.log(`[Decorator] ${this.constructor.name} on ${this.gameObject.name} onDestroy`);\n    }\n}","import {\n    Object3D,\n    Scene,\n    Matrix4,\n    Box2,\n    Vector2,\n    Box3,\n    Layers,\n    Mesh,\n    SphereBufferGeometry,\n    BoxBufferGeometry,\n    MeshBasicMaterial,\n    MeshStandardMaterial,\n    Material,\n    Camera,\n    Vector3,\n    Quaternion,\n    Euler\n} from 'three';\n\n/**\n * Set the parent of the object3d.\n * @param object3d the object to re-parent.\n * @param parent the object to parent to.\n * @param scene the scene that these objects exist in.\n */\nexport function setParent(object3d: Object3D, parent: Object3D, scene: Scene) {\n    if (!object3d) return;\n    if (!scene)\n        throw new Error('utils.setParent needs a valid scene parameter.');\n\n    // Detach\n    if (object3d.parent && object3d.parent !== scene) {\n        object3d.applyMatrix4(object3d.parent.matrixWorld);\n        object3d.parent.remove(object3d);\n        scene.add(object3d);\n    }\n\n    // Attach\n    if (parent) {\n        object3d.applyMatrix4(new Matrix4().getInverse(parent.matrixWorld));\n        scene.remove(object3d);\n        parent.add(object3d);\n    }\n\n    object3d.updateMatrixWorld(true);\n}\n\n/**\n * Find the scene object that the given object is parented to.\n * Will return null if no parent scene is found.\n * @param object3d The object to find the parent scene for.\n */\nexport function findParentScene(object3d: Object3D): Scene {\n    if (!object3d) {\n        return null;\n    }\n\n    if (object3d instanceof Scene) {\n        return object3d;\n    } else {\n        return findParentScene(object3d.parent);\n    }\n}\n\n/**\n * Is the object a child of the given parent object.\n * @param parent The parent object that we want to know if the other object is a child of.\n * @param object The object that we want to know if is a child of the parent object.\n */\nexport function isObjectChildOf(object: Object3D, parent: Object3D): boolean {\n    if (!parent || !object.parent) {\n        return false;\n    }\n\n    if (object.parent === parent) {\n        return true;\n    } else {\n        return isObjectChildOf(object.parent, parent);\n    }\n}\n\n/**\n * Convert the Box3 object to a box2 object. Basically discards the z components of the Box3's min and max.\n * @param box3 The Box3 to convert to a Box2.\n */\nexport function convertToBox2(box3: Box3): Box2 {\n    return new Box2(\n        new Vector2(box3.min.x, box3.min.y),\n        new Vector2(box3.max.x, box3.max.y)\n    );\n}\n\n/**\n * Set the layer number that the given object 3d is on (and optionally all of its children too).\n * @param obj The root object 3d to change the layer.\n * @param layer The layer to set the object 3d to.\n * @param children Should change all children of given object 3d as well?\n */\nexport function setLayer(obj: Object3D, layer: number, children?: boolean) {\n    obj.layers.set(layer);\n    if (children) {\n        traverseSafe(obj, (child) => child.layers.set(layer));\n    }\n}\n\n/**\n * Set the layer mask of the given object 3d (and optionally all of its children too).\n * @param obj The root object 3d to change the layer.\n * @param layerMask The layer mask to set the object 3d to.\n * @param children Should change all children of given object 3d as well?\n */\nexport function setLayerMask(\n    obj: Object3D,\n    layerMask: number,\n    children?: boolean\n) {\n    obj.layers.mask = layerMask;\n    if (children) {\n        traverseSafe(obj, (child) => child.layers.mask = layerMask);\n    }\n}\n\n/**\n * Debug print out all 32 layers for this object and wether or not it belongs to them.\n * @param obj The object to print out layers for.\n */\nexport function debugLayersToString(obj: Object3D): string {\n    if (!obj) return;\n\n    let output: string = '\\n';\n    for (let i = 0; i < 32; i++) {\n        let l = new Layers();\n        l.set(i);\n        output += '[' + i + ']  ' + obj.layers.test(l) + '\\n';\n    }\n\n    return output;\n}\n\nexport function isObjectVisible(obj: Object3D) {\n    if (!obj) {\n        return false;\n    }\n    while (obj) {\n        if (!obj.visible) {\n            return false;\n        }\n        obj = obj.parent;\n    }\n    return true;\n}\n\nexport function disposeObject3d<T extends Object3D>(obj: T) {\n    if (obj) {\n        traverseSafe(obj, (o) => {\n            if (o instanceof Mesh) {\n                if (o.geometry) {\n                    o.geometry.dispose();\n                }\n                \n                if (Array.isArray(o.material)) {\n                    o.material.forEach((m) => m.dispose());\n                } else {\n                    o.material.dispose();\n                }\n            }\n    \n            if (o.parent) {\n                o.parent.remove(o);\n            }\n        });\n    }\n}\n\n/**\n * Dispose of each object 3d in the array and then clear the array.\n */\nexport function disposeObject3ds(objs: Object3D[]) {\n    if (objs && objs.length > 0) {\n        for (let i = 0; i < objs.length; i++) {\n            disposeObject3d(objs[i]);\n        }\n        objs = [];\n    }\n}\n\nexport function createDebugSphere(radius: number, color: string, lit?: boolean): Mesh {\n    const geometry = new SphereBufferGeometry(radius, 24, 24);\n    let material: Material;\n\n    if (lit) {\n        material = new MeshStandardMaterial({\n            color,\n        });\n    } else {\n        material = new MeshBasicMaterial({\n            color,\n        });\n    }\n\n    return new Mesh(geometry, material);\n}\n\nexport function createDebugCube(size: number, color: string, lit?: boolean): Mesh {\n    const geometry = new BoxBufferGeometry(size, size, size);\n    let material: Material;\n\n    if (lit) {\n        material = new MeshStandardMaterial({\n            color,\n        });\n    } else {\n        material = new MeshBasicMaterial({\n            color,\n        });\n    }\n\n    return new Mesh(geometry, material);\n}\n\nexport function worldToScreenPosition(target: Object3D | Vector3, camera: Camera): Vector2 {\n    const pos = new Vector3();\n    \n    if (target instanceof Object3D) {\n        pos.setFromMatrixPosition(target.matrixWorld);\n    } else {\n        pos.copy(target);\n    }\n\n    pos.project(camera);\n\n    const halfWidth = window.innerWidth * 0.5;\n    const halfHeight = window.innerHeight * 0.5;\n\n    pos.x = (pos.x * halfWidth) + halfWidth;\n    pos.y = -(pos.y * halfHeight) + halfHeight;\n    pos.z = 0;\n\n    return new Vector2(pos.x, pos.y);\n}\n\n/**\n * Return the world direction for the given local direction from the object's perspective.\n * @param localDirection The local direction.\n * @param obj The object to return the world direction for.\n */\nexport function objectWorldDirection(\n    localDirection: Vector3,\n    obj: Object3D\n): Vector3 {\n    const worldRotation = new Quaternion();\n    worldRotation.setFromRotationMatrix(obj.matrixWorld);\n    const forward = localDirection.clone().applyQuaternion(worldRotation);\n    return forward;\n}\n\nexport function getMaterials(mesh: Mesh): Material[] {\n    if (Array.isArray(mesh.material)) {\n        return mesh.material;\n    } else {\n        return [mesh.material];\n    }\n}\n\nexport function getWorldPosition(object3d: Object3D): Vector3 {\n    const worldPos = new Vector3();\n    object3d.getWorldPosition(worldPos);\n    return worldPos;\n}\n\nexport function setWorldPosition(object3d: Object3D, target: Vector3 | Object3D): void {\n    const scene = findParentScene(object3d);\n\n    if (!scene) {\n        console.error(`Cannot set world position of object3d ${object3d.name} because it is not attached to a scene.`);\n        return;\n    }\n\n    let matrixWorld: Matrix4;\n\n    if (target instanceof Vector3) {\n        matrixWorld = new Matrix4();\n        matrixWorld.setPosition(target);\n    } else {\n        matrixWorld = target.matrixWorld;\n    }\n\n    const prevParent = object3d.parent;\n    scene.attach(object3d);\n    object3d.position.setFromMatrixPosition(matrixWorld);\n    prevParent.attach(object3d);\n}\n\nexport function rotationToFace(object3d: Object3D, worldPos: Vector3): Quaternion {\n    const dummy = new Object3D();\n\n    if (object3d.parent) {\n        object3d.parent.add(dummy);\n    }\n\n    setWorldPosition(dummy, object3d);\n    dummy.rotation.copy(object3d.rotation);\n    dummy.scale.copy(object3d.scale);\n\n    dummy.lookAt(worldPos);\n\n    const faceRotation = dummy.quaternion.clone();\n\n    if (dummy.parent) {\n        dummy.parent.remove(dummy);\n    }\n\n    return faceRotation;\n}\n\n/**\n * Same function as Object3D.traverse except that it does not execute on children that have become undefined like the built-in function does.\n */\nexport function traverseSafe(object3d: Object3D, callback: (object3d: Object3D) => void) {\n    callback(object3d);\n\n    const children = object3d.children;\n    for (let i = 0, l = children.length; i < l; i++) {\n        if (children[i]) {\n            traverseSafe(children[i], callback);\n        }\n    }\n}\n\n/**\n * Same function as Object3D.traverseVisible except that it does not execute on children that have become undefined like the built-in function does.\n */\nexport function traverseVisibleSafe(object3d: Object3D, callback: (object3d: Object3D) => void) {\n\n    if (object3d.visible === false) return;\n\n    callback(object3d);\n\n    const children = object3d.children;\n    for (let i = 0, l = children.length; i < l; i++) {\n        if (children[i]) {\n            traverseVisibleSafe(children[i], callback);\n        }\n    }\n}","import { Object3D, Scene } from \"three\";\nimport { Decorator } from \"./decorators/Decorator\";\nimport { traverseSafe, traverseVisibleSafe } from \"../utils/ThreeUtils\";\n\n\nenum DestroyState {\n    None = -1,\n    WillDestroy = 0,\n    Destroyed = 1\n}\n\n/**\n * GameObject is an APEngine specific implemention of Three's Object3D class that supports decorators.\n */\nexport class GameObject extends Object3D {\n\n    private static __APEngine_destroyQueue: GameObject[] = [];\n\n    /**\n     * Destroy the given GameObject and all of its children.\n     */\n    static destroy(gameObject: GameObject): void {\n        // Get array of all child gameObjects in ascending order,\n        // including the given gameObject.\n        traverseSafe(gameObject, (go) => {\n            if (go instanceof GameObject) {\n                if (go._destroyState === DestroyState.None) {\n                    GameObject.__APEngine_destroyQueue.push(go);\n                    go._destroyState = DestroyState.WillDestroy;\n\n                    // Inform all gameObject decorators that it will be destroyed.\n                    go._decorators.forEach(d => d.onWillDestroy());\n                }\n            }\n        });\n    }\n\n    /**\n     * Process the GameObject destroy queue.\n     * This should ONLY be called by APEngine.\n     */\n    static __APEngine_ProcessGameObjectDestroyQueue() {\n        if (this.__APEngine_destroyQueue.length > 0) {\n            // Use a copy of the destroy queue in its current state so that \n            // any modifications to the destroy queue during processing are not affected.\n            const count = this.__APEngine_destroyQueue.length;\n\n            for (let i = 0; i < count; i++) {\n                const gameObject = this.__APEngine_destroyQueue.pop();\n                if (gameObject && gameObject._destroyState === DestroyState.WillDestroy) {\n                    // Infrom the gameobject that it is being destroyed.\n                    gameObject.onDestroy();\n\n                    gameObject._destroyState = DestroyState.Destroyed;\n                }\n            }\n        }\n    }\n\n    /**\n     * Is the given GameObject visible to rendering?\n     * This function taked into account the visibility of the gameObject's parents.\n     */\n    static isGameObjectVisible(gameObject: GameObject) {\n        let obj = gameObject as Object3D;\n\n        if (!obj) {\n            return false;\n        }\n        while (obj) {\n            if (!obj.visible) {\n                return false;\n            }\n            obj = obj.parent;\n        }\n        return true;\n    }\n\n    /**\n     * Find the GameObject that is a parent of the given object.  \n     * If the object is a GameObject, then the object itself is returned.  \n     * If the object has no GameObject parents, then null is returned.\n     */\n    static findParentGameObject(obj: Object3D): GameObject {\n        if (obj instanceof GameObject) {\n            return obj;\n        }\n        if (obj.parent) {\n            return GameObject.findParentGameObject(obj.parent);\n        }\n        return null;\n    }\n\n    /**\n     * Find a GameObject that has the given name at or underneath the given root/scene.\n     */\n    static findGameObjectByName(root: Object3D | Scene, name: string): GameObject {\n        if (root instanceof GameObject && root.name === name) {\n            return root;\n        }\n\n        for (let child of root.children) {\n            const go = GameObject.findGameObjectByName(child, name);\n            if (go) {\n                return go;\n            }\n        }\n\n        return null;\n    }\n\n    private _decorators: Decorator[] = [];\n    private _destroyState: DestroyState = DestroyState.None;\n    private _prevVisible: boolean = false;\n\n    get destroyed(): boolean {\n        return this._destroyState !== DestroyState.None;\n    }\n\n    constructor(name?: string) {\n        super();\n        \n        if (name) {\n            this.name = name;\n        }\n    }\n\n    addDecorator<T extends Decorator>(decorator: T): T {\n        if (this._decorators.some((d) => d === decorator)) {\n            // Decorator is already added.\n            return;\n        }\n\n        // Add decorator to the array.\n        this._decorators.push(decorator);\n        decorator.onAttach(this);\n\n        return decorator;\n    }\n\n    getDecorator<T extends Decorator>(type: { new(): T }): T {\n        if (!this.destroyed) {\n            for (let i = 0; i < this._decorators.length; i++) {\n                const decorator = this._decorators[i];\n                if (decorator instanceof type && !decorator.destroyed) {\n                    return decorator;\n                }\n            }\n        }\n\n        return null;\n    }\n\n    getDecorators<T extends Decorator>(type: { new(): T }): T[] {\n        let decorators: T[] = [];\n\n        if (!this.destroyed) {\n            for (let i = 0; i < this._decorators.length; i++) {\n                const decorator = this._decorators[i];\n                if (decorator instanceof type && !decorator.destroyed) {\n                    decorators.push(decorator);\n                }\n            }\n        }\n\n        if (decorators.length > 0) {\n            return decorators;\n        } else {\n            return null;\n        }\n    }\n\n    getDecoratorInChildren<T extends Decorator>(type: { new(): T }, includeInvisible?: boolean): T {\n        // Check this gameObject for matching decorator.\n        if (includeInvisible || this.visible) {\n            const decorator = this.getDecorator(type);\n            if (decorator) {\n                return decorator;\n            }\n        }\n\n        // Recursively search through child gameObjects for matching decorator.\n        for (const child of this.children) {\n            if (child instanceof GameObject) {\n                const decorator = child.getDecoratorInChildren(type, includeInvisible);\n                if (decorator) {\n                    return decorator;\n                }\n            }\n        }\n\n        // No matching decorator found in this gameObject or its children.\n        return null;\n    }\n\n    getDecoratorsInChildren<T extends Decorator>(type: { new(): T }, includeInvisible?: boolean): T[] {\n        const decorators: T[] = [];\n\n        if (!includeInvisible) {\n            traverseVisibleSafe(this, (o) => {\n                if (o instanceof GameObject) {\n                    const decs = o.getDecorators(type);\n                    if (decs) {\n                        decorators.push(...decs);\n                    }\n                }\n            });\n        } else {\n            traverseSafe(this, (o) => {\n                if (o instanceof GameObject) {\n                    const decs = o.getDecorators(type);\n                    if (decs) {\n                        decorators.push(...decs);\n                    }\n                }\n            });\n        }\n\n        if (decorators.length > 0) {\n            return decorators;\n        } else {\n            return null;\n        }\n    }\n    \n    getDecoratorInParent<T extends Decorator>(type: { new(): T }, includeInvisible?: boolean): T {\n        // Check this gameObject for matching decorator.\n        if (includeInvisible || this.visible) {\n            const decorator = this.getDecorator(type);\n            if (decorator) {\n                return decorator;\n            }\n        }\n\n        // Recursively search through parent gameObjects for matching decorator.\n        if (this.parent && this.parent instanceof GameObject) {\n            const decorator = this.parent.getDecoratorInParent(type, includeInvisible);\n            if (decorator) {\n                return decorator;\n            }\n        }\n\n        // No matching decorator found in this gameObject or its parents.\n        return null;\n    }\n\n    /**\n     * Called for each three js frame.\n     */\n    onUpdate() {\n        if (this.destroyed) {\n            return;\n        }\n\n        let isVisible = GameObject.isGameObjectVisible(this);\n\n        this._decorators.forEach((d) => {\n            if (!d.destroyed && isVisible) {\n                if (!d.started) {\n                    this._prevVisible = true;\n                    d.onVisible();\n                    d.onStart();\n                    if (!d.started) {\n                        console.error(`Decorator ${d.constructor.name} does not have super.onStart() called.`);\n                    }\n                } else {\n                    isVisible = this.visibleChangeCheck();\n                }\n\n                if (isVisible) {\n                    d.onUpdate();\n                }\n            }\n        });\n\n        this.cleanupDestroyedDecorators();\n    }\n\n    /**\n     * Called for each three js frame but after all onUpdate calls have been made.\n     */\n    onLateUpdate() {\n        if (this.destroyed) {\n            return;\n        }\n\n        const isVisible = this.visibleChangeCheck();\n\n        this._decorators.forEach((d) => {\n            if (!d.destroyed && isVisible) {\n                d.onLateUpdate();\n            }\n        });\n\n        this.cleanupDestroyedDecorators();\n    }\n\n    /**\n     * Run a visibility change check. Returns the current state of gameobject visibility.\n     */\n    private visibleChangeCheck(): boolean {\n        const isVisible = GameObject.isGameObjectVisible(this);\n\n        if (this._prevVisible !== isVisible) {\n            this._decorators.forEach((d) => {\n                if (!d.destroyed) {\n                    if (isVisible) {\n                        d.onVisible();\n                    } else {\n                        d.onInvisible();\n                    }\n                }\n            });\n            this._prevVisible = isVisible;\n        }\n\n        return isVisible;\n    }\n\n    private onDestroy() {\n        // Destroy our decorators.\n        this._decorators.forEach((c) => {\n            Decorator.destroy(c);\n        });\n        this._decorators = [];\n\n        if (this.parent) {\n            // Remove ourself from parent object (and thus the scene).\n            this.parent.remove(this);\n        }\n    }\n\n    private cleanupDestroyedDecorators() {\n        this._decorators = this._decorators.filter((c) => {\n            return !c.destroyed;\n        });\n    }\n}","import { IDisposable } from \"../misc/IDisposable\";\nimport { \n    Group,\n    WebGLRenderer,\n    Vector3,\n    Quaternion\n} from \"three\";\nimport { ArgEvent } from '../misc/Events';\n\nexport interface ControllerPose {\n    position: Vector3;\n    rotation: Quaternion;\n    scale: Vector3;\n}\n\nexport class XRInput implements IDisposable {\n\n    controller: Group;\n\n    private _renderer: WebGLRenderer;\n\n    onSelectStart = new ArgEvent<ControllerPose>();\n    onSelect = new ArgEvent<ControllerPose>();\n    onSelectEnd = new ArgEvent<ControllerPose>();\n\n    constructor(renderer: WebGLRenderer) {\n        this._renderer = renderer;\n\n        this._onControllerSelectStart = this._onControllerSelectStart.bind(this);\n        this._onControllerSelect = this._onControllerSelect.bind(this);\n        this._onControllerSelectEnd = this._onControllerSelectEnd.bind(this);\n\n        // Setup AR controller.\n        this.controller = this._renderer.xr.getController(0);\n        this.controller.addEventListener('selectstart', this._onControllerSelectStart);\n        this.controller.addEventListener('select', this._onControllerSelect);\n        this.controller.addEventListener('selectend', this._onControllerSelectEnd);\n    }\n\n    /**\n     * Return the controller's pose at the current time.\n     * This is a snapshot of the controller's pose and will not change as the controller moves.\n     */\n    getCurrentControllerPose(): ControllerPose {\n        if (this.controller) {\n            const controllerPose: ControllerPose = {\n                position: new Vector3(),\n                rotation: new Quaternion(),\n                scale: new Vector3()\n            };\n\n            this.controller.matrixWorld.decompose(controllerPose.position, controllerPose.rotation, controllerPose.scale);\n            return controllerPose;\n        } else {\n            return null;\n        }\n    }\n\n    dispose(): void {\n        if (this.controller) {\n            this.controller.removeEventListener('selectstart', this._onControllerSelectStart);\n            this.controller.removeEventListener('select', this._onControllerSelect);\n            this.controller.removeEventListener('selectend', this._onControllerSelectEnd);\n        }\n    }\n\n    private _onControllerSelectStart() {\n        this.onSelectStart.invoke(this.getCurrentControllerPose());\n    }\n\n    private _onControllerSelect() {\n        this.onSelect.invoke(this.getCurrentControllerPose());\n    }\n\n\n    private _onControllerSelectEnd() {\n        this.onSelectEnd.invoke(this.getCurrentControllerPose());\n    }\n\n}","import Stats from 'stats.js';\nimport { IDisposable } from './IDisposable';\n\ndeclare type StatsPosition = 'top left' | 'top right' | 'bottom left' |'bottom right';\nexport class PerformanceStats implements IDisposable {\n\n    private _enabled: boolean = false;\n    private _position: StatsPosition = null;\n    private _stats: Stats | null = null;\n\n    get enabled() {\n        return this._enabled;\n    }\n\n    set enabled(enable: boolean) {\n        if (this._enabled !== enable) {\n            this._enabled = enable;\n\n            if (this._enabled) {\n                this._onEnable();\n            } else {\n                this._onDisable();\n            }\n        }\n    }\n\n    get position() {\n        return this._position;\n    }\n\n    set position(pos: StatsPosition) {\n        if (this._position !== pos) {\n            this._position = pos;\n            this._updatePosition();\n        }\n    }\n\n    constructor() {\n        this._onEnable = this._onEnable.bind(this);\n        this._onDisable = this._onDisable.bind(this);\n    }\n\n    update() {\n        if (this._enabled) {\n            this._stats.update();\n        }\n    }\n\n    dispose() {\n        this.enabled = false;\n    }\n\n    private _onEnable() {\n        this._stats = new Stats();\n        this._stats.showPanel(0);\n        document.body.appendChild(this._stats.dom);\n        this._updatePosition();\n    }\n\n    private _onDisable() {\n        document.body.removeChild(this._stats.dom);\n        this._stats = null;\n    }\n\n    private _updatePosition() {\n        if (!this._stats) {\n            return;\n        }\n\n        let pos = this._position;\n        if (!pos) {\n            pos = 'bottom left';\n        }\n\n        if (pos === 'top left') {\n            this._stats.dom.style.top = '0px';\n            this._stats.dom.style.left = '0px';\n            this._stats.dom.style.right = '';\n            this._stats.dom.style.bottom = '';\n        } else if (pos === 'top right') {\n            this._stats.dom.style.top = '0px';\n            this._stats.dom.style.left = '';\n            this._stats.dom.style.right = '0px';\n            this._stats.dom.style.bottom = '';\n        } else if (pos === 'bottom left') {\n            this._stats.dom.style.top = '';\n            this._stats.dom.style.left = '0px';\n            this._stats.dom.style.right = '';\n            this._stats.dom.style.bottom = '0px';\n        } else if (pos === 'bottom right') {\n            this._stats.dom.style.top = '';\n            this._stats.dom.style.left = '';\n            this._stats.dom.style.right = '0px';\n            this._stats.dom.style.bottom = '0px';\n        }\n    }\n}","\n\nexport function hasValue(obj: any): boolean {\n    return obj !== undefined && obj !== null;\n}\n\nexport function getOptionalValue<T>(obj: T, defaultValue: T): T {\n    return obj !== undefined && obj !== null ? obj : defaultValue;\n}\n\n/**\n * Post the given data object as JSON to the provided URL.\n * @returns - Promise that resolves to a Response or null if an exception occured.\n */\nexport async function postJsonData(url: string, data: any): Promise<Response> {\n    console.log(`[postJsonData] start...`);\n\n    const headers = new Headers();\n    headers.set('Content-Type', 'application/json');\n\n    const init: RequestInit = {\n        method: 'POST',\n        body: JSON.stringify(data),\n        mode: 'cors',\n        headers: headers,\n\n    }\n\n    const request = new Request(url, init);\n    console.log(request);\n\n    try {\n        // Until aux is CORS enabled, the response will always be opaque and thus checking the response for anything is pointless.\n        const response = await fetch(request);\n        console.log(`[postJsonData] response received.`);\n        return response;\n    } catch (error) {\n        console.error(`[postJsonData] Could not fetch. error: ${error}`);\n        return null;\n    }\n}\n\n/**\n * Search through element's descendents and return the first child element that contains the given class name(s). \n * An element must contain all of the given class names in order to be matched.\n * @param element The element to search the descendents of.\n * @param className The class name(s) to search for. Can be either a single class name or many.\n */\nexport function getElementByClassName(element: Element, names: string): HTMLElement {\n    if (element instanceof HTMLElement) {\n        // Check element for class names.\n        const elementClassList: DOMTokenList = element.classList;\n\n        if (elementClassList.length > 0) {\n            const classNames: string[] = names.split(' ');\n            let classFoundCount: number = 0;\n\n            for (const className of classNames) {\n                if (elementClassList.contains(className)) {\n                    classFoundCount++;\n\n                    if (classFoundCount === classNames.length) {\n                        return element;\n                    }\n                }\n            }\n        }\n    }\n\n    // Check descendents of element.\n    const children = element.children;\n    for (let i = 0; i < children.length; i++) {\n        const match = getElementByClassName(children[i], names);\n        if (match !== null) {\n            return match;\n        }\n    }\n\n    // No matching element.\n    return null;\n}\n\nexport function getFilename(path: string): string | null {\n    const lastSlashIndex = path.lastIndexOf('/');\n\n    let filename: string | null = null;\n    if (lastSlashIndex < 0) {\n        filename = path;\n    } else {\n        filename = path.substr(lastSlashIndex + 1);\n    }\n\n    // Make sure that it is a file by check for an extension.\n    const ext = getExtension(filename);\n\n    if (ext !== null) {\n        return filename;\n    } else {\n        return null;\n    }\n}\n\nexport function getExtension(path: string): string | null {\n    if (path.includes('.')) {\n        const ext = path.split('.').pop();\n\n        if (ext) {\n            if (!ext.includes('/')) {\n                return ext;\n            }\n        }\n    }\n\n    return null;\n}\n\n/**\n * Load the image from the given url (or from the cache if the browser as it stored).\n * @param url Location of the image to load.\n */\nexport async function loadImage(url: string, onProgress?: (event: ProgressEvent<EventTarget>) => void): Promise<HTMLImageElement> {\n    return new Promise<HTMLImageElement>(((resolve: (value: HTMLImageElement) => void, reject) => {\n        const img: HTMLImageElement = new Image();\n\n        img.addEventListener('load', (event) => {\n            resolve(img);\n        });\n        \n        img.addEventListener('progress', (event) => {\n            if (onProgress) {\n                onProgress(event);\n            }\n        })\n\n        img.addEventListener('error', (event) => {\n            reject(event);\n        });\n        \n        img.src = url;\n    }));\n}\n\nexport function copyToClipboard(text: string): void {\n    // Create text area element to contain text content.\n    const textArea = document.createElement('textarea');\n    textArea.style.position = 'fixed';\n    textArea.style.opacity = '0';\n    textArea.textContent = text;\n    document.body.appendChild(textArea);\n\n    // Select text area element and execute document's copy command.\n    textArea.select();\n    document.execCommand('copy');\n\n    // Remove text area element from document.\n    textArea.remove();\n}\n\nexport function appendLine(text: string, line: string): string {\n    if (!text || text.length === 0) {\n        return line;\n    } else if (text.length > 0) {\n        text += `\\n${line}`;\n    }\n\n    return text;\n}\n\nexport function sortAZ<T, K extends keyof T>(array: T[], propertyKey: K): void {\n    array.sort((a, b) => {\n        return a[propertyKey] > b[propertyKey] ? 1 : -1\n    });\n}\n\nexport function sortZA<T, K extends keyof T>(array: T[], propertyKey: K): void {\n    array.sort((a, b) => {\n        return a[propertyKey] < b[propertyKey] ? 1 : -1\n    });\n}","import { Vector3, Vector2, MathUtils } from \"three\";\nimport { hasValue } from \"./MiscUtils\";\n\nexport const Vector3_Up = new Vector3(0, 1, 0);\nexport const Vector3_Down = new Vector3(0, -1, 0);\nexport const Vector3_Forward = new Vector3(0, 0, 1);\nexport const Vector3_Back = new Vector3(0, 0, -1);\nexport const Vector3_Left = new Vector3(-1, 0, 0);\nexport const Vector3_Right = new Vector3(1, 0, 0);\nexport const Vector3_Zero = new Vector3(0, 0, 0);\nexport const Vector3_One = new Vector3(1, 1, 1);\n\nexport function interpolate(start: number, end: number, progress: number, ease?: (t: number) => number): number {\n    if (ease) {\n        progress = ease(progress);\n    }\n\n    return (1 - progress) * start + progress * end;\n}\n\nexport function interpolateClamped(start: number, end: number, progress: number, ease?: (t: number) => number): number {\n    const value = interpolate(start, end, progress, ease);\n    return clamp(value, start, end);\n}\n\nexport function clamp(value: number, min?: number, max?: number): number {\n    if (hasValue(min) && value < min) {\n        value = min;\n    }\n    if (hasValue(max) && value > max) {\n        value = max;\n    }\n\n    return value;\n}\n\nexport function inRange(value: number, min: number, max: number): boolean {\n    if (value <= max && value >= min) {\n        return true;\n    } else {\n        return false;\n    }\n}\n\nexport function isEven(value: number): boolean {\n    return value % 2 === 0;\n}\n\nexport function isOdd(value: number): boolean {\n    return !isEven(value);\n}\n\nexport function clampDegAngle(value: number, min: number, max: number): number {\n    if (value < -360)\n        value += 360;\n    if (value > 360)\n        value -= 360;\n    return clamp(value, min, max);\n}\n\nexport function pointOnSphere(center: Vector3, radius: number, rotation: Vector2): Vector3 {\n    /*\n        Reference: https://stackoverflow.com/questions/11819833/finding-3d-coordinates-from-point-with-known-xyz-angles-radius-and-origin\n        x = origin.x + radius * math.cos(math.rad(rotation.y)) * math.cos(math.rad(rotation.x))\n        y = origin.y + radius * math.sin(math.rad(rotation.x)) \n        z = origin.z + radius * math.sin(math.rad(rotation.y)) * math.cos(math.rad(rotation.x))\n     */\n\n    const pos = new Vector3();\n    pos.x = center.x + radius * Math.cos(MathUtils.DEG2RAD * rotation.y) * Math.cos(MathUtils.DEG2RAD * rotation.x);\n    pos.y = center.y + radius * Math.sin(MathUtils.DEG2RAD * rotation.x);\n    pos.z = center.z + radius * Math.sin(MathUtils.DEG2RAD * rotation.y) * Math.cos(MathUtils.DEG2RAD * rotation.x);\n\n    return pos;\n}\n\nexport function pointOnCircle(center: Vector2, radius: number, angle: number): Vector2 {\n    const angleRad: number = angle * MathUtils.DEG2RAD;\n\n    const point = new Vector2(\n        center.x + radius * Math.sin(angleRad),\n        center.y + radius * Math.cos(angleRad)\n    );\n\n    return point;\n}\n\n/**\n * Tests if point is inside the given polygon. Test is done in 2d space.\n * Reference: https://codepen.io/prisoner849/pen/ROdXzw?editors=1010\n */\nexport function pointInPolygon2D(point: Vector2, polyPoints: Vector2[]): boolean {\n\n    const x = point.x;\n    const y = point.y;\n\n    let inside = false;\n    for (let i = 0, j = polyPoints.length - 1; i < polyPoints.length; j = i++) {\n        let xi = polyPoints[i].x,\n            yi = polyPoints[i].y;\n        let xj = polyPoints[j].x,\n            yj = polyPoints[j].y;\n\n        let intersect = ((yi > y) != (yj > y)) &&\n            (x < (xj - xi) * (y - yi) / (yj - yi) + xi);\n        if (intersect) inside = !inside;\n    }\n\n    return inside;\n}\n\nexport function calculateRowOffsets(rowLength: number, cellWidth: number, alignment: 'start' | 'center' | 'end'): number[] {\n    if (rowLength <= 0) {\n        return [];\n    }\n\n    const totalWidth: number = (rowLength - 1) * cellWidth;\n\n    // Our start x and offset will be different based on which how we want to align the children.\n    let startX: number;\n    let offset: number;\n    if (alignment == 'start') {\n        startX = 0;\n        offset = -cellWidth;\n    } else if (alignment == 'center') {\n        startX = -(totalWidth * 0.5);\n        offset = cellWidth;\n    } else {\n        startX = 0;\n        offset = cellWidth;\n    }\n\n    const rowOffsets: number[] = [];\n    for (let i = 0; i < rowLength; i++) {\n        rowOffsets.push(\n            startX + (offset * i)\n        );\n    }\n\n    return rowOffsets;\n}\n\nexport function normalize(value: number, min: number, max: number): number {\n    return (value - min) / (max - min);\n}\n\nexport function normalizeClamped(value: number, min: number, max: number): number {\n    value = clamp(value, min, max);\n    return (value - min) / (max - min);\n}\n\nexport function unnormalize(normal: number, min: number, max: number): number {\n    return normal * (max - min) + min;\n}\n\nexport function unnormalizeClamped(normal: number, min: number, max: number): number {\n    normal = clamp(normal, 0.0, 1.0);\n    return normal * (max - min) + min;\n}\n\nexport function calculateFrustumPlanes(size: number, aspect: number): { left: number, right: number, top: number, bottom: number } {\n    return {\n        left: - size * aspect / 2,\n        right: size * aspect / 2,\n        top: size / 2,\n        bottom: - size / 2,\n    }\n}\n\n/**\n * Split integer number into an array of mostly equal parts.\n * @example \n * splitInteger(10, 3) // [4, 3, 3]\n * splitInteger(142, 5) // [29, 29, 28, 28, 28]\n */\nexport function splitInteger(num: number, parts: number): number[] {\n    if (!Number.isInteger(num)) {\n        return null;\n    }\n    if (num < parts) {\n        return null;\n    } \n\n    const mod = num % parts;\n    const splitArray: number[] = [];\n    \n    if (mod === 0) {\n        const value = num / parts;\n        for (let i = 0; i < parts; i++) {\n            splitArray.push(value);\n        }\n\n        return splitArray;\n    } else {\n        const value = (num - mod) / parts;\n        for (let i = 0; i < parts; i++) {\n            splitArray.push(value);\n        }\n\n        for(let i =0; i < mod; i++) {\n            splitArray[i] = splitArray[i] + 1;\n        }\n\n        return splitArray;\n    }\n}","import { WebGLRenderer } from \"three\";\nimport { clamp } from \"../utils/MathUtils\";\nimport { hasValue } from '../utils/MiscUtils';\n\nexport interface IParams {\n    startEnabled?: boolean;\n    targetFramerate?: number;\n    targetPixelRatio?: number;\n    minimumPixelRatio?: number;\n    pixelRatioAdjustRate?: number;\n}\n\nexport class PerformanceResolutionScalar {\n    enabled: boolean = true;\n    targetFramerate: number = 60;\n    targetPixelRatio: number;\n    minimumPixelRatio: number = 0.5;\n    pixelRatioAdjustRate: number = 0.01;\n    debugUI: PerformanceResolutionScalarDebugUI;\n\n    private _renderer: WebGLRenderer;\n    private _lastFrameTimestamp: number = -1;\n    private _lastFrameTime: number = -1;\n\n    constructor(renderer: WebGLRenderer, options?: IParams) {\n        this._renderer = renderer;\n\n        this.debugUI = new PerformanceResolutionScalarDebugUI();\n        this.debugUI.visible = false;\n\n        if (!options) {\n            options = {};\n        }\n\n        if (hasValue(options.startEnabled)) {\n            this.enabled = options.startEnabled;\n        }\n\n        if (hasValue(options.targetFramerate)) {\n            this.targetFramerate = options.targetFramerate;\n        }\n\n        if (hasValue(options.targetPixelRatio)) {\n            this.targetPixelRatio = options.targetPixelRatio;\n        } else {\n            this.targetPixelRatio = renderer.getPixelRatio();\n        }\n\n        if (hasValue(options.minimumPixelRatio)) {\n            this.minimumPixelRatio = options.minimumPixelRatio;\n        }\n\n        if (hasValue(options.pixelRatioAdjustRate)) {\n            this.pixelRatioAdjustRate = options.pixelRatioAdjustRate;\n        }\n    }\n\n    update(): void {\n        const frameTimestamp = performance.now();\n\n        if (this._lastFrameTimestamp > 0 && this.enabled) {\n            const currentFrameTime = frameTimestamp - this._lastFrameTimestamp;\n            const targetFrameTime = Math.ceil(1000 / this.targetFramerate);\n            this.debugUI.customText(\n                \"targetTime\",\n                `Target Frame Time: ${targetFrameTime.toFixed(2)}`\n            );\n\n            // Reference: https://software.intel.com/en-us/articles/dynamic-resolution-rendering-article/\n            const t = (targetFrameTime - currentFrameTime) / targetFrameTime;\n            this.debugUI.customText(\"t\", `T: ${t.toFixed(2)}`);\n\n            let ratioDelta = 0;\n            if (t < 0) {\n                ratioDelta = -this.pixelRatioAdjustRate;\n            } else if (t > 0) {\n                ratioDelta = this.pixelRatioAdjustRate;\n            }\n            // const ratioDelta: number =\n            // this.pixelRatioAdjustRate * this._renderer.getPixelRatio() * t;\n            this.debugUI.customText(\n                \"ratioDelta\",\n                `Ratio Delta: ${ratioDelta.toFixed(2)}`\n            );\n\n            if (ratioDelta !== 0) {\n                // Apply pixel ratio adjustment.\n                const newPixelRatio = clamp(\n                    this._renderer.getPixelRatio() + ratioDelta,\n                    this.minimumPixelRatio,\n                    this.targetPixelRatio\n                );\n\n                // console.log(`new pixel ratio: ${newPixelRatio}`);\n\n                if (this._renderer.getPixelRatio() !== newPixelRatio) {\n                    // console.log(\"new pixel ratio: \" + newPixelRatio);\n                    this._renderer.setPixelRatio(newPixelRatio);\n                }\n            }\n\n            this._lastFrameTime = currentFrameTime;\n        }\n\n        this._lastFrameTimestamp = frameTimestamp;\n        this.debugUI.update(this);\n    }\n\n    getCurrentPixelRatio(): number {\n        return this._renderer.getPixelRatio();\n    }\n\n    getLastFrameTime(): number {\n        return this._lastFrameTime;\n    }\n}\n\nclass PerformanceResolutionScalarDebugUI {\n    private _rootEl: HTMLDivElement;\n    private _pixelRatioEl: HTMLParagraphElement;\n    private _minMaxEl: HTMLParagraphElement;\n    private _frameTimeEl: HTMLParagraphElement;\n\n    private _customTextMap: Map<string, HTMLParagraphElement>;\n\n    get visible(): boolean {\n        return this._rootEl.style.display === \"block\";\n    }\n\n    set visible(visible: boolean) {\n        this._rootEl.style.display = visible ? \"block\" : \"none\";\n    }\n\n    constructor() {\n        this._rootEl = document.createElement(\"div\");\n        document.body.appendChild(this._rootEl);\n        this._rootEl.style.position = \"absolute\";\n        this._rootEl.style.left = 0 + \"px\";\n        this._rootEl.style.bottom = 0 + \"px\";\n        this._rootEl.style.minWidth = 180 + \"px\";\n        this._rootEl.style.padding = 2 + \"px\";\n        this._rootEl.style.backgroundColor = \"#000\";\n        this._rootEl.style.fontFamily = \"Courier New\";\n\n        this._pixelRatioEl = this._addTextElement(this._rootEl);\n        this._minMaxEl = this._addTextElement(this._rootEl);\n        this._frameTimeEl = this._addTextElement(this._rootEl);\n    }\n\n    private _addTextElement(parent: HTMLElement): HTMLParagraphElement {\n        const textEl = document.createElement(\"p\");\n        textEl.style.color = \"#fff\";\n        textEl.style.margin = 1 + \"px\";\n        parent.appendChild(textEl);\n        return textEl;\n    }\n\n    public customText(id: string, text: string): void {\n        if (!this.visible) {\n            return;\n        }\n\n        if (!this._customTextMap) {\n            this._customTextMap = new Map();\n        }\n\n        let textEl = this._customTextMap.get(id);\n        if (!textEl) {\n            textEl = this._addTextElement(this._rootEl);\n            this._customTextMap.set(id, textEl);\n        }\n\n        textEl.innerText = text;\n    }\n\n    update(scalar: PerformanceResolutionScalar): void {\n        if (!this.visible) {\n            return;\n        }\n        \n        this._pixelRatioEl.innerText = `Pixel Ratio: ${scalar\n            .getCurrentPixelRatio()\n            .toFixed(2)}`;\n\n        this._minMaxEl.innerText = `Min/Max: ${scalar.minimumPixelRatio} / ${\n            scalar.targetPixelRatio\n            }`;\n\n        this._frameTimeEl.innerHTML = `Frame Time: ${scalar\n            .getLastFrameTime()\n            .toFixed(2)}`;\n    }\n}\n","/**\n * Returns a promise that waits for the given condition function to return true.\n * If the condition function returns false, it will continue to be called at a regular interval until\n * the condition function returns true.\n * @param condition A function that must return true in order for the promise to resolve.\n * @param timeout An optional timeout value. Must be greater than 0 to be used. If condition is not met before timeout (ms), then the promise is rejected.\n * @param tickRate A optional tick rate value. Must be greater than 0. How frequently the condition function should be called (in ms).\n */\nexport async function waitForCondition(condition: () => boolean, timeout?: number, tickRate?: number): Promise<void> {\n    if (typeof tickRate !== 'number' || tickRate <= 0) {\n        tickRate = 30;\n    }\n\n    return new Promise<void>((resolve, reject) => {\n        let tickTimeoutId: number;\n        let timeoutId: number;\n\n        const tick = () => {\n            if (condition()) {\n                window.clearTimeout(tickTimeoutId);\n                window.clearTimeout(timeoutId);\n                return resolve();\n            } else {\n                tickTimeoutId = window.setTimeout(tick, tickRate);\n            }\n        };\n\n        tick();\n\n        if (typeof timeout === 'number' && timeout > 0) {\n            timeoutId = window.setTimeout(() => {\n                // Timeout reached before promise was able to resolve.\n                window.clearTimeout(tickTimeoutId);\n                \n                // Check for condition one last time in last ditch effort to resolve.\n                if (condition()) {\n                    return resolve();\n                } else {\n                    return reject('Timeout occured before condition could be met.');\n                }\n            }, timeout);\n        }\n    });\n}\n\n/**\n * Return a promise that waits the given number of seconds before resolving.\n * @param seconds Number of seconds to wait before resolving the promise.\n * @deprecated Use APEngine.time.waitForSeconds instead. This allows the promise to be responsive to pause/timescale.\n */\nexport async function waitForSeconds(seconds: number): Promise<void> {\n    console.warn(`DEPRECATED: Use APEngine.time.waitForSeconds instead. This allows the promise to be responsive to pause/timescale.`)\n    if (seconds > 0) {\n        return new Promise<void>((resolve, reject) => {\n            window.setTimeout(() => {\n                return resolve();\n            }, (seconds * 1000));\n        });\n    } else {\n        return Promise.resolve();\n    }\n}","\nimport { IDisposable } from '../misc/IDisposable';\nimport { waitForCondition } from '../utils/WaitPromises';\n\nexport interface IVideoStreamStartResult {\n    started: boolean;\n    error?: any;\n}\n\n/**\n * Device Camera is a class that wraps modern rowser functionality to interact with device camera hardware.\n */\nexport class DeviceCamera implements IDisposable {\n    \n    constraints: MediaStreamConstraints;\n\n    private _video: HTMLVideoElement = null;\n    private _stream: MediaStream = null;\n    private _playing: boolean = false;\n\n    constructor(constraints?: MediaStreamConstraints) {\n        this.constraints = constraints;\n    }\n\n    /**\n     * Is the device camera stream currently playing or not.\n     */\n    isPlaying(): boolean {\n        return this._playing;\n    }\n\n    /**\n     * The video element that is playing the device camera feed.\n     */\n    getVideoElement(): HTMLVideoElement {\n        return this._video;\n    }\n\n    /**\n     * Request to start device camera video stream. Promise will return true if successful, otherwise false.\n     * Uses the DeviceCamera.constraints object when requesting the camera from the browser.\n     * \n     * May provide a timeout value in milliseconds.\n     */\n    async startVideoStream(timeout?: number): Promise<IVideoStreamStartResult> {\n        if (this._video) {\n            return {\n                started: true\n            }\n        }\n\n        try {\n            this._stream = await navigator.mediaDevices.getUserMedia(this.constraints);\n        } catch (error) {\n            return {\n                started: false,\n                error: error\n            }\n        }\n\n        this._video = document.createElement('video');\n        this._video.srcObject = this._stream;\n        // this._video.setAttribute('autoplay', 'false');\n        this._video.setAttribute('playsinline', 'true');\n        this._video.play();\n\n        if (typeof timeout === 'number') {\n            if (timeout <= 0) {\n                timeout = 6000;\n            }\n        }\n\n        \n        try {\n            await waitForCondition(() => {\n                if (this._video) {\n                    return this._video.readyState === HTMLMediaElement.HAVE_ENOUGH_DATA;\n                }\n            }, timeout);\n\n            this._playing = true;\n            return {\n                started: true\n            }\n        } catch (error) {\n            this.stopVideoStream();\n            this._playing = false;\n            return {\n                started: false,\n                error: error\n            }\n        }\n    }\n\n    /**\n     * Stop running video streams and clean up related objects.\n     */\n    stopVideoStream(): void {\n        if (this._video) {\n            this._video = null;\n        }\n\n        if (this._stream) {\n            const tracks = this._stream.getTracks()\n            for (let track of tracks) {\n                track.stop();\n            }\n\n            this._stream = null;\n        }\n\n        this._playing = false;\n    }\n\n    dispose(): void {\n        this.stopVideoStream();\n    }\n}","import {\n    Vector2,\n    Camera,\n    Vector3,\n    Ray,\n    Raycaster,\n    Object3D,\n    Intersection,\n    Plane,\n} from 'three';\n\n/**\n * Container for all custom physics functions for game engine.\n */\nexport namespace Physics {\n    /**\n     * Infinite mathematical plane whos normal points up towards the sky.\n     */\n    export const GroundPlane: Plane = new Plane(new Vector3(0, 1, 0));\n\n    const _Raycaster: Raycaster = new Raycaster();\n\n    /**\n     * Defines the result of a raycast.\n     */\n    export interface RaycastResult {\n        /**\n         * The screen position used to perform this raycast.\n         */\n        pointerScreenPos: Vector2;\n\n        /**\n         * The ray used to perform this raycast.\n         */\n        ray: Ray;\n\n        /**\n         * The list of intersections from the raycast.\n         */\n        intersects: Intersection[];\n    }\n\n    /**\n     * Calculates a ray from the given screen position and camera.\n     * @pos The screen position that the ray should use for its direction vector.\n     * @camera The camera that the ray should point from.\n     */\n    export function screenPosToRay(screenPos: Vector2, camera: Camera): Ray {\n        _Raycaster.setFromCamera(screenPos, camera);\n        return _Raycaster.ray.clone();\n    }\n\n    /**\n     * Gets a point that is the given distance along the given ray.\n     * @param ray The ray.\n     * @param distance The distance along the ray from the origin.\n     */\n    export function pointOnRay(ray: Ray, distance: number): Vector3 {\n        let pos = new Vector3(\n            ray.direction.x,\n            ray.direction.y,\n            ray.direction.z\n        );\n        pos.multiplyScalar(distance);\n        pos.add(ray.origin);\n\n        return pos;\n    }\n\n    /**\n     * Calculates the point at which the given ray intersects the given plane.\n     * If the ray does not intersect the plane then null is returned.\n     * @param ray The ray.\n     * @param plane The plane that the ray should test against.\n     */\n    export function pointOnPlane(ray: Ray, plane: Plane): Vector3 | null {\n        let point = new Vector3();\n        point = ray.intersectPlane(plane, point);\n\n        return point;\n    }\n\n    /**\n     * Performs a raycast at the given screen position with the given camera against the given objects.\n     * @param screenPos The screen position to raycast from.\n     * @param objects The objects to raycast against.\n     * @param camera The camera to use.\n     * @param recursive  If true, it also checks all descendants of the objects. Otherwise it only checks intersecton with the objects. Default is false.\n     */\n    export function raycastAtScreenPos(\n        screenPos: Vector2,\n        objects: Object3D[],\n        camera: Camera,\n        recursive?: boolean\n    ): RaycastResult {\n        _Raycaster.setFromCamera(screenPos, camera);\n        const intersects = _Raycaster.intersectObjects(objects, recursive);\n\n        return {\n            pointerScreenPos: screenPos,\n            ray: _Raycaster.ray.clone(),\n            intersects,\n        };\n    }\n\n    /**\n     * Performs a raycast with the given ray against the given objects.\n     * @param ray The ray to use.\n     * @param objects The objects to raycast against.\n     * @param recursive  If true, it also checks all descendants of the objects. Otherwise it only checks intersecton with the objects. Default is false.\n     */\n    export function raycast(ray: Ray, objects: Object3D[], recursive?: boolean): RaycastResult {\n        _Raycaster.set(ray.origin, ray.direction);\n        const intersects = _Raycaster.intersectObjects(objects, recursive);\n\n        return {\n            pointerScreenPos: null,\n            ray: _Raycaster.ray.clone(),\n            intersects,\n        };\n    }\n\n    /**\n     * Returns the first intersection from the raycast test. If none exist, then null is returned.\n     */\n    export function firstRaycastHit(result: RaycastResult) {\n        return result.intersects.length > 0 ? result.intersects[0] : null;\n    }\n}\n","import { Event, ArgEvent } from './misc/Events';\n\nexport namespace APEngineEvents {\n    export const onUpdate: Event = new Event();\n    export const onLateUpdate: Event = new Event();\n    export const onResize: Event = new Event();\n    export const onXRSessionStarted: Event = new Event();\n    export const onXRSessionEnded: Event = new Event();\n    export const onVisibilityChanged: ArgEvent<boolean> = new ArgEvent();\n}","import { IDecoratorOptions, Decorator } from \"./Decorator\";\nimport { GameObject } from \"../GameObject\";\nimport { PerspectiveCamera, OrthographicCamera, MathUtils, WebGLRenderer, Scene, Camera, Geometry, BufferGeometry, Material, Group, Matrix4, Vector3, Euler, Frustum } from \"three\";\nimport { getOptionalValue } from \"../../utils/MiscUtils\";\nimport { calculateFrustumPlanes } from \"../../utils/MathUtils\";\nimport { APEngineEvents } from \"../../APEngineEvents\";\n\nexport declare type CameraType = 'perspective' | 'orthographic';\n\nexport declare type FieldOfViewType = 'vertical' | 'horizontal';\n\nexport interface ICameraDecoratorOptions extends IDecoratorOptions {\n    cameraType?: CameraType;\n    fovType?: FieldOfViewType;\n    vFov?: number;\n    hFov?: number;\n    zoom?: number;\n    aspect?: number;\n    near?: number;\n    far?: number;\n    size?: number;\n}\n\n/**\n * Camera decorator creates and manages ThreeJS cameras. \n * You can change the camera type on the fly by setting the cameraType property.\n */\nexport class CameraDecorator extends Decorator {\n\n    private static _PrimaryCamera: CameraDecorator = null;\n    private static _Cameras: CameraDecorator[] = [];\n\n    /**\n     * The camera that is marked as primary.\n     * If no camera is marked as primary, than the first camera is returned.\n     */\n    static get PrimaryCamera(): CameraDecorator {\n        if (this._PrimaryCamera) {\n            return this._PrimaryCamera;\n        } else if (this._Cameras.length > 0) {\n            return this._Cameras[0];\n        } else {\n            return null;\n        }\n    }\n\n    static set PrimaryCamera(cam: CameraDecorator) {\n        if (this._PrimaryCamera !== cam) {\n            this._PrimaryCamera = cam;\n        }\n    }\n\n    /**\n     * Cameras that are updated by APEngine.\n     * These camera will automatically get resized when APEngine window resize is triggered.\n     */\n    static get Cameras(): Readonly<CameraDecorator[]> {\n        return this._Cameras;\n    }\n\n    private _cameraType: CameraType;\n    private _fovType: FieldOfViewType;\n    private _vFov: number;\n    private _hFov: number;\n    private _zoom: number;\n    private _aspect: number;\n    private _near: number;\n    private _far: number;\n    private _size: number;\n    private _camera: PerspectiveCamera | OrthographicCamera;\n    private _nonXrPositon: Vector3;\n    private _nonXrRotation: Euler;\n    private _nonXrScale: Vector3;\n    private _frustum = new Frustum();\n    private _projScreenMatrix = new Matrix4();\n\n    /**\n     * Is the camera orthographic or perspective.\n     */\n    get cameraType(): CameraType { return this._cameraType }\n    set cameraType(value: CameraType) {\n        if (this._cameraType !== value) {\n            this._cameraType = value;\n            this._removeCamera();\n            this._createCamera();\n        }\n    }\n\n    /**\n     * Field of View type for perspective camera. The field of view type dictates\n     * how vertical fov is calculated based on the aspect ratio. No affect on orthographic cameras.\n     */\n    get fovType(): FieldOfViewType { return this._fovType }\n    set fovType(value: FieldOfViewType) {\n        if (this._fovType !== value) {\n            this._fovType = value;\n\n            if (this._camera && this._camera instanceof PerspectiveCamera) {\n                this.resize();\n            }\n        }\n    }\n\n    /**\n     * Vertical field of view for perspective camera. No affect on orthographic cameras.\n     * If field of view type is set to horizontal, the vertical field of view will be dynamic.\n     * This is the default FOV that Three JS cameras use.\n     */\n    get vFov(): number { return this._vFov }\n    set vFov(value: number) { \n        if (this._vFov !== value) {\n            this._vFov = value;\n\n            if (this._camera && this._camera instanceof PerspectiveCamera) {\n                this._camera.fov = this._vFov;\n                this._camera.updateProjectionMatrix();\n            }\n        }\n    }\n\n    /**\n     * Horizontal field of view for perspective camera. No affect on orthographic cameras.\n     * Only has an affect if the field of view type is set to horizontal.\n     */\n    get hFov(): number { return this._hFov }\n    set hFov(value: number) { \n        if (this._hFov !== value) {\n            this._hFov = value;\n\n            if (this._camera && this._camera instanceof PerspectiveCamera) {\n                this.resize();\n            }\n        }\n    }\n\n    /**\n     * Zoom level of the camera.\n     */\n    get zoom(): number { return this._zoom }   \n    set zoom(value: number) { \n        if (this._zoom !== value) {\n            this._zoom = value;\n\n            if (this._camera) {\n                this._camera.zoom = this._zoom;\n                this._camera.updateProjectionMatrix();\n            }\n        }\n    }\n\n    /**\n     * Aspect ratio of perspective camera. Has no effect on orthographic camera.\n     */\n    get aspect(): number { return this._aspect }\n    set aspect(value: number) {\n        if (this._aspect !== value) {\n            this._aspect = value;\n\n            if (this._camera && this._camera instanceof PerspectiveCamera) {\n                this._camera.aspect = this._aspect;\n                this._camera.updateProjectionMatrix();\n            }\n        }\n    }\n\n    /** \n     * Far clipping plane \n     */\n    get far(): number { return this._far }\n    set far(value: number) {\n        if (this._far !== value) {\n            this._far = value;\n\n            if (this._camera) {\n                this._camera.far = this._far;\n                this._camera.updateProjectionMatrix();\n            }\n        }\n    }\n\n    /**\n     * Near clipping plane\n     */\n    get near(): number { return this._near }\n    set near(value: number) { \n        if (this._near !== value) {\n            this._near = value;\n\n            if (this._camera) {\n                this._camera.near = this._near;\n                this._camera.updateProjectionMatrix();\n            }\n        }\n    }\n\n    /**\n     * The frustum size of orthographic camera. This has no affect on perspective camera.\n     */\n    get size(): number { return this._size }\n    set size(value: number) {\n        if (this._size !== value) {\n            this._size = value;\n\n            if (this._camera && this._camera instanceof OrthographicCamera) {\n                const planes = calculateFrustumPlanes(this._size, this._aspect);\n                this._camera.left = planes.left;\n                this._camera.right = planes.right;\n                this._camera.top = planes.top;\n                this._camera.bottom = planes.bottom;\n                this._camera.updateProjectionMatrix();\n            }\n        }\n    }\n\n    /**\n     * ThreeJS camera that is managed by this camera decorator.\n     */\n    get camera(): Readonly<PerspectiveCamera> | Readonly<OrthographicCamera> { return this._camera; }\n\n    /**\n     * The frustum for the camera. Useful for doing intersection tests with the area visible to the camera.\n     */\n    get frustum(): Frustum { return this._frustum }\n\n    configure(options: ICameraDecoratorOptions): void {\n        super.configure(options);\n\n        this._cameraType = getOptionalValue(options.cameraType, 'perspective');\n        this._fovType = getOptionalValue(options.fovType, 'vertical');\n        this._vFov = getOptionalValue(options.vFov, 50);\n        this._hFov = getOptionalValue(options.hFov, 50);\n        this._zoom = getOptionalValue(options.zoom, 1);\n        this._aspect = getOptionalValue(options.aspect, window.innerWidth / window.innerHeight);\n        this._far = getOptionalValue(options.far, 2000);\n        this._near = getOptionalValue(options.near, 0.1);\n        this._size = getOptionalValue(options.size, 25);\n    }\n\n    onAttach(gameObject: GameObject): void {\n        super.onAttach(gameObject);\n\n        this._createCamera();\n        this._updateFrustum();\n\n        // Add camera decorator to global list of camera decorators.\n        CameraDecorator._Cameras.push(this);\n\n        this._onXRSessionStarted = this._onXRSessionStarted.bind(this);\n        APEngineEvents.onXRSessionStarted.addListener(this._onXRSessionStarted);\n\n        this._onXRSessionEnded = this._onXRSessionEnded.bind(this);\n        APEngineEvents.onXRSessionEnded.addListener(this._onXRSessionEnded);\n\n        this.resize();\n    }\n\n    onVisible() {\n        super.onVisible();\n    }\n\n    onInvisible() {\n        super.onInvisible();\n    }\n\n    onStart(): void {\n        super.onStart();\n    }\n\n    onUpdate(): void {\n        super.onUpdate();\n\n        this._updateFrustum();\n    }\n\n    onLateUpdate(): void {\n        super.onLateUpdate();\n    }\n\n    resize(): void {\n        if (this._camera) {\n            this.aspect = window.innerWidth / window.innerHeight;\n\n            if (this._camera instanceof PerspectiveCamera) {\n                if (this._fovType === 'horizontal') {\n                    // Reference: https://github.com/mrdoob/three.js/issues/15968#issuecomment-475986352\n                    this.vFov = Math.atan( Math.tan( this._hFov * Math.PI / 360 ) / this.aspect ) * 360 / Math.PI;\n                } else {\n                    this._hFov = 2 * Math.atan( Math.tan( this.vFov * Math.PI / 180 / 2 ) * this.aspect ) * 180 / Math.PI;\n                }\n            } else {\n                // Update frustum planes for othrogtraphic camera using new aspect ratio.\n                const planes = calculateFrustumPlanes(this._size, this._aspect);\n                this._camera.left = planes.left;\n                this._camera.right = planes.right;\n                this._camera.top = planes.top;\n                this._camera.bottom = planes.bottom;\n                this._camera.updateProjectionMatrix();\n            }\n        }\n    }\n\n    private _onXRSessionStarted(): void {\n        // Store this camera decorator's game object matrix before the WebXRManager starts overtwriting camera positioning.\n        this._nonXrPositon = this.gameObject.position.clone();\n        this._nonXrRotation = this.gameObject.rotation.clone();\n        this._nonXrScale = this.gameObject.scale.clone();\n\n        // Reset the camera decorator game object to default position, rotation, and scale.\n        // WebXRManager doesnt like if the xr camera to be parented to an object with an offset.\n        this.gameObject.position.set(0, 0, 0);\n        this.gameObject.rotation.set(0, 0, 0);\n        this.gameObject.scale.set(1, 1, 1);\n    }\n\n    private _onXRSessionEnded(): void {\n        // Restore the camera decorator's game object to the position, rotation, and scale it was at before entering XR mode.\n        this.gameObject.position.copy(this._nonXrPositon);\n        this.gameObject.rotation.copy(this._nonXrRotation);\n        this.gameObject.scale.copy(this._nonXrScale);\n\n        this._nonXrPositon = null;\n        this._nonXrRotation = null;\n        this._nonXrScale = null;\n    }\n\n    private _createCamera(): void {\n        if (!this.gameObject) {\n            // Dont create camera until this decorator is attached to a GameObject.\n            return;\n        }\n\n        if (this._cameraType === 'perspective') {\n            this._camera = new PerspectiveCamera(this._vFov, this._aspect, this._near, this._far);\n        } else if (this._cameraType === 'orthographic') {\n            const planes = calculateFrustumPlanes(this._size, this._aspect);\n            this._camera = new OrthographicCamera(planes.left, planes.right, planes.top, planes.bottom, this._near, this._far);\n        } else {\n            console.error(`[CameraDecorator] Can't create camera. Unknown camera type: ${this._cameraType}`);\n        }\n\n        if (this._camera) {\n            // Rotate camera 180 degrees on the y-axis so that it faces forward.\n            this._camera.rotateY(180 * MathUtils.DEG2RAD);\n\n            // Add camera to this gameObject.\n            this.gameObject.add(this._camera);\n        }\n\n        this.resize();\n    }\n\n    private _removeCamera(): void {\n        if (!this._camera) {\n            // No camera to remove.\n            return;\n        }\n\n        if (this._camera.parent) {\n            this._camera.parent.remove(this._camera);\n        }\n        this._camera = null;\n    }\n\n    private _updateFrustum(): void {\n        if (!this._camera) {\n            // Need camera to update frustum.\n            return;\n        }\n\n        this._projScreenMatrix.multiplyMatrices(this._camera.projectionMatrix, this._camera.matrixWorldInverse);\n        this._frustum.setFromProjectionMatrix(this._projScreenMatrix);\n    }\n\n    onDestroy(): void {\n        super.onDestroy();\n\n        this._removeCamera();\n        \n        // Remove camera decorator from global list of camera decorators.\n        const index = CameraDecorator._Cameras.findIndex(cameraDecorator => cameraDecorator === this);\n        if (index >= 0) {\n            CameraDecorator._Cameras.splice(index, 1);\n        }\n\n        // If this camera is the primary camera, set primary camera back to null.\n        if (CameraDecorator._PrimaryCamera === this) {\n            CameraDecorator._PrimaryCamera = null;\n        }\n    }\n}","import { Object3D, Vector2, Intersection, Camera } from 'three';\nimport { IDisposable } from '../misc/IDisposable';\nimport { Input, InputType } from './Input';\nimport { Physics } from '../physics/Physics';\nimport { isObjectVisible } from '../utils/ThreeUtils';\nimport { CameraDecorator } from '../gameobject/decorators/CameraDecorator';\nimport { sortZA } from '../utils/MiscUtils';\n\nexport type PointerEventType = 'pointer enter' | 'pointer exit' | 'pointer down' | 'pointer up' | 'pointer click';\n\nexport interface IPointerEvent {\n    /**\n     * The string event type identifier.\n     */\n    eventType: PointerEventType;\n\n    /**\n     * The Object3D (if any) that was responsible for this event.\n     */\n    object: Object3D;\n\n    /**\n     * The object (if any) that had pointer down called on it at the time of this event.\n     */\n    pointerDown: IPointerEventListener;\n}\n\nexport interface IPointerEnterEvent extends IPointerEvent {\n}\n\nexport interface IPointerExitEvent extends IPointerEvent {\n}\n\nexport interface IPointerDownEvent extends IPointerEvent {\n}\n\nexport interface IPointerUpEvent extends IPointerEvent {\n}\n\nexport interface IPointerClickEvent extends IPointerEvent {\n}\n\nexport interface IPointerEventListener {\n    /**\n     * The objects that the pointer event system will use to detect collision for this listener.\n     */\n    pointerTargets: Object3D[];\n\n    /**\n     * Function that will be invoked when the pointer event system issues pointer enter event for this listener.\n     * If \n     */\n    onPointerEnter(event: IPointerEnterEvent): void;\n\n    /**\n     * Function that will be invoked when the pointer event system issues pointer exit event for this listener.\n     */\n    onPointerExit(event: IPointerExitEvent): void;\n\n    /**\n     * Function that will be invoked when the pointer event system issues pointer down event for this listener.\n     */\n    onPointerDown(event: IPointerDownEvent): void;\n\n    /**\n     * Function that will be invoked when the pointer event system issues pointer up event for this listener.\n     */\n    onPointerUp(event: IPointerUpEvent): void;\n\n    /**\n     * Function that will be invoked when the pointer event system issues pointer click event for this listener.\n     */\n    onPointerClick(event: IPointerClickEvent): void;\n}\n\n/**\n * A class that can be used to easily listen for some basic input events for Three JS Oojects.\n */\nexport class PointerEventSystem implements IDisposable {\n    \n    static debug: boolean = false;\n\n    private static _activeSystems: PointerEventSystem[] = [];\n    private static _focusedSystem: PointerEventSystem;\n\n    /**\n     * List of all active pointer event systems.\n     */\n    static get activeSystems(): Readonly<PointerEventSystem[]> {\n        return this._activeSystems;\n    }\n\n    /**\n     * Update all active pointer events systems.\n     * This function sorts the systems based on priority (highest to lowest priority).\n     */\n    static updateActiveSystems(input: Input): void {\n        if (!this._activeSystems || this._activeSystems.length === 0) {\n            return;\n        }\n\n        if (this._activeSystems.length === 1) {\n            // No need to sort, only one pointer event system is active.\n            this._activeSystems[0]._update(input);\n        } else {\n            // If there is a focused system, update it first.\n            // If the focuses system becomes no longer focuses then move on to updating\n            // systems until one does.\n            if (this._focusedSystem) {\n                const isFocused = this._focusedSystem._update(input);\n                if (!isFocused) {\n                    // Focused system is no longer focused.\n                    if (this.debug) {\n                        console.log(`[PointerEventSystem] ${this._focusedSystem.name} has lost focus.`);\n                    }\n\n                    this._focusedSystem = null;\n                } else {\n                    // Focused system is still focused. Dont update other pointer event systems.\n                    return; \n                }\n            }\n\n            // Sort pointer event systems in descending priority order.\n            const systems = Array.from(this._activeSystems);\n            sortZA(systems, 'priority');\n\n            // Loop through and update systems until one becomes focused.\n            // If we find a new focused system, release any active pointers for remaining systems.\n            for (const system of systems) {\n                if (!this._focusedSystem) {\n                    const isFocused = system._update(input);\n                    if (isFocused) {\n                        // Found a system that has gained focus.\n                        this._focusedSystem = system;\n\n                        if (this.debug) {\n                            console.log(`[PointerEventSystem] ${this._focusedSystem.name} has gained focus.`);\n                        }\n                    }\n                } else {\n                    // A system already gained focus, release active pointers for this system.\n                    system.releaseActivePointers();\n                }\n            }\n        }\n    }\n\n    /**\n     * The camera to use for hit testing pointer event listeners.\n     * If this is undefined, this pointer event system will use the primary camera (CameraDecorator.PrimaryCamera).\n     */\n    cameraDecorator: CameraDecorator = undefined;\n    \n    /**\n     * The priority this pointer event system has over other pointer event systems.\n     * During an update frame, pointer event systems are sorted by priority (highest to lowest) and hit testing is done\n     * in that order. If a hit is detected in a pointer system above another, all lower pointer systems have their pointers released and are then ignored.\n     * Lower priority pointer systems are only reached if the higher priority systems dont detect any hits.\n     */\n    priority: number = 0;\n\n    private _name: string;\n    private _enabled: boolean = true;\n    private _listeners: Set<IPointerEventListener> = new Set();\n    private _pointerDown: IPointerEventListener = null;\n    private _pointerEnter: IPointerEventListener = null;\n\n    get name(): string { return this._name }\n    get pointerDown(): IPointerEventListener { return this._pointerDown }\n    get pointerEnter(): IPointerEventListener { return this._pointerEnter }\n\n    get enabled(): boolean { return this._enabled }\n    set enabled(value: boolean) {\n        if (this._enabled === value) {\n            return;\n        }\n\n        this._enabled = value;\n        if (!this._enabled) {\n            this.releaseActivePointers();\n        }\n    }\n\n    constructor(name: string, priority: number, cameraDecorator?: CameraDecorator) {\n        this._name = name;\n        this.priority = priority;\n        this.cameraDecorator = cameraDecorator;\n\n        PointerEventSystem._activeSystems.push(this);\n    }\n\n    addListener(listener: IPointerEventListener): void {\n        if (!this._listeners.has(listener)) {\n            this._listeners.add(listener);\n        }\n    }\n\n    removeListener(listener: IPointerEventListener): void {\n        if (this._pointerDown === listener) { this._pointerDown = null; }\n        if (this._pointerEnter === listener) { this._pointerEnter = null; }\n        this._listeners.delete(listener);\n    }\n\n    /**\n     * Update event system. Returns true if the update causes the pointer event system to become focused.\n     */\n    private _update(input: Input): boolean {\n        if (!this._enabled) {\n            // Input must be enabled for the pointer event system.\n            return;\n        }\n\n        let cameraDecorator = this.cameraDecorator === undefined ? CameraDecorator.PrimaryCamera : this.cameraDecorator;\n\n        if (!input || !cameraDecorator || !cameraDecorator.camera) {\n            // Pointer event system needs both an input module and a camera.\n            return;\n        }\n\n        if (input.currentInputType !== InputType.Mouse &&\n            input.currentInputType !== InputType.Touch\n        ) {\n            // Pointer Event System only works with mouse and touch input types.\n            return;\n        }\n\n        // Retrieve the pointer's current screen position.\n        let pointerScreenPos: Vector2 = (input.currentInputType === InputType.Mouse) ? input.getMouseScreenPos() : input.getTouchScreenPos(0);\n\n        // Raycast against pointer event listeners using the pointer's screen position to find \n        // the event listener that is currently the closest to the camera.\n        let closestIntersection: Intersection;\n        let closestListener: IPointerEventListener;\n\n        if (pointerScreenPos) {\n            // Collect all active listener target objects.\n            const allActiveListenerTargets: Object3D[] = [];\n            this._listeners.forEach((listener) => {\n                const pointerTargets = listener.pointerTargets;\n                if (pointerTargets) {\n                    const activeTargets = pointerTargets.filter((target) => {\n                        return isObjectVisible(target);\n                    });\n    \n                    allActiveListenerTargets.push(...activeTargets);\n                }\n            });\n    \n            // Raycast againsts all pointer event listener target objects.\n            const hits = Physics.raycastAtScreenPos(pointerScreenPos, allActiveListenerTargets, cameraDecorator.camera, false);\n            closestIntersection = Physics.firstRaycastHit(hits);\n            closestListener = closestIntersection ? this._findEventListenerForObject(closestIntersection.object) : null;\n        } else {\n            // No pointer screen position currently.\n            closestIntersection = null;\n            closestListener = null;\n        }\n\n        //\n        // Pointer enter/exit events.\n        //\n        if (closestListener) {\n            if (this._pointerEnter !== null && this._pointerEnter !== closestListener) {\n                // Let the last pointer enter object know that the pointer has exited it.\n                const pointerExit = this._pointerEnter;\n                this._pointerEnter = null;\n\n                if (PointerEventSystem.debug) {\n                    console.log(`[PointerEventSystem] Name: ${this.name}, Event: pointer exit`, pointerExit);\n                }\n\n                pointerExit.onPointerExit({\n                    eventType: 'pointer exit',\n                    object: closestIntersection.object,\n                    pointerDown: this._pointerDown\n                });\n            }\n\n            if (this._pointerEnter === null) {\n                // Let the closest listener know that the pointer has entered it.\n                this._pointerEnter = closestListener;\n\n                if (PointerEventSystem.debug) {\n                    console.log(`[PointerEventSystem] Name: ${this.name}, Event: pointer enter`, this._pointerEnter);\n                }\n\n                this._pointerEnter.onPointerEnter({\n                    eventType: 'pointer enter',\n                    object: closestIntersection.object,\n                    pointerDown: this._pointerDown\n                });\n            }\n\n        } else {\n            // Pointer is not over any listeners.\n            if (this._pointerEnter !== null) {\n                // Let the last pointer enter object know that the pointer has exited it.\n                if (PointerEventSystem.debug) {\n                    console.log(`[PointerEventSystem] Name: ${this.name}, Event: pointer exit`, this._pointerEnter);\n                }\n\n                this._pointerEnter.onPointerExit({\n                    eventType: 'pointer exit',\n                    object: null,\n                    pointerDown: this._pointerDown\n                });\n                this._pointerEnter = null;\n            }\n        }\n\n        //\n        // Pointer down/up/click events.\n        //\n        const isPrimaryDown: boolean = (input.currentInputType === InputType.Mouse) ? input.getMouseButtonDown(0) : input.getTouchDown(0);\n        if (isPrimaryDown) {\n            if (this._pointerEnter !== null && this._pointerEnter === closestListener && this._pointerDown === null) {\n                // Let the closest listener know that the pointer is down on it.\n                this._pointerDown = closestListener;\n\n                if (PointerEventSystem.debug) {\n                    console.log(`[PointerEventSystem] Name: ${this.name}, Event: pointer down`, this._pointerDown);\n                }\n\n                this._pointerDown.onPointerDown({\n                    eventType: 'pointer down',\n                    object: closestIntersection.object,\n                    pointerDown: this._pointerDown\n                });\n            }\n        }\n        \n        const isPrimaryUp: boolean = (input.currentInputType === InputType.Mouse) ? input.getMouseButtonUp(0) : input.getTouchUp(0);\n        if (isPrimaryUp) {\n            if (this._pointerDown !== null) {\n                // Let the last pointer down object know that the pointer is up.\n                const pointerUp = this._pointerDown;\n                this._pointerDown = null;\n\n                if (PointerEventSystem.debug) {\n                    console.log(`[PointerEventSystem] Name: ${this.name}, Event: pointer up`, pointerUp);\n                }\n                \n                pointerUp.onPointerUp({\n                    eventType: 'pointer up',\n                    object: closestIntersection ? closestIntersection.object : null,\n                    pointerDown: this._pointerDown\n                });\n\n                // Detect if pointer click occurs. \n                // Click means that an event listener that received the down event is now receiving the up event while being hovered over.\n                const isClick: boolean = (closestListener !== null && pointerUp === closestListener);\n                if (isClick) {\n                    const pointerClick = pointerUp;\n\n                    if (PointerEventSystem.debug) {\n                        console.log(`[PointerEventSystem] Name: ${this.name}, Event: pointer click`, pointerClick);\n                    }\n\n                    pointerClick.onPointerClick({\n                        eventType: 'pointer click',\n                        object: closestIntersection.object,\n                        pointerDown: this._pointerDown\n                    });\n                }\n            }\n        }\n\n        return !!this._pointerDown;\n    }\n\n    /**\n     * Release any held pointers. If active enter/down listener, then exit/up is invoked.\n     */\n    releaseActivePointers(): void {\n        if (this._pointerDown) {\n            const pointerUp = this._pointerDown;\n            this._pointerDown = null;\n\n            if (PointerEventSystem.debug) {\n                console.log(`[PointerEventSystem] Name: ${this.name}, Event: pointer up`, pointerUp);\n            }\n            \n            pointerUp.onPointerUp({\n                eventType: 'pointer up',\n                object: null,\n                pointerDown: this._pointerDown\n            });\n        }\n\n        if (this._pointerEnter) {\n            const pointerExit = this._pointerEnter;\n            this._pointerEnter = null;\n\n            if (PointerEventSystem.debug) {\n                console.log(`[PointerEventSystem] Name: ${this.name}, Event: pointer exit`, pointerExit);\n            }\n\n            pointerExit.onPointerExit({\n                eventType: 'pointer exit',\n                object: null,\n                pointerDown: this._pointerDown\n            });\n        }\n    }\n\n    dispose(): void {\n        this.releaseActivePointers();\n\n        this._listeners = null;\n        this.cameraDecorator = null;\n\n        const index = PointerEventSystem._activeSystems.findIndex(pes => pes === this);\n        if (index >= 0) {\n            PointerEventSystem._activeSystems.splice(index, 1);\n        }\n\n        if (PointerEventSystem._focusedSystem === this) {\n            PointerEventSystem._focusedSystem = null;\n        }\n    }\n\n    private _findEventListenerForObject(obj3d: Object3D): IPointerEventListener {\n        if (obj3d) {\n            const listenerValues = Array.from(this._listeners);\n            for (const listener of listenerValues) {\n                const pointerTargets = listener.pointerTargets;\n                if (pointerTargets && pointerTargets.length > 0) {\n                    const matchFound = pointerTargets.some((target) => {\n                        return target === obj3d;\n                    });\n                    if (matchFound) {\n                        return listener;\n                    }\n                }\n            }\n        }\n\n        return null;\n    }\n}","export namespace APEngineBuildInfo {\n    /**\n     * Version number of the app. \n     */\n    export const version: string = '__ape_version__';\n\n    const _time: string = '__ape-build-time__';\n\n    /**\n     * The date that this version of the app was built.\n     */\n    export function date(): Date {\n        const timeNum = parseInt(_time);\n        return new Date(timeNum);\n    }\n}\n","import { Scene, Camera, WebGLRenderer } from 'three';\nimport { CameraDecorator } from '../gameobject/decorators/CameraDecorator';\n\nexport class SceneRenderOperation {\n    scene: Scene;\n    cameraDecorator: CameraDecorator;\n    enabled: boolean = true;\n\n    clearColor: boolean = false;\n    clearDepth: boolean = false;\n    clearStencil: boolean = false;\n\n    constructor(scene?: Scene, cameraDecorator?: CameraDecorator) {\n        this.scene = scene;\n        this.cameraDecorator = cameraDecorator;\n    }\n\n    render(webglRenderer: WebGLRenderer): void {\n        if (!this.scene) {\n            // No scene to render.\n            return;\n        }\n        if (!this.cameraDecorator || !this.cameraDecorator.camera) {\n            // No camera to render scene with.\n            return;\n        }\n        if (!this.enabled) {\n            // Dont render if render operatio is disabled.\n            return;\n        }\n\n        if (this.clearColor) {\n            webglRenderer.clearColor();\n        }\n\n        if (this.clearDepth) {\n            webglRenderer.clearDepth();\n        }\n\n        if (this.clearStencil) {\n            webglRenderer.clearStencil();\n        }\n\n        webglRenderer.render(this.scene, this.cameraDecorator.camera);\n    }\n}","import { IDisposable } from \"../misc/IDisposable\";\nimport { Scene, WebGLRenderer } from \"three\";\nimport { SceneRenderOperation as RenderOperation } from \"./SceneRenderOperation\";\nimport { GameObject } from \"../gameobject/GameObject\";\nimport { CameraDecorator } from \"../gameobject/decorators/CameraDecorator\";\nimport { traverseSafe } from \"../utils/ThreeUtils\";\n\nexport class SceneManager implements IDisposable {\n\n    private _scenes: Scene[] = [];\n    private _primaryScene: Scene = null;\n    private _renderList: RenderOperation[] = [];\n    private _updatedGameObjects: GameObject[];\n    \n    /**\n     * Scenes that are updated by APEngine. \n     * GameObjects that are parented to scenes in this list will get their lifecycle functions invoked.\n     */\n    get scenes(): Readonly<Scene[]> {\n        return this._scenes;\n    }\n\n    get sceneRenderList(): Readonly<RenderOperation[]> {\n        return this._renderList;\n    }\n\n    /**\n     * The scene that is marked as primary.\n     * If no scene is marked as primary, than the first scene is returned.\n     */\n    get primaryScene(): Scene {\n        if (this._primaryScene) {\n            return this._primaryScene;\n        } else if (this._scenes.length > 0) {\n            return this._scenes[0];\n        } else {\n            return null;\n        }\n    }\n\n    set primaryScene(scene: Scene) {\n        if (this._primaryScene !== scene) {\n            this._primaryScene = scene;\n        }\n    }\n    \n    constructor() {\n    }\n\n    addScene(scene: Scene): void {\n        if (!this._scenes.some(s => s === scene)) {\n            this._scenes.push(scene);\n        }\n    }\n\n    removeScene(scene: Scene): void {\n        const index = this._scenes.findIndex(s => s === scene);\n        if (index >= 0) {\n            this._scenes.splice(index, 1);\n        }\n\n        this.removeRenderOperationsUsingScene(scene);\n    }\n\n    addRenderOperation(scene: Scene, cameraDecorator: CameraDecorator): RenderOperation {\n        const renderOp = new RenderOperation(scene, cameraDecorator);\n        this._renderList.push(renderOp);\n        return renderOp;\n    }\n\n    reorderRenderOperation(renderOp: RenderOperation, renderOrder: number) {\n        const oldIndex = this._renderList.indexOf(renderOp);\n        if (oldIndex >= 0) {\n            this._renderList.splice(oldIndex, 1);\n            this._renderList.splice(renderOrder, 0, renderOp);\n        }\n    }\n\n    removeRenderOperation(scene: Scene, cameraDecorator: CameraDecorator): void {\n        const index = this._renderList.findIndex(op => op.scene === scene && op.cameraDecorator === cameraDecorator);\n        if (index >= 0) {\n            this._renderList.splice(index, 1);\n        }\n    }\n\n    removeRenderOperationsUsingScene(scene: Scene): void {\n        this._renderList = this._renderList.filter((op) => {\n            if (op.scene !== scene) {\n                return true;\n            }\n        });\n    }\n\n    removeRenderOperationsUsingCamera(cameraDecorator: CameraDecorator): void {\n        this._renderList = this._renderList.filter((op) => {\n            if (op.cameraDecorator !== cameraDecorator) {\n                return true;\n            }\n        });\n    }\n\n    removeAllRenderOperations(): void {\n        this._renderList = [];\n    }\n\n    update(): void {\n        this._updatedGameObjects = [];\n\n        for (let scene of this._scenes) {\n            if (scene) {\n                traverseSafe(scene, (go) => {\n                    if (go instanceof GameObject) {\n                        go.onUpdate();\n                        this._updatedGameObjects.push(go);\n                    }\n                });\n            }\n        }\n    }\n\n    lateUpdate(): void {\n        for (let i = 0; i < this._updatedGameObjects.length; i++) {\n            if (this._updatedGameObjects[i]) {\n                this._updatedGameObjects[i].onLateUpdate();\n            }\n        }\n    }\n\n    render(webglRenderer: WebGLRenderer): void {\n        webglRenderer.clear();\n        webglRenderer.info.autoReset = false;\n        webglRenderer.info.reset();\n        \n        for (let renderOp of this._renderList) {\n            if (renderOp) {\n                renderOp.render(webglRenderer);\n            }\n        }\n    }\n\n    dispose(): void {\n        for (let scene of this._scenes) {\n            if (scene) {\n                scene.dispose();\n            }\n        }\n\n        this._scenes = [];\n        this._renderList = [];\n        this._primaryScene = null;\n        this._updatedGameObjects = [];\n    }\n}","import {\n    Vector3,\n    Matrix4,\n    Quaternion,\n    WebGLRenderer\n} from 'three';\nimport { IDisposable } from '../misc/IDisposable';\nimport { Event } from '../misc/Events';\n\nexport interface RaycastHit {\n    position: Vector3;\n    rotation: Quaternion;\n}\n\n// Reference 01: https://github.com/mrdoob/three.js/blob/dev/examples/webxr_ar_hittest.html\n// Refernece 02: https://web.dev/ar-hit-test/\nexport class XRPhysics implements IDisposable {\n\n    private _renderer: WebGLRenderer;\n    private _xrSessionStartedEvent: Event;\n    private _xrSessionEndedEvent: Event;\n    private _getFrame: () => any;\n    \n    private _viewerHitTestSource: any = null;\n\n    constructor(renderer: WebGLRenderer, onXRSessionStarted: Event, onXRSessionEnded: Event, getFrame: () => any) {\n        this._renderer = renderer;\n        this._xrSessionStartedEvent = onXRSessionStarted;\n        this._xrSessionEndedEvent = onXRSessionEnded;\n        this._getFrame = getFrame;\n\n        this._onXRSessionStarted = this._onXRSessionStarted.bind(this);\n        this._xrSessionStartedEvent.addListener(this._onXRSessionStarted);\n\n        this._onXRSessionEnded = this._onXRSessionEnded.bind(this);\n        this._xrSessionEndedEvent.addListener(this._onXRSessionEnded);\n    }\n\n    gazeRaycast(): RaycastHit | null {\n        const frame = this._getFrame();\n\n        if (frame) {\n            const referenceSpace = this._renderer.xr.getReferenceSpace();\n\n            if (this._viewerHitTestSource) {\n                const hitTestResults = frame.getHitTestResults(this._viewerHitTestSource);\n\n                if (hitTestResults.length) {\n                    const hitPose = hitTestResults[0].getPose(referenceSpace);\n                    const hitMatrix = new Matrix4();\n                    hitMatrix.fromArray(hitPose.transform.matrix);\n\n                    const position = new Vector3();\n                    const rotation = new Quaternion();\n                    const scale = new Vector3();\n\n                    hitMatrix.decompose(position, rotation, scale);\n\n                    return {\n                        position,\n                        rotation\n                    }\n                }\n            }\n        }\n\n        return null;\n    }\n\n    private async _onXRSessionStarted() {\n        // Retrieve hit test source for viewer reference space.\n        const session = this._renderer.xr.getSession();\n        const referenceSpace = await session.requestReferenceSpace('viewer');\n        this._viewerHitTestSource = await session.requestHitTestSource({\n            space: referenceSpace\n        });\n    }\n    \n    private _onXRSessionEnded() {\n        this._viewerHitTestSource = null;\n    }\n\n    dispose() {\n        this._xrSessionStartedEvent.removeListener(this._onXRSessionStarted);\n        this._xrSessionEndedEvent.removeListener(this._onXRSessionEnded);\n    }\n}","import {\n    WebGLRenderer,\n    WebGLRendererParameters\n} from 'three';\nimport { Time } from './Time';\nimport { Input } from './input/Input';\nimport { GameObject } from \"./gameobject/GameObject\";\nimport { XRInput } from './input/XRInput';\nimport { PerformanceStats } from './misc/PerformanceStats';\nimport { PerformanceResolutionScalar } from './misc/PerformanceResolutionScalar';\nimport { DeviceCamera } from './device-camera/DeviceCamera';\nimport { PointerEventSystem } from './input/PointerEventSystem';\nimport { APEngineBuildInfo } from './APEngineBuildInfo';\nimport { SceneManager } from './scene-management/SceneManager';\nimport { CameraDecorator } from './gameobject/decorators/CameraDecorator';\nimport { XRPhysics } from './physics/XRPhysics';\nimport { APEngineEvents } from './APEngineEvents';\n\nexport namespace APEngine {\n\n    export const sceneManager = new SceneManager();\n    \n    export let webglRenderer: WebGLRenderer;\n    export let time: Time;\n    export let input: Input;\n    export let xrInput: XRInput;\n    export let xrPhysics: XRPhysics;\n    export let performanceStats: PerformanceStats;\n    export let performanceResolutionScalar: PerformanceResolutionScalar;\n    export let deviceCamera: DeviceCamera;\n    export let pointerEventSystem: PointerEventSystem;\n\n    let _initialized: boolean = false;\n    let _xrFrame: any;\n    let _xrEnabled: boolean = false;\n    let _maxPixelRatio: number = 0;\n    let _audioMutedCount: number = 0;\n\n    export function isXREnabled() {\n        return _xrEnabled;\n    }\n\n    export function getXRFrame(): any { \n        return _xrFrame;\n    }\n\n    export function init(webglParams?: WebGLRendererParameters) {\n        if (_initialized) {\n            return;\n        }\n\n        console.info(`== APEngine v${APEngineBuildInfo.version} ==\\nDate: ${APEngineBuildInfo.date().toString()}`);\n\n        _initialized = true;\n\n        // Create renderer.\n        webglRenderer = new WebGLRenderer(webglParams);\n        webglRenderer.autoClear = false;\n\n        const width = window.innerWidth;\n        const height = window.innerHeight;\n\n        webglRenderer.setSize(width, height);\n        webglRenderer.domElement.style.display = \"block\";\n        \n        // Create time module.\n        time = new Time();\n\n        // Create performance stats module.\n        performanceStats = new PerformanceStats();\n\n        // Create performance resolution scalar.\n        performanceResolutionScalar = new PerformanceResolutionScalar(webglRenderer, {\n            startEnabled: false\n        });\n        \n        // Create input module.\n        input = new Input({\n            inputElement: webglRenderer.domElement,\n            canvasElement: webglRenderer.domElement,\n            time: time,\n            getUIHtmlElements: () => []\n        });\n        \n        // Create xr input module.\n        xrInput = new XRInput(webglRenderer);\n\n        // Create xr physics module.\n        xrPhysics = new XRPhysics(webglRenderer, APEngineEvents.onXRSessionStarted, APEngineEvents.onXRSessionEnded, getXRFrame);\n\n        // Create pointer event system.\n        pointerEventSystem = new PointerEventSystem('Default', 0);\n\n        // Create device camera module.\n        deviceCamera = new DeviceCamera({\n            video: {\n                facingMode: 'environment'\n            },\n            audio: false\n        })\n\n        // Setup update loop.\n        webglRenderer.setAnimationLoop(update);\n\n        resize();\n\n        // Listen for window resize event so that we can update the webgl canvas accordingly.\n        window.addEventListener('resize', resize);\n\n        // Listen for page visibility change event so we can disable sounds, etc\n        document.addEventListener('visibilitychange', visibilityChange);\n    }\n\n    function update(timestamp: any, frame: any) {\n        performanceResolutionScalar.update();\n\n        _xrFrame = frame;\n\n        // Track state of XR presentation.\n        const xrEnabled = webglRenderer.xr.isPresenting && !!_xrFrame;\n        if (_xrEnabled !== xrEnabled) {\n            _xrEnabled = xrEnabled;\n\n            if (_xrEnabled) {\n                webglRenderer.xr.enabled = true;\n                APEngineEvents.onXRSessionStarted.invoke();\n            } else {\n                webglRenderer.xr.enabled = false;\n                APEngineEvents.onXRSessionEnded.invoke();\n            }\n        }\n\n        input.update();\n\n        // Update pointer event system.\n        PointerEventSystem.updateActiveSystems(input);\n        \n        // Update game objects in scenes.\n        sceneManager.update();\n        APEngineEvents.onUpdate.invoke();\n        sceneManager.lateUpdate();\n        APEngineEvents.onLateUpdate.invoke();\n\n        GameObject.__APEngine_ProcessGameObjectDestroyQueue();\n        \n        sceneManager.render(webglRenderer);\n\n        time.update();\n        performanceStats.update();\n    }\n\n    export function getMaxPixelRatio() {\n        return _maxPixelRatio;\n    }\n\n    export function setMaxPixelRatio(pixelRatio: number) {\n        _maxPixelRatio = pixelRatio;\n        resize();\n    }\n\n    export function dispose() {\n        window.removeEventListener('resize', resize);\n\n        sceneManager.dispose();\n\n        webglRenderer.dispose();\n        webglRenderer = null;\n\n        time.dispose();\n        time = null;\n\n        input.dispose();\n        input = null;\n\n        xrInput.dispose();\n        xrInput = null;\n\n        xrPhysics.dispose();\n        xrPhysics = null;\n\n        deviceCamera.dispose();\n        deviceCamera = null;\n\n        performanceStats.dispose();\n        performanceStats = null;\n\n        _xrEnabled = false;\n        _xrFrame = null;\n\n        APEngineEvents.onUpdate.removeAllListeners();\n        APEngineEvents.onLateUpdate.removeAllListeners();\n        APEngineEvents.onXRSessionStarted.removeAllListeners();\n        APEngineEvents.onXRSessionEnded.removeAllListeners();\n\n        _initialized = false;\n    }\n\n    function resize() {\n        const width = window.innerWidth;\n        const height = window.innerHeight;\n\n        webglRenderer.setSize(width, height);\n\n        let pixelRatio = window.devicePixelRatio;\n        if ((_maxPixelRatio > 0) && (pixelRatio > _maxPixelRatio)) {\n            pixelRatio = _maxPixelRatio;\n        }\n        \n        webglRenderer.setPixelRatio(pixelRatio);\n        CameraDecorator.Cameras.forEach(camera => camera.resize());\n\n        APEngineEvents.onResize.invoke();\n    }\n\n    function visibilityChange() {\n        setAudioMuted(document.hidden);\n\n        APEngineEvents.onVisibilityChanged.invoke(document.hidden);\n    }\n\n    export function setAudioMuted(muted:boolean) {\n        if (muted) {\n            _audioMutedCount++;\n            if (_audioMutedCount > 0) {\n                Howler.mute(true);\n            }\n        } else {\n            _audioMutedCount--;\n            if (_audioMutedCount <= 0) {\n                _audioMutedCount = 0;\n                Howler.mute(false);\n            }\n        }\n    }\n\n}","import { Scene, WebGLRenderer } from \"three\";\n \nexport namespace ThreeDevTools {\n    \n    declare var __THREE_DEVTOOLS__: any;\n    \n    /**\n     * Dispatch event to the Three JS Dev Tools (if it exists) so that it can observe the given scene and renderer.\n     */\n    export function observe(scene: Scene, renderer: WebGLRenderer) {\n        // Observe a scene or a renderer\n        if (typeof __THREE_DEVTOOLS__ !== 'undefined') {\n            console.log(`[ThreeDevTools] dispatch event to observe scene and renderer.`);\n            __THREE_DEVTOOLS__.dispatchEvent(new CustomEvent('observe', { detail: scene }));\n            __THREE_DEVTOOLS__.dispatchEvent(new CustomEvent('observe', { detail: renderer }));\n        }\n    }\n}","import { \n    AnimationAction,\n    AnimationMixer,\n    AnimationClip,\n    Event as DispatcherEvent,\n    LoopOnce,\n    LoopRepeat, \n    AnimationActionLoopStyles\n} from 'three';\nimport { IDecoratorOptions, Decorator } from './Decorator';\nimport { GameObject } from '../GameObject';\nimport { APEngine } from '../../APEngine';\nimport { ArgEvent } from '../../misc/Events';\nimport { clamp, unnormalize } from '../../utils/MathUtils';\n\nexport interface IAnimatorDecoratorOptions extends IDecoratorOptions {\n    clips?: AnimationClip[];\n}\n\ndeclare type ActionEventType = 'finished' | 'loop';\n\ninterface ActionEvent extends DispatcherEvent {\n    type: ActionEventType\n    action: AnimationAction;\n}\n\ninterface ActionFinishedEvent extends ActionEvent {\n    direction: number;\n}\n\ninterface ActionLoopEvent extends ActionEvent {\n    loopDelta: number;\n}\n\nexport interface AnimatorEvent {\n    clipName: string;\n}\n\nclass ActionTracker {\n    private _actions: AnimationAction[] = [];\n    private _animator: AnimatorDecorator;\n\n    get count(): number { return this._actions.length }\n\n    constructor(animator: AnimatorDecorator) { \n        this._animator = animator;\n    }\n\n    contains(action: AnimationAction): boolean {\n        return this._actions.some(a => a === action);\n    }\n    \n    getByIndex(index: number): AnimationAction {\n        return this._actions[index];\n    }\n\n    getActionsWithWeight(): AnimationAction[] {\n        return this._actions.filter((action) => {\n            return action.getEffectiveWeight() > 0;\n        });\n    }\n\n    tryGet(index: number): AnimationAction {\n        if (index >= 0 && index < this._actions.length) {\n            return this._actions[index];\n        } else {\n            return null;\n        }\n    }\n\n    add(action: AnimationAction): boolean {\n        let added = false;\n        if (!this.contains(action)) {\n            this._actions.push(action);\n            added = true;\n\n            if (this._animator.debug) {\n                console.log(`${this._animator.gameObject.name} added action ${action.getClip().name}.`);\n            }\n\n            this.print();\n        }\n\n        return added;\n    }\n\n    remove(action: AnimationAction): boolean {\n        let removed = false;\n        const startCount = this._actions.length;\n        this._actions = this._actions.filter((a) => {\n            return a !== action;\n        });\n\n        if (startCount !== this._actions.length) {\n            removed = true;\n\n            if (this._animator.debug) {\n                console.log(`${this._animator.gameObject.name} removed action ${action.getClip().name}.`);\n            }\n\n            this.print();\n        }\n\n        return removed;\n    }\n\n    print(): void {\n        if (this._animator.debug) {\n            let message: string = `${this._animator.gameObject.name} actions: ${this._actions.length}`;\n            for (const action of this._actions) {\n                message += `\\n  ${action.getClip().name}`;\n                message += `\\n    effectiveWeight: ${action.getEffectiveWeight()}`;\n            }\n    \n            console.log(message);\n        }\n    }\n}\n\nexport interface PlayClipOptions {\n\n    /**\n     * Should the clip be set to loop.\n     */\n    loop?: boolean;\n\n    /** \n     * How quickly to transition to this animation.\n     * If this value is 0 or less, then all animations will be stopped before playing the clip.\n     */\n    transitionDuration?: number;\n\n    /**\n     * Time to start playing the clip at in normalized range (0.0 - 1.0).\n     */\n    normalizedStartTime?: number;\n\n    /**\n     * Duration of the clip in seconds.\n     */\n    durationOverride?: number;\n}\n\nexport class AnimatorDecorator extends Decorator {\n\n    debug: boolean = false;\n\n    private _mixer: AnimationMixer;\n    private _clips: Map<string, AnimationClip> = new Map();\n    private _actionTracker = new ActionTracker(this);\n    private _timeScale: number = 1.0;\n    private _visible: boolean;\n\n    onAnimationLoop: ArgEvent<AnimatorEvent> = new ArgEvent();\n    onAnimationFinished: ArgEvent<AnimatorEvent> = new ArgEvent();\n\n    get clips(): AnimationClip[] { return Array.from(this._clips.values()) }\n    \n    /**\n     * The global time scale of the animator.\n     */\n    get timeScale(): number {\n        return this._timeScale;\n    }\n    /**\n     * The global time scale of the animator.\n     */\n    set timeScale(value: number) {\n        this._timeScale = value;\n\n        if (this._mixer) {\n            this._mixer.timeScale = value;\n        }\n    }\n\n    /**\n     * The global time of the animator in seconds.\n     */\n    get time(): number {\n        return this._mixer.time;\n    }\n    /**\n     * The global time of the animator in seconds.\n     */\n    set time(value: number) {\n        this._mixer.setTime(value);\n    }\n    \n    configure(options: IAnimatorDecoratorOptions): void {\n        super.configure(options);\n        \n        if (options.clips) {\n            for(const clip of options.clips) {\n                this.addClip(clip);\n            }\n        }\n    }\n\n    addClip(clip: AnimationClip): void {\n        if (!this._clips.has(clip.name)) {\n            this._clips.set(clip.name, clip);\n        } else {\n            console.error(`Animator already has a clip named ${clip.name} on GameObject ${this.gameObject.name}. All clips on an Animator must have a unique name.`);\n        }\n    }\n\n    getClip(clipName: string): AnimationClip {\n        return this._clips.get(clipName);\n    }\n\n    onAttach(gameObject: GameObject): void {\n        super.onAttach(gameObject);\n\n        this._onActionLoop = this._onActionLoop.bind(this);\n        this._onActionFinished = this._onActionFinished.bind(this);\n\n        this._mixer = new AnimationMixer(this.gameObject);\n        this._mixer.addEventListener('loop', this._onActionLoop);\n        this._mixer.addEventListener('finished', this._onActionFinished);\n        this._mixer.timeScale = this._timeScale;\n    }\n\n    onVisible() {\n        super.onVisible();\n        this._visible = true;\n    }\n\n    onInvisible() {\n        super.onInvisible();\n        this._visible = false;\n    }\n\n    onStart(): void {\n        super.onStart();\n    }\n\n    play(clipName: string, options?: PlayClipOptions): void {\n        const clip = this._clips.get(clipName);\n        if (!clip) {\n            console.error(`There is no clip named ${clipName} in the Animator ${this.gameObject.name} for GameObject ${this.gameObject.name}`);\n            return;\n        }\n        if (this._clipAlreadyPlaying(clip, LoopOnce)) {\n            console.warn(`There is already an action that is playing the clip ${clip.name}`);\n            // There is already an action that is playing the clip.\n            return;\n        }\n\n        if (!options) {\n            options = {};\n        }\n\n        if (this.debug) {\n            console.log(`${this.gameObject.name} play ${clipName} with options: ${JSON.stringify(options)}`);\n        }\n\n        // Get action for clip.\n        const action = this._mixer.clipAction(clip).reset();\n\n        // Get list of actions that still have weight.\n        let actionsWithWeight = this._actionTracker.getActionsWithWeight();\n        if (actionsWithWeight && actionsWithWeight.length > 0) {\n            // Filter out the clip that we are about to start playing.\n            actionsWithWeight = actionsWithWeight.filter(a => a !== action);\n        }\n\n        if (this.debug) {\n            if (actionsWithWeight && actionsWithWeight.length > 0) {\n                let message = `${this.gameObject.name} other actions with weight: ${actionsWithWeight.length}`;\n                for (const action of actionsWithWeight) {\n                    message += `\\n  ${action.getClip().name}`;\n                    message += `\\n    effectiveWeight: ${action.getEffectiveWeight()}`;\n                }\n\n                console.log(message);\n            } else {\n                console.log(`${this.gameObject.name} no other actions with weight.`);\n            }\n        }\n\n        if (actionsWithWeight &&\n            actionsWithWeight.length > 0 && \n            options.transitionDuration > 0\n        ) {\n            // Fade out the action that still have weight.\n            for (let i = 0; i < actionsWithWeight.length; i++) {\n                if (this.debug) {\n                    console.log(`${this.gameObject.name} fade out action ${actionsWithWeight[i].getClip().name} over ${options.transitionDuration} seconds`);\n                }\n                actionsWithWeight[i].stopFading();\n                actionsWithWeight[i].fadeOut(options.transitionDuration);\n            }\n\n            // Fade in the new action.\n            if (this.debug) {\n                console.log(`${this.gameObject.name} fade in action ${action.getClip().name} over ${options.transitionDuration} seconds`);\n            }\n            action.stopFading();\n            action.fadeIn(options.transitionDuration);\n        } else {\n            // Stop all current actions.\n            this.stopAll();\n\n            action.setEffectiveWeight(1);\n        }\n\n        // Set the loop properties.\n        if (options.loop) {\n            action.setLoop(LoopRepeat, Infinity);\n        } else {\n            action.setLoop(LoopOnce, 0);\n        }\n\n        // Always clamp on the last frame when finished.\n        action.clampWhenFinished = true;\n\n        if (options.durationOverride >= 0) {\n            action.setDuration(options.durationOverride);\n        } else {\n            action.setEffectiveTimeScale(1);\n        }\n\n        // Change start time if one is provided.\n        if (options.normalizedStartTime >= 0) {\n            options.normalizedStartTime = clamp(options.normalizedStartTime, 0, 1);\n            action.time = unnormalize(options.normalizedStartTime, 0, action.getClip().duration);\n        }\n        \n        // Play the action.\n        action.play();\n        \n        this._actionTracker.add(action);\n    }\n\n    playAll(): void {\n        this.stopAll();\n\n        for (const [clipName, clip] of this._clips) {\n            const action = this._mixer.clipAction(clip).reset();\n            action.play();\n\n            this._actionTracker.add(action);\n        }\n    }\n\n    stopAll(): void {\n        if (this.debug) {\n            console.log(`${this.gameObject.name} stop all ${this._actionTracker.count} actions.`);\n        }\n\n        for (let i = this._actionTracker.count - 1; i >= 0; i--) {\n            const action = this._actionTracker.getByIndex(i);\n            action.stop();\n            this._actionTracker.remove(action);\n        }\n    }\n\n    onUpdate(): void {\n        super.onUpdate();\n\n        if (this._visible) {\n            this._mixer.update(APEngine.time.deltaTime);\n        }\n    }\n\n    onLateUpdate(): void {\n        super.onLateUpdate();\n    }\n\n    private _onActionLoop(e: DispatcherEvent): void {\n        const loopEvent = e as ActionLoopEvent;\n\n        if (this.debug) {\n            console.log(`${this.gameObject.name} on action ${loopEvent.action.getClip().name} loop`);\n        }\n\n        this.onAnimationLoop.invoke({\n            clipName: loopEvent.action.getClip().name\n        });\n    }\n\n    private _onActionFinished(e: DispatcherEvent): void {\n        const finishEvent = e as ActionFinishedEvent;\n\n        if (this.debug) {\n            console.log(`${this.gameObject.name} on action ${finishEvent.action.getClip().name} finished`);\n        }\n\n        this.onAnimationFinished.invoke({\n            clipName: finishEvent.action.getClip().name\n        });\n    }\n\n    private _clipAlreadyPlaying(clip: AnimationClip, loop: AnimationActionLoopStyles): boolean {\n        const action = this._mixer.clipAction(clip);\n        if (action.isRunning() && action.loop === loop) {\n            return true;\n        }\n        return false;\n    }\n\n    onDestroy(): void {\n        super.onDestroy();\n\n        this.stopAll();\n\n        this.onAnimationLoop.dispose();\n        this.onAnimationFinished.dispose();\n\n        this._mixer.removeEventListener('loop', this._onActionLoop);\n        this._mixer.removeEventListener('finished', this._onActionFinished);\n\n        this._mixer.stopAllAction();\n        this._mixer.uncacheRoot(this._mixer.getRoot());\n        this._mixer = null;\n\n        this._clips.clear();\n    }\n}","import { Decorator, IDecoratorOptions } from './Decorator';\nimport { Mesh } from 'three';\nimport { GameObject } from '../GameObject';\n\nexport interface IMeshDecoratorOptions extends IDecoratorOptions {\n    mesh: Mesh\n}\n\nexport class MeshDecorator extends Decorator {\n\n    mesh: Mesh;\n\n    configure(options: IMeshDecoratorOptions) {\n        super.configure(options);\n\n        this.mesh = options.mesh;\n    }\n\n    onAttach(gameObject: GameObject) {\n        super.onAttach(gameObject);\n\n        this.gameObject.add(this.mesh);\n    }\n\n    onStart() {\n        super.onStart();\n    }\n\n    onDestroy() {\n        super.onDestroy();\n        \n        this.gameObject.remove(this.mesh);\n    }\n}","import { TransformControls } from \"three/examples/jsm/controls/TransformControls\";\nimport { IDisposable } from \"./IDisposable\";\nimport { ArgEvent } from \"../misc/Events\";\nimport { Vector3, Euler, MathUtils } from \"three\";\n\nconst VectorFields: string[] = ['x', 'y', 'z'];\n\nexport class TransformControlsGUI implements IDisposable {\n    private _controls: TransformControls;\n    private _rootEl: HTMLDivElement;\n\n    onUnselectClick: ArgEvent<TransformControlsGUI> = new ArgEvent();\n\n    constructor(controls: TransformControls) {\n        this._controls = controls;\n\n        this._controlsChange = this._controlsChange.bind(this);\n        this._controlsObjectChange = this._controlsObjectChange.bind(this);\n\n        this._controls.addEventListener('change', this._controlsChange);\n        this._controls.addEventListener('objectChange', this._controlsObjectChange);\n\n        // Create the gui.\n        this._rootEl = document.createElement('div');\n        document.body.appendChild(this._rootEl);\n        this._rootEl.id = 'transform-controls-gui';\n\n        this._rootEl.style.position = 'fixed';\n        this._rootEl.style.right = '0';\n        this._rootEl.style.bottom = '0'\n        this._rootEl.style.minWidth = '250px';\n        this._rootEl.style.maxWidth = '50%';\n        this._rootEl.style.backgroundColor = '#333';\n        this._rootEl.style.color = '#fff';\n        this._rootEl.style.fontFamily = \"Courier New\";\n        this._rootEl.style.padding = '4px';\n        this._rootEl.style.fontSize = '14px';\n\n        this._addHeader('Object Name');\n        this._addParagraph('object-name');\n        this._addSpacer();\n        this._addHeader('Local Position');\n        this._addVector3('local-position', (vector) => {\n            this._controls.object.position.copy(vector);\n        });\n        this._addSpacer();\n        this._addHeader('Local Rotation');\n        this._addVector3('local-rotation', (vector) => {\n            const rad = vector.clone().multiplyScalar(MathUtils.DEG2RAD);\n            this._controls.object.rotation.setFromVector3(rad);\n        });\n        this._addSpacer();\n        this._addHeader('Local Scale');\n        this._addVector3('local-scale', (vector) => {\n            this._controls.object.scale.copy(vector);\n        });\n        this._addSpacer();\n        this._addHeader('Transform Mode');\n        this._addButtonRow([\n            {\n                 text: 'Translate',\n                 callback: (e) => {\n                    this._controls.setMode('translate');\n                 }\n            },\n            {\n                 text: 'Rotate',\n                 callback: (e) => {\n                    this._controls.setMode('rotate');\n                 }\n            },\n            {\n                 text: 'Scale',\n                 callback: (e) => {\n                    this._controls.setMode('scale');\n                 }\n            },\n        ]);\n        this._addSpacer();\n        this._addHeader('Transform Space');\n        this._addButtonRow([\n            {\n                 text: 'Local',\n                 callback: (e) => {\n                    this._controls.setSpace('local');\n                 }\n            },\n            {\n                 text: 'World',\n                 callback: (e) => {\n                    this._controls.setSpace('world');\n                 }\n            },\n        ]);\n        this._addSpacer('24px');\n        this._addButton('Unselect Object', (e) => {\n            this.onUnselectClick.invoke(this);\n        });\n\n        this.refresh();\n    }\n\n    private _addHeader(title: string): void {\n        const headerEl = document.createElement('div');\n        this._rootEl.appendChild(headerEl);\n\n        headerEl.style.backgroundColor = '#555';\n        headerEl.style.width = '100%';\n        headerEl.style.textAlign = 'left';\n        headerEl.style.letterSpacing = '1px';\n        headerEl.style.padding = '4px';\n        headerEl.style.boxSizing = 'border-box';\n        headerEl.textContent = title;\n    }\n\n    private _addSpacer(height?: string): void {\n        const spacerEl = document.createElement('div');\n        this._rootEl.appendChild(spacerEl);\n\n        spacerEl.style.height = height ?? '16px';\n    }\n\n    private _addParagraph(id: string): void {\n        const paragraphEl = document.createElement('p');\n        this._rootEl.appendChild(paragraphEl);\n        paragraphEl.id = id;\n\n        paragraphEl.style.boxSizing = 'border-box';\n        paragraphEl.style.margin = '4px 4px 0px 4px';\n    }\n\n    private _refreshParagraph(id: string, text: string): void {\n        const paragraphEl = document.querySelector(`#${id}`) as HTMLParamElement;\n        if (paragraphEl) {\n            paragraphEl.textContent = text;\n        }\n    }\n\n    private _addButton(text: string, callback: (e: MouseEvent) => void): void {\n        const buttonEl = document.createElement('button');\n        this._rootEl.appendChild(buttonEl);\n        \n        buttonEl.style.width = '100%';\n        buttonEl.style.fontSize = '14px';\n\n        buttonEl.textContent = text;\n        buttonEl.onclick = (e) => callback(e);\n    }\n\n    private _addButtonRow(configs: { text: string, callback: (e: MouseEvent) => void }[]): void {\n        const rowEl = document.createElement('div');\n        this._rootEl.appendChild(rowEl);\n        rowEl.style.display = 'flex';\n        rowEl.style.flexDirection = 'row';\n\n        for (let i = 0; i < configs.length; i++) {\n            const config = configs[i];\n\n            const buttonEl = document.createElement('button');\n            rowEl.appendChild(buttonEl);\n\n            buttonEl.style.width = '100%';\n            buttonEl.style.fontSize = '14px';\n\n            buttonEl.textContent = config.text;\n            buttonEl.onclick = (e) => config.callback(e);\n        }\n    }\n\n    private _addVector3(id: string, callback: (vector: Vector3) => void): void {\n        const vectorEl = document.createElement('div');\n        this._rootEl.appendChild(vectorEl);\n        vectorEl.id = id;\n\n        vectorEl.style.display = 'flex';\n        vectorEl.style.flexDirection = 'row';\n\n        for (let i = 0; i < VectorFields.length; i++) {\n            const field = VectorFields[i];\n\n            const labelEl = document.createElement('label');\n            vectorEl.appendChild(labelEl);\n            labelEl.htmlFor = field;\n            labelEl.textContent = `${field.toUpperCase()}:`;\n\n            const inputEl = document.createElement('input');\n            vectorEl.appendChild(inputEl);\n            inputEl.type = 'number';\n            inputEl.onchange = () => callback(this._getVector3(id));\n            inputEl.style.width = '75px';\n            inputEl.id = field;\n            inputEl.name = field;\n        }\n    }\n\n    private _getVector3(id: string): Vector3 {\n        const vectorEl = document.querySelector(`#${id}`);\n        if (vectorEl) {\n            const vector = new Vector3();\n            for (let i = 0; i < VectorFields.length; i++ ) {\n                const field = VectorFields[i];\n\n                const inputEl = vectorEl.querySelector(`#${field}`) as HTMLInputElement;\n                vector.setComponent(i, Number.parseFloat(inputEl.value));\n            }\n\n            return vector;\n        }\n\n        return null;\n    }\n\n    private _refreshVector3(id: string, vector: Vector3): void {\n        const vectorEl = document.querySelector(`#${id}`);\n        if (vectorEl) {\n            for (let i = 0; i < VectorFields.length; i++ ) {\n                const field = VectorFields[i];\n\n                const inputEl = vectorEl.querySelector(`#${field}`) as HTMLInputElement;\n                inputEl.value = vector.getComponent(i).toFixed(3);\n            }\n        }\n    }\n\n    refresh(): void {\n        if (!this._rootEl) {\n            return;\n        }\n\n        this._refreshParagraph('object-name', this._controls.object.name);\n        this._refreshVector3('local-position', this._controls.object.position);\n        this._refreshVector3('local-rotation', new Vector3(\n            this._controls.object.rotation.x * MathUtils.RAD2DEG,\n            this._controls.object.rotation.y * MathUtils.RAD2DEG,\n            this._controls.object.rotation.z * MathUtils.RAD2DEG\n        ));\n        this._refreshVector3('local-scale', this._controls.object.scale);\n    }\n    \n    private _controlsChange(): void {\n        this.refresh();\n    }\n\n    private _controlsObjectChange(): void {\n        this.refresh();\n    }\n\n    dispose(): void {\n        this._controls.removeEventListener('change', this._controlsChange);\n        this._controls.removeEventListener('objectChange', this._controlsObjectChange);\n        if (this._rootEl) {\n            this._rootEl.remove();\n            this._rootEl = null;\n        }\n    }\n}","import { TransformControls } from \"three/examples/jsm/controls/TransformControls\";\nimport { Object3D, Camera } from \"three\";\nimport { Event, ArgEvent } from \"../misc/Events\";\nimport { APEngine } from \"../APEngine\";\nimport { findParentScene } from \"../utils/ThreeUtils\";\nimport { TransformControlsGUI } from \"./TransformControlsGUI\";\nimport { CameraDecorator } from \"../gameobject/decorators/CameraDecorator\";\n\nexport namespace TransformTool {\n    var _controls: TransformControls;\n    var _gui: TransformControlsGUI;\n    var _mouseDown: boolean;\n\n    export const onAttach: ArgEvent<Object3D> = new ArgEvent();\n    export const onDetach: ArgEvent<Object3D> = new ArgEvent();\n    export const onMouseDown: Event = new Event();\n    export const onMouseUp: Event = new Event();\n    export const onObjectChange: ArgEvent<Object3D> = new ArgEvent();\n\n    export function attach(object3d: Object3D, cameraDecorator?: CameraDecorator): void {\n        if (_controls || _gui) {\n            detach();\n        }\n\n        const transformCamera = cameraDecorator ?? CameraDecorator.PrimaryCamera;\n        if (!transformCamera) {\n            console.error(`[TransformTool] There is no valid camera to create transfrom controls with.`);\n            return;\n        }\n        if (!APEngine.webglRenderer.domElement) {\n            console.error(`[TransformTool] There is no valid dom element to attach transfrom controls events to.`);\n            return;\n        }\n\n        _controls = new TransformControls(\n            transformCamera.camera,\n            APEngine.webglRenderer.domElement\n        );\n\n        _controls.attach(object3d);\n        _controls.setSpace('local');\n        _controls.setMode('translate');\n\n        _controls.addEventListener('change', controlsChange);\n        _controls.addEventListener('mouseDown', controlsMouseDown);\n        _controls.addEventListener('mouseUp', controlsMouseUp);\n        _controls.addEventListener('objectChange', controlsObjectChange);\n\n        // window.addEventListener('keydown', handleKeyDown);\n\n        const scene = findParentScene(object3d);\n        scene.add(_controls);\n\n        _gui = new TransformControlsGUI(_controls);\n        _gui.onUnselectClick.addListener(guiUnselectClick);\n    }\n\n    export function detach(): void {\n        if (_gui) {\n            _gui.onUnselectClick.removeListener(guiUnselectClick);\n            _gui.dispose();\n            _gui = null;\n        }\n\n        if (_controls) {\n            _controls.removeEventListener('change', controlsChange);\n            _controls.removeEventListener('mouseDown', controlsMouseDown);\n            _controls.removeEventListener('mouseUp', controlsMouseUp);\n            _controls.removeEventListener('objectChange', controlsObjectChange);\n\n            // window.removeEventListener('keydown', handleKeyDown;\n\n            _controls.parent.remove(_controls);\n            _controls.detach();\n            _controls.dispose();\n            _controls = null;\n        }\n    }\n\n    export function getAttachedObject(): Object3D {\n        if (_controls) {\n            return _controls.object;\n        } else { \n            return null;\n        }\n    }\n\n    export function isMouseDown(): boolean {\n        return _mouseDown;\n    }\n\n    function guiUnselectClick(): void {\n        detach();\n    }\n    \n    function controlsChange(): void {\n    }\n\n    function controlsObjectChange(): void {\n        onObjectChange.invoke(getAttachedObject());\n    }\n\n    function controlsMouseDown(): void {\n        _mouseDown = true;\n        onMouseDown.invoke();\n    }\n\n    function controlsMouseUp(): void {\n        _mouseDown = false;\n        onMouseUp.invoke();\n    }\n}","import { IDecoratorOptions, Decorator } from \"./Decorator\";\nimport { GameObject } from \"../GameObject\";\nimport { APEngine } from \"../../APEngine\";\nimport { \n    IPointerEventListener, \n    IPointerClickEvent,\n    IPointerDownEvent,\n    IPointerEnterEvent,\n    IPointerExitEvent,\n    IPointerUpEvent\n} from \"../../input/PointerEventSystem\";\nimport { Object3D } from \"three\";\nimport { TransformTool } from \"../../misc/TransformTool\";\nimport { traverseSafe } from \"../../utils/ThreeUtils\";\n\nexport interface ITransformPickerDecoratorOptions extends IDecoratorOptions {\n}\n\nexport class TransformPickerDecorator extends Decorator implements IPointerEventListener {\n\n    get pointerTargets(): Object3D[] {\n        const children: Object3D[] = [];\n        traverseSafe(this.gameObject, (obj) => children.push(obj));\n        return children;\n    }\n\n    configure(options: ITransformPickerDecoratorOptions): void {\n        super.configure(options);\n    }\n\n    onAttach(gameObject: GameObject): void {\n        super.onAttach(gameObject);\n    }\n\n    onVisible() {\n        super.onVisible();\n\n        APEngine.pointerEventSystem.addListener(this);\n    }\n\n    onInvisible() {\n        super.onInvisible();\n\n        APEngine.pointerEventSystem.removeListener(this);\n    }\n\n    onStart(): void {\n        super.onStart();\n    }\n\n    onPointerEnter(event: IPointerEnterEvent): void {\n    }\n\n    onPointerExit(event: IPointerExitEvent): void {\n    }\n\n    onPointerDown(event: IPointerDownEvent): void {\n    }\n\n    onPointerUp(event: IPointerUpEvent): void {\n    }\n\n    onPointerClick(event: IPointerClickEvent): void {\n        TransformTool.attach(this.gameObject);\n    }\n\n    onUpdate(): void {\n        super.onUpdate();\n    }\n\n    onLateUpdate(): void {\n        super.onLateUpdate();\n    }\n\n    onDestroy(): void {\n        super.onDestroy();\n\n        if (TransformTool.getAttachedObject() === this.gameObject) {\n            TransformTool.detach();\n        }\n\n        APEngine.pointerEventSystem.removeListener(this);\n    }\n}","import { IDecoratorOptions, Decorator } from \"./Decorator\";\nimport { GameObject } from \"../GameObject\";\nimport { Vector3, Vector2 } from \"three\";\nimport { CameraDecorator } from \"./CameraDecorator\";\nimport { clamp, clampDegAngle, pointOnSphere } from \"../../utils/MathUtils\";\nimport { APEngine } from \"../../APEngine\";\nimport { InputType } from \"../../input/Input\";\nimport { getOptionalValue } from \"../../utils/MiscUtils\";\nimport { TransformTool } from \"../../misc/TransformTool\";\n\nexport interface ICameraOrbitDecoratorOptions extends IDecoratorOptions {\n    cameraDecorator?: CameraDecorator;\n}\n\n/**\n * Decorator that provided orbit controls for a camera decorator.\n */\nexport class CameraOrbitDecorator extends Decorator {\n    /**\n     * The world position that the camera is looking at.\n     */\n    target: Vector3 = new Vector3();\n\n    /**\n     * The distance in pixels that needs to be crossed in order for dragging to start.\n     */\n    dragThreshold = 10.0;\n\n    invertY: boolean = true;\n    invertX: boolean = true;\n\n    xMouseSpeed = 1.0;\n    yMouseSpeed = 1.0;\n    xTouchSpeed = 1.0;\n    yTouchSpeed = 1.0;\n\n    xMinDeg = -360.0;\n    xMaxDeg = 360.0;\n    yMinDeg = -90.0;\n    yMaxDeg = 90.0;\n\n    zoomMouseSpeed = 1.0;\n    zoomTouchSpeed = 1.0;\n\n    zoomMin = 0.0;\n    zoomMax = 40.0;\n\n    rotateWhileZooming: boolean = false;\n\n    private _camera: CameraDecorator = null;\n    private _inputEnabled: boolean = true;\n    private _zoomEnabled: boolean = true;\n    private _isDragging: boolean = false;\n    private _isZooming: boolean = false;\n    private _x: number = 0;\n    private _y: number = 0;\n    private _zoomDistance: number = 0;\n    private _inputDown: boolean = false;\n    private _inputDownStartPos: Vector2 = new Vector2();\n    private _inputDragLastPos: Vector2 = new Vector2();\n    private _inputTouchZoomDist: number = 0;\n    \n    get inputEnabled(): boolean { return this._inputEnabled; }\n    set inputEnabled(value: boolean) { \n        this._inputEnabled = value;\n\n        if (!this.inputEnabled) {\n            this._inputDown = false;\n            this._isDragging = false;\n            this._isZooming = false;\n            this._inputDownStartPos.set(0, 0);\n            this._inputDragLastPos.set(0, 0);\n            this._inputTouchZoomDist = 0;\n        }\n    }\n\n    get zoomEnabled(): boolean { return this._zoomEnabled; }\n    set zoomEnabled(value: boolean) {\n        this._zoomEnabled = value;\n\n        if (!this._zoomEnabled) {\n            this._isZooming = false;\n            this._inputTouchZoomDist = 0;\n        }\n    }\n\n    get camera(): CameraDecorator { return this._camera; } \n    get isDragging(): boolean { return this._isDragging; } \n    get isZooming(): boolean { return this._isZooming; }\n\n    configure(options: ICameraOrbitDecoratorOptions): void {\n        super.configure(options);\n\n        this._camera = getOptionalValue(options.cameraDecorator, null);\n    }\n\n    onAttach(gameObject: GameObject): void {\n        super.onAttach(gameObject);\n\n        if (!this._camera) {\n            // If no camera was provided, look for one on the gameObject we are attached to.\n            this._camera = this.gameObject.getDecorator(CameraDecorator);\n        }\n\n        if (!this._camera) {\n            console.error(`[CameraOrbitDecorator] No camera decorator to control. Need to be provided one or be attached to GameObject with CameraDecorator on it.`);\n        }\n    }\n\n    onVisible() {\n        super.onVisible();\n    }\n\n    onInvisible() {\n        super.onInvisible();\n    }\n\n    onStart(): void {\n        super.onStart();\n    }\n\n    setOrbit(x?: number, y?: number) {\n        let set = false;\n        if (typeof x === 'number') {\n            this._x = x;\n            set = true;\n        }\n        if (typeof y === 'number') {\n            this._y = y;\n            set = true;\n        }\n        if (set) {\n            this._updateCamera();\n        }\n    }\n\n    setOrbitFromGeoCoord(latitude?: number, longitude?: number): void {\n        let set = false;\n        if (typeof longitude === 'number') {\n            this._x = -90 + longitude;\n            set = true;\n        }\n        if (typeof latitude === 'number') {\n            this._y = -latitude;\n            set = true;\n        }\n        if (set) {\n            this._updateCamera();\n        }\n    }\n\n    getOrbit(): { x: number, y: number } {\n        return {\n            x: this._x,\n            y: this._y\n        }\n    }\n\n    setZoomDistance(zoom: number) {\n        zoom = clamp(zoom, this.zoomMin, this.zoomMax);\n\n        if (this._zoomDistance !== zoom) {\n            this._zoomDistance = zoom;\n            this._updateCamera();\n        }\n    }\n\n    getZoomDistance(): number {\n        return this._zoomDistance;\n    }\n\n    private _rotateControls(): void {\n        if (!this.inputEnabled) {\n            return;\n        }\n\n        const input = APEngine.input;\n\n        if (input.currentInputType === InputType.Touch && input.getTouchDown(0)) {\n            this._inputDown = true;\n            this._isDragging = false;\n            this._inputDownStartPos.copy(input.getTouchClientPos(0));\n        } else if (input.currentInputType === InputType.Mouse && input.getMouseButtonDown(0)) {\n            this._inputDown = true;\n            this._isDragging = false;\n            this._inputDownStartPos.copy(input.getMouseClientPos());\n        }\n        \n        if (this._inputDown && !this._isDragging) {\n            // Need to cross drag theshold in order to start dragging.\n            let dragDistance: number = 0.0;\n            let inputPos: Vector2;\n            if (input.currentInputType === InputType.Touch) {\n                inputPos = input.getTouchClientPos(0);\n            } else {\n                inputPos = input.getMouseClientPos();\n            }\n\n            dragDistance = this._inputDownStartPos.distanceTo(inputPos);\n\n            if (dragDistance >= this.dragThreshold) {\n                this._isDragging = true;\n                this._inputDragLastPos.copy(inputPos);\n            }\n        }\n\n        if (input.currentInputType === InputType.Touch && input.getTouchUp(0)) {\n            this._inputDown = false;\n            this._isDragging = false;\n            this._inputDownStartPos.set(0, 0);\n        } else if (input.currentInputType === InputType.Mouse && input.getMouseButtonUp(0)) {\n            this._inputDown = false;\n            this._isDragging = false;\n            this._inputDownStartPos.set(0, 0);\n        }\n\n        if (this._isDragging) {\n            const rotateAllowed = !this.isZooming || (this.isZooming && this.rotateWhileZooming);\n\n            if (input.currentInputType === InputType.Touch && input.getTouchHeld(0)) {\n                if (rotateAllowed) {\n                    const delta = this._inputDragLastPos.clone().sub(input.getTouchClientPos(0));\n                    this._x += (delta.x * this.xTouchSpeed);\n                    this._y += (delta.y * this.yTouchSpeed);\n                }\n                this._inputDragLastPos.copy(input.getTouchClientPos(0));\n            } else if (input.currentInputType === InputType.Mouse && input.getMouseButtonHeld(0)) {\n                if (rotateAllowed) {\n                    const delta = this._inputDragLastPos.clone().sub(input.getMouseClientPos());\n                    this._x += (delta.x * this.xMouseSpeed);\n                    this._y += (delta.y * this.yMouseSpeed);\n                }\n                this._inputDragLastPos.copy(input.getMouseClientPos());\n            }\n        }\n    }\n\n    private _zoomControls(): void {\n        if (!this.inputEnabled) {\n            return;\n        }\n        if (!this._zoomEnabled) {\n            return;\n        }\n\n        const input = APEngine.input;\n\n        let zoomDelta: number = 0;\n\n        if (input.currentInputType === InputType.Touch && input.getTouchCount() === 2) {\n            const posA = input.getTouchClientPos(0);\n            const posB = input.getTouchClientPos(1);\n            const distance = posA.distanceTo(posB);\n\n            if (input.getTouchDown(1)) {\n                // Pinch zoom start.\n                this._isZooming = true;\n                \n                // Calculate starting distance between the two touch points.\n                this._inputTouchZoomDist = distance;\n            } else {\n                zoomDelta = ((this._inputTouchZoomDist - distance) * this.zoomTouchSpeed);\n                this._inputTouchZoomDist = distance;\n            }\n        } else if (input.currentInputType === InputType.Mouse && input.getWheelMoved()) {\n            this._isZooming = true;\n            zoomDelta = (input.getWheelData().delta.y * this.zoomMouseSpeed);\n        } else {\n            this._isZooming = false;\n            this._inputTouchZoomDist = 0;\n        }\n\n        if (zoomDelta !== 0) {\n            this._zoomDistance = clamp(this._zoomDistance + zoomDelta, this.zoomMin, this.zoomMax);\n        }\n    }\n\n    private _updateCamera(): void {\n        this._x = clampDegAngle(this._x, this.xMinDeg, this.xMaxDeg);\n        this._y = clampDegAngle(this._y, this.yMinDeg, this.yMaxDeg);\n\n        if (this._camera) {\n            const position = pointOnSphere(\n                this.target, \n                this._zoomDistance, \n                new Vector2(\n                    this.invertY ? -this._y : this._y,\n                    this.invertX ? -this._x : this._x,\n                )\n            );\n            \n            this._camera.gameObject.position.copy(position);\n            this._camera.gameObject.lookAt(this.target);\n        }\n    }\n\n    onUpdate(): void {\n        super.onUpdate();\n        \n        if (!APEngine.isXREnabled() && !TransformTool.isMouseDown() && this.target) {\n            this._rotateControls();\n            this._zoomControls();\n            this._updateCamera();\n        }\n    }\n\n    onLateUpdate(): void {\n        super.onLateUpdate();\n    }\n\n    onDestroy(): void {\n        super.onDestroy();\n    }\n}","export interface IFlags {\n    [key: string]: boolean;\n}\n\n/**\n * An easy to use class for handling a simple collection of flags.\n * This is easier to setup than bitwise flags and uses Typescript to stay strongly typed.\n */\nexport class Flags<T extends IFlags> {\n    private _flags: T;\n\n    get flagCount(): number {\n        return Object.keys(this._flags).length;\n    }\n\n    constructor(initialFlags: T) {\n        this._flags = Object.create(initialFlags);\n        this._flags = Object.assign(this._flags, initialFlags);\n    }\n\n    /**\n     * Set wether or not the given flags are enabled.\n     * If no flags are given, all available flags are assumed.\n     */\n    set<K extends keyof T>(enabled: boolean, ...flags: K[]): void {\n        flags = this._internalGetFlags(flags);\n\n        for (const flag of flags) {\n            this._flags[flag] = enabled as T[K];\n        }\n    }\n\n    /**\n     * Return the name of the flag that sits at the given index.\n     */\n    flagFromIndex(index: number): keyof T | undefined { \n        const keys = Object.keys(this._flags);\n        if (index >= 0 && index < keys.length) {\n            return keys[index];\n        }\n        \n        console.error(`[Flags] Index ${index} is out of range (0 -> ${keys.length - 1})`);\n        return undefined;\n    }\n\n    /**\n     * Toggle the enabled state of the given flags. \n     * This will set flags that are true to false and flags that are false to true.\n     * If no flags are given, all available flags are assumed.\n     */\n    toggle<K extends keyof T>(...flags: K[]): void {\n        flags = this._internalGetFlags(flags);\n\n        for (const flag of flags) {\n            this._flags[flag] = !this._flags[flag] as T[K];\n        }\n    }\n\n    /**\n     * Will return true if one of the given flags is enabled.\n     * If no flags are given, all available flags are assumed.\n     */\n    some<K extends keyof T>(...flags: K[]): boolean {\n        flags = this._internalGetFlags(flags);\n        \n        for (const flag of flags) {\n            if (this._flags[flag]) {\n                return true;\n            }\n        }\n\n        return false;\n    }\n\n    /**\n     * Will return true if all of the given flags are enabled.\n     * If no flags are given, all available flags are assumed.\n     */\n    every<K extends keyof T>(...flags: K[]): boolean {\n        flags = this._internalGetFlags(flags);\n\n        for (const flag of flags) {\n            if (!this._flags[flag]) {\n                return false;\n            }\n        }\n\n        return true;\n    }\n\n    /**\n     * Will return true if none of the given flags are enabled.\n     * If no flags are given, all available flags are assumed.\n     */\n    not<K extends keyof T>(...flags: K[]): boolean {\n        flags = this._internalGetFlags(flags);\n\n        for (const flag of flags) {\n            if (this._flags[flag]) {\n                return false;\n            }\n        }\n\n        return true;\n    }\n\n    only<K extends keyof T>(...flags: K[]): boolean {\n        flags = this._internalGetFlags(flags);\n        const remainingFlags = new Set<keyof T>(Object.keys(this._flags));\n\n        // Check to make sure that the given flags are all enabled.\n        for (const flag of flags) {\n            if (this._flags[flag]) {\n                remainingFlags.delete(flag);\n            } else {\n                // One of the given flags is not enabled.\n                return false;\n            }\n        }\n\n        // Now make sure all of the remaining flags are set to false.\n        for (const flag of remainingFlags) {\n            if (this._flags[flag]) {\n                // One of the remaining flags is enabled.\n                return false;\n            }\n        }\n\n        // Only the given flags are enabled.\n        return true;\n    }\n\n    private _internalGetFlags<K extends keyof T>(flags: K[]): K[] {\n        if (!flags || flags.length === 0) { \n            // No flags were given, return all flags.\n            flags = Object.keys(this._flags) as K[];\n        }\n\n        return flags;\n    }\n\n    toString(): string {\n        return JSON.stringify(this._flags);\n    }\n}","import { IDisposable } from \"../misc/IDisposable\";\nimport { Flags } from \"../misc/Flags\";\n\nexport class TapCode implements IDisposable {\n\n    /**\n     * Debug flags for this tap code object.\n     */\n    debugFlags = new Flags({\n        inputEvents: false,\n        processing: false,\n    });\n\n    /**\n     * Wether or not this tap code be triggered by entering the code via the keyboard.\n     */\n    allowKeyboardEntry: boolean = false;\n    \n    private readonly _code: number[];\n    private readonly _codeStr: string;\n    private _codeEnteredCallback: (tapCode: TapCode) => void;\n    private _touchCount: number = 0;\n    private _codeQueue: number[] = [];\n\n    get code(): string { return this._codeStr; }\n\n    constructor(code: string, onCodeEntered: (tapCode: TapCode) => void) {\n        this._codeEnteredCallback = onCodeEntered;\n        this._codeStr = code;\n        this._code = [];\n\n        // Convert code string into array of numbers.\n        for (let i = 0; i < code.length; i++) {\n            const n = Number.parseInt(code[i]);\n            if (Number.isInteger(n)) {\n                if (n > 0 && n <= 5) {\n                     this._code.push(n);\n                } else {\n                    console.error(`[TapCode] ${n} must be in the range of 1 to 5.`);\n                }\n            } else {\n                console.error(`[TapCode] ${n} is not an integer. Tap code must be string of only integer numbers in the range of 1 to 5.`);\n            }\n        }\n        this._onKeyDown = this._onKeyDown.bind(this);\n        this._onTouchStart = this._onTouchStart.bind(this);\n        this._onTouchEnd = this._onTouchEnd.bind(this);\n\n        document.body.addEventListener('keydown', this._onKeyDown);\n        document.body.addEventListener('touchstart', this._onTouchStart);\n        document.body.addEventListener('touchend', this._onTouchEnd);\n    }\n\n    private _onKeyDown(event: KeyboardEvent): void {\n        if (!event.repeat && this.allowKeyboardEntry) {\n            switch (event.key) {\n                case '1': \n                    this._endTouch(1);\n                    break;\n                case '2':\n                    this._endTouch(2);\n                    break;\n                case '3':\n                    this._endTouch(3);\n                    break;\n                case '4':\n                    this._endTouch(4);\n                    break;\n                case '5':\n                    this._endTouch(5);\n                    break;\n            }\n        }\n    }\n\n    private _onTouchStart(event: TouchEvent): void {\n        this._touchCount = event.touches.length;\n\n        if (this.debugFlags.some('inputEvents')) {\n            console.log(`[TapCode] Touch began. count: ${this._touchCount}`);\n        }\n    }\n\n    private _onTouchEnd(event: TouchEvent): void {\n        if (event.touches.length < this._touchCount) {\n            if (this.debugFlags.some('inputEvents')) {\n                console.log(`[TapCode] Touch ended. count: ${this._touchCount}`);\n            }\n\n            this._endTouch(this._touchCount);\n            this._touchCount = 0;\n        }\n    }\n\n    private _endTouch(touchCount: number): void {\n        if (touchCount < 1) { \n            return;\n        }\n\n        this._codeQueue.push(touchCount);\n\n        if (this._codeQueue.length > this._code.length) {\n            this._codeQueue.splice(0, this._codeQueue.length - this._code.length);\n        }\n\n        if (this.debugFlags.some('processing')) {\n            console.log(`[TapCode] Code: ${this._codeStr} Current entry: ${JSON.stringify(this._codeQueue)}`);\n        }\n\n        if (this._codeQueue.length < this._code.length) {\n            // Not enough taps yet.\n            if (this.debugFlags.some('processing')) {\n\n            }\n            return;\n        }\n\n        for (let i = 0; i < this._codeQueue.length; i++) {\n            if (this._codeQueue[i] != this._code[i]) {\n                // Number doesn't match at this position yet.\n                return;\n            }\n        }\n\n        // Tap code success!\n        if (this.debugFlags.some('processing')) {\n            console.log(`[TapCode] ${this._codeStr} triggered!`);\n        }\n\n        this._codeQueue = [];\n        this._codeEnteredCallback(this);\n    }\n\n    dispose(): void {\n        this._codeEnteredCallback = null;\n\n        document.body.removeEventListener('keydown', this._onKeyDown);\n        document.body.removeEventListener('touchstart', this._onTouchStart);\n        document.body.removeEventListener('touchend', this._onTouchEnd);\n    }\n}","import { DeviceCamera } from '../DeviceCamera';\nimport { IDisposable } from '../../misc/IDisposable';\n\nexport interface IDeviceCameraReaderOptions {\n    deviceCamera: DeviceCamera\n}\n\nexport class DeviceCameraReader implements IDisposable {\n\n    private _deviceCamera: DeviceCamera;\n    private _canvas: HTMLCanvasElement;\n    private _running: boolean = false;\n    private _updateHandle: number;\n\n    get deviceCamera(): DeviceCamera { return this._deviceCamera };\n\n    get canvas(): HTMLCanvasElement { return this._canvas };\n\n    get running(): boolean { return this._running; };\n\n    constructor() {\n        this._canvas = document.createElement('canvas');\n\n        this._update = this._update.bind(this);\n    }\n\n    /**\n     * Start the camera reader with the given options.\n     */\n    start(options: IDeviceCameraReaderOptions): void {\n        if (this._running) {\n            throw new Error(`${this.constructor.name} is already running. Check 'running' property before calling start()`);\n        }\n        \n        this._deviceCamera = options.deviceCamera;\n        this._running = true;\n\n        this._updateHandle = requestAnimationFrame(this._update);\n    }\n\n    private _update(): void {\n        if (this._running && this._deviceCamera && this._deviceCamera.isPlaying()) {\n            const video = this._deviceCamera.getVideoElement();\n            this._canvas.width = video.videoWidth;\n            this._canvas.height = video.videoHeight;\n            const ctx = this._canvas.getContext('2d');\n            ctx.drawImage(video, 0, 0, this._canvas.width, this._canvas.height);\n\n            this.onRenderedToCanvas(this._canvas);\n        }\n\n        this._updateHandle = requestAnimationFrame(this._update);\n    }\n\n    protected onRenderedToCanvas(canvas: HTMLCanvasElement): void {\n        // Do nothing by default.\n    }\n\n    stop(): void {\n        this._deviceCamera = null;\n        this._running = false;\n\n        if (typeof this._updateHandle === 'number') {\n            cancelAnimationFrame(this._updateHandle);\n        }\n    }\n\n    dispose(): void {\n        this._deviceCamera = null;\n        this._canvas = null;\n    }\n}","import jsQR from 'jsqr';\nimport { ArgEvent } from '../../misc/Events';\nimport { IDeviceCameraReaderOptions, DeviceCameraReader } from './DeviceCameraReader';\n\nexport class DeviceCameraQRReader extends DeviceCameraReader {\n    /**\n     * Event that is invoked when a qr code is scanned.\n     */\n    onQRScanned: ArgEvent<string> = new ArgEvent();\n\n    constructor() {\n        super();\n    }\n\n    start(options: IDeviceCameraReaderOptions): void {\n        super.start(options);\n    }\n\n    protected onRenderedToCanvas(canvas: HTMLCanvasElement): void {\n        super.onRenderedToCanvas(canvas);\n\n        const ctx = canvas.getContext('2d');\n        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\n        const code = jsQR(imageData.data, imageData.width, imageData.height, {\n            inversionAttempts: \"dontInvert\"\n        });\n\n        if (code) {\n            this.onQRScanned.invoke(code.data);\n        }\n    }\n    \n    stop(): void {\n        super.stop();\n    }\n\n    dispose(): void {\n        super.dispose();\n\n        this.onQRScanned.removeAllListeners();\n    }\n}","import { ArgEvent } from \"./Events\";\nimport { APEngine } from \"../APEngine\";\nimport isEqual from \"lodash/isEqual\";\nimport { IDisposable } from \"./IDisposable\";\n\nexport abstract class State<Id, Command> {\n    private _id: Id;\n    private _stateMachine: StateMachine<Id, Command>;\n\n    /**\n     * The id of the state.\n     */\n    get id(): Id { return this._id }\n\n    /**\n     * The state machine that the state belongs to.\n     */\n    get stateMachine(): StateMachine<Id, Command> { return this._stateMachine }\n\n    constructor(id: Id, stateMachine: StateMachine<Id, Command>) {\n        this._id = id;\n        this._stateMachine = stateMachine;\n    }\n\n    abstract onStateEnter(): void;\n    abstract onStateUpdate(): Command;\n    abstract onStateExit(): void;\n    abstract dispose(): void;\n}\n\ninterface ITransition<Id, Command> {\n    fromStateId: Id,\n    command: Command,\n    nextStateId: Id\n}\n\nexport class StateMachine<Id, Command> implements IDisposable {\n    /**\n     * Debug level for this state machine.  \n     * 0 = Disabled  \n     * 1 = State enter/exit  \n     * 2 = State command\n     * 3 = State update\n     */\n    debugLevel: number = 0;\n\n    private _name: string;\n    private _states: Map<Id, State<Id, Command>> = new Map();\n    private _transitions: ITransition<Id, Command>[] = [];\n    private _curState: State<Id, Command>;\n    private _changeStateId: Id;\n    private _lastStateUpdate: number;\n    private _active: boolean;\n    private _prevTransition: ITransition<Id, Command>;\n\n    /**\n     * The name of the state machine.\n     */\n    get name(): string { return this._name; } \n\n    /**\n     * The current state that the state machine is in.\n     */\n    get currentState(): State<Id, Command> { return this._curState; }\n\n    /**\n     * The previous transition used to get to the current state.\n     */\n    get previousTransition(): ITransition<Id, Command> { return this._prevTransition; }\n\n    onStateEnter: ArgEvent<Id> = new ArgEvent();\n    onStateExit: ArgEvent<Id> = new ArgEvent();\n\n    constructor(name: string) {\n        this._name = name;\n    }\n\n    /**\n     * Startup the state machine in the given state.\n     */\n    start(startingStateId: Id): void {\n        if (this._active) {\n            return;\n        }\n\n        this._active = true;\n\n        this._changeState(startingStateId);\n        this.update();\n    }\n\n    /**\n     * Pause updating the state machine.\n     */\n    pause(): void {\n        if (!this._active) {\n            return;\n        }\n\n        this._active = false;\n    }\n\n    /**\n     * Resume updating the state machine.\n     */\n    resume(): void {\n        if (this._active) {\n            return;\n        }\n\n        this._active = true;\n        this.update();\n    }\n\n    /**\n     * Add the given state to the state machine.\n     */\n    addState(state: State<Id, Command>): void {\n        if (this._active) {\n            throw new Error(`Cannot add states after the state machine has been started.`);\n        }\n\n        this._states.set(state.id, state);\n    }\n\n    /**\n     * Add the given transition to the state machine.\n     */\n    addStateTransition(fromStateId: Id, command: Command, nextStateId: Id): void {\n        if (this._active) {\n            throw new Error(`Cannot add state transitions after the state machine has been started.`);\n        }\n\n        const transition = { fromStateId, command, nextStateId };\n\n        if (!this._states.has(nextStateId)) {\n            throw new Error(`Can't add transition for State '${nextStateId}'. This state does not exist on the state machine.`);\n        }\n\n        const alreadyAdded: boolean = this._transitions.some(t => isEqual(t, transition));\n        if (!alreadyAdded) {\n            this._transitions.push(transition);\n        }\n    }\n\n    /**\n     * Return the state that is assigned the given state id.\n     */\n    getState(stateId: Id) {\n        return this._states.get(stateId);\n    }\n\n    /**\n     * Update the state machine. Should be called once per frame.\n     */\n    update(): void {\n        if (!this._active) {\n            return;\n        }\n\n        this._updateState();\n    }\n\n    /**\n     * Usually this state machine should be controlled with state transitions, but in some cases we may want to force a state change.\n     */\n    forceChangeState(stateId: Id): void {\n        this._changeState(stateId);\n    }\n\n    /**\n     * Dispose of the state machine.\n     */\n    dispose(): void {\n        for (const [id, state] of this._states) {\n            state.dispose();\n        }\n\n        this._active = false;\n        this._curState = null;\n        this._changeStateId = null;\n        this._lastStateUpdate = null;\n        this._transitions = [];\n        this._states = new Map();\n        this._prevTransition = null;\n\n        this.onStateEnter.removeAllListeners();\n        this.onStateExit.removeAllListeners();\n    }\n\n    private _changeState(stateId: Id): void {\n        this._changeStateId = stateId;\n        \n        // Set the last update frame to an invalid number so that the update state function is forced to run.\n        this._lastStateUpdate = -1;\n\n        // Run the update state function immediately to respond to change the state in the same frame.\n        this._updateState();\n    }\n\n    private _getTransition(command: Command): ITransition<Id, Command> {\n        if (!this._transitions) {\n            return null;\n        }\n\n        const transition = this._transitions.find(t => t.command === command && t.fromStateId === this._curState.id);\n\n        if (!transition) {\n            throw new Error(`[StateMachine::${this._name}] No transition found for State '${this._curState.id}' with command '${command}'`);\n        }\n\n        return transition;\n    }\n\n    private _updateState(): void {\n        if (this._lastStateUpdate === APEngine.time.frameCount) {\n            return;\n        }\n\n        this._lastStateUpdate = APEngine.time.frameCount;\n\n        if (this._changeStateId) {\n            if (this._curState) {\n                if (this.debugLevel >= 1) {\n                    console.log(`[StateMachine::${this._name}] ${this._curState.id} onStateExit. Frame: ${APEngine.time.frameCount}`);\n                }\n\n                this._curState.onStateExit();\n                this.onStateExit.invoke(this._curState.id);\n            }\n\n            this._curState = this._states.get(this._changeStateId);\n            if (this._curState) {\n                if (this.debugLevel >= 1) {\n                    console.log(`[StateMachine::${this._name}] ${this._curState.id} onStateEnter. Frame: ${APEngine.time.frameCount}`);\n                }\n\n                this._curState.onStateEnter();\n                this.onStateEnter.invoke(this._curState.id);\n            } else {\n                throw new Error(`[StateMachine::${this._name}] No State with Id ${this._changeStateId} found.`);\n            }\n\n            this._changeStateId = null;\n        }\n\n        if (this._curState) {\n            if (this.debugLevel >= 3) {\n                console.log(`[StateMachine::${this._name}] ${this._curState.id} onStateUpdate. Frame: ${APEngine.time.frameCount}`);\n            }\n\n            const command = this._curState.onStateUpdate();\n\n            if (command) {\n                const transition = this._getTransition(command);\n                this._prevTransition = transition;\n\n                if (this.debugLevel >= 2) {\n                    console.log(`[StateMachine::${this._name}] ${this._curState.id} Command: ${command}, NextStateId: ${transition.nextStateId}. Frame: ${APEngine.time.frameCount}`);\n                }\n\n                this._changeState(transition.nextStateId);\n            }\n        }\n    }\n}","import { ArgEvent } from '../misc/Events';\nimport isEqual from 'lodash/isEqual';\n\nexport interface IPropertyChangedEvent<T> {\n    newValue: T;\n    previousValue: T;\n}\n\n/**\n * Property Spectator is a simple wrapper object around any javascript value that has events for \n * when it is set/changed as well as polling function for changes.\n */\nexport class PropertySpectator<T> {\n    private _value: T = null;\n    private _prevValue: T = null;\n\n    /**\n     * Event invoked when the property value is changed.\n     */\n    onValueChanged: ArgEvent<IPropertyChangedEvent<T>> = new ArgEvent();\n    \n    constructor(value?: T) {\n        this._value = value;\n    }\n\n    /**\n     * The property's current value.\n     */\n    get value(): T {\n        return this._value;\n    }\n\n    set value(obj: T) {\n        if (!isEqual(this._value, obj)) {\n            this._prevValue = this._value;\n            this._value = obj;\n\n            this.onValueChanged.invoke({\n                newValue: this._value,\n                previousValue: this._prevValue\n            });\n        }\n    }\n\n    /**\n     * The property's previous value.\n     */\n    get previousValue(): T {\n        return this._prevValue;\n    }\n\n    /**\n     * Does the property currently have a value assigned.\n     */\n    get hasValue(): boolean {\n        return (this._value !== null && this._value !== undefined);\n    }\n}","import remove from 'lodash/remove';\nimport { MathUtils } from 'three';\nimport { getOptionalValue } from '../utils/MiscUtils';\n\n/**\n * This is a generic object pool class that can be extended from to implement a pool for\n * theoretically any type of object you would want.\n */\nexport abstract class ObjectPool<T> {\n    name: string;\n\n    /**\n     * Log a warning to the console when the pool empty, causing a new object to be generated during retrieve.\n     */\n    poolEmptyWarn: boolean;\n\n    private _pool: T[];\n\n    /**\n     * Simple map of objects that this pool is responsible for and has created.\n     * Used mostly to check that an object being placed back in the pool actually does belong here.\n     */\n    private _objectIds: Map<string, boolean>;\n\n    get poolSize(): number {\n        return this._pool.length;\n    }\n\n    constructor(name?: string, poolEmptyWarn?: boolean) {\n        this.name = getOptionalValue(name, `ObjectPool_${MathUtils.generateUUID()}`);\n        this.poolEmptyWarn = getOptionalValue(poolEmptyWarn, true);\n        this._objectIds = new Map<string, boolean>();\n    }\n\n    /**\n     * Initialize the pool of objects.\n     * @param startSize [Optional] How starting size of the object pool (Default is 5).\n     */\n    initializePool(startSize?: number): this {\n        if (this._pool) return;\n\n        startSize = startSize || 5;\n\n        this._pool = [];\n\n        for (let i = 0; i < startSize; i++) {\n            const obj = this.createPoolObject();\n            const id = this.getPoolObjectId(obj);\n            this._objectIds.set(id, true);\n\n            this._pool.push(obj);\n        }\n\n        return this;\n    }\n\n    /**\n     * Retrieve an object from the pool.\n     */\n    retrieve(): T {\n        if (!this._pool) {\n            this.initializePool();\n        }\n\n        let obj: T = null;\n\n        if (this._pool.length > 0) {\n            obj = this._pool[0];\n            remove(this._pool, o => o === obj);\n        } else {\n            if (this.poolEmptyWarn) {\n                console.warn(\n                    '[ObjectPool]',\n                    this.name,\n                    'ran out of objects in its pool, so it is generating another one.'\n                );\n            }\n            obj = this.createPoolObject();\n            const id = this.getPoolObjectId(obj);\n            this._objectIds.set(id, true);\n        }\n\n        this.onRetrieved(obj);\n\n        return obj;\n    }\n\n    /**\n     * Restore the object to the pool.\n     * @param obj\n     */\n    restore(obj: T): boolean {\n        if (!this._pool) {\n            console.warn(\n                \"[ObjectPool] Can't place object\",\n                obj,\n                'in pool',\n                this.name,\n                'because the pool was never initialized.'\n            );\n            return false;\n        }\n\n        const id = this.getPoolObjectId(obj);\n        if (!this._objectIds.has(id)) {\n            console.warn(\n                \"[ObjectPool] Can't place object\",\n                obj,\n                'in pool',\n                this.name,\n                'because it does not originate from it.'\n            );\n            return false;\n        }\n\n        this._pool.push(obj);\n        this.onRestored(obj);\n\n        return true;\n    }\n\n    /**\n     * Dispose of the pool and any objects it is holding on to.\n     */\n    dispose(): void {\n        if (this._pool) {\n            for (let i = this._pool.length - 1; i >= 0; i--) {\n                let obj = this._pool[i];\n                if (obj) {\n                    this.disposePoolObject(obj);\n                }\n\n                this._pool.splice(i, 1);\n            }\n        }\n\n        this._objectIds.clear();\n    }\n\n    /**\n     * Called when an object is retrieved from the pool.\n     * @param obj The object that was retrieved.\n     */\n    protected abstract onRetrieved(obj: T): void;\n\n    /**\n     * Called when an object is restored to the pool.\n     * @param obj The object that was restored.\n     */\n    protected abstract onRestored(obj: T): void;\n\n    /**\n     * Called to create a new object for the pool.\n     */\n    protected abstract createPoolObject(): T;\n\n    /**\n     * Called to retireve an unique id for the given object.\n     * @param obj The object to get an id for.\n     */\n    protected abstract getPoolObjectId(obj: T): string;\n\n    /**\n     * Called when the object is being disposed of.\n     * @param obj The object being disposed.\n     */\n    protected abstract disposePoolObject(obj: T): void;\n}","import { Geometry, Material, Texture, Object3D, Mesh, SkinnedMesh, BufferGeometry, TextureDataType, Skeleton, MathUtils } from \"three\";\n\ndeclare type Trackable = Object3D | Geometry | BufferGeometry | Material | Texture | Skeleton;\n\nexport interface IAssetCount {\n    object3d: number;\n    geometry: number;\n    material: number;\n    texture: number;\n    skeleton: number;\n    unknown: number;\n}\n\nexport interface IAssetReference { \n    asset: Trackable,\n    referenceCount: number\n}\n\nexport interface IAssetSnapshot {\n    uuid: string,\n    name: string,\n    type: string | TextureDataType,\n    referenceCount: number\n}\n\nexport interface ISnapshot {\n    assetSnapshots: IAssetSnapshot[]\n}\n\n/**\n * APE Asset Tracker is a class that tracks objects that must be manually cleaned up that are created by Three JS.\n * These include geometries, materials, and textures.\n * \n * To use this tracker, create a new instance of it and then call track() with the given asset you would like to track.\n * The tracker will then recursively search through the asset's heirarchy (if it as one) as track all geometries, materials, and textures that it finds.\n * When you are ready to dispose of the tracked assets, call the dispose() function.\n *  \n * Reference: https://threejsfundamentals.org/threejs/lessons/threejs-cleanup.html\n */\nexport namespace APEAssetTracker {\n\n    /**\n     * Map of tracked assets indexed by the trackable's uuid.\n     */\n    export let assetRefs: Map<string, IAssetReference> = new Map();\n\n    /**\n     * Debug level for asset tracker.\n     * 0: Disabled, 1: Track/Release events, 2: Total counts\n     */\n    export let debugLevel: number = 0;\n\n    export let snapshots: ISnapshot[] = [];\n\n    /**\n     * Map of uuids for objects that do not define a uuid within themselves.\n     */\n    let internalUUIDs: Map<any, string> = new Map();\n\n    function getUUID(trackable: Trackable): string {\n        if ('uuid' in trackable) {\n            return trackable.uuid;\n        } else {\n            let uuid = internalUUIDs.get(trackable);\n            if (!uuid) {\n                uuid = MathUtils.generateUUID();\n                internalUUIDs.set(trackable, uuid);\n            }\n\n            return uuid;\n        }\n    }\n\n    function getName(trackable: Trackable): string {\n        if ('name' in trackable) {\n            return trackable.name;\n        } else if (trackable instanceof Skeleton) {\n            return 'Skeleton';\n        } else {\n            return 'Unnamed';\n        }\n    }\n\n    function getType(trackable: Trackable): string | TextureDataType {\n        if ('type' in trackable) {\n            return trackable.type;\n        } else if (trackable instanceof Skeleton) {\n            return 'Skeleton';\n        } else {\n            return 'Unknown Type';\n        }\n    }\n\n    /**\n     * Recursive search function that will collect all objects underneath the given asset that can be considered a Trackable.\n     * Each item's key in the Map is the trackable's uuid.\n     */\n    function findTrackables(asset: any, trackables: Map<string, Trackable>): void {\n        if (!asset) {\n            return;\n        }\n    \n        // Handle arrays of objects, materials, and textures.\n        if (Array.isArray(asset)) {\n            asset.forEach(resource => findTrackables(resource, trackables));\n            return;\n        }\n    \n        if ('dispose' in asset || asset instanceof Object3D) {\n            trackables.set(getUUID(asset), asset);\n        }\n    \n        if (asset instanceof Object3D) {\n            if (asset instanceof Mesh) {\n                findTrackables(asset.geometry, trackables);\n                findTrackables(asset.material, trackables);\n    \n                if (asset instanceof SkinnedMesh) {\n                    findTrackables(asset.skeleton, trackables);\n                }\n            }\n    \n            findTrackables(asset.children, trackables);\n        } else if (asset instanceof Material) {\n            // We have to check if there are any textures on the material\n            for (const value of Object.values(asset)) {\n                if (value instanceof Texture) {\n                    findTrackables(value, trackables);\n                }\n            }\n            \n            // We also have to check if any uniforms reference textures or arrays of textures\n            if ('uniforms' in asset) {\n                const uniforms = (<any>asset).uniforms;\n                for (const uniform of Object.values(uniforms)) {\n                    if (uniform) {\n                        const uniformValue = (<any>uniform).value;\n                        if (uniformValue instanceof Texture || Array.isArray(uniformValue)) {\n                            findTrackables(uniformValue, trackables);\n                        }\n                    }\n                }\n            }\n        }\n    }\n\n    export function getAssetCounts(): IAssetCount {\n        const assetCounts: IAssetCount = {\n            geometry: 0,\n            material: 0,\n            object3d: 0,\n            texture: 0,\n            skeleton: 0,\n            unknown: 0\n        }\n\n        assetRefs.forEach((assetRef) => {\n            const asset = assetRef.asset;\n\n            if (asset instanceof Object3D) {\n                assetCounts.object3d++;\n            } else if (asset instanceof Material) {\n                assetCounts.material++;\n            } else if (asset instanceof Geometry || asset instanceof BufferGeometry) {\n                assetCounts.geometry++;\n            } else if (asset instanceof Texture) {\n                assetCounts.texture++;\n            } else if (asset instanceof Skeleton) {\n                assetCounts.skeleton++;\n            } else {\n                assetCounts.unknown++;\n            }\n        });\n\n        return assetCounts;\n    }\n\n    /**\n     * Take a snapshot of the current state of asset references.\n     * This is useful for comparing snapshots during debugging to figure out which assets are not \n     * being untracked and cleaned up properly.\n     */\n    export function takeSnapshot(): ISnapshot {\n        const snapshot: ISnapshot = {\n            assetSnapshots: []\n        };\n\n        assetRefs.forEach((assetRef) => {\n            snapshot.assetSnapshots.push({\n                uuid: getUUID(assetRef.asset),\n                name: getName(assetRef.asset),\n                type: getType(assetRef.asset),\n                referenceCount: assetRef.referenceCount,\n            });\n        });\n\n        snapshots.push(snapshot);\n\n        return snapshot;\n    }\n    \n    export function clearSnapshots(): void {\n        snapshots = [];\n    }\n\n    export function diffOfLastTwoSnapshots(): IAssetSnapshot[] {\n        if (snapshots.length >= 2) {\n            return diffOfSnapshots(snapshots[snapshots.length - 2], snapshots[snapshots.length - 1]);\n        } else {\n            console.warn(`Need at least two snapshots in order to diff the last two.`);\n        }\n    }\n\n    export function diffOfSnapshots(snapshotA: ISnapshot, snapshotB: ISnapshot): IAssetSnapshot[] {\n        const setA = Array.from(new Set(snapshotA.assetSnapshots));\n        const setB = Array.from(new Set(snapshotB.assetSnapshots));\n\n        // Create a diff set that has the elements from setA that are not in setB.\n        const diff = [];\n        for (const entry of setA) {\n            const inSetB = setB.some(snap => snap.uuid === entry.uuid);\n            if (!inSetB) {\n                diff.push(entry);\n            }\n        }\n        \n        return diff;\n    }\n\n    export function intersectOfLastTwoSnapshots(): IAssetSnapshot[] {\n        if (snapshots.length >= 2) {\n            return intersectOfSnapshots(snapshots[snapshots.length - 2], snapshots[snapshots.length - 1]);\n        } else {\n            console.warn(`Need at least two snapshots in order to intersect the last two.`);\n        }\n    }\n\n    export function intersectOfSnapshots(snapshotA: ISnapshot, snapshotB: ISnapshot): IAssetSnapshot[] {\n        const setA = Array.from(new Set(snapshotA.assetSnapshots));\n        const setB = Array.from(new Set(snapshotB.assetSnapshots));\n\n        // Create a intersection set that has the elements that are in both setA and setB.\n        const intersect = [];\n        for (const entry of setA) {\n            const inSetB = setB.some(snap => snap.uuid === entry.uuid);\n            if (inSetB) {\n                intersect.push(entry);\n            }\n        }\n\n        return intersect;\n    }\n\n    /**\n     * Track the given asset by incrementing the reference counter for it.\n     */\n    export function track(asset: any): void {\n        const trackables = new Map<string, Trackable>();\n        findTrackables(asset, trackables);\n\n        if (trackables && trackables.size > 0) {\n            trackables.forEach((asset, uuid) => {\n                let assetRef: IAssetReference = assetRefs.get(uuid);\n\n                if (assetRef) {\n                    assetRef.referenceCount++;\n                } else {\n                    assetRef = {\n                        asset: asset,\n                        referenceCount: 1\n                    };\n\n                    assetRefs.set(getUUID(asset), assetRef);\n                }\n\n                if (debugLevel >= 1) {\n                    console.log(`[APEAssetTracker] track asset type: ${asset.constructor.name}, uuid: ${getUUID(asset)}, refCount: ${assetRef.referenceCount}`);\n                }\n                if (debugLevel >= 2) {\n                    console.log(`[APEAssetTracker] tracked assets -> ${JSON.stringify(getAssetCounts())}`);\n                }\n            });\n        }\n    }\n\n    /**\n     * Untrack the given asset by decrementing the reference counter for it. If the reference counter reaches zero, the asset will be released.\n     */\n    export function untrack(asset: any): void {\n        const trackables = new Map<string, Trackable>();\n        findTrackables(asset, trackables);\n\n        if (trackables && trackables.size > 0) {\n            trackables.forEach((asset, uuid) => {\n                // Only release assets that are explicitly tracked by the tracker.\n                // We dont want to cause unintended behaviour by releasing an untracked trackable asset.\n                const assetRef = assetRefs.get(uuid);\n\n                if (assetRef) {\n                    if (assetRef.referenceCount > 0) {\n                        assetRef.referenceCount--;\n\n                        if (debugLevel >= 1) {\n                            console.log(`[APEAssetTracker] decrement reference count for asset type: ${asset.constructor.name}, uuid: ${getUUID(asset)}, refCount: ${assetRef.referenceCount}`);\n                        }\n                    }\n\n                    if (assetRef.referenceCount <= 0) {\n                        if (debugLevel >= 1) {\n                            console.log(`[APEAssetTracker] release asset type: ${asset.constructor.name}, uuid: ${getUUID(asset)}`);\n                        }\n                    \n                        if (asset instanceof Object3D) {\n                            if (asset.parent) {\n                                asset.parent.remove(asset);\n                            }\n                        }\n            \n                        if ('dispose' in asset) {\n                            asset.dispose();\n                        }\n                        \n                        // Remove the tracked asset from the map.\n                        assetRefs.delete(uuid);\n\n                        // Remove the asset from the internal uuid map (if it is even in it).\n                        internalUUIDs.delete(asset);\n    \n                        if (debugLevel >= 2) {\n                            console.log(`[APEAssetTracker] tracked assets -> ${JSON.stringify(getAssetCounts())}`);\n                        }\n                    }\n                }\n            });\n        }\n    }\n\n    /**\n     * Dispose of all tracked assets.\n     */\n    export function dispose(): void {\n        assetRefs.forEach((assetRef, uuid) => {\n            const asset = assetRef.asset;\n\n            untrack(asset);\n            if (asset instanceof Object3D) {\n                if (asset.parent) {\n                    asset.parent.remove(asset);\n                }\n            }\n\n            if ('dispose' in asset) {\n                asset.dispose();\n            }\n        });\n\n        assetRefs = new Map();\n        snapshots = [];\n        internalUUIDs = new Map();\n    }\n}","import { Object3D } from 'three';\nimport { APEAssetTracker } from '../resources/APEAssetTracker';\nimport { ObjectPool } from './ObjectPool';\n\nexport class Object3DPool extends ObjectPool<Object3D> {\n    private _sourceObject: Object3D;\n\n    constructor(\n        sourceObject: Object3D,\n        name?: string,\n        poolEmptyWarn?: boolean\n    ) {\n        super(name, poolEmptyWarn);\n\n        this._sourceObject = sourceObject.clone(true);\n        this._sourceObject.parent = null;\n\n        APEAssetTracker.track(this._sourceObject);\n    }\n\n    protected onRetrieved(obj: Object3D): void {\n        // Do nothing.\n    }\n\n    protected onRestored(obj: Object3D): void {\n        if (obj.parent) {\n            // Remove from its current parent.\n            obj.parent.remove(obj);\n            obj.parent = null;\n        }\n    }\n\n    protected createPoolObject(): Object3D {\n        const obj = this._sourceObject.clone(true);\n        APEAssetTracker.track(obj);\n\n        return obj;\n    }\n\n    protected getPoolObjectId(obj: Object3D): string {\n        return obj.uuid;\n    }\n\n    protected disposePoolObject(obj: Object3D): void {\n        APEAssetTracker.untrack(obj);\n    }\n}","\nimport { Resource, IResourceConfig } from './Resource';\nimport { IDisposable } from \"../misc/IDisposable\";\n\ntype ConfigType<T> = T extends Resource<any, infer P> ? P : never;\n\n/**\n * A Resource Manager is a generic class that manages any type of Resouce that it is created for.\n * Resource Managers load, track, retrieve, and dipose of any Resources assigned to it.\n */\nexport class ResourceManager<T extends Resource<any, IResourceConfig>> implements IDisposable {\n    private _resources = new Map<string, T>();\n    private _activator: { new(name: string, config: IResourceConfig): T };\n\n    constructor(resourceActivator: { new(name: string, config: any): T }) {\n        this._activator = resourceActivator;\n    }\n\n    add(name: string, config: ConfigType<T>): void {\n        if (!this._resources.has(name)) {\n            const resource = new this._activator(name, config);\n            this._resources.set(resource.name, resource);\n        }\n    }\n\n    unload(name: string) {\n        if (this._resources.has(name)) {\n            const resource = this._resources.get(name);\n            resource.unload();\n            this._resources.delete(name);\n        }\n    }\n\n    has(name: string): boolean {\n        return this._resources.has(name);\n    }\n\n    count(): number {\n        return this._resources.size;\n    }\n\n    async get(name: string): Promise<T> {\n        if (this._resources.has(name)) {\n            const resource = this._resources.get(name);\n            if (!resource.loaded) {\n                await resource.load();\n            }\n            return resource;\n        } else {\n            throw new Error(`Could not get resource: ${name}`);\n        }\n    }\n    \n    lookup(name: string): T {\n        return this._resources.get(name);\n    }\n\n    /**\n     * Returns the combined loading progress of all resources that are currently in this Resource Manager.\n     */\n    getLoadProgress(): Readonly<number> {\n        if (this._resources.size > 0) {\n            let pTotal = 0;\n\n            for (const [resourceName, resource] of this._resources) {\n                pTotal += resource.progress;\n            }\n            \n            return pTotal / this._resources.size;\n        } else {\n            return 1;\n        }\n    }\n\n    async preload(): Promise<void> {\n        if (this._resources.size > 0) {\n            const resources: Resource<any, any>[] = Array.from(this._resources.values());\n            await Promise.all(resources.map(r => r.load()));\n        }\n    }\n\n    /**\n     * Returns wether all Resources that are currently in this Resource Manager are loaded or not.\n     */\n    allLoaded(): boolean {\n        if (this._resources.size > 0) {\n            const resources: Resource<any, any>[] = Array.from(this._resources.values());\n            for (let resource of resources) {\n                if (!resource.loaded) {\n                    return false;\n                }\n            }\n            return true;\n        } else {\n            return true;\n        }\n    }\n\n    /**\n     * Returns a map of all resource names currenty in the resource manager and wether or not they are currently loaded.\n     */\n    loadState(): Map<string, boolean> {\n        const map = new Map<string, boolean>();\n\n        for (const [resourceName, resource] of this._resources) {\n            map.set(resourceName, resource.loaded);\n        }\n\n        return map;\n    }\n\n    dispose(): void {\n        this._resources.forEach((resource) => {\n            resource.dispose();\n        });\n\n        this._resources = new Map();\n    }\n}","import { IDisposable } from \"../misc/IDisposable\";\n\nexport interface IResourceConfig {\n}\n\n/**\n * Base class of all resource objects that are loaded by ResourceManagers.\n * Resource is a generic class that returns an internally loaded object/asset.\n * Classed that derive from Resource should specifify what the object being loaded is.\n */\nexport abstract class Resource<O, K extends IResourceConfig> implements IDisposable {\n    private _name: string = undefined;\n    private _loaded: boolean = false;\n    private _loadPromise: Promise<Resource<O, K>> = null;\n    private _object: O = null;\n\n    protected _progress: number = 0;\n\n    get name(): string {\n        return this._name;\n    }\n\n    get loaded(): boolean {\n        return this._loaded;\n    }\n\n    get progress(): number {\n        return this._progress;\n    }\n\n    get object(): O {\n        return this._object;\n    }\n\n    constructor(name: string, config: K) {\n        this._name = name;\n    }\n\n    async load(): Promise<Resource<O, K>> {\n        try {\n            if (!this._loaded) {\n                if (!this._loadPromise) {\n                    this._loadPromise = new Promise((resolve) => {\n                        this._loadObject().then((object) => {\n                            this._object = object;\n                            this._loaded = true;\n                            this._progress = 1;\n                            this._loadPromise = null;\n    \n                            resolve(this);\n                        });\n                    });\n                }\n\n                return this._loadPromise;\n            } else {\n                return this;\n            }\n        } catch(error) {\n            this._loaded = false;\n            this._progress = 0;\n            console.error(`Could not load resource ${this.name}.`);\n            console.error(error);\n        }\n    }\n\n    unload(): void {\n        if (this._object) {\n            this._unloadObject();\n        }\n        this._object = null;\n        this._progress = 0;\n    }\n\n    dispose(): void {\n        this.unload();\n    }\n\n    /**\n     * This function should be implemented by classed that derive from Resource\n     * to return a promise that for the Resource's given object type.\n     */\n    protected abstract async _loadObject(): Promise<O>;\n\n    /**\n     * This function should be implemented by classed that derive from Resource\n     * to unload and release memory for the Resource's loaded object.\n     */\n    protected abstract _unloadObject(): void;\n}\n","import { Resource, IResourceConfig } from \"./Resource\";\nimport { getOptionalValue } from \"../utils/MiscUtils\";\nimport { Howl } from \"howler\";\n\nexport interface IAudioConfig extends IResourceConfig {\n    url: string,\n    loop?: boolean\n}\n\nexport class AudioResource extends Resource<Howl, IAudioConfig> {\n    private _url: string;\n    private _loop: boolean;\n\n    constructor(name: string, config: IAudioConfig) {\n        super(name, config);\n\n        this._url = config.url;\n        this._loop = getOptionalValue(config.loop, false);\n    }\n\n    protected _loadObject(): Promise<Howl> {\n        return new Promise<Howl>(((resolve: (value: Howl) => void, reject) => {\n            const howl = new Howl({\n                src: this._url,\n                loop: this._loop,\n                onload: () => {\n                    resolve(howl);\n                },\n                onloaderror: (soundId: number, error: any) => {\n                    reject(error);\n                }\n            });\n        }));\n    }\n\n    protected _unloadObject(): void {\n        this.object.unload();\n    }\n}","import { APEAssetTracker } from \"./APEAssetTracker\";\nimport { Object3D, AnimationClip } from \"three\";\nimport { IDisposable } from \"../misc/IDisposable\";\nimport { SkeletonUtils } from \"three/examples/jsm/utils/SkeletonUtils\";\n\nexport class GLTFPrefab implements IDisposable {\n    private _prefab: Object3D;\n    private _clips: AnimationClip[];\n\n    /**\n     * The GLTF object3d prefab object.\n     * It is NOT RECOMMENDED to use this in your scenes. \n     * If you want a clone of the prefab use the clone() function instead.\n     */\n    get prefab(): Object3D { return this._prefab; }\n\n    /**\n     * The animation clips for the GLTF model.\n     */\n    get clips(): AnimationClip[] { return this._clips; }\n\n    constructor(obj3d: Object3D, clips: AnimationClip[]) {\n        this._prefab = obj3d;\n        this._clips = clips;\n        APEAssetTracker.track(this._prefab);\n    }\n\n    /**\n     * Retrieve a clone of the Object3D.\n     * This will clone all Object3Ds and Materials on the prefab.\n     * \n     * If optional childObjectName is given then the returned clone is only of the specified child object and its children.\n     * If the given child object name is not found then an exception will be thrown.\n     * \n     * Returned object will have '(clone)' appened to its name.\n     */\n    clone(childObjectName?: string): Object3D {\n        if (childObjectName) {\n            const childObject = this.prefab.getObjectByName(childObjectName);\n            if (childObject) {\n                // const clone = childObject.clone();\n                const clone = SkeletonUtils.clone(childObject) as Object3D;\n                clone.name = `${clone.name} (clone)`;\n                return clone;\n            } else {\n                throw new Error(`Could not find child object named ${childObjectName} in the prefab ${this._prefab}`);\n            }\n        } else {\n            // const clone = this._prefab.clone();\n            const clone = SkeletonUtils.clone(this._prefab) as Object3D;\n            clone.name = `${clone.name} (clone)`;\n            return clone;\n        }\n    }\n\n    dispose(): void {\n        APEAssetTracker.untrack(this._prefab);\n    }\n}","import { Resource, IResourceConfig } from \"./Resource\";\nimport { Group, LoadingManager } from \"three\";\nimport { GLTFLoader } from \"three/examples/jsm/loaders/GLTFLoader\";\nimport { DRACOLoader } from \"three/examples/jsm/loaders/DRACOLoader\";\nimport { getFilename, getExtension } from \"../utils/MiscUtils\";\nimport { GLTFPrefab } from \"./GLTFPrefab\";\n\nexport interface IGLTFConfig extends IResourceConfig {\n    gltfUrl: string;\n    binUrl?: string;\n    textureUrls?: GLTFTextureRedirect[] | string[];\n}\n\nexport interface GLTFTextureRedirect {\n    filename: string;\n    redirectUrl: string;\n}\n\nexport class GLTFResource extends Resource<GLTFPrefab, IGLTFConfig> {\n    private _gltfUrl: string;\n    private _binUrl?: string;\n    private _textureUrls?: GLTFTextureRedirect[] | string[];\n\n    private static _sentTextureUrlObsoleteWarning: boolean = false;\n    private static _dracoLoader: DRACOLoader = null;\n\n    constructor(name: string, config: IGLTFConfig) {\n        super(name, config);\n\n        this._gltfUrl = config.gltfUrl;\n        this._binUrl = config.binUrl;\n        this._textureUrls = config.textureUrls;\n    }\n\n    protected _loadObject(): Promise<GLTFPrefab> {\n        return new Promise<GLTFPrefab>((resolve: (value: GLTFPrefab) => void, reject) => {\n            const loadingManager = new LoadingManager();\n\n            loadingManager.setURLModifier((url): string => {\n                if (url.startsWith('data:')) {\n                    // Do not redirect data uris.\n                    return url;\n                }\n                if (url.startsWith('blob:')) {\n                    // Do not redirect blobs.\n                    return url;\n                }\n\n                // Redirect gltf relative url to CDN asset location.\n                const filename = getFilename(url);\n                const ext = getExtension(url);\n\n                if (filename === 'draco_wasm_wrapper.js' || filename === 'draco_decoder.wasm' || filename === 'draco_decoder.js') {\n                    // Do not redirect draco specific files.\n                    return url;\n                }\n\n                let redirectUrl: string = null;\n                \n                if (ext === 'gltf' || ext === 'glb') {\n                    redirectUrl = this._gltfUrl;\n                } else if (ext === 'bin') {\n                    if (this._binUrl) {\n                        redirectUrl = this._binUrl;\n                    }\n                } else {\n                    // Assume that url is for texture image.\n                    if (this._textureUrls) {\n                        if (isStringArray(this._textureUrls)) {\n                            if (!GLTFResource._sentTextureUrlObsoleteWarning) {\n                                console.warn(`[GLTFResource] WARNING! OBSOLETE! It is highly recommended that GLTFResource textureUrls be in GLTFTextureRedirect format and not a plain string array.\n                                The string array implementation was designed for a specific CDN use case and requires that filesnames match. This filename matching does \n                                not work if using local assets that are hashed at build time.\n                                `);\n\n                                GLTFResource._sentTextureUrlObsoleteWarning = true;\n                            }\n\n                            redirectUrl = this._textureUrls.find((textureUrl) => filename === getFilename(textureUrl));\n                        } else {\n                            const textureRedirect = this._textureUrls.find((tr) => filename === tr.filename);\n                            if (textureRedirect) {\n                                redirectUrl = textureRedirect.redirectUrl;\n                            }\n                        }\n                    }\n                }\n\n                if (!redirectUrl) {\n                    console.error(`[GLTFResource] ${this.name} could not find a redirect url for ${url}`);\n                }\n                \n                return redirectUrl;\n            });\n\n            const gltfLoader = new GLTFLoader(loadingManager);\n\n            if (!GLTFResource._dracoLoader) {\n                GLTFResource._dracoLoader = new DRACOLoader(loadingManager);\n                GLTFResource._dracoLoader.setDecoderPath('public/draco/');\n                GLTFResource._dracoLoader.setDecoderConfig({ type: 'js' });\n            }\n            gltfLoader.setDRACOLoader(GLTFResource._dracoLoader);\n\n            gltfLoader.load(\n                this._gltfUrl,\n                (gltf) => {\n                    const prefab = new GLTFPrefab(gltf.scene, gltf.animations);\n                    resolve(prefab);\n                },\n                (progressEvent) => {\n                    this._progress = progressEvent.loaded / progressEvent.total;\n                },\n                (errorEvent) => {\n                    console.error(`[GLTFResource] ${this.name} Error: ${errorEvent}`);\n                    reject(errorEvent);\n                }\n            );\n        });\n    }\n\n    protected _unloadObject(): void {\n        this.object.dispose();\n    }\n}\n\nfunction isStringArray(value: any): value is string[] {\n    if (value && Array.isArray(value) && value.length > 0) {\n        if (typeof value[0] === 'string') {\n            return true;\n        }\n    }\n\n    return false;\n}","import { Resource } from \"./Resource\";\nimport { Texture, TextureLoader, sRGBEncoding, TextureEncoding } from \"three\";\nimport { getOptionalValue } from \"../utils/MiscUtils\";\n\nexport interface ITextureConfig {\n    url: string;\n    encoding?: TextureEncoding;\n    flipY?: boolean;\n}\n\nexport class TextureResource extends Resource<Texture, ITextureConfig> {\n    private _url: string;\n    private _encoding: TextureEncoding;\n    private _flipY: boolean;\n\n    constructor(name: string, config: ITextureConfig) {\n        super(name, config);\n\n        this._url = config.url;\n        this._encoding = config.encoding;\n        this._flipY = getOptionalValue(this._flipY, true); // This is the defualt value as of ThreeJS r113\n    }\n\n    protected _loadObject(): Promise<Texture> {\n        return new Promise<Texture>(((resolve: (value: Texture) => void, reject) => {\n            const loader = new TextureLoader();\n            loader.load(\n                this._url, \n                (texture) => {\n                    if (this._encoding) {\n                        texture.encoding = this._encoding;\n                        texture.needsUpdate = true;\n                    }\n\n                    texture.flipY = this._flipY ? true : false;\n                    texture.needsUpdate = true;\n\n                    resolve(texture);\n                },\n                (progressEvent) => {\n                    this._progress = progressEvent.loaded / progressEvent.total;\n                },\n                (errorEvent) => {\n                    reject(errorEvent);\n                }\n            );\n        }));\n    }\n\n    protected _unloadObject(): void {\n        this.object.dispose();\n    }\n}","import { Resource } from \"./Resource\";\nimport { loadImage } from \"../utils/MiscUtils\";\n\nexport interface IImageConfig {\n    url: string\n}\n\nexport class ImageResource extends Resource<HTMLImageElement, IImageConfig> {\n    private _url: string;\n\n    constructor(name: string, config: IImageConfig) {\n        super(name, config);\n\n        this._url = config.url;\n    }\n\n    protected _loadObject(): Promise<HTMLImageElement> {\n        const onProgress = (event: ProgressEvent<EventTarget>) => {\n            this._progress = event.loaded / event.total;\n        } \n        return loadImage(this._url, onProgress);\n    }\n\n    protected _unloadObject(): void {\n    }\n}","export class ResourceProgress {\n    private _id: string;\n    private _weight: number;\n\n    get id(): string { return this._id; }\n    get weight(): number { return this._weight; }\n    \n    value: number = 0;\n\n    constructor(id: string, weight: number) {\n        this._id = id;\n        this._weight = weight;\n    }\n}\n\ninterface ResourceProgressConfig {\n    id: string;\n    weight: number;\n}\n\nexport class ResourceProgressMap {\n\n    private _progressMap = new Map<string, ResourceProgress>();\n\n    addProgressObject(config: ResourceProgressConfig): ResourceProgress {\n        let p = this._progressMap.get(config.id);\n        if (!p) {\n            p = new ResourceProgress(config.id, config.weight);\n            this._progressMap.set(config.id, p);\n        }\n\n        return p;\n    }\n\n    removeProgressObject(id: string): void {\n        this._progressMap.delete(id);\n    }\n\n    clearProgressObjects(): void {\n        this._progressMap = new Map();\n    }\n\n    calculateWeightedMean(): number {\n        if (this._progressMap.size === 0) {\n            return 0;\n        }\n\n        let pSum = 0;\n        let wSum = 0;\n\n        for (const [id, p] of this._progressMap) {\n            pSum += p.value * p.weight;\n            wSum += p.weight;\n        }\n\n        const mean = pSum / wSum;\n        return mean;\n    }\n\n}","import { ResourceManager } from './ResourceManager';\nimport { AudioResource } from './AudioResource';\nimport { GLTFResource } from './GLTFResource';\nimport { TextureResource } from './TextureResource';\nimport { ImageResource } from './ImageResource';\nimport { ResourceProgressMap } from './ResourceProgress';\n\n/**\n * Contains all the core APEngine Resource Managers and related objects.\n */\nexport namespace APEResources {\n    \n    export const audio = new ResourceManager(AudioResource);\n    export const gltf = new ResourceManager(GLTFResource);\n    export const textures = new ResourceManager(TextureResource);\n    export const images = new ResourceManager(ImageResource);\n\n    /**\n     * Preload all resource managers.\n     */\n    export async function preloadResources(): Promise<void> {\n        await Promise.all([\n            audio.preload(),\n            gltf.preload(),\n            textures.preload(),\n            images.preload()\n        ]);\n    }\n\n    export function getProgress(): Readonly<number> {\n        const progressMap = new ResourceProgressMap();\n\n        const audioProgress = progressMap.addProgressObject({ id: 'audio', weight: audio.count() });\n        audioProgress.value = audio.getLoadProgress();\n\n        const gltfProgress = progressMap.addProgressObject({ id: 'gltf', weight: gltf.count() });\n        gltfProgress.value = gltf.getLoadProgress();\n\n        const textureProgress = progressMap.addProgressObject({ id: 'textures', weight: textures.count() });\n        textureProgress.value = textures.getLoadProgress();\n\n        const imageProgress = progressMap.addProgressObject({ id: 'images', weight: images.count() });\n        imageProgress.value = images.getLoadProgress();\n\n        return progressMap.calculateWeightedMean();\n    }\n\n    /**\n     * Dispose of all resource managers.\n     */\n    export function diposeAll(): void {\n        audio.dispose();\n        gltf.dispose();\n        textures.dispose();\n        images.dispose();\n    }\n\n    /**\n     * Print out all resource manager load states to the console.\n     */\n    export function printLoadStates(): void {\n        console.groupCollapsed(`[APEResource] Resource Manager Load States`);\n        console.log('Audio');\n        console.log(audio.loadState());\n        console.log('GLTF');\n        console.log(gltf.loadState());\n        console.log('Textures');\n        console.log(textures.loadState());\n        console.log('Images');\n        console.log(images.loadState());\n        console.groupEnd();\n    }\n}","/**\n * Easing functions from https://easings.net/\n */\n\nexport function easeInSine(x: number): number {\n    return 1 - Math.cos((x * Math.PI) / 2);\n}\n\nexport function easeOutSine(x: number): number {\n    return Math.sin((x * Math.PI) / 2);\n}\n\nexport function easeInOutSine(x: number): number {\n    return -(Math.cos(Math.PI * x) - 1) / 2;\n}\n\nexport function easeInCubic(x: number): number {\n    return x * x * x;\n}\n\nexport function easeOutCubic(x: number): number {\n    return 1 - Math.pow(1 - x, 3);\n}\n\nexport function easeInOutCubic(x: number): number {\n    return x < 0.5 ? 4 * x * x * x : 1 - Math.pow(-2 * x + 2, 3) / 2;\n}\n\nexport function easeInQuint(x: number): number {\n    return x * x * x * x * x;\n}\n\nexport function easeOutQuint(x: number): number {\n    return 1 - Math.pow(1 - x, 5);\n}\n\nexport function easeInOutQuint(x: number): number {\n    return x < 0.5 ? 16 * x * x * x * x * x : 1 - Math.pow(-2 * x + 2, 5) / 2;\n}\n\nexport function easeInCirc(x: number): number {\n    return 1 - Math.sqrt(1 - Math.pow(x, 2));\n}\n\nexport function easeOutCirc(x: number): number {\n    return Math.sqrt(1 - Math.pow(x - 1, 2));\n}\n\nexport function easeInOutCirc(x: number): number {\n    return x < 0.5\n        ? (1 - Math.sqrt(1 - Math.pow(2 * x, 2))) / 2\n        : (Math.sqrt(1 - Math.pow(-2 * x + 2, 2)) + 1) / 2;\n}\n\nexport function easeInElastic(x: number): number {\n    const c4 = (2 * Math.PI) / 3;\n\n    return x === 0\n        ? 0\n        : x === 1\n            ? 1\n            : -Math.pow(2, 10 * x - 10) * Math.sin((x * 10 - 10.75) * c4);\n}\n\nexport function easeOutElastic(x: number): number {\n    const c4 = (2 * Math.PI) / 3;\n\n    return x === 0\n        ? 0\n        : x === 1\n            ? 1\n            : Math.pow(2, -10 * x) * Math.sin((x * 10 - 0.75) * c4) + 1;\n}\n\nexport function easeInOutElastic(x: number): number {\n    const c5 = (2 * Math.PI) / 4.5;\n\n    return x === 0\n        ? 0\n        : x === 1\n            ? 1\n            : x < 0.5\n                ? -(Math.pow(2, 20 * x - 10) * Math.sin((20 * x - 11.125) * c5)) / 2\n                : (Math.pow(2, -20 * x + 10) * Math.sin((20 * x - 11.125) * c5)) / 2 + 1;\n}\n\nexport function easeInQuad(x: number): number {\n    return x * x;\n}\n\nexport function easeOutQuad(x: number): number {\n    return 1 - (1 - x) * (1 - x);\n}\n\nexport function easeInOutQuad(x: number): number {\n    return x < 0.5 ? 2 * x * x : 1 - Math.pow(-2 * x + 2, 2) / 2;\n}\n\nexport function easeInQuart(x: number): number {\n    return x * x * x * x;\n}\n\nexport function easeOutQuart(x: number): number {\n    return 1 - Math.pow(1 - x, 4);\n}\n\nexport function easeInOutQuart(x: number): number {\n    return x < 0.5 ? 8 * x * x * x * x : 1 - Math.pow(-2 * x + 2, 4) / 2;\n}\n\nexport function easeInExpo(x: number): number {\n    return x === 0 ? 0 : Math.pow(2, 10 * x - 10);\n}\n\nexport function easeOutExpo(x: number): number {\n    return x === 1 ? 1 : 1 - Math.pow(2, -10 * x);\n}\n\nexport function easeInOutExpo(x: number): number {\n    return x === 0\n        ? 0\n        : x === 1\n            ? 1\n            : x < 0.5\n                ? Math.pow(2, 20 * x - 10) / 2\n                : (2 - Math.pow(2, -20 * x + 10)) / 2;\n}\n\nexport function easeInBack(x: number): number {\n    const c1 = 1.70158;\n    const c3 = c1 + 1;\n\n    return c3 * x * x * x - c1 * x * x;\n}\n\nexport function easeOutBack(x: number): number {\n    const c1 = 1.70158;\n    const c3 = c1 + 1;\n\n    return 1 + c3 * Math.pow(x - 1, 3) + c1 * Math.pow(x - 1, 2);\n}\n\nexport function easeInOutBack(x: number): number {\n    const c1 = 1.70158;\n    const c2 = c1 * 1.525;\n\n    return x < 0.5\n        ? (Math.pow(2 * x, 2) * ((c2 + 1) * 2 * x - c2)) / 2\n        : (Math.pow(2 * x - 2, 2) * ((c2 + 1) * (x * 2 - 2) + c2) + 2) / 2;\n}\n\nexport function easeInBounce(x: number): number {\n    return 1 - easeOutBounce(1 - x);\n}\n\nexport function easeOutBounce(x: number): number {\n    const n1 = 7.5625;\n    const d1 = 2.75;\n\n    if (x < 1 / d1) {\n        return n1 * x * x;\n    } else if (x < 2 / d1) {\n        return n1 * (x -= 1.5 / d1) * x + 0.75;\n    } else if (x < 2.5 / d1) {\n        return n1 * (x -= 2.25 / d1) * x + 0.9375;\n    } else {\n        return n1 * (x -= 2.625 / d1) * x + 0.984375;\n    }\n}\n\nexport function easeInOutBounce(x: number): number {\n    return x < 0.5\n        ? (1 - easeOutBounce(1 - 2 * x)) / 2\n        : (1 + easeOutBounce(2 * x - 1)) / 2;\n}","\n/**\n * Simple object that can mesaure the passage of time. \n * Useful for debugging code performance or simply getting elapsed time values.\n */\nexport class Stopwatch {\n\n    private _startTime: number = null;\n    private _stopTime: number = null;\n\n    /**\n     * Create a new Stopwatch with the start time set to time of creation.\n     */\n    constructor() {\n        this.start();\n    }\n\n    /**\n     * STart the stopwatch. Set's the start time to now.\n     */\n    start(): void {\n        this._startTime = Date.now();\n        this._stopTime = null;\n    }\n\n    /**\n     * Stop the stopwatch. Set's the stop time to now.\n     */\n    stop(): void {\n        this._stopTime = Date.now();\n    }\n\n    /**\n     * Reset the stopwatch. Clears both the start and stop time.\n     */\n    reset(): void {\n        this._startTime = null;\n        this._stopTime = null;\n    }\n\n    /**\n     * Return number of milliseconds that have elapsed.\n     */\n    elapsed(): number {\n        if (this._startTime) {\n            const endTime = this._stopTime ?? Date.now();\n            return endTime - this._startTime;\n        } else {\n            return 0;\n        }\n    }\n}"],"names":["RenderOperation"],"mappings":";;;;;;;;;;;;;;AAEA;AACA;AACA;AACA;AAEA;;;MAGa,KAAK;IAAlB;QACY,eAAU,GAAoB,EAAE,CAAC;KA2B5C;IAzBU,WAAW,CAAC,QAAuB;QACtC,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;KAClC;IAEM,cAAc,CAAC,QAAuB;QACzC,MAAM,KAAK,GAAG,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;QAChD,IAAI,KAAK,KAAK,CAAC,CAAC,EAAE;YACd,IAAI,CAAC,UAAU,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC;SACpC;KACJ;IAEM,kBAAkB;QACrB,IAAI,CAAC,UAAU,GAAG,EAAE,CAAC;KACxB;IAEM,MAAM;QACT,MAAM,SAAS,GAAG,CAAC,GAAG,IAAI,CAAC,UAAU,CAAC,CAAC;QACvC,SAAS,CAAC,OAAO,CAAC,CAAC;YACf,CAAC,EAAE,CAAC;SACP,CAAC,CAAC;KACN;IAEM,OAAO;QACV,IAAI,CAAC,kBAAkB,EAAE,CAAC;KAC7B;CACJ;AAOD;;;MAGa,YAAY;IAAzB;QACY,eAAU,GAA2B,EAAE,CAAC;KAyBnD;IAvBU,WAAW,CAAC,QAA8B;QAC7C,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;KAClC;IAEM,cAAc,CAAC,QAA8B;QAChD,MAAM,KAAK,GAAG,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;QAChD,IAAI,KAAK,KAAK,CAAC,CAAC,EAAE;YACd,IAAI,CAAC,UAAU,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC;SACpC;KACJ;IAEM,kBAAkB;QACrB,IAAI,CAAC,UAAU,GAAG,EAAE,CAAC;KACxB;IAEY,MAAM;;YACf,MAAM,QAAQ,GAAG,CAAC,GAAG,IAAI,CAAC,UAAU,CAAC,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;YACpD,MAAM,OAAO,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;SAC/B;KAAA;IAEM,OAAO;QACV,IAAI,CAAC,kBAAkB,EAAE,CAAC;KAC7B;CACJ;AAOD;;;MAGa,QAAQ;IAArB;QACY,eAAU,GAA0B,EAAE,CAAC;KA2BlD;IAzBU,WAAW,CAAC,QAA6B;QAC5C,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;KAClC;IAEM,cAAc,CAAC,QAA6B;QAC/C,MAAM,KAAK,GAAG,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;QAChD,IAAI,KAAK,KAAK,CAAC,CAAC,EAAE;YACd,IAAI,CAAC,UAAU,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC;SACpC;KACJ;IAEM,kBAAkB;QACrB,IAAI,CAAC,UAAU,GAAG,EAAE,CAAC;KACxB;IAEM,MAAM,CAAC,GAAM;QAChB,MAAM,SAAS,GAAG,CAAC,GAAG,IAAI,CAAC,UAAU,CAAC,CAAC;QACvC,SAAS,CAAC,OAAO,CAAC,CAAC;YACf,CAAC,CAAC,GAAG,CAAC,CAAC;SACV,CAAC,CAAC;KACN;IAEM,OAAO;QACV,IAAI,CAAC,kBAAkB,EAAE,CAAC;KAC7B;CACJ;AAOD;;;MAGa,eAAe;IAA5B;QACY,eAAU,GAAiC,EAAE,CAAC;KAyBzD;IAvBU,WAAW,CAAC,QAAoC;QACnD,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;KAClC;IAEM,cAAc,CAAC,QAAoC;QACtD,MAAM,KAAK,GAAG,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;QAChD,IAAI,KAAK,KAAK,CAAC,CAAC,EAAE;YACd,IAAI,CAAC,UAAU,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC;SACpC;KACJ;IAEM,kBAAkB;QACrB,IAAI,CAAC,UAAU,GAAG,EAAE,CAAC;KACxB;IAEY,MAAM,CAAC,GAAM;;YACtB,MAAM,QAAQ,GAAG,CAAC,GAAG,IAAI,CAAC,UAAU,CAAC,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC;YACvD,MAAM,OAAO,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;SAC/B;KAAA;IAEM,OAAO;QACV,IAAI,CAAC,kBAAkB,EAAE,CAAC;KAC7B;CACJ;AAOD;;;;IAIiB,MAqDhB;AArDD,WAAiB,KAAK;IAElB,IAAI,YAAY,GAA6C,IAAI,GAAG,EAAE,CAAC;IAEvE,SAAgB,gBAAgB,CAAC,IAAY,EAAE,QAAmC;QAC9E,IAAI,SAAS,GAAgC,YAAY,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;QAEpE,IAAI,SAAS,EAAE;;YAEX,IAAI,cAAc,GAAY,SAAS,CAAC,IAAI,CAAC,CAAC,CAAC,KAAK,CAAC,KAAK,QAAQ,CAAC,CAAC;YACpE,IAAI,CAAC,cAAc,EAAE;gBACjB,SAAS,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;gBACzB,OAAO,IAAI,CAAC;aACf;iBAAM;;gBAEH,OAAO,KAAK,CAAC;aAChB;SACJ;aAAM;;YAEH,SAAS,GAAG,EAAE,CAAC;YACf,SAAS,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;YACzB,YAAY,CAAC,GAAG,CAAC,IAAI,EAAE,SAAS,CAAC,CAAC;YAClC,OAAO,IAAI,CAAC;SACf;KACJ;IApBe,sBAAgB,mBAoB/B,CAAA;IAED,SAAgB,mBAAmB,CAAC,IAAW,EAAE,QAAmC;QAChF,IAAI,SAAS,GAAgC,YAAY,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;QAEpE,IAAI,SAAS,EAAE;YACX,IAAI,KAAK,GAAG,SAAS,CAAC,SAAS,CAAC,CAAC,CAAC,KAAK,CAAC,KAAK,QAAQ,CAAC,CAAC;YACvD,IAAI,KAAK,IAAI,CAAC,EAAE;gBACZ,SAAS,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC;gBAC3B,OAAO,IAAI,CAAC;aACf;SACJ;QAED,OAAO,KAAK,CAAC;KAChB;IAZe,yBAAmB,sBAYlC,CAAA;IAED,SAAgB,aAAa,CAAC,IAAY,EAAE,GAAa;QACrD,IAAI,SAAS,GAAgC,YAAY,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;QAEpE,IAAI,SAAS,EAAE;;YAEX,IAAI,aAAa,GAAG,SAAS,CAAC,KAAK,EAAE,CAAC;YACtC,aAAa,CAAC,OAAO,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC;SACxC;KACJ;IARe,mBAAa,gBAQ5B,CAAA;IAED,SAAgB,uBAAuB;QACnC,YAAY,GAAG,IAAI,GAAG,EAAE,CAAC;KAC5B;IAFe,6BAAuB,0BAEtC,CAAA;AACL,CAAC,EArDgB,KAAK,KAAL,KAAK;;MCjJT,IAAI;IAgBb;;;;QAXA,cAAS,GAAW,GAAG,CAAC;QAExB,aAAQ,GAAmB,IAAI,QAAQ,EAAE,CAAC;QAElC,gBAAW,GAAW,CAAC,CAAC;QACxB,oBAAe,GAAW,CAAC,CAAC;QAC5B,eAAU,GAAW,CAAC,CAAC;QAEvB,sBAAiB,GAAsB,EAAE,CAAC;QAC1C,uBAAkB,GAAuB,EAAE,CAAC;QAGhD,IAAI,CAAC,WAAW,GAAG,CAAC,CAAC;QACrB,IAAI,CAAC,eAAe,GAAG,CAAC,CAAC;QACzB,IAAI,CAAC,UAAU,GAAG,CAAC,CAAC;QACpB,IAAI,CAAC,MAAM,GAAG,IAAI,KAAK,CAAC,IAAI,CAAC,CAAC;KACjC;;;;IAKD,IAAI,UAAU;QACV,OAAO,IAAI,CAAC,WAAW,CAAC;KAC3B;;;;IAKD,IAAI,cAAc;QACd,OAAO,IAAI,CAAC,eAAe,CAAC;KAC/B;;;;IAKD,IAAI,SAAS;QACT,OAAO,IAAI,CAAC,UAAU,CAAC;KAC1B;IAED,MAAM;;QAEF,IAAI,CAAC,WAAW,IAAI,CAAC,CAAC;QAEtB,MAAM,UAAU,GAAG,IAAI,CAAC,MAAM,CAAC,QAAQ,EAAE,CAAC;QAC1C,IAAI,CAAC,UAAU,GAAG,UAAU,GAAG,IAAI,CAAC,SAAS,CAAC;QAE9C,IAAI,CAAC,eAAe,IAAI,IAAI,CAAC,UAAU,CAAC;;QAGxC,IAAI,IAAI,CAAC,kBAAkB,CAAC,MAAM,GAAG,CAAC,EAAE;YACpC,IAAI,CAAC,kBAAkB,GAAG,IAAI,CAAC,kBAAkB,CAAC,MAAM,CAAC,CAAC,EAAE;gBACxD,IAAI,EAAE,CAAC,KAAK,IAAI,IAAI,CAAC,WAAW,EAAE;oBAC9B,EAAE,CAAC,OAAO,EAAE,CAAC;oBACb,OAAO,KAAK,CAAC;iBAChB;qBAAM;oBACH,OAAO,IAAI,CAAC;iBACf;aACJ,CAAC,CAAC;SACN;;QAGD,IAAI,IAAI,CAAC,iBAAiB,CAAC,MAAM,GAAG,CAAC,EAAE;YACnC,IAAI,CAAC,iBAAiB,GAAG,IAAI,CAAC,iBAAiB,CAAC,MAAM,CAAC,CAAC,EAAE;gBACtD,IAAI,EAAE,CAAC,WAAW,IAAI,IAAI,CAAC,eAAe,EAAE;oBACxC,EAAE,CAAC,OAAO,EAAE,CAAC;oBACb,OAAO,KAAK,CAAC;iBAChB;qBAAM;oBACH,OAAO,IAAI,CAAC;iBACf;aACJ,CAAC,CAAC;SACN;QAED,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;KAC9B;;;;;IAMK,cAAc,CAAC,OAAe;;YAChC,IAAI,OAAO,IAAI,CAAC,EAAE;gBACd,OAAO;aACV;YAED,OAAO,IAAI,OAAO,CAAC,CAAC,OAAO;gBACvB,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC;oBACxB,WAAW,EAAE,IAAI,CAAC,eAAe,GAAG,OAAO;oBAC3C,OAAO;iBACV,CAAC,CAAC;aACN,CAAC,CAAC;SACN;KAAA;;;;IAKK,gBAAgB;;YAClB,OAAO,IAAI,OAAO,CAAC,CAAC,OAAO;gBACvB,IAAI,CAAC,kBAAkB,CAAC,IAAI,CAAC;oBACzB,KAAK,EAAE,IAAI,CAAC,WAAW,GAAG,CAAC;oBAC3B,OAAO;iBACV,CAAC,CAAC;aACN,CAAC,CAAC;SACN;KAAA;;;;IAKK,aAAa,CAAC,UAAkB;;YAClC,OAAO,IAAI,OAAO,CAAC,CAAC,OAAO;gBACvB,IAAI,CAAC,kBAAkB,CAAC,IAAI,CAAC;oBACzB,KAAK,EAAE,IAAI,CAAC,WAAW,GAAG,UAAU;oBACpC,OAAO;iBACV,CAAC,CAAC;aACN,CAAC,CAAC;SACN;KAAA;IAED,OAAO;KACN;;;MC3HQ,KAAK;IAyFd,YAAY,OAAiB;;;;;QApFtB,eAAU,GAAW,CAAC,CAAC;QAEvB,yBAAoB,GAAG,IAAI,CAAC;QAW3B,eAAU,GAAc,SAAS,CAAC,SAAS,CAAC;QAwEhD,IAAI,CAAC,QAAQ,GAAG,OAAO,CAAC;QAExB,IAAI,CAAC,UAAU,GAAG;YACd,eAAe,EAAE,IAAI,UAAU,EAAE;YACjC,gBAAgB,EAAE,IAAI,UAAU,EAAE;YAClC,iBAAiB,EAAE,IAAI,UAAU,EAAE;YACnC,SAAS,EAAE,IAAI,OAAO,CAAC,CAAC,EAAE,CAAC,CAAC;YAC5B,OAAO,EAAE,IAAI,OAAO,CAAC,CAAC,EAAE,CAAC,CAAC;YAC1B,SAAS,EAAE,IAAI,OAAO,CAAC,CAAC,EAAE,CAAC,CAAC;SAC/B,CAAC;QACF,IAAI,CAAC,WAAW,GAAG;YACf,SAAS,EAAE,IAAI;YACf,OAAO,EAAE,IAAI;YACb,SAAS,EAAE,IAAI;SAClB,CAAC;QACF,IAAI,CAAC,UAAU,GAAG,EAAE,CAAC;QACrB,IAAI,CAAC,QAAQ,GAAG,IAAI,GAAG,EAAE,CAAC;QAC1B,IAAI,CAAC,oBAAoB,GAAG,IAAI,GAAG,EAAE,CAAC;QACtC,IAAI,CAAC,UAAU,GAAG,IAAI,SAAS,EAAE,CAAC;QAClC,IAAI,CAAC,qBAAqB,GAAG;YACzB,WAAW,EAAE,CAAC;YACd,UAAU,EAAE,CAAC;YACb,SAAS,EAAE,IAAI,OAAO,CAAC,CAAC,EAAE,CAAC,CAAC;YAC5B,OAAO,EAAE,IAAI,OAAO,CAAC,CAAC,EAAE,CAAC,CAAC;YAC1B,SAAS,EAAE,IAAI,OAAO,CAAC,CAAC,EAAE,CAAC,CAAC;YAC5B,KAAK,EAAE,IAAI,UAAU,EAAE;SAC1B,CAAC;QAEF,IAAI,CAAC,gBAAgB,GAAG,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QACzD,IAAI,CAAC,gBAAgB,GAAG,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QACzD,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QACrD,IAAI,CAAC,iBAAiB,GAAG,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAC3D,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QACjD,IAAI,CAAC,iBAAiB,GAAG,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAC3D,IAAI,CAAC,gBAAgB,GAAG,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QACzD,IAAI,CAAC,eAAe,GAAG,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QACvD,IAAI,CAAC,kBAAkB,GAAG,IAAI,CAAC,kBAAkB,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAC7D,IAAI,CAAC,kBAAkB,GAAG,IAAI,CAAC,kBAAkB,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAC7D,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QACrD,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAEjD,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,QAAQ,CAAC,YAAY,CAAC,CAAC;QACjD,QAAQ,CAAC,gBAAgB,CAAC,SAAS,EAAE,IAAI,CAAC,cAAc,CAAC,CAAC;QAC1D,QAAQ,CAAC,gBAAgB,CAAC,OAAO,EAAE,IAAI,CAAC,YAAY,CAAC,CAAC;;QAGtD,IAAI,CAAC,QAAQ,CAAC,aAAa,CAAC,gBAAgB,CACxC,aAAa,EACb,IAAI,CAAC,kBAAkB,CAC1B,CAAC;KACL;;;;IAjHD,IAAI,gBAAgB;QAChB,OAAO,IAAI,CAAC,UAAU,CAAC;KAC1B;;;;IAKD,IAAI,gBAAgB,CAAC,SAAoB;QACrC,IAAI,CAAC,UAAU,GAAG,SAAS,CAAC;KAC/B;;;;;;;IAQM,OAAO,cAAc,CAAC,OAAgB,EAAE,IAAiB;QAC5D,IAAI,SAAS,GAAG,IAAI,OAAO,CAAC,OAAO,CAAC,CAAC,EAAE,OAAO,CAAC,CAAC,CAAC,CAAC;QAClD,IAAI,QAAQ,GAAG,IAAI,CAAC,qBAAqB,EAAE,CAAC;QAC5C,IAAI,OAAO,GAAG,SAAS,CAAC,GAAG,CAAC,IAAI,OAAO,CAAC,QAAQ,CAAC,IAAI,EAAE,QAAQ,CAAC,GAAG,CAAC,CAAC,CAAC;QACtE,OAAO,IAAI,OAAO,CACd,CAAC,OAAO,CAAC,CAAC,GAAG,QAAQ,CAAC,KAAK,IAAI,CAAC,GAAG,CAAC,EACpC,EAAE,OAAO,CAAC,CAAC,GAAG,QAAQ,CAAC,MAAM,CAAC,GAAG,CAAC,GAAG,CAAC,CACzC,CAAC;KACL;;;;;;IAOM,OAAO,aAAa,CAAC,YAAqB,EAAE,aAAsB;QACrE,OAAO,YAAY,CAAC,UAAU,CAAC,aAAa,CAAC,CAAC;KACjD;;;;;;IAOM,OAAO,0BAA0B,CACpC,SAAkB,EAClB,OAAoB;QAEpB,IAAI,SAAS,GAAG,QAAQ,CAAC,gBAAgB,CAAC,SAAS,CAAC,CAAC,EAAE,SAAS,CAAC,CAAC,CAAC,CAAC;QACpE,OAAO,SAAS,KAAK,OAAO,CAAC;KAChC;;;;;;IAOM,OAAO,kBAAkB,CAC5B,SAAkB,EAClB,OAAoB;QAEpB,IAAI,QAAQ,GAAG,QAAQ,CAAC,iBAAiB,CAAC,SAAS,CAAC,CAAC,EAAE,SAAS,CAAC,CAAC,CAAC,CAAC;QACpE,OAAO,IAAI,CAAC,QAAQ,EAAE,CAAC,IAAI,CAAC,KAAK,OAAO,CAAC,CAAC;KAC7C;;;;;;IA4DM,eAAe,CAAC,OAAoB;QACvC,IAAI,IAAI,CAAC,QAAQ,CAAC,YAAY,EAAE;YAC5B,IAAI,CAAC,QAAQ,CAAC,YAAY,CAAC,mBAAmB,CAAC,WAAW,EAAE,IAAI,CAAC,gBAAgB,CAAC,CAAC;YACnF,IAAI,CAAC,QAAQ,CAAC,YAAY,CAAC,mBAAmB,CAAC,WAAW,EAAE,IAAI,CAAC,gBAAgB,CAAC,CAAC;YACnF,IAAI,CAAC,QAAQ,CAAC,YAAY,CAAC,mBAAmB,CAAC,SAAS,EAAE,IAAI,CAAC,cAAc,CAAC,CAAC;YAC/E,IAAI,CAAC,QAAQ,CAAC,YAAY,CAAC,mBAAmB,CAAC,YAAY,EAAE,IAAI,CAAC,iBAAiB,CAAC,CAAC;YACrF,IAAI,CAAC,QAAQ,CAAC,YAAY,CAAC,mBAAmB,CAAC,OAAO,EAAE,IAAI,CAAC,YAAY,CAAC,CAAC;YAC3E,IAAI,CAAC,QAAQ,CAAC,YAAY,CAAC,mBAAmB,CAAC,YAAY,EAAE,IAAI,CAAC,iBAAiB,CAAC,CAAC;SACxF;QAED,IAAI,CAAC,QAAQ,CAAC,YAAY,GAAG,OAAO,CAAC;QACrC,IAAI,IAAI,CAAC,QAAQ,CAAC,YAAY,EAAE;YAC5B,IAAI,CAAC,QAAQ,CAAC,YAAY,CAAC,gBAAgB,CAAC,WAAW,EAAE,IAAI,CAAC,gBAAgB,CAAC,CAAC;YAChF,IAAI,CAAC,QAAQ,CAAC,YAAY,CAAC,gBAAgB,CAAC,WAAW,EAAE,IAAI,CAAC,gBAAgB,CAAC,CAAC;YAChF,IAAI,CAAC,QAAQ,CAAC,YAAY,CAAC,gBAAgB,CAAC,SAAS,EAAE,IAAI,CAAC,cAAc,CAAC,CAAC;YAC5E,IAAI,CAAC,QAAQ,CAAC,YAAY,CAAC,gBAAgB,CAAC,YAAY,EAAE,IAAI,CAAC,iBAAiB,CAAC,CAAC;YAClF,IAAI,CAAC,QAAQ,CAAC,YAAY,CAAC,gBAAgB,CAAC,OAAO,EAAE,IAAI,CAAC,YAAY,CAAC,CAAC;YACxE,IAAI,CAAC,QAAQ,CAAC,YAAY,CAAC,gBAAgB,CAAC,YAAY,EAAE,IAAI,CAAC,iBAAiB,CAAC,CAAC;SACrF;KACJ;IAEM,OAAO;QACV,OAAO,CAAC,GAAG,CAAC,iBAAiB,CAAC,CAAC;QAE/B,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,CAAC;QAC3B,QAAQ,CAAC,mBAAmB,CAAC,SAAS,EAAE,IAAI,CAAC,cAAc,CAAC,CAAC;QAC7D,QAAQ,CAAC,mBAAmB,CAAC,OAAO,EAAE,IAAI,CAAC,YAAY,CAAC,CAAC;;QAGzD,IAAI,CAAC,QAAQ,CAAC,aAAa,CAAC,mBAAmB,CAC3C,aAAa,EACb,IAAI,CAAC,kBAAkB,CAC1B,CAAC;QAEF,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC;KACxB;;;;;IAMM,eAAe,CAAC,OAAoB;QACvC,MAAM,WAAW,GAAG,IAAI,CAAC,WAAW,CAAC,SAAS,CAAC;QAC/C,OAAO,KAAK,CAAC,2BAA2B,CAAC,WAAW,EAAE,OAAO,CAAC,CAAC;KAClE;;;;;IAMM,mBAAmB,CAAC,QAAuB;QAC9C,MAAM,WAAW,GAAG,IAAI,CAAC,WAAW,CAAC,SAAS,CAAC;QAC/C,MAAM,eAAe,GAAG,QAAQ,CAAC,IAAI,CAAC,CAAC,IACnC,KAAK,CAAC,2BAA2B,CAAC,WAAW,EAAE,CAAC,CAAC,CACpD,CAAC;QACF,OAAO,CAAC,CAAC,eAAe,CAAC;KAC5B;;;;IAKM,uBAAuB;QAC1B,MAAM,WAAW,GAAG,IAAI,CAAC,WAAW,CAAC,SAAS,CAAC;QAC/C,MAAM,aAAa,GAAG,CAAC,IAAI,CAAC,QAAQ,CAAC,aAAa,EAAE,GAAG,IAAI,CAAC,QAAQ,CAAC,iBAAiB,EAAE,CAAC,CAAC;QAC1F,MAAM,eAAe,GAAG,aAAa,CAAC,IAAI,CAAC,CAAC,IACxC,KAAK,CAAC,2BAA2B,CAAC,WAAW,EAAE,CAAC,CAAC,CACpD,CAAC;QACF,OAAO,CAAC,CAAC,eAAe,CAAC;KAC5B;;;;;IAMM,mBAAmB,CAAC,OAAoB;QAC3C,MAAM,WAAW,GAAG,IAAI,CAAC,WAAW,CAAC,SAAS,CAAC;QAC/C,OAAO,KAAK,CAAC,2BAA2B,CAAC,WAAW,EAAE,OAAO,CAAC,CAAC;KAClE;;;;;IAMM,uBAAuB,CAAC,QAAuB;QAClD,MAAM,WAAW,GAAG,IAAI,CAAC,WAAW,CAAC,SAAS,CAAC;QAC/C,MAAM,eAAe,GAAG,QAAQ,CAAC,IAAI,CAAC,CAAC,IACnC,KAAK,CAAC,2BAA2B,CAAC,WAAW,EAAE,CAAC,CAAC,CACpD,CAAC;QACF,OAAO,CAAC,CAAC,eAAe,CAAC;KAC5B;;;;IAKM,2BAA2B;QAC9B,MAAM,WAAW,GAAG,IAAI,CAAC,WAAW,CAAC,SAAS,CAAC;QAC/C,MAAM,aAAa,GAAG,CAAC,IAAI,CAAC,QAAQ,CAAC,aAAa,EAAE,GAAG,IAAI,CAAC,QAAQ,CAAC,iBAAiB,EAAE,CAAC,CAAC;QAC1F,MAAM,eAAe,GAAG,aAAa,CAAC,IAAI,CAAC,CAAC,IACxC,KAAK,CAAC,2BAA2B,CAAC,WAAW,EAAE,CAAC,CAAC,CACpD,CAAC;QACF,OAAO,CAAC,CAAC,eAAe,CAAC;KAC5B;;;;;;;IAQM,oBAAoB,CACvB,KAA8B,EAC9B,QAAuB;QAEvB,IAAI,EAAW,CAAC;QAChB,IAAI,KAAK,YAAY,UAAU,EAAE;YAC7B,EAAE,GAAG,QAAQ,CAAC,gBAAgB,CAAC,KAAK,CAAC,OAAO,EAAE,KAAK,CAAC,OAAO,CAAC,CAAC;SAChE;aAAM;YACH,EAAE,GAAG,QAAQ,CAAC,gBAAgB,CAC1B,KAAK,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC,OAAO,EAC/B,KAAK,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC,OAAO,CAClC,CAAC;SACL;QAED,MAAM,eAAe,GAAG,QAAQ,CAAC,IAAI,CAAC,CAAC,IACnC,KAAK,CAAC,2BAA2B,CAAC,EAAE,EAAE,CAAC,CAAC,CAC3C,CAAC;QACF,OAAO,CAAC,CAAC,eAAe,CAAC;KAC5B;;;;;;IAOM,OAAO,2BAA2B,CACrC,OAAgB,EAChB,SAAsB;QAEtB,IAAI,OAAO,KAAK,SAAS,EAAE;YACvB,OAAO,IAAI,CAAC;SACf;aAAM;YACH,IAAI,CAAC,OAAO,EAAE;gBACV,OAAO,KAAK,CAAC;aAChB;iBAAM;gBACH,OAAO,IAAI,CAAC,2BAA2B,CACnC,OAAO,CAAC,aAAa,EACrB,SAAS,CACZ,CAAC;aACL;SACJ;KACJ;;;;;IAMM,kBAAkB,CAAC,QAAuB;QAC7C,IAAI,IAAI,CAAC,UAAU,IAAI,SAAS,CAAC,KAAK,EAAE;YACpC,IAAI,WAAW,GAAG,IAAI,CAAC,oBAAoB,CAAC,QAAQ,CAAC,CAAC;YACtD,IAAI,WAAW,EAAE;gBACb,OAAO,WAAW,CAAC,aAAa,CAC5B,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,UAAU,CAChC,CAAC;aACL;SACJ;aAAM,IAAI,IAAI,CAAC,UAAU,IAAI,SAAS,CAAC,KAAK,EAAE;YAC3C,IAAI,QAAQ,IAAI,aAAa,CAAC,IAAI,EAAE;gBAChC,OAAO,IAAI,CAAC,qBAAqB,CAAC,KAAK,CAAC,aAAa,CACjD,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,UAAU,CAChC,CAAC;aAGL;SACJ;QAED,OAAO,KAAK,CAAC;KAChB;IAEM,YAAY,CAAC,WAAmB;QACnC,IAAI,SAAS,GAAG,IAAI,CAAC,YAAY,CAAC,WAAW,CAAC,CAAC;QAC/C,IAAI,SAAS,EAAE;YACX,OAAO,SAAS,CAAC,KAAK,CAAC,aAAa,CAChC,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,UAAU,CAChC,CAAC;SACL;QAED,OAAO,KAAK,CAAC;KAChB;;;;;IAMM,UAAU,CAAC,GAAW;QACzB,IAAI,OAAO,GAAG,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC;QACnC,IAAI,OAAO,EAAE;YACT,OAAO,OAAO,CAAC,KAAK,CAAC,aAAa,CAAC,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;SACrE;QAED,OAAO,KAAK,CAAC;KAChB;;;;;IAMM,gBAAgB,CAAC,QAAuB;QAC3C,IAAI,IAAI,CAAC,UAAU,IAAI,SAAS,CAAC,KAAK,EAAE;YACpC,IAAI,WAAW,GAAG,IAAI,CAAC,oBAAoB,CAAC,QAAQ,CAAC,CAAC;YACtD,IAAI,WAAW,EAAE;gBACb,OAAO,WAAW,CAAC,WAAW,CAAC,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;aACjE;SACJ;aAAM,IAAI,IAAI,CAAC,UAAU,IAAI,SAAS,CAAC,KAAK,EAAE;YAC3C,IAAI,QAAQ,IAAI,aAAa,CAAC,IAAI,EAAE;gBAChC,OAAO,IAAI,CAAC,qBAAqB,CAAC,KAAK,CAAC,WAAW,CAC/C,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,UAAU,CAChC,CAAC;aAGL;SACJ;QAED,OAAO,KAAK,CAAC;KAChB;IAEM,UAAU,CAAC,WAAmB;QACjC,IAAI,SAAS,GAAG,IAAI,CAAC,YAAY,CAAC,WAAW,CAAC,CAAC;QAC/C,IAAI,SAAS,EAAE;YACX,OAAO,SAAS,CAAC,KAAK,CAAC,WAAW,CAAC,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;SACrE;QAED,OAAO,KAAK,CAAC;KAChB;;;;;IAMM,QAAQ,CAAC,GAAW;QACvB,IAAI,OAAO,GAAG,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC;QACnC,IAAI,OAAO,EAAE;YACT,OAAO,OAAO,CAAC,KAAK,CAAC,WAAW,CAAC,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;SACnE;QAED,OAAO,KAAK,CAAC;KAChB;;;;;IAMM,kBAAkB,CAAC,QAAuB;QAC7C,IAAI,IAAI,CAAC,UAAU,IAAI,SAAS,CAAC,KAAK,EAAE;YACpC,IAAI,WAAW,GAAG,IAAI,CAAC,oBAAoB,CAAC,QAAQ,CAAC,CAAC;YACtD,IAAI,WAAW,EAAE;gBACb,OAAO,WAAW,CAAC,aAAa,CAC5B,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,UAAU,CAChC,CAAC;aACL;SACJ;aAAM,IAAI,IAAI,CAAC,UAAU,IAAI,SAAS,CAAC,KAAK,EAAE;YAC3C,IAAI,QAAQ,IAAI,aAAa,CAAC,IAAI,EAAE;gBAChC,OAAO,IAAI,CAAC,qBAAqB,CAAC,KAAK,CAAC,aAAa,CACjD,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,UAAU,CAChC,CAAC;aAGL;SACJ;QAED,OAAO,KAAK,CAAC;KAChB;IAEM,YAAY,CAAC,WAAmB;QACnC,IAAI,SAAS,GAAG,IAAI,CAAC,YAAY,CAAC,WAAW,CAAC,CAAC;QAC/C,IAAI,SAAS,EAAE;YACX,OAAO,SAAS,CAAC,KAAK,CAAC,aAAa,CAChC,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,UAAU,CAChC,CAAC;SACL;QAED,OAAO,KAAK,CAAC;KAChB;;;;;IAMM,UAAU,CAAC,GAAW;QACzB,IAAI,OAAO,GAAG,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC;QACnC,IAAI,OAAO,EAAE;YACT,OAAO,OAAO,CAAC,KAAK,CAAC,aAAa,CAAC,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;SACrE;QACD,OAAO,KAAK,CAAC;KAChB;;;;IAKM,aAAa;QAChB,QACI,IAAI,CAAC,UAAU,CAAC,QAAQ,CAAC,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,UAAU,CAAC,IAAI,IAAI,EACjE;KACL;;;;IAKM,YAAY;;QAEf,IAAI,UAAU,GAAG,IAAI,CAAC,UAAU,CAAC,QAAQ,CACrC,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,UAAU,CAChC,CAAC;QACF,IAAI,UAAU;YAAE,OAAO,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,SAAS,CAAC,UAAU,CAAC,CAAC,CAAC;;YACzD,OAAO,IAAI,CAAC;KACpB;;;;;IAMM,iBAAiB;QACpB,IAAI,IAAI,CAAC,UAAU,IAAI,SAAS,CAAC,KAAK,EAAE;YACpC,OAAO,IAAI,CAAC,UAAU,CAAC,SAAS,CAAC;SACpC;aAAM,IAAI,IAAI,CAAC,UAAU,IAAI,SAAS,CAAC,KAAK,EAAE;YAC3C,OAAO,IAAI,CAAC,qBAAqB,CAAC,SAAS,CAAC;SAC/C;QAED,OAAO,IAAI,CAAC;KACf;;;;;IAMM,eAAe;QAClB,IAAI,IAAI,CAAC,UAAU,IAAI,SAAS,CAAC,KAAK,EAAE;YACpC,OAAO,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC;SAClC;aAAM,IAAI,IAAI,CAAC,UAAU,IAAI,SAAS,CAAC,KAAK,EAAE;YAC3C,OAAO,IAAI,CAAC,qBAAqB,CAAC,OAAO,CAAC;SAC7C;QAED,OAAO,IAAI,CAAC;KACf;;;;;IAMM,iBAAiB;QACpB,IAAI,IAAI,CAAC,UAAU,IAAI,SAAS,CAAC,KAAK,EAAE;YACpC,OAAO,IAAI,CAAC,UAAU,CAAC,SAAS,CAAC;SACpC;aAAM,IAAI,IAAI,CAAC,UAAU,IAAI,SAAS,CAAC,KAAK,EAAE;YAC3C,OAAO,IAAI,CAAC,qBAAqB,CAAC,SAAS,CAAC;SAC/C;QAED,OAAO,IAAI,CAAC;KACf;;;;;IAMM,iBAAiB,CAAC,WAAmB;QACxC,IAAI,SAAS,GAAG,IAAI,CAAC,YAAY,CAAC,WAAW,CAAC,CAAC;QAC/C,IAAI,SAAS,EAAE;YACX,OAAO,SAAS,CAAC,SAAS,CAAC;SAC9B;QACD,OAAO,IAAI,CAAC;KACf;;;;;IAMM,eAAe,CAAC,WAAmB;QACtC,IAAI,SAAS,GAAG,IAAI,CAAC,YAAY,CAAC,WAAW,CAAC,CAAC;QAC/C,IAAI,SAAS,EAAE;YACX,OAAO,SAAS,CAAC,OAAO,CAAC;SAC5B;QACD,OAAO,IAAI,CAAC;KACf;;;;;IAMM,iBAAiB,CAAC,WAAmB;QACxC,IAAI,SAAS,GAAG,IAAI,CAAC,YAAY,CAAC,WAAW,CAAC,CAAC;QAC/C,IAAI,SAAS,EAAE;YACX,OAAO,SAAS,CAAC,SAAS,CAAC;SAC9B;QACD,OAAO,IAAI,CAAC;KACf;;;;IAKM,aAAa;QAChB,OAAO,IAAI,CAAC,UAAU,CAAC,MAAM,CAAC;KACjC;IAEM,YAAY;QACf,OAAO,IAAI,CAAC,UAAU,CAAC;KAC1B;;;;IAKM,YAAY,CAAC,WAAmB;QACnC,IAAI,IAAI,CAAC,UAAU,CAAC,MAAM,GAAG,CAAC,EAAE;YAC5B,IAAI,SAAS,GAAG,IAAI,CAAC,IAAI,CAAC,UAAU,EAAE,CAAC,CAAY;gBAC/C,OAAO,CAAC,CAAC,WAAW,KAAK,WAAW,CAAC;aACxC,CAAC,CAAC;YACH,IAAI,SAAS,EAAE;gBACX,OAAO,SAAS,CAAC;aACpB;SACJ;QACD,OAAO,IAAI,CAAC;KACf;;;;;;IAOM,UAAU,CAAC,GAAW;QACzB,OAAO,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;KACjC;;;;;IAMM,OAAO;QACV,OAAO,IAAI,CAAC,QAAQ,CAAC,MAAM,EAAE,CAAC;KACjC;;;;;;;IAQM,aAAa;QAChB,OAAO,IAAI,CAAC,WAAW,CAAC;KAC3B;;;;IAKM,kBAAkB;QACrB,MAAM,YAAY,GAAG,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,UAAU,CAAC;;QAGnD,IAAI,IAAI,CAAC,UAAU,CAAC,eAAe,CAAC,aAAa,CAAC,YAAY,CAAC,EAAE;YAC7D,IAAI,CAAC,UAAU,CAAC,eAAe,CAAC,UAAU,CAAC,YAAY,CAAC,CAAC;SAC5D;QACD,IAAI,IAAI,CAAC,UAAU,CAAC,iBAAiB,CAAC,aAAa,CAAC,YAAY,CAAC,EAAE;YAC/D,IAAI,CAAC,UAAU,CAAC,iBAAiB,CAAC,UAAU,CAAC,YAAY,CAAC,CAAC;SAC9D;QACD,IAAI,IAAI,CAAC,UAAU,CAAC,gBAAgB,CAAC,aAAa,CAAC,YAAY,CAAC,EAAE;YAC9D,IAAI,CAAC,UAAU,CAAC,gBAAgB,CAAC,UAAU,CAAC,YAAY,CAAC,CAAC;SAC7D;;QAGD,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,UAAU,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;YAC7C,IAAI,SAAS,GAAG,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC;YACnC,IAAI,SAAS,CAAC,KAAK,CAAC,aAAa,CAAC,YAAY,CAAC,EAAE;gBAC7C,SAAS,CAAC,KAAK,CAAC,UAAU,CAAC,YAAY,CAAC,CAAC;aAC5C;SACJ;KACJ;IAEM,MAAM;QACT,IAAI,CAAC,cAAc,EAAE,CAAC;QACtB,IAAI,CAAC,UAAU,CAAC,eAAe,CAAC,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;KAClE;;;;;;IAOO,cAAc;QAClB,IAAI,YAAY,GAAY,KAAK,CAAC;QAElC,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,UAAU,CAAC,MAAM,CAAC,CAAC,CAAY;YAClD,IAAI,OAAO,GAAG,CAAC,CAAC,KAAK,CAAC,UAAU,EAAE,CAAC;;YAGnC,IAAI,OAAO,KAAK,CAAC,CAAC,EAAE;;gBAEhB,IAAI,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,UAAU,GAAG,OAAO,EAAE;oBACzC,IAAI,IAAI,CAAC,UAAU,IAAI,CAAC,EAAE;wBACtB,OAAO,CAAC,GAAG,CACP,yBAAyB;4BACrB,CAAC,CAAC,WAAW;4BACb,WAAW;4BACX,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,UAAU,CACpC,CAAC;qBACL;oBAED,YAAY,GAAG,IAAI,CAAC;oBACpB,OAAO,KAAK,CAAC;iBAChB;aACJ;YAED,OAAO,IAAI,CAAC;SACf,CAAC,CAAC;QAEH,IAAI,YAAY,IAAI,IAAI,CAAC,UAAU,CAAC,MAAM,GAAG,CAAC,EAAE;;YAE5C,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,UAAU,CAAC,IAAI,CAClC,CAAC,CAAY,EAAE,CAAY;gBACvB,OAAO,CAAC,CAAC,WAAW,GAAG,CAAC,CAAC,WAAW,CAAC;aACxC,CACJ,CAAC;YAEF,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,UAAU,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;gBAC7C,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,WAAW,GAAG,CAAC,CAAC;aACtC;SACJ;KACJ;IAEO,uBAAuB,CAAC,IAAe;QAC3C,IAAI,CAAC,qBAAqB,CAAC,WAAW,GAAG,IAAI,CAAC,WAAW,CAAC;QAC1D,IAAI,CAAC,qBAAqB,CAAC,UAAU,GAAG,IAAI,CAAC,UAAU,CAAC;QACxD,IAAI,CAAC,qBAAqB,CAAC,SAAS,GAAG,IAAI,CAAC,SAAS,CAAC,KAAK,EAAE,CAAC;QAC9D,IAAI,CAAC,qBAAqB,CAAC,OAAO,GAAG,IAAI,CAAC,OAAO,CAAC,KAAK,EAAE,CAAC;QAC1D,IAAI,CAAC,qBAAqB,CAAC,SAAS,GAAG,IAAI,CAAC,SAAS,CAAC,KAAK,EAAE,CAAC;QAC9D,IAAI,CAAC,qBAAqB,CAAC,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,KAAK,EAAE,CAAC;KACzD;;;;IAKO,oBAAoB,CAAC,MAAqB;QAC9C,IAAI,MAAM,IAAI,aAAa,CAAC,IAAI;YAC5B,OAAO,IAAI,CAAC,UAAU,CAAC,eAAe,CAAC;QAC3C,IAAI,MAAM,IAAI,aAAa,CAAC,KAAK;YAC7B,OAAO,IAAI,CAAC,UAAU,CAAC,gBAAgB,CAAC;QAC5C,IAAI,MAAM,IAAI,aAAa,CAAC,MAAM;YAC9B,OAAO,IAAI,CAAC,UAAU,CAAC,iBAAiB,CAAC;QAE7C,OAAO,CAAC,IAAI,CAAC,mCAAmC,GAAG,MAAM,CAAC,CAAC;QAC3D,OAAO,IAAI,CAAC;KACf;;;;;;IAOO,qBAAqB,CAAC,OAAe;QACzC,IAAI,MAAM,GAAG,EAAkB,CAAC;QAChC,IAAI,CAAC,OAAO,GAAG,CAAC,MAAM,CAAC,EAAE;YACrB,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,oBAAoB,CAAC,aAAa,CAAC,IAAI,CAAC,CAAC,CAAC;SAC9D;QACD,IAAI,CAAC,OAAO,GAAG,CAAC,MAAM,CAAC,EAAE;YACrB,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,oBAAoB,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC,CAAC;SAC/D;QACD,IAAI,CAAC,OAAO,GAAG,CAAC,MAAM,CAAC,EAAE;YACrB,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,oBAAoB,CAAC,aAAa,CAAC,MAAM,CAAC,CAAC,CAAC;SAChE;QACD,OAAO,MAAM,CAAC;KACjB;;;;;;;IAQO,mBAAmB,CAAC,KAAa,EAAE,KAAa;QACpD,OAAO,KAAK,CAAC,cAAc,CACvB,IAAI,OAAO,CAAC,KAAK,EAAE,KAAK,CAAC,EACzB,IAAI,CAAC,QAAQ,CAAC,aAAa,CAC9B,CAAC;KACL;IAEO,gBAAgB,CAAC,KAAiB;QACtC,IAAI,IAAI,CAAC,UAAU,IAAI,SAAS,CAAC,SAAS;YACtC,IAAI,CAAC,UAAU,GAAG,SAAS,CAAC,KAAK,CAAC;QACtC,IAAI,IAAI,CAAC,UAAU,IAAI,SAAS,CAAC,KAAK;YAAE,OAAO;QAE/C,IACI,IAAI,CAAC,oBAAoB,CAAC,KAAK,EAAE;YAC7B,IAAI,CAAC,QAAQ,CAAC,aAAa;YAC3B,GAAG,IAAI,CAAC,QAAQ,CAAC,iBAAiB,EAAE;SACvC,CAAC,EACJ;YACE,KAAK,CAAC,cAAc,EAAE,CAAC;SAC1B;QAED,IAAI,WAAW,GAAe,IAAI,CAAC,oBAAoB,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC;QACtE,IAAI,WAAW,EAAE;YACb,WAAW,CAAC,YAAY,CAAC,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;YAExD,IAAI,IAAI,CAAC,UAAU,IAAI,CAAC,EAAE;gBACtB,OAAO,CAAC,GAAG,CACP,eAAe;oBACX,KAAK,CAAC,MAAM;oBACZ,2BAA2B;oBAC3B,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,UAAU,CACpC,CAAC;aACL;YAED,IAAI,CAAC,WAAW,CAAC,SAAS,GAAgB,KAAK,CAAC,MAAM,CAAC;YACvD,IAAI,CAAC,UAAU,CAAC,SAAS,GAAG,IAAI,OAAO,CACnC,KAAK,CAAC,OAAO,EACb,KAAK,CAAC,OAAO,CAChB,CAAC;YACF,IAAI,CAAC,UAAU,CAAC,OAAO,GAAG,IAAI,OAAO,CAAC,KAAK,CAAC,KAAK,EAAE,KAAK,CAAC,KAAK,CAAC,CAAC;YAChE,IAAI,CAAC,UAAU,CAAC,SAAS,GAAG,IAAI,CAAC,mBAAmB,CAChD,KAAK,CAAC,KAAK,EACX,KAAK,CAAC,KAAK,CACd,CAAC;SACL;KACJ;IAEO,cAAc,CAAC,KAAiB;QACpC,IAAI,IAAI,CAAC,UAAU,IAAI,SAAS,CAAC,SAAS;YACtC,IAAI,CAAC,UAAU,GAAG,SAAS,CAAC,KAAK,CAAC;QACtC,IAAI,IAAI,CAAC,UAAU,IAAI,SAAS,CAAC,KAAK;YAAE,OAAO;QAE/C,IACI,IAAI,CAAC,oBAAoB,CAAC,KAAK,EAAE;YAC7B,IAAI,CAAC,QAAQ,CAAC,aAAa;YAC3B,GAAG,IAAI,CAAC,QAAQ,CAAC,iBAAiB,EAAE;SACvC,CAAC,EACJ;YACE,KAAK,CAAC,cAAc,EAAE,CAAC;SAC1B;QAED,IAAI,WAAW,GAAe,IAAI,CAAC,oBAAoB,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC;QACtE,IAAI,WAAW,EAAE;YACb,WAAW,CAAC,UAAU,CAAC,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;YAEtD,IAAI,IAAI,CAAC,UAAU,IAAI,CAAC,EAAE;gBACtB,OAAO,CAAC,GAAG,CAAE,eAAe;oBACpB,KAAK,CAAC,MAAM;oBACZ,yBAAyB;oBACzB,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,UAAU,CACpC,CAAC;aACL;YAED,IAAI,CAAC,WAAW,CAAC,OAAO,GAAgB,KAAK,CAAC,MAAM,CAAC;YACrD,IAAI,CAAC,UAAU,CAAC,SAAS,GAAG,IAAI,OAAO,CAAC,KAAK,CAAC,OAAO,EAAE,KAAK,CAAC,KAAK,CAAC,CAAC;YACpE,IAAI,CAAC,UAAU,CAAC,OAAO,GAAG,IAAI,OAAO,CAAC,KAAK,CAAC,KAAK,EAAE,KAAK,CAAC,KAAK,CAAC,CAAC;YAChE,IAAI,CAAC,UAAU,CAAC,SAAS,GAAG,IAAI,CAAC,mBAAmB,CAChD,KAAK,CAAC,KAAK,EACX,KAAK,CAAC,KAAK,CACd,CAAC;SACL;KACJ;IACO,iBAAiB,CAAC,KAAiB;QACvC,IAAI,IAAI,CAAC,UAAU,IAAI,SAAS,CAAC,SAAS;YACtC,IAAI,CAAC,UAAU,GAAG,SAAS,CAAC,KAAK,CAAC;QACtC,IAAI,IAAI,CAAC,UAAU,IAAI,SAAS,CAAC,KAAK;YAAE,OAAO;QAE/C,IAAI,IAAI,CAAC,oBAAoB,CAAC,KAAK,EAAE;YAC7B,IAAI,CAAC,QAAQ,CAAC,aAAa;YAC3B,GAAG,IAAI,CAAC,QAAQ,CAAC,iBAAiB,EAAE;SACvC,CAAC,EACJ;YACE,KAAK,CAAC,cAAc,EAAE,CAAC;SAC1B;;QAGD,IAAI,YAAY,GAAiB;YAC7B,IAAI,CAAC,UAAU,CAAC,eAAe;YAC/B,IAAI,CAAC,UAAU,CAAC,gBAAgB;YAChC,IAAI,CAAC,UAAU,CAAC,iBAAiB;SACpC,CAAC;QACF,KAAK,IAAI,WAAW,IAAI,YAAY,EAAE;YAClC,WAAW,CAAC,UAAU,CAAC,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;SACzD;QACD,IAAI,IAAI,CAAC,UAAU,IAAI,CAAC,EAAE;YACtB,OAAO,CAAC,GAAG,CAAC,eAAe,GAAG,KAAK,CAAC,MAAM,GAAG,4BAA4B,GAAG,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;SAC9G;QACD,IAAI,CAAC,WAAW,CAAC,OAAO,GAAgB,KAAK,CAAC,MAAM,CAAC;QACrD,IAAI,CAAC,UAAU,CAAC,SAAS,GAAG,IAAI,OAAO,CAAC,KAAK,CAAC,OAAO,EAAE,KAAK,CAAC,KAAK,CAAC,CAAC;QACpE,IAAI,CAAC,UAAU,CAAC,OAAO,GAAG,IAAI,OAAO,CAAC,KAAK,CAAC,KAAK,EAAE,KAAK,CAAC,KAAK,CAAC,CAAC;QAChE,IAAI,CAAC,UAAU,CAAC,SAAS,GAAG,IAAI,CAAC,mBAAmB,CAChD,KAAK,CAAC,KAAK,EACX,KAAK,CAAC,KAAK,CACd,CAAC;KACL;IAEO,gBAAgB,CAAC,KAAiB;QACtC,IAAI,IAAI,CAAC,UAAU,IAAI,SAAS,CAAC,SAAS;YACtC,IAAI,CAAC,UAAU,GAAG,SAAS,CAAC,KAAK,CAAC;QACtC,IAAI,IAAI,CAAC,UAAU,IAAI,SAAS,CAAC,KAAK;YAAE,OAAO;QAE/C,IACI,IAAI,CAAC,oBAAoB,CAAC,KAAK,EAAE;YAC7B,IAAI,CAAC,QAAQ,CAAC,aAAa;YAC3B,GAAG,IAAI,CAAC,QAAQ,CAAC,iBAAiB,EAAE;SACvC,CAAC,EACJ;YACE,KAAK,CAAC,cAAc,EAAE,CAAC;SAC1B;;;QAID,MAAM,YAAY,GAAiB,IAAI,CAAC,qBAAqB,CACzD,KAAK,CAAC,OAAO,CAChB,CAAC;QACF,IAAI,aAAa,GAAG,KAAK,CAAC;QAC1B,KAAK,IAAI,KAAK,IAAI,YAAY,EAAE;YAC5B,IAAI,IAAI,GAAG,KAAK,CAAC,YAAY,EAAE,CAAC;YAChC,IAAI,EAAE,GAAG,KAAK,CAAC,UAAU,EAAE,CAAC;YAC5B,IAAI,EAAE,GAAG,IAAI,IAAI,IAAI,KAAK,CAAC,CAAC,EAAE;gBAC1B,KAAK,CAAC,YAAY,CAAC,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;gBAClD,aAAa,GAAG,IAAI,CAAC;aACxB;SACJ;QACD,IAAI,aAAa,EAAE;YACf,IAAI,IAAI,CAAC,UAAU,IAAI,CAAC,EAAE;gBACtB,OAAO,CAAC,GAAG,CAAC,gBAAgB,GAAG,KAAK,CAAC,OAAO,GAAG,mCAAmC,GAAG,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;aACvH;SACJ;QAED,IAAI,CAAC,UAAU,CAAC,SAAS,GAAG,IAAI,OAAO,CAAC,KAAK,CAAC,OAAO,EAAE,KAAK,CAAC,OAAO,CAAC,CAAC;QACtE,IAAI,CAAC,UAAU,CAAC,OAAO,GAAG,IAAI,OAAO,CAAC,KAAK,CAAC,KAAK,EAAE,KAAK,CAAC,KAAK,CAAC,CAAC;QAChE,IAAI,CAAC,UAAU,CAAC,SAAS,GAAG,IAAI,CAAC,mBAAmB,CAChD,KAAK,CAAC,KAAK,EACX,KAAK,CAAC,KAAK,CACd,CAAC;QACF,IAAI,CAAC,WAAW,CAAC,SAAS,GAAgB,KAAK,CAAC,MAAM,CAAC;QAEvD,IAAI,IAAI,CAAC,UAAU,IAAI,CAAC,EAAE;YACtB,OAAO,CAAC,GAAG,CAAC,aAAa,CAAC,CAAC;YAC3B,OAAO,CAAC,GAAG,CACP,eAAe,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,UAAU,CAAC,SAAS,CAAC,CAC9D,CAAC;YACF,OAAO,CAAC,GAAG,CACP,aAAa,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,CAC1D,CAAC;YACF,OAAO,CAAC,GAAG,CACP,eAAe,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,UAAU,CAAC,SAAS,CAAC,CAC9D,CAAC;SACL;KACJ;IAEO,YAAY,CAAC,GAAW;QAC5B,OAAO,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;KACjC;IAEO,YAAY,CAAC,KAAoB;QACrC,IAAI,QAAQ,GAAG,IAAI,CAAC,YAAY,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;QAC5C,IAAI,QAAQ,EAAE;YACV,QAAQ,CAAC,KAAK,CAAC,UAAU,CAAC,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;SAC5D;QAED,IAAI,IAAI,CAAC,UAAU,IAAI,CAAC,EAAE;YACtB,OAAO,CAAC,GAAG,CACP,MAAM;gBACF,KAAK,CAAC,GAAG;gBACT,yBAAyB;gBACzB,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,UAAU,CACpC,CAAC;SACL;KACJ;IAEO,cAAc,CAAC,KAAoB;QACvC,IAAI,OAAO,GAAG,IAAI,CAAC,YAAY,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;QAC3C,IAAI,CAAC,OAAO,EAAE;YACV,OAAO,GAAG;gBACN,GAAG,EAAE,KAAK,CAAC,GAAG;gBACd,KAAK,EAAE,IAAI,UAAU,EAAE;aAC1B,CAAC;YACF,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,OAAO,CAAC,GAAG,EAAE,OAAO,CAAC,CAAC;SAC3C;QAED,IAAI,CAAC,KAAK,CAAC,MAAM,EAAE;YACf,OAAO,CAAC,KAAK,CAAC,YAAY,CAAC,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;SAC7D;QAED,IAAI,IAAI,CAAC,UAAU,IAAI,CAAC,EAAE;YACtB,OAAO,CAAC,GAAG,CACP,MAAM;gBACF,KAAK,CAAC,GAAG;gBACT,2BAA2B;gBAC3B,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,UAAU;gBAC7B,eAAe;gBACf,KAAK,CAAC,MAAM,CACnB,CAAC;SACL;KACJ;IAEO,YAAY,CAAC,KAAiB;QAClC,IAAI,IAAI,CAAC,mBAAmB,CAAC,IAAI,CAAC,QAAQ,CAAC,aAAa,CAAC,EAAE;YACvD,KAAK,CAAC,cAAc,EAAE,CAAC;SAC1B;QAED,IAAI,UAAU,GAAe;YACzB,SAAS,EAAE,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,UAAU;YACxC,KAAK,EAAE,IAAI,OAAO,CAAC,KAAK,CAAC,MAAM,EAAE,KAAK,CAAC,MAAM,EAAE,KAAK,CAAC,MAAM,CAAC;YAC5D,IAAI,EAAE,KAAK,CAAC,OAAO;SACtB,CAAC;QAEF,IAAI,CAAC,UAAU,CAAC,QAAQ,CAAC,UAAU,CAAC,CAAC;QAErC,IAAI,IAAI,CAAC,UAAU,IAAI,CAAC,EAAE;YACtB,IAAI,UAAU,CAAC,IAAI,EAAE;gBACjB,OAAO,CAAC,GAAG,CACP,8BACI,UAAU,CAAC,SACf,aAAa,UAAU,CAAC,KAAK,CAAC,CAAC,KAAK,UAAU,CAAC,KAAK,CAAC,CAAC,KAClD,UAAU,CAAC,KAAK,CAAC,CACrB,GAAG,CACN,CAAC;aACL;iBAAM;gBACH,OAAO,CAAC,GAAG,CACP,sBAAsB,UAAU,CAAC,SAAS,aACtC,UAAU,CAAC,KAAK,CAAC,CACrB,KAAK,UAAU,CAAC,KAAK,CAAC,CAAC,KAAK,UAAU,CAAC,KAAK,CAAC,CAAC,GAAG,CACpD,CAAC;aACL;SACJ;KACJ;IAEO,iBAAiB,CAAC,KAAiB;QACvC,IAAI,IAAI,CAAC,UAAU,IAAI,SAAS,CAAC,SAAS;YACtC,IAAI,CAAC,UAAU,GAAG,SAAS,CAAC,KAAK,CAAC;QACtC,IAAI,IAAI,CAAC,UAAU,IAAI,SAAS,CAAC,KAAK;YAAE,OAAO;QAE/C,MAAM,KAAK,GAAG,IAAI,CAAC,oBAAoB,CAAC,GAAG,CAAC,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;QAC/D,IAAI,KAAK,KAAK,CAAC,EAAE;YACb,KAAK,CAAC,MAAM,CAAC,gBAAgB,CAAC,WAAW,EAAiB,IAAI,CAAC,gBAAgB,CAAC,CAAC;YACjF,KAAK,CAAC,MAAM,CAAC,gBAAgB,CAAC,UAAU,EAAiB,IAAI,CAAC,eAAe,CAAC,CAAC;YAC/E,KAAK,CAAC,MAAM,CAAC,gBAAgB,CACzB,aAAa,EACE,IAAI,CAAC,kBAAkB,CACzC,CAAC;YACF,IAAI,CAAC,oBAAoB,CAAC,GAAG,CACzB,KAAK,CAAC,MAAM,EACZ,KAAK,CAAC,cAAc,CAAC,MAAM,CAC9B,CAAC;YAEF,IAAI,IAAI,CAAC,UAAU,IAAI,CAAC,EAAE;gBACtB,OAAO,CAAC,GAAG,CAAC,6BAA6B,EAAE,KAAK,CAAC,MAAM,CAAC,CAAC;aAC5D;SACJ;aAAM,IAAI,KAAK,IAAI,CAAC,EAAE;YACnB,IAAI,CAAC,oBAAoB,CAAC,GAAG,CACzB,KAAK,CAAC,MAAM,EACZ,KAAK,GAAG,KAAK,CAAC,cAAc,CAAC,MAAM,CACtC,CAAC;YACF,IAAI,IAAI,CAAC,UAAU,IAAI,CAAC,EAAE;gBACtB,OAAO,CAAC,GAAG,CAAC,KAAK,GAAG,CAAC,EAAE,wBAAwB,EAAE,KAAK,CAAC,MAAM,CAAC,CAAC;aAClE;SACJ;QAED,IACI,IAAI,CAAC,oBAAoB,CAAC,KAAK,EAAE;YAC7B,IAAI,CAAC,QAAQ,CAAC,aAAa;YAC3B,GAAG,IAAI,CAAC,QAAQ,CAAC,iBAAiB,EAAE;SACvC,CAAC,EACJ;YACE,KAAK,CAAC,cAAc,EAAE,CAAC;SAC1B;;QAGD,IAAI,OAAO,GAAG,KAAK,CAAC,cAAc,CAAC;QAEnC,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,OAAO,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;YACrC,IAAI,KAAK,GAAG,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;;YAG5B,IAAI,IAAI,GAAc;gBAClB,UAAU,EAAE,KAAK,CAAC,UAAU;gBAC5B,WAAW,EAAE,IAAI,CAAC,aAAa,EAAE;gBACjC,KAAK,EAAE,IAAI,UAAU,EAAE;gBACvB,SAAS,EAAE,IAAI,OAAO,CAAC,KAAK,CAAC,OAAO,EAAE,KAAK,CAAC,OAAO,CAAC;gBACpD,OAAO,EAAE,IAAI,OAAO,CAAC,KAAK,CAAC,KAAK,EAAE,KAAK,CAAC,KAAK,CAAC;gBAC9C,SAAS,EAAE,IAAI,CAAC,mBAAmB,CAAC,KAAK,CAAC,KAAK,EAAE,KAAK,CAAC,KAAK,CAAC;aAChE,CAAC;;YAGF,IAAI,CAAC,KAAK,CAAC,YAAY,CAAC,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;YAEvD,IAAI,IAAI,CAAC,WAAW,KAAK,CAAC,EAAE;gBACxB,IAAI,CAAC,uBAAuB,CAAC,IAAI,CAAC,CAAC;aACtC;YAED,IAAI,IAAI,CAAC,UAAU,IAAI,CAAC,EAAE;gBACtB,OAAO,CAAC,GAAG,CACP,eAAe;oBACX,IAAI,CAAC,UAAU;oBACf,GAAG;oBACH,IAAI,CAAC,WAAW;oBAChB,4BAA4B;oBAC5B,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,UAAU,CACpC,CAAC;aACL;YAED,IAAI,CAAC,WAAW,CAAC,SAAS,GAAG,IAAI,CAAC,WAAW,CAAC,SAAS,GAAgB,KAAK,CAAC,MAAM,CAAC;YACpF,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;SAC9B;KACJ;IAEO,gBAAgB,CAAC,KAAiB;QACtC,IAAI,IAAI,CAAC,UAAU,IAAI,SAAS,CAAC,SAAS;YACtC,IAAI,CAAC,UAAU,GAAG,SAAS,CAAC,KAAK,CAAC;QACtC,IAAI,IAAI,CAAC,UAAU,IAAI,SAAS,CAAC,KAAK;YAAE,OAAO;QAE/C,IAAI,IAAI,CAAC,oBAAoB,EAAE;YAC3B,KAAK,CAAC,wBAAwB,EAAE,CAAC;SACpC;QAED,IACI,IAAI,CAAC,oBAAoB,CAAC,KAAK,EAAE;YAC7B,IAAI,CAAC,QAAQ,CAAC,aAAa;YAC3B,GAAG,IAAI,CAAC,QAAQ,CAAC,iBAAiB,EAAE;SACvC,CAAC,EACJ;YACE,KAAK,CAAC,cAAc,EAAE,CAAC;SAC1B;;QAGD,IAAI,OAAO,GAAG,KAAK,CAAC,cAAc,CAAC;QAEnC,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,OAAO,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;YACrC,IAAI,KAAK,GAAG,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;YAE5B,IAAI,aAAa,GAAG,IAAI,CAAC,IAAI,CAAC,UAAU,EAAE,CAAC;gBACvC,OAAO,CAAC,CAAC,UAAU,KAAK,KAAK,CAAC,UAAU,CAAC;aAC5C,CAAC,CAAC;YACH,aAAa,CAAC,SAAS,GAAG,IAAI,OAAO,CAAC,KAAK,CAAC,OAAO,EAAE,KAAK,CAAC,OAAO,CAAC,CAAC;YACpE,aAAa,CAAC,OAAO,GAAG,IAAI,OAAO,CAAC,KAAK,CAAC,KAAK,EAAE,KAAK,CAAC,KAAK,CAAC,CAAC;YAC9D,aAAa,CAAC,SAAS,GAAG,IAAI,CAAC,mBAAmB,CAC9C,KAAK,CAAC,KAAK,EACX,KAAK,CAAC,KAAK,CACd,CAAC;;YAEF,IAAI,CAAC,WAAW,CAAC,SAAS,IACtB,QAAQ,CAAC,gBAAgB,CAAC,KAAK,CAAC,OAAO,EAAE,KAAK,CAAC,OAAO,CAAC,CAC1D,CAAC;YAEF,IAAI,aAAa,CAAC,WAAW,KAAK,CAAC,EAAE;gBACjC,IAAI,CAAC,uBAAuB,CAAC,aAAa,CAAC,CAAC;aAC/C;YAED,IAAI,IAAI,CAAC,UAAU,IAAI,CAAC,EAAE;gBACtB,OAAO,CAAC,GAAG,CAAC,aAAa,CAAC,CAAC;gBAC3B,OAAO,CAAC,GAAG,CAAC,gBAAgB,GAAG,aAAa,CAAC,UAAU,CAAC,CAAC;gBACzD,OAAO,CAAC,GAAG,CAAC,iBAAiB,GAAG,aAAa,CAAC,WAAW,CAAC,CAAC;gBAC3D,OAAO,CAAC,GAAG,CACP,eAAe,GAAG,IAAI,CAAC,SAAS,CAAC,aAAa,CAAC,SAAS,CAAC,CAC5D,CAAC;gBACF,OAAO,CAAC,GAAG,CACP,aAAa,GAAG,IAAI,CAAC,SAAS,CAAC,aAAa,CAAC,OAAO,CAAC,CACxD,CAAC;gBACF,OAAO,CAAC,GAAG,CACP,eAAe,GAAG,IAAI,CAAC,SAAS,CAAC,aAAa,CAAC,SAAS,CAAC,CAC5D,CAAC;aACL;SACJ;KACJ;IAEO,eAAe,CAAC,GAAe;QACnC,IAAI,IAAI,CAAC,UAAU,IAAI,SAAS,CAAC,SAAS;YACtC,IAAI,CAAC,UAAU,GAAG,SAAS,CAAC,KAAK,CAAC;QACtC,IAAI,IAAI,CAAC,UAAU,IAAI,SAAS,CAAC,KAAK;YAAE,OAAO;QAE/C,IAAI,IAAI,CAAC,oBAAoB,EAAE;YAC3B,KAAK,CAAC,wBAAwB,EAAE,CAAC;SACpC;QAED,MAAM,KAAK,GAAG,IAAI,CAAC,oBAAoB,CAAC,GAAG,CAAC,GAAG,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;QAC7D,IAAI,KAAK,IAAI,GAAG,CAAC,cAAc,CAAC,MAAM,EAAE;YACpC,GAAG,CAAC,MAAM,CAAC,mBAAmB,CAC1B,WAAW,EACI,IAAI,CAAC,gBAAgB,CACvC,CAAC;YACF,GAAG,CAAC,MAAM,CAAC,mBAAmB,CAAC,UAAU,EAAiB,IAAI,CAAC,eAAe,CAAC,CAAC;YAChF,GAAG,CAAC,MAAM,CAAC,mBAAmB,CAC1B,aAAa,EACE,IAAI,CAAC,kBAAkB,CACzC,CAAC;YACF,IAAI,CAAC,oBAAoB,CAAC,GAAG,CAAC,GAAG,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;YAE7C,IAAI,IAAI,CAAC,UAAU,IAAI,CAAC,EAAE;gBACtB,OAAO,CAAC,GAAG,CAAC,+BAA+B,EAAE,GAAG,CAAC,MAAM,CAAC,CAAC;aAC5D;SACJ;aAAM,IAAI,KAAK,GAAG,CAAC,EAAE;YAClB,IAAI,CAAC,oBAAoB,CAAC,GAAG,CACzB,GAAG,CAAC,MAAM,EACV,KAAK,GAAG,GAAG,CAAC,cAAc,CAAC,MAAM,CACpC,CAAC;YACF,IAAI,IAAI,CAAC,UAAU,IAAI,CAAC,EAAE;gBACtB,OAAO,CAAC,GAAG,CAAC,KAAK,GAAG,CAAC,EAAE,wBAAwB,EAAE,GAAG,CAAC,MAAM,CAAC,CAAC;aAChE;SACJ;QAED,IACI,IAAI,CAAC,oBAAoB,CAAC,GAAG,EAAE;YAC3B,IAAI,CAAC,QAAQ,CAAC,aAAa;YAC3B,GAAG,IAAI,CAAC,QAAQ,CAAC,iBAAiB,EAAE;SACvC,CAAC,EACJ;YACE,GAAG,CAAC,cAAc,EAAE,CAAC;SACxB;;QAGD,IAAI,OAAO,GAAG,GAAG,CAAC,cAAc,CAAC;QAEjC,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,OAAO,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;YACrC,IAAI,KAAK,GAAG,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;;YAG5B,IAAI,CAAC,WAAW,CAAC,OAAO,GAAG,IAAI,CAAC,WAAW,CAAC,SAAS,GAAgB,QAAQ,CAAC,gBAAgB,CAAC,KAAK,CAAC,OAAO,EAAE,KAAK,CAAC,OAAO,CAAC,CAAC;YAE7H,IAAI,aAAa,GAAG,IAAI,CAAC,IAAI,CAAC,UAAU,EAAE,CAAC;gBACvC,OAAO,CAAC,CAAC,UAAU,KAAK,KAAK,CAAC,UAAU,CAAC;aAC5C,CAAC,CAAC;YACH,aAAa,CAAC,KAAK,CAAC,UAAU,CAAC,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;YAC9D,aAAa,CAAC,SAAS,GAAG,IAAI,OAAO,CAAC,KAAK,CAAC,OAAO,EAAE,KAAK,CAAC,OAAO,CAAC,CAAC;YACpE,aAAa,CAAC,OAAO,GAAG,IAAI,OAAO,CAAC,KAAK,CAAC,KAAK,EAAE,KAAK,CAAC,KAAK,CAAC,CAAC;YAC9D,aAAa,CAAC,SAAS,GAAG,IAAI,CAAC,mBAAmB,CAC9C,KAAK,CAAC,KAAK,EACX,KAAK,CAAC,KAAK,CACd,CAAC;YAEF,IAAI,aAAa,CAAC,WAAW,KAAK,CAAC,EAAE;gBACjC,IAAI,CAAC,uBAAuB,CAAC,aAAa,CAAC,CAAC;aAC/C;YAED,IAAI,IAAI,CAAC,UAAU,IAAI,CAAC,EAAE;gBACtB,OAAO,CAAC,GAAG,CACP,eAAe;oBACX,aAAa,CAAC,UAAU;oBACxB,GAAG;oBACH,aAAa,CAAC,WAAW;oBACzB,0BAA0B;oBAC1B,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,UAAU,CACpC,CAAC;aACL;SACJ;KACJ;IAEO,kBAAkB,CAAC,GAAe;QACtC,IAAI,IAAI,CAAC,UAAU,IAAI,SAAS,CAAC,SAAS;YACtC,IAAI,CAAC,UAAU,GAAG,SAAS,CAAC,KAAK,CAAC;QACtC,IAAI,IAAI,CAAC,UAAU,IAAI,SAAS,CAAC,KAAK;YAAE,OAAO;QAE/C,IAAI,IAAI,CAAC,oBAAoB,EAAE;YAC3B,KAAK,CAAC,wBAAwB,EAAE,CAAC;SACpC;QAED,MAAM,KAAK,GAAG,IAAI,CAAC,oBAAoB,CAAC,GAAG,CAAC,GAAG,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;QAC7D,IAAI,KAAK,IAAI,GAAG,CAAC,cAAc,CAAC,MAAM,EAAE;YACpC,GAAG,CAAC,MAAM,CAAC,mBAAmB,CAC1B,WAAW,EACI,IAAI,CAAC,gBAAgB,CACvC,CAAC;YACF,GAAG,CAAC,MAAM,CAAC,mBAAmB,CAAC,UAAU,EAAiB,IAAI,CAAC,eAAe,CAAC,CAAC;YAChF,GAAG,CAAC,MAAM,CAAC,mBAAmB,CAC1B,aAAa,EACE,IAAI,CAAC,kBAAkB,CACzC,CAAC;YACF,IAAI,CAAC,oBAAoB,CAAC,GAAG,CAAC,GAAG,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;YAE7C,IAAI,IAAI,CAAC,UAAU,IAAI,CAAC,EAAE;gBACtB,OAAO,CAAC,GAAG,CAAC,+BAA+B,EAAE,GAAG,CAAC,MAAM,CAAC,CAAC;aAC5D;SACJ;aAAM,IAAI,KAAK,GAAG,CAAC,EAAE;YAClB,IAAI,CAAC,oBAAoB,CAAC,GAAG,CACzB,GAAG,CAAC,MAAM,EACV,KAAK,GAAG,GAAG,CAAC,cAAc,CAAC,MAAM,CACpC,CAAC;YACF,IAAI,IAAI,CAAC,UAAU,IAAI,CAAC,EAAE;gBACtB,OAAO,CAAC,GAAG,CAAC,KAAK,GAAG,CAAC,EAAE,wBAAwB,EAAE,GAAG,CAAC,MAAM,CAAC,CAAC;aAChE;SACJ;QAED,IAAI,OAAO,GAAG,GAAG,CAAC,cAAc,CAAC;QAEjC,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,OAAO,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;;YAErC,IAAI,KAAK,GAAG,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;YAE5B,IAAI,aAAa,GAAG,IAAI,CAAC,IAAI,CAAC,UAAU,EAAE,CAAC;gBACvC,OAAO,CAAC,CAAC,UAAU,KAAK,KAAK,CAAC,UAAU,CAAC;aAC5C,CAAC,CAAC;YACH,aAAa,CAAC,KAAK,CAAC,UAAU,CAAC,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;YAC9D,aAAa,CAAC,SAAS,GAAG,IAAI,OAAO,CAAC,KAAK,CAAC,OAAO,EAAE,KAAK,CAAC,OAAO,CAAC,CAAC;YACpE,aAAa,CAAC,OAAO,GAAG,IAAI,OAAO,CAAC,KAAK,CAAC,KAAK,EAAE,KAAK,CAAC,KAAK,CAAC,CAAC;YAC9D,aAAa,CAAC,SAAS,GAAG,IAAI,CAAC,mBAAmB,CAC9C,KAAK,CAAC,KAAK,EACX,KAAK,CAAC,KAAK,CACd,CAAC;YAEF,IAAI,aAAa,CAAC,WAAW,KAAK,CAAC,EAAE;gBACjC,IAAI,CAAC,uBAAuB,CAAC,aAAa,CAAC,CAAC;aAC/C;YAED,IAAI,IAAI,CAAC,UAAU,IAAI,CAAC,EAAE;gBACtB,OAAO,CAAC,GAAG,CACP,eAAe;oBACX,aAAa,CAAC,WAAW;oBACzB,+BAA+B;oBAC/B,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,UAAU,CACpC,CAAC;aACL;SACJ;KACJ;IAEO,kBAAkB,CAAC,KAAiB;;QAExC,KAAK,CAAC,cAAc,EAAE,CAAC;QACvB,KAAK,CAAC,eAAe,EAAE,CAAC;KAC3B;CACJ;IAEW;AAAZ,WAAY,SAAS;IACjB,oCAAuB,CAAA;IACvB,4BAAe,CAAA;IACf,4BAAe,CAAA;AACnB,CAAC,EAJW,SAAS,KAAT,SAAS,QAIpB;IAEW;AAAZ,WAAY,aAAa;IACrB,iDAAQ,CAAA;IACR,qDAAU,CAAA;IACV,mDAAS,CAAA;AACb,CAAC,EAJW,aAAa,KAAb,aAAa,QAIxB;MAEY,UAAU;IAAvB;;;;QAIY,eAAU,GAAW,CAAC,CAAC,CAAC;;;;QAKxB,aAAQ,GAAW,CAAC,CAAC,CAAC;KAgEjC;IA9DG,YAAY;QACR,OAAO,IAAI,CAAC,UAAU,CAAC;KAC1B;IAED,YAAY,CAAC,KAAa;QACtB,IAAI,CAAC,UAAU,GAAG,KAAK,CAAC;KAC3B;IAED,UAAU;QACN,OAAO,IAAI,CAAC,QAAQ,CAAC;KACxB;IAED,UAAU,CAAC,KAAa;QACpB,IAAI,CAAC,QAAQ,GAAG,KAAK,CAAC;KACzB;;;;;;IAOD,aAAa,CAAC,KAAa;QACvB,OAAO,KAAK,KAAK,IAAI,CAAC,UAAU,CAAC;KACpC;;;;;IAMD,aAAa,CAAC,KAAa;;QAEvB,IAAI,IAAI,CAAC,UAAU,KAAK,CAAC,CAAC,EAAE;;YAExB,IAAI,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,QAAQ,EAAE;;gBAEjC,IAAI,KAAK,IAAI,IAAI,CAAC,UAAU,EAAE;oBAC1B,OAAO,IAAI,CAAC;iBACf;aACJ;SACJ;QAED,OAAO,KAAK,CAAC;KAChB;;;;;IAMD,WAAW,CAAC,KAAa;QACrB,OAAO,KAAK,KAAK,IAAI,CAAC,QAAQ,CAAC;KAClC;;;;IAKD,KAAK;QACD,IAAI,KAAK,GAAG,IAAI,UAAU,EAAE,CAAC;QAC7B,KAAK,CAAC,UAAU,GAAG,IAAI,CAAC,UAAU,CAAC;QACnC,KAAK,CAAC,QAAQ,GAAG,IAAI,CAAC,QAAQ,CAAC;QAE/B,OAAO,KAAK,CAAC;KAChB;CACJ;AA8GD,MAAM,SAAS;IAAf;QACY,iBAAY,GAAiB,EAAE,CAAC;KAkC3C;;;;;IA5BG,QAAQ,CAAC,UAAsB;QAC3B,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;KACtC;;;;;IAMD,QAAQ,CAAC,KAAa;QAClB,IAAI,UAAU,GAAG,IAAI,CAAC,IAAI,CAAC,YAAY,EAAE,CAAC,CAAa;YACnD,OAAO,CAAC,CAAC,SAAS,KAAK,KAAK,CAAC;SAChC,CAAC,CAAC;QACH,IAAI,UAAU;YAAE,OAAO,UAAU,CAAC;;YAC7B,OAAO,IAAI,CAAC;KACpB;;;;;IAMD,eAAe,CAAC,QAAgB;QAC5B,IAAI,IAAI,CAAC,YAAY,CAAC,MAAM,KAAK,CAAC;YAAE,OAAO;;QAE3C,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,CAAC,CAAa;YACvD,OAAO,CAAC,CAAC,SAAS,IAAI,QAAQ,CAAC;SAClC,CAAC,CAAC;;KAEN;;;MC39CiB,SAAS;IAA/B;QAcY,gBAAW,GAAY,KAAK,CAAC;QAC7B,iBAAY,GAAY,KAAK,CAAC;QAC9B,eAAU,GAAY,KAAK,CAAC;QAC5B,aAAQ,GAAY,KAAK,CAAC;QAC1B,gBAAW,GAAe,IAAI,CAAC;KAgF1C;IAhGG,OAAO,OAAO,CAAC,SAAoB;QAC/B,IAAI,SAAS,CAAC,UAAU,EAAE;YACtB,OAAO;SACV;QAED,IAAI,CAAC,SAAS,CAAC,YAAY,EAAE;YACzB,SAAS,CAAC,aAAa,EAAE,CAAC;SAC7B;QAED,SAAS,CAAC,SAAS,EAAE,CAAC;KACzB;IAQD,IAAI,SAAS;QACT,OAAO,IAAI,CAAC,UAAU,CAAC;KAC1B;IAED,IAAI,UAAU;QACV,OAAO,IAAI,CAAC,WAAW,CAAC;KAC3B;IAED,IAAI,OAAO;QACP,OAAO,IAAI,CAAC,QAAQ,CAAC;KACxB;IAED,SAAS,CAAC,MAAyB;QAC/B,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC;KAC3B;;;;IAKD,QAAQ,CAAC,UAAsB;QAC3B,IAAI,CAAC,IAAI,CAAC,WAAW,EAAE;YACnB,MAAM,IAAI,KAAK,CAAC,eAAe,IAAI,CAAC,WAAW,CAAC,IAAI,OAAO,IAAI,CAAC,UAAU,CAAC,IAAI,uEAAuE,CAAC,CAAC;SAC3J;QAED,IAAI,CAAC,WAAW,GAAG,UAAU,CAAC;KACjC;;;;IAKD,SAAS;;KAER;;;;IAKD,WAAW;;KAEV;;;;IAKD,OAAO;;QAEH,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC;KACxB;;;;IAKD,QAAQ;;KAEP;;;;IAKD,YAAY;;KAEX;;;;IAKD,aAAa;QACT,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC;;KAE5B;;;;IAKS,SAAS;QACf,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC;;KAE1B;;;AClFL;;;;;;SAMgB,SAAS,CAAC,QAAkB,EAAE,MAAgB,EAAE,KAAY;IACxE,IAAI,CAAC,QAAQ;QAAE,OAAO;IACtB,IAAI,CAAC,KAAK;QACN,MAAM,IAAI,KAAK,CAAC,gDAAgD,CAAC,CAAC;;IAGtE,IAAI,QAAQ,CAAC,MAAM,IAAI,QAAQ,CAAC,MAAM,KAAK,KAAK,EAAE;QAC9C,QAAQ,CAAC,YAAY,CAAC,QAAQ,CAAC,MAAM,CAAC,WAAW,CAAC,CAAC;QACnD,QAAQ,CAAC,MAAM,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC;QACjC,KAAK,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;KACvB;;IAGD,IAAI,MAAM,EAAE;QACR,QAAQ,CAAC,YAAY,CAAC,IAAI,OAAO,EAAE,CAAC,UAAU,CAAC,MAAM,CAAC,WAAW,CAAC,CAAC,CAAC;QACpE,KAAK,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC;QACvB,MAAM,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;KACxB;IAED,QAAQ,CAAC,iBAAiB,CAAC,IAAI,CAAC,CAAC;AACrC,CAAC;AAED;;;;;SAKgB,eAAe,CAAC,QAAkB;IAC9C,IAAI,CAAC,QAAQ,EAAE;QACX,OAAO,IAAI,CAAC;KACf;IAED,IAAI,QAAQ,YAAY,KAAK,EAAE;QAC3B,OAAO,QAAQ,CAAC;KACnB;SAAM;QACH,OAAO,eAAe,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC;KAC3C;AACL,CAAC;AAED;;;;;SAKgB,eAAe,CAAC,MAAgB,EAAE,MAAgB;IAC9D,IAAI,CAAC,MAAM,IAAI,CAAC,MAAM,CAAC,MAAM,EAAE;QAC3B,OAAO,KAAK,CAAC;KAChB;IAED,IAAI,MAAM,CAAC,MAAM,KAAK,MAAM,EAAE;QAC1B,OAAO,IAAI,CAAC;KACf;SAAM;QACH,OAAO,eAAe,CAAC,MAAM,CAAC,MAAM,EAAE,MAAM,CAAC,CAAC;KACjD;AACL,CAAC;AAED;;;;SAIgB,aAAa,CAAC,IAAU;IACpC,OAAO,IAAI,IAAI,CACX,IAAI,OAAO,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,EACnC,IAAI,OAAO,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,CACtC,CAAC;AACN,CAAC;AAED;;;;;;SAMgB,QAAQ,CAAC,GAAa,EAAE,KAAa,EAAE,QAAkB;IACrE,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;IACtB,IAAI,QAAQ,EAAE;QACV,YAAY,CAAC,GAAG,EAAE,CAAC,KAAK,KAAK,KAAK,CAAC,MAAM,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC,CAAC;KACzD;AACL,CAAC;AAED;;;;;;SAMgB,YAAY,CACxB,GAAa,EACb,SAAiB,EACjB,QAAkB;IAElB,GAAG,CAAC,MAAM,CAAC,IAAI,GAAG,SAAS,CAAC;IAC5B,IAAI,QAAQ,EAAE;QACV,YAAY,CAAC,GAAG,EAAE,CAAC,KAAK,KAAK,KAAK,CAAC,MAAM,CAAC,IAAI,GAAG,SAAS,CAAC,CAAC;KAC/D;AACL,CAAC;AAED;;;;SAIgB,mBAAmB,CAAC,GAAa;IAC7C,IAAI,CAAC,GAAG;QAAE,OAAO;IAEjB,IAAI,MAAM,GAAW,IAAI,CAAC;IAC1B,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,EAAE,EAAE,CAAC,EAAE,EAAE;QACzB,IAAI,CAAC,GAAG,IAAI,MAAM,EAAE,CAAC;QACrB,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;QACT,MAAM,IAAI,GAAG,GAAG,CAAC,GAAG,KAAK,GAAG,GAAG,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC;KACzD;IAED,OAAO,MAAM,CAAC;AAClB,CAAC;SAEe,eAAe,CAAC,GAAa;IACzC,IAAI,CAAC,GAAG,EAAE;QACN,OAAO,KAAK,CAAC;KAChB;IACD,OAAO,GAAG,EAAE;QACR,IAAI,CAAC,GAAG,CAAC,OAAO,EAAE;YACd,OAAO,KAAK,CAAC;SAChB;QACD,GAAG,GAAG,GAAG,CAAC,MAAM,CAAC;KACpB;IACD,OAAO,IAAI,CAAC;AAChB,CAAC;SAEe,eAAe,CAAqB,GAAM;IACtD,IAAI,GAAG,EAAE;QACL,YAAY,CAAC,GAAG,EAAE,CAAC,CAAC;YAChB,IAAI,CAAC,YAAY,IAAI,EAAE;gBACnB,IAAI,CAAC,CAAC,QAAQ,EAAE;oBACZ,CAAC,CAAC,QAAQ,CAAC,OAAO,EAAE,CAAC;iBACxB;gBAED,IAAI,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,QAAQ,CAAC,EAAE;oBAC3B,CAAC,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,OAAO,EAAE,CAAC,CAAC;iBAC1C;qBAAM;oBACH,CAAC,CAAC,QAAQ,CAAC,OAAO,EAAE,CAAC;iBACxB;aACJ;YAED,IAAI,CAAC,CAAC,MAAM,EAAE;gBACV,CAAC,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;aACtB;SACJ,CAAC,CAAC;KACN;AACL,CAAC;AAED;;;SAGgB,gBAAgB,CAAC,IAAgB;IAC7C,IAAI,IAAI,IAAI,IAAI,CAAC,MAAM,GAAG,CAAC,EAAE;QACzB,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;YAClC,eAAe,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC;SAC5B;QACD,IAAI,GAAG,EAAE,CAAC;KACb;AACL,CAAC;SAEe,iBAAiB,CAAC,MAAc,EAAE,KAAa,EAAE,GAAa;IAC1E,MAAM,QAAQ,GAAG,IAAI,oBAAoB,CAAC,MAAM,EAAE,EAAE,EAAE,EAAE,CAAC,CAAC;IAC1D,IAAI,QAAkB,CAAC;IAEvB,IAAI,GAAG,EAAE;QACL,QAAQ,GAAG,IAAI,oBAAoB,CAAC;YAChC,KAAK;SACR,CAAC,CAAC;KACN;SAAM;QACH,QAAQ,GAAG,IAAI,iBAAiB,CAAC;YAC7B,KAAK;SACR,CAAC,CAAC;KACN;IAED,OAAO,IAAI,IAAI,CAAC,QAAQ,EAAE,QAAQ,CAAC,CAAC;AACxC,CAAC;SAEe,eAAe,CAAC,IAAY,EAAE,KAAa,EAAE,GAAa;IACtE,MAAM,QAAQ,GAAG,IAAI,iBAAiB,CAAC,IAAI,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC;IACzD,IAAI,QAAkB,CAAC;IAEvB,IAAI,GAAG,EAAE;QACL,QAAQ,GAAG,IAAI,oBAAoB,CAAC;YAChC,KAAK;SACR,CAAC,CAAC;KACN;SAAM;QACH,QAAQ,GAAG,IAAI,iBAAiB,CAAC;YAC7B,KAAK;SACR,CAAC,CAAC;KACN;IAED,OAAO,IAAI,IAAI,CAAC,QAAQ,EAAE,QAAQ,CAAC,CAAC;AACxC,CAAC;SAEe,qBAAqB,CAAC,MAA0B,EAAE,MAAc;IAC5E,MAAM,GAAG,GAAG,IAAI,OAAO,EAAE,CAAC;IAE1B,IAAI,MAAM,YAAY,QAAQ,EAAE;QAC5B,GAAG,CAAC,qBAAqB,CAAC,MAAM,CAAC,WAAW,CAAC,CAAC;KACjD;SAAM;QACH,GAAG,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;KACpB;IAED,GAAG,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;IAEpB,MAAM,SAAS,GAAG,MAAM,CAAC,UAAU,GAAG,GAAG,CAAC;IAC1C,MAAM,UAAU,GAAG,MAAM,CAAC,WAAW,GAAG,GAAG,CAAC;IAE5C,GAAG,CAAC,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,GAAG,SAAS,IAAI,SAAS,CAAC;IACxC,GAAG,CAAC,CAAC,GAAG,EAAE,GAAG,CAAC,CAAC,GAAG,UAAU,CAAC,GAAG,UAAU,CAAC;IAC3C,GAAG,CAAC,CAAC,GAAG,CAAC,CAAC;IAEV,OAAO,IAAI,OAAO,CAAC,GAAG,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,CAAC,CAAC;AACrC,CAAC;AAED;;;;;SAKgB,oBAAoB,CAChC,cAAuB,EACvB,GAAa;IAEb,MAAM,aAAa,GAAG,IAAI,UAAU,EAAE,CAAC;IACvC,aAAa,CAAC,qBAAqB,CAAC,GAAG,CAAC,WAAW,CAAC,CAAC;IACrD,MAAM,OAAO,GAAG,cAAc,CAAC,KAAK,EAAE,CAAC,eAAe,CAAC,aAAa,CAAC,CAAC;IACtE,OAAO,OAAO,CAAC;AACnB,CAAC;SAEe,YAAY,CAAC,IAAU;IACnC,IAAI,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,QAAQ,CAAC,EAAE;QAC9B,OAAO,IAAI,CAAC,QAAQ,CAAC;KACxB;SAAM;QACH,OAAO,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;KAC1B;AACL,CAAC;SAEe,gBAAgB,CAAC,QAAkB;IAC/C,MAAM,QAAQ,GAAG,IAAI,OAAO,EAAE,CAAC;IAC/B,QAAQ,CAAC,gBAAgB,CAAC,QAAQ,CAAC,CAAC;IACpC,OAAO,QAAQ,CAAC;AACpB,CAAC;SAEe,gBAAgB,CAAC,QAAkB,EAAE,MAA0B;IAC3E,MAAM,KAAK,GAAG,eAAe,CAAC,QAAQ,CAAC,CAAC;IAExC,IAAI,CAAC,KAAK,EAAE;QACR,OAAO,CAAC,KAAK,CAAC,yCAAyC,QAAQ,CAAC,IAAI,yCAAyC,CAAC,CAAC;QAC/G,OAAO;KACV;IAED,IAAI,WAAoB,CAAC;IAEzB,IAAI,MAAM,YAAY,OAAO,EAAE;QAC3B,WAAW,GAAG,IAAI,OAAO,EAAE,CAAC;QAC5B,WAAW,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC;KACnC;SAAM;QACH,WAAW,GAAG,MAAM,CAAC,WAAW,CAAC;KACpC;IAED,MAAM,UAAU,GAAG,QAAQ,CAAC,MAAM,CAAC;IACnC,KAAK,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC;IACvB,QAAQ,CAAC,QAAQ,CAAC,qBAAqB,CAAC,WAAW,CAAC,CAAC;IACrD,UAAU,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC;AAChC,CAAC;SAEe,cAAc,CAAC,QAAkB,EAAE,QAAiB;IAChE,MAAM,KAAK,GAAG,IAAI,QAAQ,EAAE,CAAC;IAE7B,IAAI,QAAQ,CAAC,MAAM,EAAE;QACjB,QAAQ,CAAC,MAAM,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;KAC9B;IAED,gBAAgB,CAAC,KAAK,EAAE,QAAQ,CAAC,CAAC;IAClC,KAAK,CAAC,QAAQ,CAAC,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;IACvC,KAAK,CAAC,KAAK,CAAC,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC;IAEjC,KAAK,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC;IAEvB,MAAM,YAAY,GAAG,KAAK,CAAC,UAAU,CAAC,KAAK,EAAE,CAAC;IAE9C,IAAI,KAAK,CAAC,MAAM,EAAE;QACd,KAAK,CAAC,MAAM,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;KAC9B;IAED,OAAO,YAAY,CAAC;AACxB,CAAC;AAED;;;SAGgB,YAAY,CAAC,QAAkB,EAAE,QAAsC;IACnF,QAAQ,CAAC,QAAQ,CAAC,CAAC;IAEnB,MAAM,QAAQ,GAAG,QAAQ,CAAC,QAAQ,CAAC;IACnC,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,QAAQ,CAAC,MAAM,EAAE,CAAC,GAAG,CAAC,EAAE,CAAC,EAAE,EAAE;QAC7C,IAAI,QAAQ,CAAC,CAAC,CAAC,EAAE;YACb,YAAY,CAAC,QAAQ,CAAC,CAAC,CAAC,EAAE,QAAQ,CAAC,CAAC;SACvC;KACJ;AACL,CAAC;AAED;;;SAGgB,mBAAmB,CAAC,QAAkB,EAAE,QAAsC;IAE1F,IAAI,QAAQ,CAAC,OAAO,KAAK,KAAK;QAAE,OAAO;IAEvC,QAAQ,CAAC,QAAQ,CAAC,CAAC;IAEnB,MAAM,QAAQ,GAAG,QAAQ,CAAC,QAAQ,CAAC;IACnC,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,QAAQ,CAAC,MAAM,EAAE,CAAC,GAAG,CAAC,EAAE,CAAC,EAAE,EAAE;QAC7C,IAAI,QAAQ,CAAC,CAAC,CAAC,EAAE;YACb,mBAAmB,CAAC,QAAQ,CAAC,CAAC,CAAC,EAAE,QAAQ,CAAC,CAAC;SAC9C;KACJ;AACL;;ACpVA,IAAK,YAIJ;AAJD,WAAK,YAAY;IACb,gDAAS,CAAA;IACT,6DAAe,CAAA;IACf,yDAAa,CAAA;AACjB,CAAC,EAJI,YAAY,KAAZ,YAAY,QAIhB;AAED;;;MAGa,UAAW,SAAQ,QAAQ;IAyGpC,YAAY,IAAa;QACrB,KAAK,EAAE,CAAC;QATJ,gBAAW,GAAgB,EAAE,CAAC;QAC9B,kBAAa,GAAiB,YAAY,CAAC,IAAI,CAAC;QAChD,iBAAY,GAAY,KAAK,CAAC;QASlC,IAAI,IAAI,EAAE;YACN,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;SACpB;KACJ;;;;IAxGD,OAAO,OAAO,CAAC,UAAsB;;;QAGjC,YAAY,CAAC,UAAU,EAAE,CAAC,EAAE;YACxB,IAAI,EAAE,YAAY,UAAU,EAAE;gBAC1B,IAAI,EAAE,CAAC,aAAa,KAAK,YAAY,CAAC,IAAI,EAAE;oBACxC,UAAU,CAAC,uBAAuB,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;oBAC5C,EAAE,CAAC,aAAa,GAAG,YAAY,CAAC,WAAW,CAAC;;oBAG5C,EAAE,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,CAAC,aAAa,EAAE,CAAC,CAAC;iBAClD;aACJ;SACJ,CAAC,CAAC;KACN;;;;;IAMD,OAAO,wCAAwC;QAC3C,IAAI,IAAI,CAAC,uBAAuB,CAAC,MAAM,GAAG,CAAC,EAAE;;;YAGzC,MAAM,KAAK,GAAG,IAAI,CAAC,uBAAuB,CAAC,MAAM,CAAC;YAElD,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,KAAK,EAAE,CAAC,EAAE,EAAE;gBAC5B,MAAM,UAAU,GAAG,IAAI,CAAC,uBAAuB,CAAC,GAAG,EAAE,CAAC;gBACtD,IAAI,UAAU,IAAI,UAAU,CAAC,aAAa,KAAK,YAAY,CAAC,WAAW,EAAE;;oBAErE,UAAU,CAAC,SAAS,EAAE,CAAC;oBAEvB,UAAU,CAAC,aAAa,GAAG,YAAY,CAAC,SAAS,CAAC;iBACrD;aACJ;SACJ;KACJ;;;;;IAMD,OAAO,mBAAmB,CAAC,UAAsB;QAC7C,IAAI,GAAG,GAAG,UAAsB,CAAC;QAEjC,IAAI,CAAC,GAAG,EAAE;YACN,OAAO,KAAK,CAAC;SAChB;QACD,OAAO,GAAG,EAAE;YACR,IAAI,CAAC,GAAG,CAAC,OAAO,EAAE;gBACd,OAAO,KAAK,CAAC;aAChB;YACD,GAAG,GAAG,GAAG,CAAC,MAAM,CAAC;SACpB;QACD,OAAO,IAAI,CAAC;KACf;;;;;;IAOD,OAAO,oBAAoB,CAAC,GAAa;QACrC,IAAI,GAAG,YAAY,UAAU,EAAE;YAC3B,OAAO,GAAG,CAAC;SACd;QACD,IAAI,GAAG,CAAC,MAAM,EAAE;YACZ,OAAO,UAAU,CAAC,oBAAoB,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;SACtD;QACD,OAAO,IAAI,CAAC;KACf;;;;IAKD,OAAO,oBAAoB,CAAC,IAAsB,EAAE,IAAY;QAC5D,IAAI,IAAI,YAAY,UAAU,IAAI,IAAI,CAAC,IAAI,KAAK,IAAI,EAAE;YAClD,OAAO,IAAI,CAAC;SACf;QAED,KAAK,IAAI,KAAK,IAAI,IAAI,CAAC,QAAQ,EAAE;YAC7B,MAAM,EAAE,GAAG,UAAU,CAAC,oBAAoB,CAAC,KAAK,EAAE,IAAI,CAAC,CAAC;YACxD,IAAI,EAAE,EAAE;gBACJ,OAAO,EAAE,CAAC;aACb;SACJ;QAED,OAAO,IAAI,CAAC;KACf;IAMD,IAAI,SAAS;QACT,OAAO,IAAI,CAAC,aAAa,KAAK,YAAY,CAAC,IAAI,CAAC;KACnD;IAUD,YAAY,CAAsB,SAAY;QAC1C,IAAI,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC,CAAC,KAAK,CAAC,KAAK,SAAS,CAAC,EAAE;;YAE/C,OAAO;SACV;;QAGD,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;QACjC,SAAS,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;QAEzB,OAAO,SAAS,CAAC;KACpB;IAED,YAAY,CAAsB,IAAkB;QAChD,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE;YACjB,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,WAAW,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;gBAC9C,MAAM,SAAS,GAAG,IAAI,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC;gBACtC,IAAI,SAAS,YAAY,IAAI,IAAI,CAAC,SAAS,CAAC,SAAS,EAAE;oBACnD,OAAO,SAAS,CAAC;iBACpB;aACJ;SACJ;QAED,OAAO,IAAI,CAAC;KACf;IAED,aAAa,CAAsB,IAAkB;QACjD,IAAI,UAAU,GAAQ,EAAE,CAAC;QAEzB,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE;YACjB,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,WAAW,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;gBAC9C,MAAM,SAAS,GAAG,IAAI,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC;gBACtC,IAAI,SAAS,YAAY,IAAI,IAAI,CAAC,SAAS,CAAC,SAAS,EAAE;oBACnD,UAAU,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;iBAC9B;aACJ;SACJ;QAED,IAAI,UAAU,CAAC,MAAM,GAAG,CAAC,EAAE;YACvB,OAAO,UAAU,CAAC;SACrB;aAAM;YACH,OAAO,IAAI,CAAC;SACf;KACJ;IAED,sBAAsB,CAAsB,IAAkB,EAAE,gBAA0B;;QAEtF,IAAI,gBAAgB,IAAI,IAAI,CAAC,OAAO,EAAE;YAClC,MAAM,SAAS,GAAG,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,CAAC;YAC1C,IAAI,SAAS,EAAE;gBACX,OAAO,SAAS,CAAC;aACpB;SACJ;;QAGD,KAAK,MAAM,KAAK,IAAI,IAAI,CAAC,QAAQ,EAAE;YAC/B,IAAI,KAAK,YAAY,UAAU,EAAE;gBAC7B,MAAM,SAAS,GAAG,KAAK,CAAC,sBAAsB,CAAC,IAAI,EAAE,gBAAgB,CAAC,CAAC;gBACvE,IAAI,SAAS,EAAE;oBACX,OAAO,SAAS,CAAC;iBACpB;aACJ;SACJ;;QAGD,OAAO,IAAI,CAAC;KACf;IAED,uBAAuB,CAAsB,IAAkB,EAAE,gBAA0B;QACvF,MAAM,UAAU,GAAQ,EAAE,CAAC;QAE3B,IAAI,CAAC,gBAAgB,EAAE;YACnB,mBAAmB,CAAC,IAAI,EAAE,CAAC,CAAC;gBACxB,IAAI,CAAC,YAAY,UAAU,EAAE;oBACzB,MAAM,IAAI,GAAG,CAAC,CAAC,aAAa,CAAC,IAAI,CAAC,CAAC;oBACnC,IAAI,IAAI,EAAE;wBACN,UAAU,CAAC,IAAI,CAAC,GAAG,IAAI,CAAC,CAAC;qBAC5B;iBACJ;aACJ,CAAC,CAAC;SACN;aAAM;YACH,YAAY,CAAC,IAAI,EAAE,CAAC,CAAC;gBACjB,IAAI,CAAC,YAAY,UAAU,EAAE;oBACzB,MAAM,IAAI,GAAG,CAAC,CAAC,aAAa,CAAC,IAAI,CAAC,CAAC;oBACnC,IAAI,IAAI,EAAE;wBACN,UAAU,CAAC,IAAI,CAAC,GAAG,IAAI,CAAC,CAAC;qBAC5B;iBACJ;aACJ,CAAC,CAAC;SACN;QAED,IAAI,UAAU,CAAC,MAAM,GAAG,CAAC,EAAE;YACvB,OAAO,UAAU,CAAC;SACrB;aAAM;YACH,OAAO,IAAI,CAAC;SACf;KACJ;IAED,oBAAoB,CAAsB,IAAkB,EAAE,gBAA0B;;QAEpF,IAAI,gBAAgB,IAAI,IAAI,CAAC,OAAO,EAAE;YAClC,MAAM,SAAS,GAAG,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,CAAC;YAC1C,IAAI,SAAS,EAAE;gBACX,OAAO,SAAS,CAAC;aACpB;SACJ;;QAGD,IAAI,IAAI,CAAC,MAAM,IAAI,IAAI,CAAC,MAAM,YAAY,UAAU,EAAE;YAClD,MAAM,SAAS,GAAG,IAAI,CAAC,MAAM,CAAC,oBAAoB,CAAC,IAAI,EAAE,gBAAgB,CAAC,CAAC;YAC3E,IAAI,SAAS,EAAE;gBACX,OAAO,SAAS,CAAC;aACpB;SACJ;;QAGD,OAAO,IAAI,CAAC;KACf;;;;IAKD,QAAQ;QACJ,IAAI,IAAI,CAAC,SAAS,EAAE;YAChB,OAAO;SACV;QAED,IAAI,SAAS,GAAG,UAAU,CAAC,mBAAmB,CAAC,IAAI,CAAC,CAAC;QAErD,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC,CAAC;YACvB,IAAI,CAAC,CAAC,CAAC,SAAS,IAAI,SAAS,EAAE;gBAC3B,IAAI,CAAC,CAAC,CAAC,OAAO,EAAE;oBACZ,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC;oBACzB,CAAC,CAAC,SAAS,EAAE,CAAC;oBACd,CAAC,CAAC,OAAO,EAAE,CAAC;oBACZ,IAAI,CAAC,CAAC,CAAC,OAAO,EAAE;wBACZ,OAAO,CAAC,KAAK,CAAC,aAAa,CAAC,CAAC,WAAW,CAAC,IAAI,wCAAwC,CAAC,CAAC;qBAC1F;iBACJ;qBAAM;oBACH,SAAS,GAAG,IAAI,CAAC,kBAAkB,EAAE,CAAC;iBACzC;gBAED,IAAI,SAAS,EAAE;oBACX,CAAC,CAAC,QAAQ,EAAE,CAAC;iBAChB;aACJ;SACJ,CAAC,CAAC;QAEH,IAAI,CAAC,0BAA0B,EAAE,CAAC;KACrC;;;;IAKD,YAAY;QACR,IAAI,IAAI,CAAC,SAAS,EAAE;YAChB,OAAO;SACV;QAED,MAAM,SAAS,GAAG,IAAI,CAAC,kBAAkB,EAAE,CAAC;QAE5C,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC,CAAC;YACvB,IAAI,CAAC,CAAC,CAAC,SAAS,IAAI,SAAS,EAAE;gBAC3B,CAAC,CAAC,YAAY,EAAE,CAAC;aACpB;SACJ,CAAC,CAAC;QAEH,IAAI,CAAC,0BAA0B,EAAE,CAAC;KACrC;;;;IAKO,kBAAkB;QACtB,MAAM,SAAS,GAAG,UAAU,CAAC,mBAAmB,CAAC,IAAI,CAAC,CAAC;QAEvD,IAAI,IAAI,CAAC,YAAY,KAAK,SAAS,EAAE;YACjC,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC,CAAC;gBACvB,IAAI,CAAC,CAAC,CAAC,SAAS,EAAE;oBACd,IAAI,SAAS,EAAE;wBACX,CAAC,CAAC,SAAS,EAAE,CAAC;qBACjB;yBAAM;wBACH,CAAC,CAAC,WAAW,EAAE,CAAC;qBACnB;iBACJ;aACJ,CAAC,CAAC;YACH,IAAI,CAAC,YAAY,GAAG,SAAS,CAAC;SACjC;QAED,OAAO,SAAS,CAAC;KACpB;IAEO,SAAS;;QAEb,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC,CAAC;YACvB,SAAS,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;SACxB,CAAC,CAAC;QACH,IAAI,CAAC,WAAW,GAAG,EAAE,CAAC;QAEtB,IAAI,IAAI,CAAC,MAAM,EAAE;;YAEb,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;SAC5B;KACJ;IAEO,0BAA0B;QAC9B,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC,CAAC;YACzC,OAAO,CAAC,CAAC,CAAC,SAAS,CAAC;SACvB,CAAC,CAAC;KACN;;AAhUc,kCAAuB,GAAiB,EAAE;;MCDhD,OAAO;IAUhB,YAAY,QAAuB;QAJnC,kBAAa,GAAG,IAAI,QAAQ,EAAkB,CAAC;QAC/C,aAAQ,GAAG,IAAI,QAAQ,EAAkB,CAAC;QAC1C,gBAAW,GAAG,IAAI,QAAQ,EAAkB,CAAC;QAGzC,IAAI,CAAC,SAAS,GAAG,QAAQ,CAAC;QAE1B,IAAI,CAAC,wBAAwB,GAAG,IAAI,CAAC,wBAAwB,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QACzE,IAAI,CAAC,mBAAmB,GAAG,IAAI,CAAC,mBAAmB,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAC/D,IAAI,CAAC,sBAAsB,GAAG,IAAI,CAAC,sBAAsB,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;;QAGrE,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,aAAa,CAAC,CAAC,CAAC,CAAC;QACrD,IAAI,CAAC,UAAU,CAAC,gBAAgB,CAAC,aAAa,EAAE,IAAI,CAAC,wBAAwB,CAAC,CAAC;QAC/E,IAAI,CAAC,UAAU,CAAC,gBAAgB,CAAC,QAAQ,EAAE,IAAI,CAAC,mBAAmB,CAAC,CAAC;QACrE,IAAI,CAAC,UAAU,CAAC,gBAAgB,CAAC,WAAW,EAAE,IAAI,CAAC,sBAAsB,CAAC,CAAC;KAC9E;;;;;IAMD,wBAAwB;QACpB,IAAI,IAAI,CAAC,UAAU,EAAE;YACjB,MAAM,cAAc,GAAmB;gBACnC,QAAQ,EAAE,IAAI,OAAO,EAAE;gBACvB,QAAQ,EAAE,IAAI,UAAU,EAAE;gBAC1B,KAAK,EAAE,IAAI,OAAO,EAAE;aACvB,CAAC;YAEF,IAAI,CAAC,UAAU,CAAC,WAAW,CAAC,SAAS,CAAC,cAAc,CAAC,QAAQ,EAAE,cAAc,CAAC,QAAQ,EAAE,cAAc,CAAC,KAAK,CAAC,CAAC;YAC9G,OAAO,cAAc,CAAC;SACzB;aAAM;YACH,OAAO,IAAI,CAAC;SACf;KACJ;IAED,OAAO;QACH,IAAI,IAAI,CAAC,UAAU,EAAE;YACjB,IAAI,CAAC,UAAU,CAAC,mBAAmB,CAAC,aAAa,EAAE,IAAI,CAAC,wBAAwB,CAAC,CAAC;YAClF,IAAI,CAAC,UAAU,CAAC,mBAAmB,CAAC,QAAQ,EAAE,IAAI,CAAC,mBAAmB,CAAC,CAAC;YACxE,IAAI,CAAC,UAAU,CAAC,mBAAmB,CAAC,WAAW,EAAE,IAAI,CAAC,sBAAsB,CAAC,CAAC;SACjF;KACJ;IAEO,wBAAwB;QAC5B,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC,IAAI,CAAC,wBAAwB,EAAE,CAAC,CAAC;KAC9D;IAEO,mBAAmB;QACvB,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,IAAI,CAAC,wBAAwB,EAAE,CAAC,CAAC;KACzD;IAGO,sBAAsB;QAC1B,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,IAAI,CAAC,wBAAwB,EAAE,CAAC,CAAC;KAC5D;;;MCzEQ,gBAAgB;IAiCzB;QA/BQ,aAAQ,GAAY,KAAK,CAAC;QAC1B,cAAS,GAAkB,IAAI,CAAC;QAChC,WAAM,GAAiB,IAAI,CAAC;QA8BhC,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAC3C,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;KAChD;IA9BD,IAAI,OAAO;QACP,OAAO,IAAI,CAAC,QAAQ,CAAC;KACxB;IAED,IAAI,OAAO,CAAC,MAAe;QACvB,IAAI,IAAI,CAAC,QAAQ,KAAK,MAAM,EAAE;YAC1B,IAAI,CAAC,QAAQ,GAAG,MAAM,CAAC;YAEvB,IAAI,IAAI,CAAC,QAAQ,EAAE;gBACf,IAAI,CAAC,SAAS,EAAE,CAAC;aACpB;iBAAM;gBACH,IAAI,CAAC,UAAU,EAAE,CAAC;aACrB;SACJ;KACJ;IAED,IAAI,QAAQ;QACR,OAAO,IAAI,CAAC,SAAS,CAAC;KACzB;IAED,IAAI,QAAQ,CAAC,GAAkB;QAC3B,IAAI,IAAI,CAAC,SAAS,KAAK,GAAG,EAAE;YACxB,IAAI,CAAC,SAAS,GAAG,GAAG,CAAC;YACrB,IAAI,CAAC,eAAe,EAAE,CAAC;SAC1B;KACJ;IAOD,MAAM;QACF,IAAI,IAAI,CAAC,QAAQ,EAAE;YACf,IAAI,CAAC,MAAM,CAAC,MAAM,EAAE,CAAC;SACxB;KACJ;IAED,OAAO;QACH,IAAI,CAAC,OAAO,GAAG,KAAK,CAAC;KACxB;IAEO,SAAS;QACb,IAAI,CAAC,MAAM,GAAG,IAAI,KAAK,EAAE,CAAC;QAC1B,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC;QACzB,QAAQ,CAAC,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;QAC3C,IAAI,CAAC,eAAe,EAAE,CAAC;KAC1B;IAEO,UAAU;QACd,QAAQ,CAAC,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;QAC3C,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC;KACtB;IAEO,eAAe;QACnB,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE;YACd,OAAO;SACV;QAED,IAAI,GAAG,GAAG,IAAI,CAAC,SAAS,CAAC;QACzB,IAAI,CAAC,GAAG,EAAE;YACN,GAAG,GAAG,aAAa,CAAC;SACvB;QAED,IAAI,GAAG,KAAK,UAAU,EAAE;YACpB,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,KAAK,CAAC,GAAG,GAAG,KAAK,CAAC;YAClC,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,KAAK,CAAC,IAAI,GAAG,KAAK,CAAC;YACnC,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,KAAK,CAAC,KAAK,GAAG,EAAE,CAAC;YACjC,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,KAAK,CAAC,MAAM,GAAG,EAAE,CAAC;SACrC;aAAM,IAAI,GAAG,KAAK,WAAW,EAAE;YAC5B,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,KAAK,CAAC,GAAG,GAAG,KAAK,CAAC;YAClC,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,KAAK,CAAC,IAAI,GAAG,EAAE,CAAC;YAChC,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,KAAK,CAAC,KAAK,GAAG,KAAK,CAAC;YACpC,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,KAAK,CAAC,MAAM,GAAG,EAAE,CAAC;SACrC;aAAM,IAAI,GAAG,KAAK,aAAa,EAAE;YAC9B,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,KAAK,CAAC,GAAG,GAAG,EAAE,CAAC;YAC/B,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,KAAK,CAAC,IAAI,GAAG,KAAK,CAAC;YACnC,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,KAAK,CAAC,KAAK,GAAG,EAAE,CAAC;YACjC,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,KAAK,CAAC,MAAM,GAAG,KAAK,CAAC;SACxC;aAAM,IAAI,GAAG,KAAK,cAAc,EAAE;YAC/B,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,KAAK,CAAC,GAAG,GAAG,EAAE,CAAC;YAC/B,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,KAAK,CAAC,IAAI,GAAG,EAAE,CAAC;YAChC,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,KAAK,CAAC,KAAK,GAAG,KAAK,CAAC;YACpC,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,KAAK,CAAC,MAAM,GAAG,KAAK,CAAC;SACxC;KACJ;;;SC7FW,QAAQ,CAAC,GAAQ;IAC7B,OAAO,GAAG,KAAK,SAAS,IAAI,GAAG,KAAK,IAAI,CAAC;AAC7C,CAAC;SAEe,gBAAgB,CAAI,GAAM,EAAE,YAAe;IACvD,OAAO,GAAG,KAAK,SAAS,IAAI,GAAG,KAAK,IAAI,GAAG,GAAG,GAAG,YAAY,CAAC;AAClE,CAAC;AAED;;;;SAIsB,YAAY,CAAC,GAAW,EAAE,IAAS;;QACrD,OAAO,CAAC,GAAG,CAAC,yBAAyB,CAAC,CAAC;QAEvC,MAAM,OAAO,GAAG,IAAI,OAAO,EAAE,CAAC;QAC9B,OAAO,CAAC,GAAG,CAAC,cAAc,EAAE,kBAAkB,CAAC,CAAC;QAEhD,MAAM,IAAI,GAAgB;YACtB,MAAM,EAAE,MAAM;YACd,IAAI,EAAE,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC;YAC1B,IAAI,EAAE,MAAM;YACZ,OAAO,EAAE,OAAO;SAEnB,CAAA;QAED,MAAM,OAAO,GAAG,IAAI,OAAO,CAAC,GAAG,EAAE,IAAI,CAAC,CAAC;QACvC,OAAO,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;QAErB,IAAI;;YAEA,MAAM,QAAQ,GAAG,MAAM,KAAK,CAAC,OAAO,CAAC,CAAC;YACtC,OAAO,CAAC,GAAG,CAAC,mCAAmC,CAAC,CAAC;YACjD,OAAO,QAAQ,CAAC;SACnB;QAAC,OAAO,KAAK,EAAE;YACZ,OAAO,CAAC,KAAK,CAAC,0CAA0C,KAAK,EAAE,CAAC,CAAC;YACjE,OAAO,IAAI,CAAC;SACf;KACJ;CAAA;AAED;;;;;;SAMgB,qBAAqB,CAAC,OAAgB,EAAE,KAAa;IACjE,IAAI,OAAO,YAAY,WAAW,EAAE;;QAEhC,MAAM,gBAAgB,GAAiB,OAAO,CAAC,SAAS,CAAC;QAEzD,IAAI,gBAAgB,CAAC,MAAM,GAAG,CAAC,EAAE;YAC7B,MAAM,UAAU,GAAa,KAAK,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;YAC9C,IAAI,eAAe,GAAW,CAAC,CAAC;YAEhC,KAAK,MAAM,SAAS,IAAI,UAAU,EAAE;gBAChC,IAAI,gBAAgB,CAAC,QAAQ,CAAC,SAAS,CAAC,EAAE;oBACtC,eAAe,EAAE,CAAC;oBAElB,IAAI,eAAe,KAAK,UAAU,CAAC,MAAM,EAAE;wBACvC,OAAO,OAAO,CAAC;qBAClB;iBACJ;aACJ;SACJ;KACJ;;IAGD,MAAM,QAAQ,GAAG,OAAO,CAAC,QAAQ,CAAC;IAClC,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,QAAQ,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;QACtC,MAAM,KAAK,GAAG,qBAAqB,CAAC,QAAQ,CAAC,CAAC,CAAC,EAAE,KAAK,CAAC,CAAC;QACxD,IAAI,KAAK,KAAK,IAAI,EAAE;YAChB,OAAO,KAAK,CAAC;SAChB;KACJ;;IAGD,OAAO,IAAI,CAAC;AAChB,CAAC;SAEe,WAAW,CAAC,IAAY;IACpC,MAAM,cAAc,GAAG,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC;IAE7C,IAAI,QAAQ,GAAkB,IAAI,CAAC;IACnC,IAAI,cAAc,GAAG,CAAC,EAAE;QACpB,QAAQ,GAAG,IAAI,CAAC;KACnB;SAAM;QACH,QAAQ,GAAG,IAAI,CAAC,MAAM,CAAC,cAAc,GAAG,CAAC,CAAC,CAAC;KAC9C;;IAGD,MAAM,GAAG,GAAG,YAAY,CAAC,QAAQ,CAAC,CAAC;IAEnC,IAAI,GAAG,KAAK,IAAI,EAAE;QACd,OAAO,QAAQ,CAAC;KACnB;SAAM;QACH,OAAO,IAAI,CAAC;KACf;AACL,CAAC;SAEe,YAAY,CAAC,IAAY;IACrC,IAAI,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,EAAE;QACpB,MAAM,GAAG,GAAG,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,GAAG,EAAE,CAAC;QAElC,IAAI,GAAG,EAAE;YACL,IAAI,CAAC,GAAG,CAAC,QAAQ,CAAC,GAAG,CAAC,EAAE;gBACpB,OAAO,GAAG,CAAC;aACd;SACJ;KACJ;IAED,OAAO,IAAI,CAAC;AAChB,CAAC;AAED;;;;SAIsB,SAAS,CAAC,GAAW,EAAE,UAAwD;;QACjG,OAAO,IAAI,OAAO,EAAoB,CAAC,OAA0C,EAAE,MAAM;YACrF,MAAM,GAAG,GAAqB,IAAI,KAAK,EAAE,CAAC;YAE1C,GAAG,CAAC,gBAAgB,CAAC,MAAM,EAAE,CAAC,KAAK;gBAC/B,OAAO,CAAC,GAAG,CAAC,CAAC;aAChB,CAAC,CAAC;YAEH,GAAG,CAAC,gBAAgB,CAAC,UAAU,EAAE,CAAC,KAAK;gBACnC,IAAI,UAAU,EAAE;oBACZ,UAAU,CAAC,KAAK,CAAC,CAAC;iBACrB;aACJ,CAAC,CAAA;YAEF,GAAG,CAAC,gBAAgB,CAAC,OAAO,EAAE,CAAC,KAAK;gBAChC,MAAM,CAAC,KAAK,CAAC,CAAC;aACjB,CAAC,CAAC;YAEH,GAAG,CAAC,GAAG,GAAG,GAAG,CAAC;SACjB,EAAE,CAAC;KACP;CAAA;SAEe,eAAe,CAAC,IAAY;;IAExC,MAAM,QAAQ,GAAG,QAAQ,CAAC,aAAa,CAAC,UAAU,CAAC,CAAC;IACpD,QAAQ,CAAC,KAAK,CAAC,QAAQ,GAAG,OAAO,CAAC;IAClC,QAAQ,CAAC,KAAK,CAAC,OAAO,GAAG,GAAG,CAAC;IAC7B,QAAQ,CAAC,WAAW,GAAG,IAAI,CAAC;IAC5B,QAAQ,CAAC,IAAI,CAAC,WAAW,CAAC,QAAQ,CAAC,CAAC;;IAGpC,QAAQ,CAAC,MAAM,EAAE,CAAC;IAClB,QAAQ,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC;;IAG7B,QAAQ,CAAC,MAAM,EAAE,CAAC;AACtB,CAAC;SAEe,UAAU,CAAC,IAAY,EAAE,IAAY;IACjD,IAAI,CAAC,IAAI,IAAI,IAAI,CAAC,MAAM,KAAK,CAAC,EAAE;QAC5B,OAAO,IAAI,CAAC;KACf;SAAM,IAAI,IAAI,CAAC,MAAM,GAAG,CAAC,EAAE;QACxB,IAAI,IAAI,KAAK,IAAI,EAAE,CAAC;KACvB;IAED,OAAO,IAAI,CAAC;AAChB,CAAC;SAEe,MAAM,CAAuB,KAAU,EAAE,WAAc;IACnE,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC;QACZ,OAAO,CAAC,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC,WAAW,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,CAAA;KAClD,CAAC,CAAC;AACP,CAAC;SAEe,MAAM,CAAuB,KAAU,EAAE,WAAc;IACnE,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC;QACZ,OAAO,CAAC,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC,WAAW,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,CAAA;KAClD,CAAC,CAAC;AACP;;MC/Ka,UAAU,GAAG,IAAI,OAAO,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE;MAClC,YAAY,GAAG,IAAI,OAAO,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE;MACrC,eAAe,GAAG,IAAI,OAAO,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE;MACvC,YAAY,GAAG,IAAI,OAAO,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,EAAE;MACrC,YAAY,GAAG,IAAI,OAAO,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE;MACrC,aAAa,GAAG,IAAI,OAAO,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE;MACrC,YAAY,GAAG,IAAI,OAAO,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE;MACpC,WAAW,GAAG,IAAI,OAAO,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE;SAEhC,WAAW,CAAC,KAAa,EAAE,GAAW,EAAE,QAAgB,EAAE,IAA4B;IAClG,IAAI,IAAI,EAAE;QACN,QAAQ,GAAG,IAAI,CAAC,QAAQ,CAAC,CAAC;KAC7B;IAED,OAAO,CAAC,CAAC,GAAG,QAAQ,IAAI,KAAK,GAAG,QAAQ,GAAG,GAAG,CAAC;AACnD,CAAC;SAEe,kBAAkB,CAAC,KAAa,EAAE,GAAW,EAAE,QAAgB,EAAE,IAA4B;IACzG,MAAM,KAAK,GAAG,WAAW,CAAC,KAAK,EAAE,GAAG,EAAE,QAAQ,EAAE,IAAI,CAAC,CAAC;IACtD,OAAO,KAAK,CAAC,KAAK,EAAE,KAAK,EAAE,GAAG,CAAC,CAAC;AACpC,CAAC;SAEe,KAAK,CAAC,KAAa,EAAE,GAAY,EAAE,GAAY;IAC3D,IAAI,QAAQ,CAAC,GAAG,CAAC,IAAI,KAAK,GAAG,GAAG,EAAE;QAC9B,KAAK,GAAG,GAAG,CAAC;KACf;IACD,IAAI,QAAQ,CAAC,GAAG,CAAC,IAAI,KAAK,GAAG,GAAG,EAAE;QAC9B,KAAK,GAAG,GAAG,CAAC;KACf;IAED,OAAO,KAAK,CAAC;AACjB,CAAC;SAEe,OAAO,CAAC,KAAa,EAAE,GAAW,EAAE,GAAW;IAC3D,IAAI,KAAK,IAAI,GAAG,IAAI,KAAK,IAAI,GAAG,EAAE;QAC9B,OAAO,IAAI,CAAC;KACf;SAAM;QACH,OAAO,KAAK,CAAC;KAChB;AACL,CAAC;SAEe,MAAM,CAAC,KAAa;IAChC,OAAO,KAAK,GAAG,CAAC,KAAK,CAAC,CAAC;AAC3B,CAAC;SAEe,KAAK,CAAC,KAAa;IAC/B,OAAO,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;AAC1B,CAAC;SAEe,aAAa,CAAC,KAAa,EAAE,GAAW,EAAE,GAAW;IACjE,IAAI,KAAK,GAAG,CAAC,GAAG;QACZ,KAAK,IAAI,GAAG,CAAC;IACjB,IAAI,KAAK,GAAG,GAAG;QACX,KAAK,IAAI,GAAG,CAAC;IACjB,OAAO,KAAK,CAAC,KAAK,EAAE,GAAG,EAAE,GAAG,CAAC,CAAC;AAClC,CAAC;SAEe,aAAa,CAAC,MAAe,EAAE,MAAc,EAAE,QAAiB;;;;;;;IAQ5E,MAAM,GAAG,GAAG,IAAI,OAAO,EAAE,CAAC;IAC1B,GAAG,CAAC,CAAC,GAAG,MAAM,CAAC,CAAC,GAAG,MAAM,GAAG,IAAI,CAAC,GAAG,CAAC,SAAS,CAAC,OAAO,GAAG,QAAQ,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,SAAS,CAAC,OAAO,GAAG,QAAQ,CAAC,CAAC,CAAC,CAAC;IAChH,GAAG,CAAC,CAAC,GAAG,MAAM,CAAC,CAAC,GAAG,MAAM,GAAG,IAAI,CAAC,GAAG,CAAC,SAAS,CAAC,OAAO,GAAG,QAAQ,CAAC,CAAC,CAAC,CAAC;IACrE,GAAG,CAAC,CAAC,GAAG,MAAM,CAAC,CAAC,GAAG,MAAM,GAAG,IAAI,CAAC,GAAG,CAAC,SAAS,CAAC,OAAO,GAAG,QAAQ,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,SAAS,CAAC,OAAO,GAAG,QAAQ,CAAC,CAAC,CAAC,CAAC;IAEhH,OAAO,GAAG,CAAC;AACf,CAAC;SAEe,aAAa,CAAC,MAAe,EAAE,MAAc,EAAE,KAAa;IACxE,MAAM,QAAQ,GAAW,KAAK,GAAG,SAAS,CAAC,OAAO,CAAC;IAEnD,MAAM,KAAK,GAAG,IAAI,OAAO,CACrB,MAAM,CAAC,CAAC,GAAG,MAAM,GAAG,IAAI,CAAC,GAAG,CAAC,QAAQ,CAAC,EACtC,MAAM,CAAC,CAAC,GAAG,MAAM,GAAG,IAAI,CAAC,GAAG,CAAC,QAAQ,CAAC,CACzC,CAAC;IAEF,OAAO,KAAK,CAAC;AACjB,CAAC;AAED;;;;SAIgB,gBAAgB,CAAC,KAAc,EAAE,UAAqB;IAElE,MAAM,CAAC,GAAG,KAAK,CAAC,CAAC,CAAC;IAClB,MAAM,CAAC,GAAG,KAAK,CAAC,CAAC,CAAC;IAElB,IAAI,MAAM,GAAG,KAAK,CAAC;IACnB,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,UAAU,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC,GAAG,UAAU,CAAC,MAAM,EAAE,CAAC,GAAG,CAAC,EAAE,EAAE;QACvE,IAAI,EAAE,GAAG,UAAU,CAAC,CAAC,CAAC,CAAC,CAAC,EACpB,EAAE,GAAG,UAAU,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;QACzB,IAAI,EAAE,GAAG,UAAU,CAAC,CAAC,CAAC,CAAC,CAAC,EACpB,EAAE,GAAG,UAAU,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;QAEzB,IAAI,SAAS,GAAG,CAAC,CAAC,EAAE,GAAG,CAAC,MAAM,EAAE,GAAG,CAAC,CAAC;aAChC,CAAC,GAAG,CAAC,EAAE,GAAG,EAAE,KAAK,CAAC,GAAG,EAAE,CAAC,IAAI,EAAE,GAAG,EAAE,CAAC,GAAG,EAAE,CAAC,CAAC;QAChD,IAAI,SAAS;YAAE,MAAM,GAAG,CAAC,MAAM,CAAC;KACnC;IAED,OAAO,MAAM,CAAC;AAClB,CAAC;SAEe,mBAAmB,CAAC,SAAiB,EAAE,SAAiB,EAAE,SAAqC;IAC3G,IAAI,SAAS,IAAI,CAAC,EAAE;QAChB,OAAO,EAAE,CAAC;KACb;IAED,MAAM,UAAU,GAAW,CAAC,SAAS,GAAG,CAAC,IAAI,SAAS,CAAC;;IAGvD,IAAI,MAAc,CAAC;IACnB,IAAI,MAAc,CAAC;IACnB,IAAI,SAAS,IAAI,OAAO,EAAE;QACtB,MAAM,GAAG,CAAC,CAAC;QACX,MAAM,GAAG,CAAC,SAAS,CAAC;KACvB;SAAM,IAAI,SAAS,IAAI,QAAQ,EAAE;QAC9B,MAAM,GAAG,EAAE,UAAU,GAAG,GAAG,CAAC,CAAC;QAC7B,MAAM,GAAG,SAAS,CAAC;KACtB;SAAM;QACH,MAAM,GAAG,CAAC,CAAC;QACX,MAAM,GAAG,SAAS,CAAC;KACtB;IAED,MAAM,UAAU,GAAa,EAAE,CAAC;IAChC,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,SAAS,EAAE,CAAC,EAAE,EAAE;QAChC,UAAU,CAAC,IAAI,CACX,MAAM,IAAI,MAAM,GAAG,CAAC,CAAC,CACxB,CAAC;KACL;IAED,OAAO,UAAU,CAAC;AACtB,CAAC;SAEe,SAAS,CAAC,KAAa,EAAE,GAAW,EAAE,GAAW;IAC7D,OAAO,CAAC,KAAK,GAAG,GAAG,KAAK,GAAG,GAAG,GAAG,CAAC,CAAC;AACvC,CAAC;SAEe,gBAAgB,CAAC,KAAa,EAAE,GAAW,EAAE,GAAW;IACpE,KAAK,GAAG,KAAK,CAAC,KAAK,EAAE,GAAG,EAAE,GAAG,CAAC,CAAC;IAC/B,OAAO,CAAC,KAAK,GAAG,GAAG,KAAK,GAAG,GAAG,GAAG,CAAC,CAAC;AACvC,CAAC;SAEe,WAAW,CAAC,MAAc,EAAE,GAAW,EAAE,GAAW;IAChE,OAAO,MAAM,IAAI,GAAG,GAAG,GAAG,CAAC,GAAG,GAAG,CAAC;AACtC,CAAC;SAEe,kBAAkB,CAAC,MAAc,EAAE,GAAW,EAAE,GAAW;IACvE,MAAM,GAAG,KAAK,CAAC,MAAM,EAAE,GAAG,EAAE,GAAG,CAAC,CAAC;IACjC,OAAO,MAAM,IAAI,GAAG,GAAG,GAAG,CAAC,GAAG,GAAG,CAAC;AACtC,CAAC;SAEe,sBAAsB,CAAC,IAAY,EAAE,MAAc;IAC/D,OAAO;QACH,IAAI,EAAE,CAAE,IAAI,GAAG,MAAM,GAAG,CAAC;QACzB,KAAK,EAAE,IAAI,GAAG,MAAM,GAAG,CAAC;QACxB,GAAG,EAAE,IAAI,GAAG,CAAC;QACb,MAAM,EAAE,CAAE,IAAI,GAAG,CAAC;KACrB,CAAA;AACL,CAAC;AAED;;;;;;SAMgB,YAAY,CAAC,GAAW,EAAE,KAAa;IACnD,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,GAAG,CAAC,EAAE;QACxB,OAAO,IAAI,CAAC;KACf;IACD,IAAI,GAAG,GAAG,KAAK,EAAE;QACb,OAAO,IAAI,CAAC;KACf;IAED,MAAM,GAAG,GAAG,GAAG,GAAG,KAAK,CAAC;IACxB,MAAM,UAAU,GAAa,EAAE,CAAC;IAEhC,IAAI,GAAG,KAAK,CAAC,EAAE;QACX,MAAM,KAAK,GAAG,GAAG,GAAG,KAAK,CAAC;QAC1B,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,KAAK,EAAE,CAAC,EAAE,EAAE;YAC5B,UAAU,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;SAC1B;QAED,OAAO,UAAU,CAAC;KACrB;SAAM;QACH,MAAM,KAAK,GAAG,CAAC,GAAG,GAAG,GAAG,IAAI,KAAK,CAAC;QAClC,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,KAAK,EAAE,CAAC,EAAE,EAAE;YAC5B,UAAU,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;SAC1B;QAED,KAAI,IAAI,CAAC,GAAE,CAAC,EAAE,CAAC,GAAG,GAAG,EAAE,CAAC,EAAE,EAAE;YACxB,UAAU,CAAC,CAAC,CAAC,GAAG,UAAU,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC;SACrC;QAED,OAAO,UAAU,CAAC;KACrB;AACL;;MCjMa,2BAA2B;IAYpC,YAAY,QAAuB,EAAE,OAAiB;QAXtD,YAAO,GAAY,IAAI,CAAC;QACxB,oBAAe,GAAW,EAAE,CAAC;QAE7B,sBAAiB,GAAW,GAAG,CAAC;QAChC,yBAAoB,GAAW,IAAI,CAAC;QAI5B,wBAAmB,GAAW,CAAC,CAAC,CAAC;QACjC,mBAAc,GAAW,CAAC,CAAC,CAAC;QAGhC,IAAI,CAAC,SAAS,GAAG,QAAQ,CAAC;QAE1B,IAAI,CAAC,OAAO,GAAG,IAAI,kCAAkC,EAAE,CAAC;QACxD,IAAI,CAAC,OAAO,CAAC,OAAO,GAAG,KAAK,CAAC;QAE7B,IAAI,CAAC,OAAO,EAAE;YACV,OAAO,GAAG,EAAE,CAAC;SAChB;QAED,IAAI,QAAQ,CAAC,OAAO,CAAC,YAAY,CAAC,EAAE;YAChC,IAAI,CAAC,OAAO,GAAG,OAAO,CAAC,YAAY,CAAC;SACvC;QAED,IAAI,QAAQ,CAAC,OAAO,CAAC,eAAe,CAAC,EAAE;YACnC,IAAI,CAAC,eAAe,GAAG,OAAO,CAAC,eAAe,CAAC;SAClD;QAED,IAAI,QAAQ,CAAC,OAAO,CAAC,gBAAgB,CAAC,EAAE;YACpC,IAAI,CAAC,gBAAgB,GAAG,OAAO,CAAC,gBAAgB,CAAC;SACpD;aAAM;YACH,IAAI,CAAC,gBAAgB,GAAG,QAAQ,CAAC,aAAa,EAAE,CAAC;SACpD;QAED,IAAI,QAAQ,CAAC,OAAO,CAAC,iBAAiB,CAAC,EAAE;YACrC,IAAI,CAAC,iBAAiB,GAAG,OAAO,CAAC,iBAAiB,CAAC;SACtD;QAED,IAAI,QAAQ,CAAC,OAAO,CAAC,oBAAoB,CAAC,EAAE;YACxC,IAAI,CAAC,oBAAoB,GAAG,OAAO,CAAC,oBAAoB,CAAC;SAC5D;KACJ;IAED,MAAM;QACF,MAAM,cAAc,GAAG,WAAW,CAAC,GAAG,EAAE,CAAC;QAEzC,IAAI,IAAI,CAAC,mBAAmB,GAAG,CAAC,IAAI,IAAI,CAAC,OAAO,EAAE;YAC9C,MAAM,gBAAgB,GAAG,cAAc,GAAG,IAAI,CAAC,mBAAmB,CAAC;YACnE,MAAM,eAAe,GAAG,IAAI,CAAC,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,eAAe,CAAC,CAAC;YAC/D,IAAI,CAAC,OAAO,CAAC,UAAU,CACnB,YAAY,EACZ,sBAAsB,eAAe,CAAC,OAAO,CAAC,CAAC,CAAC,EAAE,CACrD,CAAC;;YAGF,MAAM,CAAC,GAAG,CAAC,eAAe,GAAG,gBAAgB,IAAI,eAAe,CAAC;YACjE,IAAI,CAAC,OAAO,CAAC,UAAU,CAAC,GAAG,EAAE,MAAM,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC;YAEnD,IAAI,UAAU,GAAG,CAAC,CAAC;YACnB,IAAI,CAAC,GAAG,CAAC,EAAE;gBACP,UAAU,GAAG,CAAC,IAAI,CAAC,oBAAoB,CAAC;aAC3C;iBAAM,IAAI,CAAC,GAAG,CAAC,EAAE;gBACd,UAAU,GAAG,IAAI,CAAC,oBAAoB,CAAC;aAC1C;;;YAGD,IAAI,CAAC,OAAO,CAAC,UAAU,CACnB,YAAY,EACZ,gBAAgB,UAAU,CAAC,OAAO,CAAC,CAAC,CAAC,EAAE,CAC1C,CAAC;YAEF,IAAI,UAAU,KAAK,CAAC,EAAE;;gBAElB,MAAM,aAAa,GAAG,KAAK,CACvB,IAAI,CAAC,SAAS,CAAC,aAAa,EAAE,GAAG,UAAU,EAC3C,IAAI,CAAC,iBAAiB,EACtB,IAAI,CAAC,gBAAgB,CACxB,CAAC;;gBAIF,IAAI,IAAI,CAAC,SAAS,CAAC,aAAa,EAAE,KAAK,aAAa,EAAE;;oBAElD,IAAI,CAAC,SAAS,CAAC,aAAa,CAAC,aAAa,CAAC,CAAC;iBAC/C;aACJ;YAED,IAAI,CAAC,cAAc,GAAG,gBAAgB,CAAC;SAC1C;QAED,IAAI,CAAC,mBAAmB,GAAG,cAAc,CAAC;QAC1C,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;KAC7B;IAED,oBAAoB;QAChB,OAAO,IAAI,CAAC,SAAS,CAAC,aAAa,EAAE,CAAC;KACzC;IAED,gBAAgB;QACZ,OAAO,IAAI,CAAC,cAAc,CAAC;KAC9B;CACJ;AAED,MAAM,kCAAkC;IAgBpC;QACI,IAAI,CAAC,OAAO,GAAG,QAAQ,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;QAC7C,QAAQ,CAAC,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;QACxC,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,QAAQ,GAAG,UAAU,CAAC;QACzC,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,IAAI,GAAG,CAAC,GAAG,IAAI,CAAC;QACnC,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,MAAM,GAAG,CAAC,GAAG,IAAI,CAAC;QACrC,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,QAAQ,GAAG,GAAG,GAAG,IAAI,CAAC;QACzC,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,OAAO,GAAG,CAAC,GAAG,IAAI,CAAC;QACtC,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,eAAe,GAAG,MAAM,CAAC;QAC5C,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,UAAU,GAAG,aAAa,CAAC;QAE9C,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;QACxD,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;QACpD,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;KAC1D;IAtBD,IAAI,OAAO;QACP,OAAO,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,OAAO,KAAK,OAAO,CAAC;KACjD;IAED,IAAI,OAAO,CAAC,OAAgB;QACxB,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,OAAO,GAAG,OAAO,GAAG,OAAO,GAAG,MAAM,CAAC;KAC3D;IAkBO,eAAe,CAAC,MAAmB;QACvC,MAAM,MAAM,GAAG,QAAQ,CAAC,aAAa,CAAC,GAAG,CAAC,CAAC;QAC3C,MAAM,CAAC,KAAK,CAAC,KAAK,GAAG,MAAM,CAAC;QAC5B,MAAM,CAAC,KAAK,CAAC,MAAM,GAAG,CAAC,GAAG,IAAI,CAAC;QAC/B,MAAM,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC;QAC3B,OAAO,MAAM,CAAC;KACjB;IAEM,UAAU,CAAC,EAAU,EAAE,IAAY;QACtC,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE;YACf,OAAO;SACV;QAED,IAAI,CAAC,IAAI,CAAC,cAAc,EAAE;YACtB,IAAI,CAAC,cAAc,GAAG,IAAI,GAAG,EAAE,CAAC;SACnC;QAED,IAAI,MAAM,GAAG,IAAI,CAAC,cAAc,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC;QACzC,IAAI,CAAC,MAAM,EAAE;YACT,MAAM,GAAG,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;YAC5C,IAAI,CAAC,cAAc,CAAC,GAAG,CAAC,EAAE,EAAE,MAAM,CAAC,CAAC;SACvC;QAED,MAAM,CAAC,SAAS,GAAG,IAAI,CAAC;KAC3B;IAED,MAAM,CAAC,MAAmC;QACtC,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE;YACf,OAAO;SACV;QAED,IAAI,CAAC,aAAa,CAAC,SAAS,GAAG,gBAAgB,MAAM;aAChD,oBAAoB,EAAE;aACtB,OAAO,CAAC,CAAC,CAAC,EAAE,CAAC;QAElB,IAAI,CAAC,SAAS,CAAC,SAAS,GAAG,YAAY,MAAM,CAAC,iBAAiB,MAC3D,MAAM,CAAC,gBACP,EAAE,CAAC;QAEP,IAAI,CAAC,YAAY,CAAC,SAAS,GAAG,eAAe,MAAM;aAC9C,gBAAgB,EAAE;aAClB,OAAO,CAAC,CAAC,CAAC,EAAE,CAAC;KACrB;;;AC/LL;;;;;;;;SAQsB,gBAAgB,CAAC,SAAwB,EAAE,OAAgB,EAAE,QAAiB;;QAChG,IAAI,OAAO,QAAQ,KAAK,QAAQ,IAAI,QAAQ,IAAI,CAAC,EAAE;YAC/C,QAAQ,GAAG,EAAE,CAAC;SACjB;QAED,OAAO,IAAI,OAAO,CAAO,CAAC,OAAO,EAAE,MAAM;YACrC,IAAI,aAAqB,CAAC;YAC1B,IAAI,SAAiB,CAAC;YAEtB,MAAM,IAAI,GAAG;gBACT,IAAI,SAAS,EAAE,EAAE;oBACb,MAAM,CAAC,YAAY,CAAC,aAAa,CAAC,CAAC;oBACnC,MAAM,CAAC,YAAY,CAAC,SAAS,CAAC,CAAC;oBAC/B,OAAO,OAAO,EAAE,CAAC;iBACpB;qBAAM;oBACH,aAAa,GAAG,MAAM,CAAC,UAAU,CAAC,IAAI,EAAE,QAAQ,CAAC,CAAC;iBACrD;aACJ,CAAC;YAEF,IAAI,EAAE,CAAC;YAEP,IAAI,OAAO,OAAO,KAAK,QAAQ,IAAI,OAAO,GAAG,CAAC,EAAE;gBAC5C,SAAS,GAAG,MAAM,CAAC,UAAU,CAAC;;oBAE1B,MAAM,CAAC,YAAY,CAAC,aAAa,CAAC,CAAC;;oBAGnC,IAAI,SAAS,EAAE,EAAE;wBACb,OAAO,OAAO,EAAE,CAAC;qBACpB;yBAAM;wBACH,OAAO,MAAM,CAAC,gDAAgD,CAAC,CAAC;qBACnE;iBACJ,EAAE,OAAO,CAAC,CAAC;aACf;SACJ,CAAC,CAAC;KACN;CAAA;AAED;;;;;SAKsB,cAAc,CAAC,OAAe;;QAChD,OAAO,CAAC,IAAI,CAAC,oHAAoH,CAAC,CAAA;QAClI,IAAI,OAAO,GAAG,CAAC,EAAE;YACb,OAAO,IAAI,OAAO,CAAO,CAAC,OAAO,EAAE,MAAM;gBACrC,MAAM,CAAC,UAAU,CAAC;oBACd,OAAO,OAAO,EAAE,CAAC;iBACpB,GAAG,OAAO,GAAG,IAAI,EAAE,CAAC;aACxB,CAAC,CAAC;SACN;aAAM;YACH,OAAO,OAAO,CAAC,OAAO,EAAE,CAAC;SAC5B;KACJ;;;ACpDD;;;MAGa,YAAY;IAQrB,YAAY,WAAoC;QAJxC,WAAM,GAAqB,IAAI,CAAC;QAChC,YAAO,GAAgB,IAAI,CAAC;QAC5B,aAAQ,GAAY,KAAK,CAAC;QAG9B,IAAI,CAAC,WAAW,GAAG,WAAW,CAAC;KAClC;;;;IAKD,SAAS;QACL,OAAO,IAAI,CAAC,QAAQ,CAAC;KACxB;;;;IAKD,eAAe;QACX,OAAO,IAAI,CAAC,MAAM,CAAC;KACtB;;;;;;;IAQK,gBAAgB,CAAC,OAAgB;;YACnC,IAAI,IAAI,CAAC,MAAM,EAAE;gBACb,OAAO;oBACH,OAAO,EAAE,IAAI;iBAChB,CAAA;aACJ;YAED,IAAI;gBACA,IAAI,CAAC,OAAO,GAAG,MAAM,SAAS,CAAC,YAAY,CAAC,YAAY,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;aAC9E;YAAC,OAAO,KAAK,EAAE;gBACZ,OAAO;oBACH,OAAO,EAAE,KAAK;oBACd,KAAK,EAAE,KAAK;iBACf,CAAA;aACJ;YAED,IAAI,CAAC,MAAM,GAAG,QAAQ,CAAC,aAAa,CAAC,OAAO,CAAC,CAAC;YAC9C,IAAI,CAAC,MAAM,CAAC,SAAS,GAAG,IAAI,CAAC,OAAO,CAAC;;YAErC,IAAI,CAAC,MAAM,CAAC,YAAY,CAAC,aAAa,EAAE,MAAM,CAAC,CAAC;YAChD,IAAI,CAAC,MAAM,CAAC,IAAI,EAAE,CAAC;YAEnB,IAAI,OAAO,OAAO,KAAK,QAAQ,EAAE;gBAC7B,IAAI,OAAO,IAAI,CAAC,EAAE;oBACd,OAAO,GAAG,IAAI,CAAC;iBAClB;aACJ;YAGD,IAAI;gBACA,MAAM,gBAAgB,CAAC;oBACnB,IAAI,IAAI,CAAC,MAAM,EAAE;wBACb,OAAO,IAAI,CAAC,MAAM,CAAC,UAAU,KAAK,gBAAgB,CAAC,gBAAgB,CAAC;qBACvE;iBACJ,EAAE,OAAO,CAAC,CAAC;gBAEZ,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC;gBACrB,OAAO;oBACH,OAAO,EAAE,IAAI;iBAChB,CAAA;aACJ;YAAC,OAAO,KAAK,EAAE;gBACZ,IAAI,CAAC,eAAe,EAAE,CAAC;gBACvB,IAAI,CAAC,QAAQ,GAAG,KAAK,CAAC;gBACtB,OAAO;oBACH,OAAO,EAAE,KAAK;oBACd,KAAK,EAAE,KAAK;iBACf,CAAA;aACJ;SACJ;KAAA;;;;IAKD,eAAe;QACX,IAAI,IAAI,CAAC,MAAM,EAAE;YACb,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC;SACtB;QAED,IAAI,IAAI,CAAC,OAAO,EAAE;YACd,MAAM,MAAM,GAAG,IAAI,CAAC,OAAO,CAAC,SAAS,EAAE,CAAA;YACvC,KAAK,IAAI,KAAK,IAAI,MAAM,EAAE;gBACtB,KAAK,CAAC,IAAI,EAAE,CAAC;aAChB;YAED,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC;SACvB;QAED,IAAI,CAAC,QAAQ,GAAG,KAAK,CAAC;KACzB;IAED,OAAO;QACH,IAAI,CAAC,eAAe,EAAE,CAAC;KAC1B;;;ACzGL;;;IAGiB,QAkHhB;AAlHD,WAAiB,OAAO;;;;IAIP,mBAAW,GAAU,IAAI,KAAK,CAAC,IAAI,OAAO,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;IAElE,MAAM,UAAU,GAAc,IAAI,SAAS,EAAE,CAAC;;;;;;IA2B9C,SAAgB,cAAc,CAAC,SAAkB,EAAE,MAAc;QAC7D,UAAU,CAAC,aAAa,CAAC,SAAS,EAAE,MAAM,CAAC,CAAC;QAC5C,OAAO,UAAU,CAAC,GAAG,CAAC,KAAK,EAAE,CAAC;KACjC;IAHe,sBAAc,iBAG7B,CAAA;;;;;;IAOD,SAAgB,UAAU,CAAC,GAAQ,EAAE,QAAgB;QACjD,IAAI,GAAG,GAAG,IAAI,OAAO,CACjB,GAAG,CAAC,SAAS,CAAC,CAAC,EACf,GAAG,CAAC,SAAS,CAAC,CAAC,EACf,GAAG,CAAC,SAAS,CAAC,CAAC,CAClB,CAAC;QACF,GAAG,CAAC,cAAc,CAAC,QAAQ,CAAC,CAAC;QAC7B,GAAG,CAAC,GAAG,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;QAEpB,OAAO,GAAG,CAAC;KACd;IAVe,kBAAU,aAUzB,CAAA;;;;;;;IAQD,SAAgB,YAAY,CAAC,GAAQ,EAAE,KAAY;QAC/C,IAAI,KAAK,GAAG,IAAI,OAAO,EAAE,CAAC;QAC1B,KAAK,GAAG,GAAG,CAAC,cAAc,CAAC,KAAK,EAAE,KAAK,CAAC,CAAC;QAEzC,OAAO,KAAK,CAAC;KAChB;IALe,oBAAY,eAK3B,CAAA;;;;;;;;IASD,SAAgB,kBAAkB,CAC9B,SAAkB,EAClB,OAAmB,EACnB,MAAc,EACd,SAAmB;QAEnB,UAAU,CAAC,aAAa,CAAC,SAAS,EAAE,MAAM,CAAC,CAAC;QAC5C,MAAM,UAAU,GAAG,UAAU,CAAC,gBAAgB,CAAC,OAAO,EAAE,SAAS,CAAC,CAAC;QAEnE,OAAO;YACH,gBAAgB,EAAE,SAAS;YAC3B,GAAG,EAAE,UAAU,CAAC,GAAG,CAAC,KAAK,EAAE;YAC3B,UAAU;SACb,CAAC;KACL;IAde,0BAAkB,qBAcjC,CAAA;;;;;;;IAQD,SAAgB,OAAO,CAAC,GAAQ,EAAE,OAAmB,EAAE,SAAmB;QACtE,UAAU,CAAC,GAAG,CAAC,GAAG,CAAC,MAAM,EAAE,GAAG,CAAC,SAAS,CAAC,CAAC;QAC1C,MAAM,UAAU,GAAG,UAAU,CAAC,gBAAgB,CAAC,OAAO,EAAE,SAAS,CAAC,CAAC;QAEnE,OAAO;YACH,gBAAgB,EAAE,IAAI;YACtB,GAAG,EAAE,UAAU,CAAC,GAAG,CAAC,KAAK,EAAE;YAC3B,UAAU;SACb,CAAC;KACL;IATe,eAAO,UAStB,CAAA;;;;IAKD,SAAgB,eAAe,CAAC,MAAqB;QACjD,OAAO,MAAM,CAAC,UAAU,CAAC,MAAM,GAAG,CAAC,GAAG,MAAM,CAAC,UAAU,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC;KACrE;IAFe,uBAAe,kBAE9B,CAAA;AACL,CAAC,EAlHgB,OAAO,KAAP,OAAO;;ICZP,eAOhB;AAPD,WAAiB,cAAc;IACd,uBAAQ,GAAU,IAAI,KAAK,EAAE,CAAC;IAC9B,2BAAY,GAAU,IAAI,KAAK,EAAE,CAAC;IAClC,uBAAQ,GAAU,IAAI,KAAK,EAAE,CAAC;IAC9B,iCAAkB,GAAU,IAAI,KAAK,EAAE,CAAC;IACxC,+BAAgB,GAAU,IAAI,KAAK,EAAE,CAAC;IACtC,kCAAmB,GAAsB,IAAI,QAAQ,EAAE,CAAC;AACzE,CAAC,EAPgB,cAAc,KAAd,cAAc;;ACqB/B;;;;MAIa,eAAgB,SAAQ,SAAS;IAA9C;;QA8CY,aAAQ,GAAG,IAAI,OAAO,EAAE,CAAC;QACzB,sBAAiB,GAAG,IAAI,OAAO,EAAE,CAAC;KA2T7C;;;;;IAjWG,WAAW,aAAa;QACpB,IAAI,IAAI,CAAC,cAAc,EAAE;YACrB,OAAO,IAAI,CAAC,cAAc,CAAC;SAC9B;aAAM,IAAI,IAAI,CAAC,QAAQ,CAAC,MAAM,GAAG,CAAC,EAAE;YACjC,OAAO,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC;SAC3B;aAAM;YACH,OAAO,IAAI,CAAC;SACf;KACJ;IAED,WAAW,aAAa,CAAC,GAAoB;QACzC,IAAI,IAAI,CAAC,cAAc,KAAK,GAAG,EAAE;YAC7B,IAAI,CAAC,cAAc,GAAG,GAAG,CAAC;SAC7B;KACJ;;;;;IAMD,WAAW,OAAO;QACd,OAAO,IAAI,CAAC,QAAQ,CAAC;KACxB;;;;IAqBD,IAAI,UAAU,KAAiB,OAAO,IAAI,CAAC,WAAW,CAAA,EAAE;IACxD,IAAI,UAAU,CAAC,KAAiB;QAC5B,IAAI,IAAI,CAAC,WAAW,KAAK,KAAK,EAAE;YAC5B,IAAI,CAAC,WAAW,GAAG,KAAK,CAAC;YACzB,IAAI,CAAC,aAAa,EAAE,CAAC;YACrB,IAAI,CAAC,aAAa,EAAE,CAAC;SACxB;KACJ;;;;;IAMD,IAAI,OAAO,KAAsB,OAAO,IAAI,CAAC,QAAQ,CAAA,EAAE;IACvD,IAAI,OAAO,CAAC,KAAsB;QAC9B,IAAI,IAAI,CAAC,QAAQ,KAAK,KAAK,EAAE;YACzB,IAAI,CAAC,QAAQ,GAAG,KAAK,CAAC;YAEtB,IAAI,IAAI,CAAC,OAAO,IAAI,IAAI,CAAC,OAAO,YAAY,iBAAiB,EAAE;gBAC3D,IAAI,CAAC,MAAM,EAAE,CAAC;aACjB;SACJ;KACJ;;;;;;IAOD,IAAI,IAAI,KAAa,OAAO,IAAI,CAAC,KAAK,CAAA,EAAE;IACxC,IAAI,IAAI,CAAC,KAAa;QAClB,IAAI,IAAI,CAAC,KAAK,KAAK,KAAK,EAAE;YACtB,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC;YAEnB,IAAI,IAAI,CAAC,OAAO,IAAI,IAAI,CAAC,OAAO,YAAY,iBAAiB,EAAE;gBAC3D,IAAI,CAAC,OAAO,CAAC,GAAG,GAAG,IAAI,CAAC,KAAK,CAAC;gBAC9B,IAAI,CAAC,OAAO,CAAC,sBAAsB,EAAE,CAAC;aACzC;SACJ;KACJ;;;;;IAMD,IAAI,IAAI,KAAa,OAAO,IAAI,CAAC,KAAK,CAAA,EAAE;IACxC,IAAI,IAAI,CAAC,KAAa;QAClB,IAAI,IAAI,CAAC,KAAK,KAAK,KAAK,EAAE;YACtB,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC;YAEnB,IAAI,IAAI,CAAC,OAAO,IAAI,IAAI,CAAC,OAAO,YAAY,iBAAiB,EAAE;gBAC3D,IAAI,CAAC,MAAM,EAAE,CAAC;aACjB;SACJ;KACJ;;;;IAKD,IAAI,IAAI,KAAa,OAAO,IAAI,CAAC,KAAK,CAAA,EAAE;IACxC,IAAI,IAAI,CAAC,KAAa;QAClB,IAAI,IAAI,CAAC,KAAK,KAAK,KAAK,EAAE;YACtB,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC;YAEnB,IAAI,IAAI,CAAC,OAAO,EAAE;gBACd,IAAI,CAAC,OAAO,CAAC,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC;gBAC/B,IAAI,CAAC,OAAO,CAAC,sBAAsB,EAAE,CAAC;aACzC;SACJ;KACJ;;;;IAKD,IAAI,MAAM,KAAa,OAAO,IAAI,CAAC,OAAO,CAAA,EAAE;IAC5C,IAAI,MAAM,CAAC,KAAa;QACpB,IAAI,IAAI,CAAC,OAAO,KAAK,KAAK,EAAE;YACxB,IAAI,CAAC,OAAO,GAAG,KAAK,CAAC;YAErB,IAAI,IAAI,CAAC,OAAO,IAAI,IAAI,CAAC,OAAO,YAAY,iBAAiB,EAAE;gBAC3D,IAAI,CAAC,OAAO,CAAC,MAAM,GAAG,IAAI,CAAC,OAAO,CAAC;gBACnC,IAAI,CAAC,OAAO,CAAC,sBAAsB,EAAE,CAAC;aACzC;SACJ;KACJ;;;;IAKD,IAAI,GAAG,KAAa,OAAO,IAAI,CAAC,IAAI,CAAA,EAAE;IACtC,IAAI,GAAG,CAAC,KAAa;QACjB,IAAI,IAAI,CAAC,IAAI,KAAK,KAAK,EAAE;YACrB,IAAI,CAAC,IAAI,GAAG,KAAK,CAAC;YAElB,IAAI,IAAI,CAAC,OAAO,EAAE;gBACd,IAAI,CAAC,OAAO,CAAC,GAAG,GAAG,IAAI,CAAC,IAAI,CAAC;gBAC7B,IAAI,CAAC,OAAO,CAAC,sBAAsB,EAAE,CAAC;aACzC;SACJ;KACJ;;;;IAKD,IAAI,IAAI,KAAa,OAAO,IAAI,CAAC,KAAK,CAAA,EAAE;IACxC,IAAI,IAAI,CAAC,KAAa;QAClB,IAAI,IAAI,CAAC,KAAK,KAAK,KAAK,EAAE;YACtB,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC;YAEnB,IAAI,IAAI,CAAC,OAAO,EAAE;gBACd,IAAI,CAAC,OAAO,CAAC,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC;gBAC/B,IAAI,CAAC,OAAO,CAAC,sBAAsB,EAAE,CAAC;aACzC;SACJ;KACJ;;;;IAKD,IAAI,IAAI,KAAa,OAAO,IAAI,CAAC,KAAK,CAAA,EAAE;IACxC,IAAI,IAAI,CAAC,KAAa;QAClB,IAAI,IAAI,CAAC,KAAK,KAAK,KAAK,EAAE;YACtB,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC;YAEnB,IAAI,IAAI,CAAC,OAAO,IAAI,IAAI,CAAC,OAAO,YAAY,kBAAkB,EAAE;gBAC5D,MAAM,MAAM,GAAG,sBAAsB,CAAC,IAAI,CAAC,KAAK,EAAE,IAAI,CAAC,OAAO,CAAC,CAAC;gBAChE,IAAI,CAAC,OAAO,CAAC,IAAI,GAAG,MAAM,CAAC,IAAI,CAAC;gBAChC,IAAI,CAAC,OAAO,CAAC,KAAK,GAAG,MAAM,CAAC,KAAK,CAAC;gBAClC,IAAI,CAAC,OAAO,CAAC,GAAG,GAAG,MAAM,CAAC,GAAG,CAAC;gBAC9B,IAAI,CAAC,OAAO,CAAC,MAAM,GAAG,MAAM,CAAC,MAAM,CAAC;gBACpC,IAAI,CAAC,OAAO,CAAC,sBAAsB,EAAE,CAAC;aACzC;SACJ;KACJ;;;;IAKD,IAAI,MAAM,KAAiE,OAAO,IAAI,CAAC,OAAO,CAAC,EAAE;;;;IAKjG,IAAI,OAAO,KAAc,OAAO,IAAI,CAAC,QAAQ,CAAA,EAAE;IAE/C,SAAS,CAAC,OAAgC;QACtC,KAAK,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC;QAEzB,IAAI,CAAC,WAAW,GAAG,gBAAgB,CAAC,OAAO,CAAC,UAAU,EAAE,aAAa,CAAC,CAAC;QACvE,IAAI,CAAC,QAAQ,GAAG,gBAAgB,CAAC,OAAO,CAAC,OAAO,EAAE,UAAU,CAAC,CAAC;QAC9D,IAAI,CAAC,KAAK,GAAG,gBAAgB,CAAC,OAAO,CAAC,IAAI,EAAE,EAAE,CAAC,CAAC;QAChD,IAAI,CAAC,KAAK,GAAG,gBAAgB,CAAC,OAAO,CAAC,IAAI,EAAE,EAAE,CAAC,CAAC;QAChD,IAAI,CAAC,KAAK,GAAG,gBAAgB,CAAC,OAAO,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC;QAC/C,IAAI,CAAC,OAAO,GAAG,gBAAgB,CAAC,OAAO,CAAC,MAAM,EAAE,MAAM,CAAC,UAAU,GAAG,MAAM,CAAC,WAAW,CAAC,CAAC;QACxF,IAAI,CAAC,IAAI,GAAG,gBAAgB,CAAC,OAAO,CAAC,GAAG,EAAE,IAAI,CAAC,CAAC;QAChD,IAAI,CAAC,KAAK,GAAG,gBAAgB,CAAC,OAAO,CAAC,IAAI,EAAE,GAAG,CAAC,CAAC;QACjD,IAAI,CAAC,KAAK,GAAG,gBAAgB,CAAC,OAAO,CAAC,IAAI,EAAE,EAAE,CAAC,CAAC;KACnD;IAED,QAAQ,CAAC,UAAsB;QAC3B,KAAK,CAAC,QAAQ,CAAC,UAAU,CAAC,CAAC;QAE3B,IAAI,CAAC,aAAa,EAAE,CAAC;QACrB,IAAI,CAAC,cAAc,EAAE,CAAC;;QAGtB,eAAe,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAEpC,IAAI,CAAC,mBAAmB,GAAG,IAAI,CAAC,mBAAmB,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAC/D,cAAc,CAAC,kBAAkB,CAAC,WAAW,CAAC,IAAI,CAAC,mBAAmB,CAAC,CAAC;QAExE,IAAI,CAAC,iBAAiB,GAAG,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAC3D,cAAc,CAAC,gBAAgB,CAAC,WAAW,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAC;QAEpE,IAAI,CAAC,MAAM,EAAE,CAAC;KACjB;IAED,SAAS;QACL,KAAK,CAAC,SAAS,EAAE,CAAC;KACrB;IAED,WAAW;QACP,KAAK,CAAC,WAAW,EAAE,CAAC;KACvB;IAED,OAAO;QACH,KAAK,CAAC,OAAO,EAAE,CAAC;KACnB;IAED,QAAQ;QACJ,KAAK,CAAC,QAAQ,EAAE,CAAC;QAEjB,IAAI,CAAC,cAAc,EAAE,CAAC;KACzB;IAED,YAAY;QACR,KAAK,CAAC,YAAY,EAAE,CAAC;KACxB;IAED,MAAM;QACF,IAAI,IAAI,CAAC,OAAO,EAAE;YACd,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC,UAAU,GAAG,MAAM,CAAC,WAAW,CAAC;YAErD,IAAI,IAAI,CAAC,OAAO,YAAY,iBAAiB,EAAE;gBAC3C,IAAI,IAAI,CAAC,QAAQ,KAAK,YAAY,EAAE;;oBAEhC,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,IAAI,CAAE,IAAI,CAAC,GAAG,CAAE,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,EAAE,GAAG,GAAG,CAAE,GAAG,IAAI,CAAC,MAAM,CAAE,GAAG,GAAG,GAAG,IAAI,CAAC,EAAE,CAAC;iBACjG;qBAAM;oBACH,IAAI,CAAC,KAAK,GAAG,CAAC,GAAG,IAAI,CAAC,IAAI,CAAE,IAAI,CAAC,GAAG,CAAE,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,EAAE,GAAG,GAAG,GAAG,CAAC,CAAE,GAAG,IAAI,CAAC,MAAM,CAAE,GAAG,GAAG,GAAG,IAAI,CAAC,EAAE,CAAC;iBACzG;aACJ;iBAAM;;gBAEH,MAAM,MAAM,GAAG,sBAAsB,CAAC,IAAI,CAAC,KAAK,EAAE,IAAI,CAAC,OAAO,CAAC,CAAC;gBAChE,IAAI,CAAC,OAAO,CAAC,IAAI,GAAG,MAAM,CAAC,IAAI,CAAC;gBAChC,IAAI,CAAC,OAAO,CAAC,KAAK,GAAG,MAAM,CAAC,KAAK,CAAC;gBAClC,IAAI,CAAC,OAAO,CAAC,GAAG,GAAG,MAAM,CAAC,GAAG,CAAC;gBAC9B,IAAI,CAAC,OAAO,CAAC,MAAM,GAAG,MAAM,CAAC,MAAM,CAAC;gBACpC,IAAI,CAAC,OAAO,CAAC,sBAAsB,EAAE,CAAC;aACzC;SACJ;KACJ;IAEO,mBAAmB;;QAEvB,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC,UAAU,CAAC,QAAQ,CAAC,KAAK,EAAE,CAAC;QACtD,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC,UAAU,CAAC,QAAQ,CAAC,KAAK,EAAE,CAAC;QACvD,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC,KAAK,EAAE,CAAC;;;QAIjD,IAAI,CAAC,UAAU,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;QACtC,IAAI,CAAC,UAAU,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;QACtC,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;KACtC;IAEO,iBAAiB;;QAErB,IAAI,CAAC,UAAU,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;QAClD,IAAI,CAAC,UAAU,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;QACnD,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;QAE7C,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC;QAC1B,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC;QAC3B,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC;KAC3B;IAEO,aAAa;QACjB,IAAI,CAAC,IAAI,CAAC,UAAU,EAAE;;YAElB,OAAO;SACV;QAED,IAAI,IAAI,CAAC,WAAW,KAAK,aAAa,EAAE;YACpC,IAAI,CAAC,OAAO,GAAG,IAAI,iBAAiB,CAAC,IAAI,CAAC,KAAK,EAAE,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,KAAK,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC;SACzF;aAAM,IAAI,IAAI,CAAC,WAAW,KAAK,cAAc,EAAE;YAC5C,MAAM,MAAM,GAAG,sBAAsB,CAAC,IAAI,CAAC,KAAK,EAAE,IAAI,CAAC,OAAO,CAAC,CAAC;YAChE,IAAI,CAAC,OAAO,GAAG,IAAI,kBAAkB,CAAC,MAAM,CAAC,IAAI,EAAE,MAAM,CAAC,KAAK,EAAE,MAAM,CAAC,GAAG,EAAE,MAAM,CAAC,MAAM,EAAE,IAAI,CAAC,KAAK,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC;SACtH;aAAM;YACH,OAAO,CAAC,KAAK,CAAC,+DAA+D,IAAI,CAAC,WAAW,EAAE,CAAC,CAAC;SACpG;QAED,IAAI,IAAI,CAAC,OAAO,EAAE;;YAEd,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,GAAG,GAAG,SAAS,CAAC,OAAO,CAAC,CAAC;;YAG9C,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;SACrC;QAED,IAAI,CAAC,MAAM,EAAE,CAAC;KACjB;IAEO,aAAa;QACjB,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE;;YAEf,OAAO;SACV;QAED,IAAI,IAAI,CAAC,OAAO,CAAC,MAAM,EAAE;YACrB,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;SAC5C;QACD,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC;KACvB;IAEO,cAAc;QAClB,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE;;YAEf,OAAO;SACV;QAED,IAAI,CAAC,iBAAiB,CAAC,gBAAgB,CAAC,IAAI,CAAC,OAAO,CAAC,gBAAgB,EAAE,IAAI,CAAC,OAAO,CAAC,kBAAkB,CAAC,CAAC;QACxG,IAAI,CAAC,QAAQ,CAAC,uBAAuB,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAC;KACjE;IAED,SAAS;QACL,KAAK,CAAC,SAAS,EAAE,CAAC;QAElB,IAAI,CAAC,aAAa,EAAE,CAAC;;QAGrB,MAAM,KAAK,GAAG,eAAe,CAAC,QAAQ,CAAC,SAAS,CAAC,eAAe,IAAI,eAAe,KAAK,IAAI,CAAC,CAAC;QAC9F,IAAI,KAAK,IAAI,CAAC,EAAE;YACZ,eAAe,CAAC,QAAQ,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC;SAC7C;;QAGD,IAAI,eAAe,CAAC,cAAc,KAAK,IAAI,EAAE;YACzC,eAAe,CAAC,cAAc,GAAG,IAAI,CAAC;SACzC;KACJ;;AAvWc,8BAAc,GAAoB,IAAI,CAAC;AACvC,wBAAQ,GAAsB,EAAE;;AC6CnD;;;MAGa,kBAAkB;IA0G3B,YAAY,IAAY,EAAE,QAAgB,EAAE,eAAiC;;;;;QAhC7E,oBAAe,GAAoB,SAAS,CAAC;;;;;;;QAQ7C,aAAQ,GAAW,CAAC,CAAC;QAGb,aAAQ,GAAY,IAAI,CAAC;QACzB,eAAU,GAA+B,IAAI,GAAG,EAAE,CAAC;QACnD,iBAAY,GAA0B,IAAI,CAAC;QAC3C,kBAAa,GAA0B,IAAI,CAAC;QAmBhD,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC;QAClB,IAAI,CAAC,QAAQ,GAAG,QAAQ,CAAC;QACzB,IAAI,CAAC,eAAe,GAAG,eAAe,CAAC;QAEvC,kBAAkB,CAAC,cAAc,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;KAChD;;;;IAtGD,WAAW,aAAa;QACpB,OAAO,IAAI,CAAC,cAAc,CAAC;KAC9B;;;;;IAMD,OAAO,mBAAmB,CAAC,KAAY;QACnC,IAAI,CAAC,IAAI,CAAC,cAAc,IAAI,IAAI,CAAC,cAAc,CAAC,MAAM,KAAK,CAAC,EAAE;YAC1D,OAAO;SACV;QAED,IAAI,IAAI,CAAC,cAAc,CAAC,MAAM,KAAK,CAAC,EAAE;;YAElC,IAAI,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC;SACzC;aAAM;;;;YAIH,IAAI,IAAI,CAAC,cAAc,EAAE;gBACrB,MAAM,SAAS,GAAG,IAAI,CAAC,cAAc,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC;gBACrD,IAAI,CAAC,SAAS,EAAE;;oBAEZ,IAAI,IAAI,CAAC,KAAK,EAAE;wBACZ,OAAO,CAAC,GAAG,CAAC,wBAAwB,IAAI,CAAC,cAAc,CAAC,IAAI,kBAAkB,CAAC,CAAC;qBACnF;oBAED,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC;iBAC9B;qBAAM;;oBAEH,OAAO;iBACV;aACJ;;YAGD,MAAM,OAAO,GAAG,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;YAChD,MAAM,CAAC,OAAO,EAAE,UAAU,CAAC,CAAC;;;YAI5B,KAAK,MAAM,MAAM,IAAI,OAAO,EAAE;gBAC1B,IAAI,CAAC,IAAI,CAAC,cAAc,EAAE;oBACtB,MAAM,SAAS,GAAG,MAAM,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC;oBACxC,IAAI,SAAS,EAAE;;wBAEX,IAAI,CAAC,cAAc,GAAG,MAAM,CAAC;wBAE7B,IAAI,IAAI,CAAC,KAAK,EAAE;4BACZ,OAAO,CAAC,GAAG,CAAC,wBAAwB,IAAI,CAAC,cAAc,CAAC,IAAI,oBAAoB,CAAC,CAAC;yBACrF;qBACJ;iBACJ;qBAAM;;oBAEH,MAAM,CAAC,qBAAqB,EAAE,CAAC;iBAClC;aACJ;SACJ;KACJ;IAsBD,IAAI,IAAI,KAAa,OAAO,IAAI,CAAC,KAAK,CAAA,EAAE;IACxC,IAAI,WAAW,KAA4B,OAAO,IAAI,CAAC,YAAY,CAAA,EAAE;IACrE,IAAI,YAAY,KAA4B,OAAO,IAAI,CAAC,aAAa,CAAA,EAAE;IAEvE,IAAI,OAAO,KAAc,OAAO,IAAI,CAAC,QAAQ,CAAA,EAAE;IAC/C,IAAI,OAAO,CAAC,KAAc;QACtB,IAAI,IAAI,CAAC,QAAQ,KAAK,KAAK,EAAE;YACzB,OAAO;SACV;QAED,IAAI,CAAC,QAAQ,GAAG,KAAK,CAAC;QACtB,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE;YAChB,IAAI,CAAC,qBAAqB,EAAE,CAAC;SAChC;KACJ;IAUD,WAAW,CAAC,QAA+B;QACvC,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,QAAQ,CAAC,EAAE;YAChC,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;SACjC;KACJ;IAED,cAAc,CAAC,QAA+B;QAC1C,IAAI,IAAI,CAAC,YAAY,KAAK,QAAQ,EAAE;YAAE,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC;SAAE;QACjE,IAAI,IAAI,CAAC,aAAa,KAAK,QAAQ,EAAE;YAAE,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC;SAAE;QACnE,IAAI,CAAC,UAAU,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC;KACpC;;;;IAKO,OAAO,CAAC,KAAY;QACxB,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE;;YAEhB,OAAO;SACV;QAED,IAAI,eAAe,GAAG,IAAI,CAAC,eAAe,KAAK,SAAS,GAAG,eAAe,CAAC,aAAa,GAAG,IAAI,CAAC,eAAe,CAAC;QAEhH,IAAI,CAAC,KAAK,IAAI,CAAC,eAAe,IAAI,CAAC,eAAe,CAAC,MAAM,EAAE;;YAEvD,OAAO;SACV;QAED,IAAI,KAAK,CAAC,gBAAgB,KAAK,SAAS,CAAC,KAAK;YAC1C,KAAK,CAAC,gBAAgB,KAAK,SAAS,CAAC,KAAK,EAC5C;;YAEE,OAAO;SACV;;QAGD,IAAI,gBAAgB,GAAY,CAAC,KAAK,CAAC,gBAAgB,KAAK,SAAS,CAAC,KAAK,IAAI,KAAK,CAAC,iBAAiB,EAAE,GAAG,KAAK,CAAC,iBAAiB,CAAC,CAAC,CAAC,CAAC;;;QAItI,IAAI,mBAAiC,CAAC;QACtC,IAAI,eAAsC,CAAC;QAE3C,IAAI,gBAAgB,EAAE;;YAElB,MAAM,wBAAwB,GAAe,EAAE,CAAC;YAChD,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC,QAAQ;gBAC7B,MAAM,cAAc,GAAG,QAAQ,CAAC,cAAc,CAAC;gBAC/C,IAAI,cAAc,EAAE;oBAChB,MAAM,aAAa,GAAG,cAAc,CAAC,MAAM,CAAC,CAAC,MAAM;wBAC/C,OAAO,eAAe,CAAC,MAAM,CAAC,CAAC;qBAClC,CAAC,CAAC;oBAEH,wBAAwB,CAAC,IAAI,CAAC,GAAG,aAAa,CAAC,CAAC;iBACnD;aACJ,CAAC,CAAC;;YAGH,MAAM,IAAI,GAAG,OAAO,CAAC,kBAAkB,CAAC,gBAAgB,EAAE,wBAAwB,EAAE,eAAe,CAAC,MAAM,EAAE,KAAK,CAAC,CAAC;YACnH,mBAAmB,GAAG,OAAO,CAAC,eAAe,CAAC,IAAI,CAAC,CAAC;YACpD,eAAe,GAAG,mBAAmB,GAAG,IAAI,CAAC,2BAA2B,CAAC,mBAAmB,CAAC,MAAM,CAAC,GAAG,IAAI,CAAC;SAC/G;aAAM;;YAEH,mBAAmB,GAAG,IAAI,CAAC;YAC3B,eAAe,GAAG,IAAI,CAAC;SAC1B;;;;QAKD,IAAI,eAAe,EAAE;YACjB,IAAI,IAAI,CAAC,aAAa,KAAK,IAAI,IAAI,IAAI,CAAC,aAAa,KAAK,eAAe,EAAE;;gBAEvE,MAAM,WAAW,GAAG,IAAI,CAAC,aAAa,CAAC;gBACvC,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC;gBAE1B,IAAI,kBAAkB,CAAC,KAAK,EAAE;oBAC1B,OAAO,CAAC,GAAG,CAAC,8BAA8B,IAAI,CAAC,IAAI,uBAAuB,EAAE,WAAW,CAAC,CAAC;iBAC5F;gBAED,WAAW,CAAC,aAAa,CAAC;oBACtB,SAAS,EAAE,cAAc;oBACzB,MAAM,EAAE,mBAAmB,CAAC,MAAM;oBAClC,WAAW,EAAE,IAAI,CAAC,YAAY;iBACjC,CAAC,CAAC;aACN;YAED,IAAI,IAAI,CAAC,aAAa,KAAK,IAAI,EAAE;;gBAE7B,IAAI,CAAC,aAAa,GAAG,eAAe,CAAC;gBAErC,IAAI,kBAAkB,CAAC,KAAK,EAAE;oBAC1B,OAAO,CAAC,GAAG,CAAC,8BAA8B,IAAI,CAAC,IAAI,wBAAwB,EAAE,IAAI,CAAC,aAAa,CAAC,CAAC;iBACpG;gBAED,IAAI,CAAC,aAAa,CAAC,cAAc,CAAC;oBAC9B,SAAS,EAAE,eAAe;oBAC1B,MAAM,EAAE,mBAAmB,CAAC,MAAM;oBAClC,WAAW,EAAE,IAAI,CAAC,YAAY;iBACjC,CAAC,CAAC;aACN;SAEJ;aAAM;;YAEH,IAAI,IAAI,CAAC,aAAa,KAAK,IAAI,EAAE;;gBAE7B,IAAI,kBAAkB,CAAC,KAAK,EAAE;oBAC1B,OAAO,CAAC,GAAG,CAAC,8BAA8B,IAAI,CAAC,IAAI,uBAAuB,EAAE,IAAI,CAAC,aAAa,CAAC,CAAC;iBACnG;gBAED,IAAI,CAAC,aAAa,CAAC,aAAa,CAAC;oBAC7B,SAAS,EAAE,cAAc;oBACzB,MAAM,EAAE,IAAI;oBACZ,WAAW,EAAE,IAAI,CAAC,YAAY;iBACjC,CAAC,CAAC;gBACH,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC;aAC7B;SACJ;;;;QAKD,MAAM,aAAa,GAAY,CAAC,KAAK,CAAC,gBAAgB,KAAK,SAAS,CAAC,KAAK,IAAI,KAAK,CAAC,kBAAkB,CAAC,CAAC,CAAC,GAAG,KAAK,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC;QAClI,IAAI,aAAa,EAAE;YACf,IAAI,IAAI,CAAC,aAAa,KAAK,IAAI,IAAI,IAAI,CAAC,aAAa,KAAK,eAAe,IAAI,IAAI,CAAC,YAAY,KAAK,IAAI,EAAE;;gBAErG,IAAI,CAAC,YAAY,GAAG,eAAe,CAAC;gBAEpC,IAAI,kBAAkB,CAAC,KAAK,EAAE;oBAC1B,OAAO,CAAC,GAAG,CAAC,8BAA8B,IAAI,CAAC,IAAI,uBAAuB,EAAE,IAAI,CAAC,YAAY,CAAC,CAAC;iBAClG;gBAED,IAAI,CAAC,YAAY,CAAC,aAAa,CAAC;oBAC5B,SAAS,EAAE,cAAc;oBACzB,MAAM,EAAE,mBAAmB,CAAC,MAAM;oBAClC,WAAW,EAAE,IAAI,CAAC,YAAY;iBACjC,CAAC,CAAC;aACN;SACJ;QAED,MAAM,WAAW,GAAY,CAAC,KAAK,CAAC,gBAAgB,KAAK,SAAS,CAAC,KAAK,IAAI,KAAK,CAAC,gBAAgB,CAAC,CAAC,CAAC,GAAG,KAAK,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC;QAC5H,IAAI,WAAW,EAAE;YACb,IAAI,IAAI,CAAC,YAAY,KAAK,IAAI,EAAE;;gBAE5B,MAAM,SAAS,GAAG,IAAI,CAAC,YAAY,CAAC;gBACpC,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC;gBAEzB,IAAI,kBAAkB,CAAC,KAAK,EAAE;oBAC1B,OAAO,CAAC,GAAG,CAAC,8BAA8B,IAAI,CAAC,IAAI,qBAAqB,EAAE,SAAS,CAAC,CAAC;iBACxF;gBAED,SAAS,CAAC,WAAW,CAAC;oBAClB,SAAS,EAAE,YAAY;oBACvB,MAAM,EAAE,mBAAmB,GAAG,mBAAmB,CAAC,MAAM,GAAG,IAAI;oBAC/D,WAAW,EAAE,IAAI,CAAC,YAAY;iBACjC,CAAC,CAAC;;;gBAIH,MAAM,OAAO,IAAa,eAAe,KAAK,IAAI,IAAI,SAAS,KAAK,eAAe,CAAC,CAAC;gBACrF,IAAI,OAAO,EAAE;oBACT,MAAM,YAAY,GAAG,SAAS,CAAC;oBAE/B,IAAI,kBAAkB,CAAC,KAAK,EAAE;wBAC1B,OAAO,CAAC,GAAG,CAAC,8BAA8B,IAAI,CAAC,IAAI,wBAAwB,EAAE,YAAY,CAAC,CAAC;qBAC9F;oBAED,YAAY,CAAC,cAAc,CAAC;wBACxB,SAAS,EAAE,eAAe;wBAC1B,MAAM,EAAE,mBAAmB,CAAC,MAAM;wBAClC,WAAW,EAAE,IAAI,CAAC,YAAY;qBACjC,CAAC,CAAC;iBACN;aACJ;SACJ;QAED,OAAO,CAAC,CAAC,IAAI,CAAC,YAAY,CAAC;KAC9B;;;;IAKD,qBAAqB;QACjB,IAAI,IAAI,CAAC,YAAY,EAAE;YACnB,MAAM,SAAS,GAAG,IAAI,CAAC,YAAY,CAAC;YACpC,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC;YAEzB,IAAI,kBAAkB,CAAC,KAAK,EAAE;gBAC1B,OAAO,CAAC,GAAG,CAAC,8BAA8B,IAAI,CAAC,IAAI,qBAAqB,EAAE,SAAS,CAAC,CAAC;aACxF;YAED,SAAS,CAAC,WAAW,CAAC;gBAClB,SAAS,EAAE,YAAY;gBACvB,MAAM,EAAE,IAAI;gBACZ,WAAW,EAAE,IAAI,CAAC,YAAY;aACjC,CAAC,CAAC;SACN;QAED,IAAI,IAAI,CAAC,aAAa,EAAE;YACpB,MAAM,WAAW,GAAG,IAAI,CAAC,aAAa,CAAC;YACvC,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC;YAE1B,IAAI,kBAAkB,CAAC,KAAK,EAAE;gBAC1B,OAAO,CAAC,GAAG,CAAC,8BAA8B,IAAI,CAAC,IAAI,uBAAuB,EAAE,WAAW,CAAC,CAAC;aAC5F;YAED,WAAW,CAAC,aAAa,CAAC;gBACtB,SAAS,EAAE,cAAc;gBACzB,MAAM,EAAE,IAAI;gBACZ,WAAW,EAAE,IAAI,CAAC,YAAY;aACjC,CAAC,CAAC;SACN;KACJ;IAED,OAAO;QACH,IAAI,CAAC,qBAAqB,EAAE,CAAC;QAE7B,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC;QACvB,IAAI,CAAC,eAAe,GAAG,IAAI,CAAC;QAE5B,MAAM,KAAK,GAAG,kBAAkB,CAAC,cAAc,CAAC,SAAS,CAAC,GAAG,IAAI,GAAG,KAAK,IAAI,CAAC,CAAC;QAC/E,IAAI,KAAK,IAAI,CAAC,EAAE;YACZ,kBAAkB,CAAC,cAAc,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC;SACtD;QAED,IAAI,kBAAkB,CAAC,cAAc,KAAK,IAAI,EAAE;YAC5C,kBAAkB,CAAC,cAAc,GAAG,IAAI,CAAC;SAC5C;KACJ;IAEO,2BAA2B,CAAC,KAAe;QAC/C,IAAI,KAAK,EAAE;YACP,MAAM,cAAc,GAAG,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;YACnD,KAAK,MAAM,QAAQ,IAAI,cAAc,EAAE;gBACnC,MAAM,cAAc,GAAG,QAAQ,CAAC,cAAc,CAAC;gBAC/C,IAAI,cAAc,IAAI,cAAc,CAAC,MAAM,GAAG,CAAC,EAAE;oBAC7C,MAAM,UAAU,GAAG,cAAc,CAAC,IAAI,CAAC,CAAC,MAAM;wBAC1C,OAAO,MAAM,KAAK,KAAK,CAAC;qBAC3B,CAAC,CAAC;oBACH,IAAI,UAAU,EAAE;wBACZ,OAAO,QAAQ,CAAC;qBACnB;iBACJ;aACJ;SACJ;QAED,OAAO,IAAI,CAAC;KACf;;AAvWM,wBAAK,GAAY,KAAK,CAAC;AAEf,iCAAc,GAAyB,EAAE;;IClF3C,kBAehB;AAfD,WAAiB,iBAAiB;;;;IAIjB,yBAAO,GAAW,OAAiB,CAAC;IAEjD,MAAM,KAAK,GAAW,eAAoB,CAAC;;;;IAK3C,SAAgB,IAAI;QAChB,MAAM,OAAO,GAAG,QAAQ,CAAC,KAAK,CAAC,CAAC;QAChC,OAAO,IAAI,IAAI,CAAC,OAAO,CAAC,CAAC;KAC5B;IAHe,sBAAI,OAGnB,CAAA;AACL,CAAC,EAfgB,iBAAiB,KAAjB,iBAAiB;;MCGrB,oBAAoB;IAS7B,YAAY,KAAa,EAAE,eAAiC;QAN5D,YAAO,GAAY,IAAI,CAAC;QAExB,eAAU,GAAY,KAAK,CAAC;QAC5B,eAAU,GAAY,KAAK,CAAC;QAC5B,iBAAY,GAAY,KAAK,CAAC;QAG1B,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC;QACnB,IAAI,CAAC,eAAe,GAAG,eAAe,CAAC;KAC1C;IAED,MAAM,CAAC,aAA4B;QAC/B,IAAI,CAAC,IAAI,CAAC,KAAK,EAAE;;YAEb,OAAO;SACV;QACD,IAAI,CAAC,IAAI,CAAC,eAAe,IAAI,CAAC,IAAI,CAAC,eAAe,CAAC,MAAM,EAAE;;YAEvD,OAAO;SACV;QACD,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE;;YAEf,OAAO;SACV;QAED,IAAI,IAAI,CAAC,UAAU,EAAE;YACjB,aAAa,CAAC,UAAU,EAAE,CAAC;SAC9B;QAED,IAAI,IAAI,CAAC,UAAU,EAAE;YACjB,aAAa,CAAC,UAAU,EAAE,CAAC;SAC9B;QAED,IAAI,IAAI,CAAC,YAAY,EAAE;YACnB,aAAa,CAAC,YAAY,EAAE,CAAC;SAChC;QAED,aAAa,CAAC,MAAM,CAAC,IAAI,CAAC,KAAK,EAAE,IAAI,CAAC,eAAe,CAAC,MAAM,CAAC,CAAC;KACjE;;;MCrCQ,YAAY;IAuCrB;QArCQ,YAAO,GAAY,EAAE,CAAC;QACtB,kBAAa,GAAU,IAAI,CAAC;QAC5B,gBAAW,GAAsB,EAAE,CAAC;KAoC3C;;;;;IA7BD,IAAI,MAAM;QACN,OAAO,IAAI,CAAC,OAAO,CAAC;KACvB;IAED,IAAI,eAAe;QACf,OAAO,IAAI,CAAC,WAAW,CAAC;KAC3B;;;;;IAMD,IAAI,YAAY;QACZ,IAAI,IAAI,CAAC,aAAa,EAAE;YACpB,OAAO,IAAI,CAAC,aAAa,CAAC;SAC7B;aAAM,IAAI,IAAI,CAAC,OAAO,CAAC,MAAM,GAAG,CAAC,EAAE;YAChC,OAAO,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;SAC1B;aAAM;YACH,OAAO,IAAI,CAAC;SACf;KACJ;IAED,IAAI,YAAY,CAAC,KAAY;QACzB,IAAI,IAAI,CAAC,aAAa,KAAK,KAAK,EAAE;YAC9B,IAAI,CAAC,aAAa,GAAG,KAAK,CAAC;SAC9B;KACJ;IAKD,QAAQ,CAAC,KAAY;QACjB,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,KAAK,KAAK,CAAC,EAAE;YACtC,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;SAC5B;KACJ;IAED,WAAW,CAAC,KAAY;QACpB,MAAM,KAAK,GAAG,IAAI,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC,IAAI,CAAC,KAAK,KAAK,CAAC,CAAC;QACvD,IAAI,KAAK,IAAI,CAAC,EAAE;YACZ,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC;SACjC;QAED,IAAI,CAAC,gCAAgC,CAAC,KAAK,CAAC,CAAC;KAChD;IAED,kBAAkB,CAAC,KAAY,EAAE,eAAgC;QAC7D,MAAM,QAAQ,GAAG,IAAIA,oBAAe,CAAC,KAAK,EAAE,eAAe,CAAC,CAAC;QAC7D,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;QAChC,OAAO,QAAQ,CAAC;KACnB;IAED,sBAAsB,CAAC,QAAyB,EAAE,WAAmB;QACjE,MAAM,QAAQ,GAAG,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;QACpD,IAAI,QAAQ,IAAI,CAAC,EAAE;YACf,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,QAAQ,EAAE,CAAC,CAAC,CAAC;YACrC,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,WAAW,EAAE,CAAC,EAAE,QAAQ,CAAC,CAAC;SACrD;KACJ;IAED,qBAAqB,CAAC,KAAY,EAAE,eAAgC;QAChE,MAAM,KAAK,GAAG,IAAI,CAAC,WAAW,CAAC,SAAS,CAAC,EAAE,IAAI,EAAE,CAAC,KAAK,KAAK,KAAK,IAAI,EAAE,CAAC,eAAe,KAAK,eAAe,CAAC,CAAC;QAC7G,IAAI,KAAK,IAAI,CAAC,EAAE;YACZ,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC;SACrC;KACJ;IAED,gCAAgC,CAAC,KAAY;QACzC,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC,EAAE;YAC1C,IAAI,EAAE,CAAC,KAAK,KAAK,KAAK,EAAE;gBACpB,OAAO,IAAI,CAAC;aACf;SACJ,CAAC,CAAC;KACN;IAED,iCAAiC,CAAC,eAAgC;QAC9D,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC,EAAE;YAC1C,IAAI,EAAE,CAAC,eAAe,KAAK,eAAe,EAAE;gBACxC,OAAO,IAAI,CAAC;aACf;SACJ,CAAC,CAAC;KACN;IAED,yBAAyB;QACrB,IAAI,CAAC,WAAW,GAAG,EAAE,CAAC;KACzB;IAED,MAAM;QACF,IAAI,CAAC,mBAAmB,GAAG,EAAE,CAAC;QAE9B,KAAK,IAAI,KAAK,IAAI,IAAI,CAAC,OAAO,EAAE;YAC5B,IAAI,KAAK,EAAE;gBACP,YAAY,CAAC,KAAK,EAAE,CAAC,EAAE;oBACnB,IAAI,EAAE,YAAY,UAAU,EAAE;wBAC1B,EAAE,CAAC,QAAQ,EAAE,CAAC;wBACd,IAAI,CAAC,mBAAmB,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;qBACrC;iBACJ,CAAC,CAAC;aACN;SACJ;KACJ;IAED,UAAU;QACN,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,mBAAmB,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;YACtD,IAAI,IAAI,CAAC,mBAAmB,CAAC,CAAC,CAAC,EAAE;gBAC7B,IAAI,CAAC,mBAAmB,CAAC,CAAC,CAAC,CAAC,YAAY,EAAE,CAAC;aAC9C;SACJ;KACJ;IAED,MAAM,CAAC,aAA4B;QAC/B,aAAa,CAAC,KAAK,EAAE,CAAC;QACtB,aAAa,CAAC,IAAI,CAAC,SAAS,GAAG,KAAK,CAAC;QACrC,aAAa,CAAC,IAAI,CAAC,KAAK,EAAE,CAAC;QAE3B,KAAK,IAAI,QAAQ,IAAI,IAAI,CAAC,WAAW,EAAE;YACnC,IAAI,QAAQ,EAAE;gBACV,QAAQ,CAAC,MAAM,CAAC,aAAa,CAAC,CAAC;aAClC;SACJ;KACJ;IAED,OAAO;QACH,KAAK,IAAI,KAAK,IAAI,IAAI,CAAC,OAAO,EAAE;YAC5B,IAAI,KAAK,EAAE;gBACP,KAAK,CAAC,OAAO,EAAE,CAAC;aACnB;SACJ;QAED,IAAI,CAAC,OAAO,GAAG,EAAE,CAAC;QAClB,IAAI,CAAC,WAAW,GAAG,EAAE,CAAC;QACtB,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC;QAC1B,IAAI,CAAC,mBAAmB,GAAG,EAAE,CAAC;KACjC;;;ACzIL;AACA;MACa,SAAS;IASlB,YAAY,QAAuB,EAAE,kBAAyB,EAAE,gBAAuB,EAAE,QAAmB;QAFpG,yBAAoB,GAAQ,IAAI,CAAC;QAGrC,IAAI,CAAC,SAAS,GAAG,QAAQ,CAAC;QAC1B,IAAI,CAAC,sBAAsB,GAAG,kBAAkB,CAAC;QACjD,IAAI,CAAC,oBAAoB,GAAG,gBAAgB,CAAC;QAC7C,IAAI,CAAC,SAAS,GAAG,QAAQ,CAAC;QAE1B,IAAI,CAAC,mBAAmB,GAAG,IAAI,CAAC,mBAAmB,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAC/D,IAAI,CAAC,sBAAsB,CAAC,WAAW,CAAC,IAAI,CAAC,mBAAmB,CAAC,CAAC;QAElE,IAAI,CAAC,iBAAiB,GAAG,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAC3D,IAAI,CAAC,oBAAoB,CAAC,WAAW,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAC;KACjE;IAED,WAAW;QACP,MAAM,KAAK,GAAG,IAAI,CAAC,SAAS,EAAE,CAAC;QAE/B,IAAI,KAAK,EAAE;YACP,MAAM,cAAc,GAAG,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,iBAAiB,EAAE,CAAC;YAE7D,IAAI,IAAI,CAAC,oBAAoB,EAAE;gBAC3B,MAAM,cAAc,GAAG,KAAK,CAAC,iBAAiB,CAAC,IAAI,CAAC,oBAAoB,CAAC,CAAC;gBAE1E,IAAI,cAAc,CAAC,MAAM,EAAE;oBACvB,MAAM,OAAO,GAAG,cAAc,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,cAAc,CAAC,CAAC;oBAC1D,MAAM,SAAS,GAAG,IAAI,OAAO,EAAE,CAAC;oBAChC,SAAS,CAAC,SAAS,CAAC,OAAO,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC;oBAE9C,MAAM,QAAQ,GAAG,IAAI,OAAO,EAAE,CAAC;oBAC/B,MAAM,QAAQ,GAAG,IAAI,UAAU,EAAE,CAAC;oBAClC,MAAM,KAAK,GAAG,IAAI,OAAO,EAAE,CAAC;oBAE5B,SAAS,CAAC,SAAS,CAAC,QAAQ,EAAE,QAAQ,EAAE,KAAK,CAAC,CAAC;oBAE/C,OAAO;wBACH,QAAQ;wBACR,QAAQ;qBACX,CAAA;iBACJ;aACJ;SACJ;QAED,OAAO,IAAI,CAAC;KACf;IAEa,mBAAmB;;;YAE7B,MAAM,OAAO,GAAG,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,UAAU,EAAE,CAAC;YAC/C,MAAM,cAAc,GAAG,MAAM,OAAO,CAAC,qBAAqB,CAAC,QAAQ,CAAC,CAAC;YACrE,IAAI,CAAC,oBAAoB,GAAG,MAAM,OAAO,CAAC,oBAAoB,CAAC;gBAC3D,KAAK,EAAE,cAAc;aACxB,CAAC,CAAC;SACN;KAAA;IAEO,iBAAiB;QACrB,IAAI,CAAC,oBAAoB,GAAG,IAAI,CAAC;KACpC;IAED,OAAO;QACH,IAAI,CAAC,sBAAsB,CAAC,cAAc,CAAC,IAAI,CAAC,mBAAmB,CAAC,CAAC;QACrE,IAAI,CAAC,oBAAoB,CAAC,cAAc,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAC;KACpE;;;ICnEY,SAyNhB;AAzND,WAAiB,QAAQ;IAER,qBAAY,GAAG,IAAI,YAAY,EAAE,CAAC;IAY/C,IAAI,YAAY,GAAY,KAAK,CAAC;IAClC,IAAI,QAAa,CAAC;IAClB,IAAI,UAAU,GAAY,KAAK,CAAC;IAChC,IAAI,cAAc,GAAW,CAAC,CAAC;IAC/B,IAAI,gBAAgB,GAAW,CAAC,CAAC;IAEjC,SAAgB,WAAW;QACvB,OAAO,UAAU,CAAC;KACrB;IAFe,oBAAW,cAE1B,CAAA;IAED,SAAgB,UAAU;QACtB,OAAO,QAAQ,CAAC;KACnB;IAFe,mBAAU,aAEzB,CAAA;IAED,SAAgB,IAAI,CAAC,WAAqC;QACtD,IAAI,YAAY,EAAE;YACd,OAAO;SACV;QAED,OAAO,CAAC,IAAI,CAAC,gBAAgB,iBAAiB,CAAC,OAAO,cAAc,iBAAiB,CAAC,IAAI,EAAE,CAAC,QAAQ,EAAE,EAAE,CAAC,CAAC;QAE3G,YAAY,GAAG,IAAI,CAAC;;QAGpB,SAAA,aAAa,GAAG,IAAI,aAAa,CAAC,WAAW,CAAC,CAAC;QAC/C,SAAA,aAAa,CAAC,SAAS,GAAG,KAAK,CAAC;QAEhC,MAAM,KAAK,GAAG,MAAM,CAAC,UAAU,CAAC;QAChC,MAAM,MAAM,GAAG,MAAM,CAAC,WAAW,CAAC;QAElC,SAAA,aAAa,CAAC,OAAO,CAAC,KAAK,EAAE,MAAM,CAAC,CAAC;QACrC,SAAA,aAAa,CAAC,UAAU,CAAC,KAAK,CAAC,OAAO,GAAG,OAAO,CAAC;;QAGjD,SAAA,IAAI,GAAG,IAAI,IAAI,EAAE,CAAC;;QAGlB,SAAA,gBAAgB,GAAG,IAAI,gBAAgB,EAAE,CAAC;;QAG1C,SAAA,2BAA2B,GAAG,IAAI,2BAA2B,CAAC,SAAA,aAAa,EAAE;YACzE,YAAY,EAAE,KAAK;SACtB,CAAC,CAAC;;QAGH,SAAA,KAAK,GAAG,IAAI,KAAK,CAAC;YACd,YAAY,EAAE,SAAA,aAAa,CAAC,UAAU;YACtC,aAAa,EAAE,SAAA,aAAa,CAAC,UAAU;YACvC,IAAI,EAAE,SAAA,IAAI;YACV,iBAAiB,EAAE,MAAM,EAAE;SAC9B,CAAC,CAAC;;QAGH,SAAA,OAAO,GAAG,IAAI,OAAO,CAAC,SAAA,aAAa,CAAC,CAAC;;QAGrC,SAAA,SAAS,GAAG,IAAI,SAAS,CAAC,SAAA,aAAa,EAAE,cAAc,CAAC,kBAAkB,EAAE,cAAc,CAAC,gBAAgB,EAAE,UAAU,CAAC,CAAC;;QAGzH,SAAA,kBAAkB,GAAG,IAAI,kBAAkB,CAAC,SAAS,EAAE,CAAC,CAAC,CAAC;;QAG1D,SAAA,YAAY,GAAG,IAAI,YAAY,CAAC;YAC5B,KAAK,EAAE;gBACH,UAAU,EAAE,aAAa;aAC5B;YACD,KAAK,EAAE,KAAK;SACf,CAAC,CAAA;;QAGF,SAAA,aAAa,CAAC,gBAAgB,CAAC,MAAM,CAAC,CAAC;QAEvC,MAAM,EAAE,CAAC;;QAGT,MAAM,CAAC,gBAAgB,CAAC,QAAQ,EAAE,MAAM,CAAC,CAAC;;QAG1C,QAAQ,CAAC,gBAAgB,CAAC,kBAAkB,EAAE,gBAAgB,CAAC,CAAC;KACnE;IAjEe,aAAI,OAiEnB,CAAA;IAED,SAAS,MAAM,CAAC,SAAc,EAAE,KAAU;QACtC,SAAA,2BAA2B,CAAC,MAAM,EAAE,CAAC;QAErC,QAAQ,GAAG,KAAK,CAAC;;QAGjB,MAAM,SAAS,GAAG,SAAA,aAAa,CAAC,EAAE,CAAC,YAAY,IAAI,CAAC,CAAC,QAAQ,CAAC;QAC9D,IAAI,UAAU,KAAK,SAAS,EAAE;YAC1B,UAAU,GAAG,SAAS,CAAC;YAEvB,IAAI,UAAU,EAAE;gBACZ,SAAA,aAAa,CAAC,EAAE,CAAC,OAAO,GAAG,IAAI,CAAC;gBAChC,cAAc,CAAC,kBAAkB,CAAC,MAAM,EAAE,CAAC;aAC9C;iBAAM;gBACH,SAAA,aAAa,CAAC,EAAE,CAAC,OAAO,GAAG,KAAK,CAAC;gBACjC,cAAc,CAAC,gBAAgB,CAAC,MAAM,EAAE,CAAC;aAC5C;SACJ;QAED,SAAA,KAAK,CAAC,MAAM,EAAE,CAAC;;QAGf,kBAAkB,CAAC,mBAAmB,CAAC,SAAA,KAAK,CAAC,CAAC;;QAG9C,SAAA,YAAY,CAAC,MAAM,EAAE,CAAC;QACtB,cAAc,CAAC,QAAQ,CAAC,MAAM,EAAE,CAAC;QACjC,SAAA,YAAY,CAAC,UAAU,EAAE,CAAC;QAC1B,cAAc,CAAC,YAAY,CAAC,MAAM,EAAE,CAAC;QAErC,UAAU,CAAC,wCAAwC,EAAE,CAAC;QAEtD,SAAA,YAAY,CAAC,MAAM,CAAC,SAAA,aAAa,CAAC,CAAC;QAEnC,SAAA,IAAI,CAAC,MAAM,EAAE,CAAC;QACd,SAAA,gBAAgB,CAAC,MAAM,EAAE,CAAC;KAC7B;IAED,SAAgB,gBAAgB;QAC5B,OAAO,cAAc,CAAC;KACzB;IAFe,yBAAgB,mBAE/B,CAAA;IAED,SAAgB,gBAAgB,CAAC,UAAkB;QAC/C,cAAc,GAAG,UAAU,CAAC;QAC5B,MAAM,EAAE,CAAC;KACZ;IAHe,yBAAgB,mBAG/B,CAAA;IAED,SAAgB,OAAO;QACnB,MAAM,CAAC,mBAAmB,CAAC,QAAQ,EAAE,MAAM,CAAC,CAAC;QAE7C,SAAA,YAAY,CAAC,OAAO,EAAE,CAAC;QAEvB,SAAA,aAAa,CAAC,OAAO,EAAE,CAAC;QACxB,SAAA,aAAa,GAAG,IAAI,CAAC;QAErB,SAAA,IAAI,CAAC,OAAO,EAAE,CAAC;QACf,SAAA,IAAI,GAAG,IAAI,CAAC;QAEZ,SAAA,KAAK,CAAC,OAAO,EAAE,CAAC;QAChB,SAAA,KAAK,GAAG,IAAI,CAAC;QAEb,SAAA,OAAO,CAAC,OAAO,EAAE,CAAC;QAClB,SAAA,OAAO,GAAG,IAAI,CAAC;QAEf,SAAA,SAAS,CAAC,OAAO,EAAE,CAAC;QACpB,SAAA,SAAS,GAAG,IAAI,CAAC;QAEjB,SAAA,YAAY,CAAC,OAAO,EAAE,CAAC;QACvB,SAAA,YAAY,GAAG,IAAI,CAAC;QAEpB,SAAA,gBAAgB,CAAC,OAAO,EAAE,CAAC;QAC3B,SAAA,gBAAgB,GAAG,IAAI,CAAC;QAExB,UAAU,GAAG,KAAK,CAAC;QACnB,QAAQ,GAAG,IAAI,CAAC;QAEhB,cAAc,CAAC,QAAQ,CAAC,kBAAkB,EAAE,CAAC;QAC7C,cAAc,CAAC,YAAY,CAAC,kBAAkB,EAAE,CAAC;QACjD,cAAc,CAAC,kBAAkB,CAAC,kBAAkB,EAAE,CAAC;QACvD,cAAc,CAAC,gBAAgB,CAAC,kBAAkB,EAAE,CAAC;QAErD,YAAY,GAAG,KAAK,CAAC;KACxB;IAnCe,gBAAO,UAmCtB,CAAA;IAED,SAAS,MAAM;QACX,MAAM,KAAK,GAAG,MAAM,CAAC,UAAU,CAAC;QAChC,MAAM,MAAM,GAAG,MAAM,CAAC,WAAW,CAAC;QAElC,SAAA,aAAa,CAAC,OAAO,CAAC,KAAK,EAAE,MAAM,CAAC,CAAC;QAErC,IAAI,UAAU,GAAG,MAAM,CAAC,gBAAgB,CAAC;QACzC,IAAI,CAAC,cAAc,GAAG,CAAC,MAAM,UAAU,GAAG,cAAc,CAAC,EAAE;YACvD,UAAU,GAAG,cAAc,CAAC;SAC/B;QAED,SAAA,aAAa,CAAC,aAAa,CAAC,UAAU,CAAC,CAAC;QACxC,eAAe,CAAC,OAAO,CAAC,OAAO,CAAC,MAAM,IAAI,MAAM,CAAC,MAAM,EAAE,CAAC,CAAC;QAE3D,cAAc,CAAC,QAAQ,CAAC,MAAM,EAAE,CAAC;KACpC;IAED,SAAS,gBAAgB;QACrB,aAAa,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC;QAE/B,cAAc,CAAC,mBAAmB,CAAC,MAAM,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC;KAC9D;IAED,SAAgB,aAAa,CAAC,KAAa;QACvC,IAAI,KAAK,EAAE;YACP,gBAAgB,EAAE,CAAC;YACnB,IAAI,gBAAgB,GAAG,CAAC,EAAE;gBACtB,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;aACrB;SACJ;aAAM;YACH,gBAAgB,EAAE,CAAC;YACnB,IAAI,gBAAgB,IAAI,CAAC,EAAE;gBACvB,gBAAgB,GAAG,CAAC,CAAC;gBACrB,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;aACtB;SACJ;KACJ;IAbe,sBAAa,gBAa5B,CAAA;AAEL,CAAC,EAzNgB,QAAQ,KAAR,QAAQ;;IChBR,cAehB;AAfD,WAAiB,aAAa;;;;IAO1B,SAAgB,OAAO,CAAC,KAAY,EAAE,QAAuB;;QAEzD,IAAI,OAAO,kBAAkB,KAAK,WAAW,EAAE;YAC3C,OAAO,CAAC,GAAG,CAAC,+DAA+D,CAAC,CAAC;YAC7E,kBAAkB,CAAC,aAAa,CAAC,IAAI,WAAW,CAAC,SAAS,EAAE,EAAE,MAAM,EAAE,KAAK,EAAE,CAAC,CAAC,CAAC;YAChF,kBAAkB,CAAC,aAAa,CAAC,IAAI,WAAW,CAAC,SAAS,EAAE,EAAE,MAAM,EAAE,QAAQ,EAAE,CAAC,CAAC,CAAC;SACtF;KACJ;IAPe,qBAAO,UAOtB,CAAA;AACL,CAAC,EAfgB,aAAa,KAAb,aAAa;;ACoC9B,MAAM,aAAa;IAMf,YAAY,QAA2B;QAL/B,aAAQ,GAAsB,EAAE,CAAC;QAMrC,IAAI,CAAC,SAAS,GAAG,QAAQ,CAAC;KAC7B;IAJD,IAAI,KAAK,KAAa,OAAO,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAA,EAAE;IAMnD,QAAQ,CAAC,MAAuB;QAC5B,OAAO,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,KAAK,MAAM,CAAC,CAAC;KAChD;IAED,UAAU,CAAC,KAAa;QACpB,OAAO,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC;KAC/B;IAED,oBAAoB;QAChB,OAAO,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC,MAAM;YAC/B,OAAO,MAAM,CAAC,kBAAkB,EAAE,GAAG,CAAC,CAAC;SAC1C,CAAC,CAAC;KACN;IAED,MAAM,CAAC,KAAa;QAChB,IAAI,KAAK,IAAI,CAAC,IAAI,KAAK,GAAG,IAAI,CAAC,QAAQ,CAAC,MAAM,EAAE;YAC5C,OAAO,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC;SAC/B;aAAM;YACH,OAAO,IAAI,CAAC;SACf;KACJ;IAED,GAAG,CAAC,MAAuB;QACvB,IAAI,KAAK,GAAG,KAAK,CAAC;QAClB,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,EAAE;YACxB,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;YAC3B,KAAK,GAAG,IAAI,CAAC;YAEb,IAAI,IAAI,CAAC,SAAS,CAAC,KAAK,EAAE;gBACtB,OAAO,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC,SAAS,CAAC,UAAU,CAAC,IAAI,iBAAiB,MAAM,CAAC,OAAO,EAAE,CAAC,IAAI,GAAG,CAAC,CAAC;aAC3F;YAED,IAAI,CAAC,KAAK,EAAE,CAAC;SAChB;QAED,OAAO,KAAK,CAAC;KAChB;IAED,MAAM,CAAC,MAAuB;QAC1B,IAAI,OAAO,GAAG,KAAK,CAAC;QACpB,MAAM,UAAU,GAAG,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC;QACxC,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC,CAAC;YACnC,OAAO,CAAC,KAAK,MAAM,CAAC;SACvB,CAAC,CAAC;QAEH,IAAI,UAAU,KAAK,IAAI,CAAC,QAAQ,CAAC,MAAM,EAAE;YACrC,OAAO,GAAG,IAAI,CAAC;YAEf,IAAI,IAAI,CAAC,SAAS,CAAC,KAAK,EAAE;gBACtB,OAAO,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC,SAAS,CAAC,UAAU,CAAC,IAAI,mBAAmB,MAAM,CAAC,OAAO,EAAE,CAAC,IAAI,GAAG,CAAC,CAAC;aAC7F;YAED,IAAI,CAAC,KAAK,EAAE,CAAC;SAChB;QAED,OAAO,OAAO,CAAC;KAClB;IAED,KAAK;QACD,IAAI,IAAI,CAAC,SAAS,CAAC,KAAK,EAAE;YACtB,IAAI,OAAO,GAAW,GAAG,IAAI,CAAC,SAAS,CAAC,UAAU,CAAC,IAAI,aAAa,IAAI,CAAC,QAAQ,CAAC,MAAM,EAAE,CAAC;YAC3F,KAAK,MAAM,MAAM,IAAI,IAAI,CAAC,QAAQ,EAAE;gBAChC,OAAO,IAAI,OAAO,MAAM,CAAC,OAAO,EAAE,CAAC,IAAI,EAAE,CAAC;gBAC1C,OAAO,IAAI,0BAA0B,MAAM,CAAC,kBAAkB,EAAE,EAAE,CAAC;aACtE;YAED,OAAO,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;SACxB;KACJ;CACJ;MA0BY,iBAAkB,SAAQ,SAAS;IAAhD;;QAEI,UAAK,GAAY,KAAK,CAAC;QAGf,WAAM,GAA+B,IAAI,GAAG,EAAE,CAAC;QAC/C,mBAAc,GAAG,IAAI,aAAa,CAAC,IAAI,CAAC,CAAC;QACzC,eAAU,GAAW,GAAG,CAAC;QAGjC,oBAAe,GAA4B,IAAI,QAAQ,EAAE,CAAC;QAC1D,wBAAmB,GAA4B,IAAI,QAAQ,EAAE,CAAC;KAwQjE;IAtQG,IAAI,KAAK,KAAsB,OAAO,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,MAAM,EAAE,CAAC,CAAA,EAAE;;;;IAKxE,IAAI,SAAS;QACT,OAAO,IAAI,CAAC,UAAU,CAAC;KAC1B;;;;IAID,IAAI,SAAS,CAAC,KAAa;QACvB,IAAI,CAAC,UAAU,GAAG,KAAK,CAAC;QAExB,IAAI,IAAI,CAAC,MAAM,EAAE;YACb,IAAI,CAAC,MAAM,CAAC,SAAS,GAAG,KAAK,CAAC;SACjC;KACJ;;;;IAKD,IAAI,IAAI;QACJ,OAAO,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC;KAC3B;;;;IAID,IAAI,IAAI,CAAC,KAAa;QAClB,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC;KAC9B;IAED,SAAS,CAAC,OAAkC;QACxC,KAAK,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC;QAEzB,IAAI,OAAO,CAAC,KAAK,EAAE;YACf,KAAI,MAAM,IAAI,IAAI,OAAO,CAAC,KAAK,EAAE;gBAC7B,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;aACtB;SACJ;KACJ;IAED,OAAO,CAAC,IAAmB;QACvB,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE;YAC7B,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;SACpC;aAAM;YACH,OAAO,CAAC,KAAK,CAAC,qCAAqC,IAAI,CAAC,IAAI,kBAAkB,IAAI,CAAC,UAAU,CAAC,IAAI,qDAAqD,CAAC,CAAC;SAC5J;KACJ;IAED,OAAO,CAAC,QAAgB;QACpB,OAAO,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;KACpC;IAED,QAAQ,CAAC,UAAsB;QAC3B,KAAK,CAAC,QAAQ,CAAC,UAAU,CAAC,CAAC;QAE3B,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QACnD,IAAI,CAAC,iBAAiB,GAAG,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAE3D,IAAI,CAAC,MAAM,GAAG,IAAI,cAAc,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;QAClD,IAAI,CAAC,MAAM,CAAC,gBAAgB,CAAC,MAAM,EAAE,IAAI,CAAC,aAAa,CAAC,CAAC;QACzD,IAAI,CAAC,MAAM,CAAC,gBAAgB,CAAC,UAAU,EAAE,IAAI,CAAC,iBAAiB,CAAC,CAAC;QACjE,IAAI,CAAC,MAAM,CAAC,SAAS,GAAG,IAAI,CAAC,UAAU,CAAC;KAC3C;IAED,SAAS;QACL,KAAK,CAAC,SAAS,EAAE,CAAC;QAClB,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC;KACxB;IAED,WAAW;QACP,KAAK,CAAC,WAAW,EAAE,CAAC;QACpB,IAAI,CAAC,QAAQ,GAAG,KAAK,CAAC;KACzB;IAED,OAAO;QACH,KAAK,CAAC,OAAO,EAAE,CAAC;KACnB;IAED,IAAI,CAAC,QAAgB,EAAE,OAAyB;QAC5C,MAAM,IAAI,GAAG,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;QACvC,IAAI,CAAC,IAAI,EAAE;YACP,OAAO,CAAC,KAAK,CAAC,0BAA0B,QAAQ,oBAAoB,IAAI,CAAC,UAAU,CAAC,IAAI,mBAAmB,IAAI,CAAC,UAAU,CAAC,IAAI,EAAE,CAAC,CAAC;YACnI,OAAO;SACV;QACD,IAAI,IAAI,CAAC,mBAAmB,CAAC,IAAI,EAAE,QAAQ,CAAC,EAAE;YAC1C,OAAO,CAAC,IAAI,CAAC,uDAAuD,IAAI,CAAC,IAAI,EAAE,CAAC,CAAC;;YAEjF,OAAO;SACV;QAED,IAAI,CAAC,OAAO,EAAE;YACV,OAAO,GAAG,EAAE,CAAC;SAChB;QAED,IAAI,IAAI,CAAC,KAAK,EAAE;YACZ,OAAO,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC,UAAU,CAAC,IAAI,SAAS,QAAQ,kBAAkB,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC;SACpG;;QAGD,MAAM,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC,KAAK,EAAE,CAAC;;QAGpD,IAAI,iBAAiB,GAAG,IAAI,CAAC,cAAc,CAAC,oBAAoB,EAAE,CAAC;QACnE,IAAI,iBAAiB,IAAI,iBAAiB,CAAC,MAAM,GAAG,CAAC,EAAE;;YAEnD,iBAAiB,GAAG,iBAAiB,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,KAAK,MAAM,CAAC,CAAC;SACnE;QAED,IAAI,IAAI,CAAC,KAAK,EAAE;YACZ,IAAI,iBAAiB,IAAI,iBAAiB,CAAC,MAAM,GAAG,CAAC,EAAE;gBACnD,IAAI,OAAO,GAAG,GAAG,IAAI,CAAC,UAAU,CAAC,IAAI,+BAA+B,iBAAiB,CAAC,MAAM,EAAE,CAAC;gBAC/F,KAAK,MAAM,MAAM,IAAI,iBAAiB,EAAE;oBACpC,OAAO,IAAI,OAAO,MAAM,CAAC,OAAO,EAAE,CAAC,IAAI,EAAE,CAAC;oBAC1C,OAAO,IAAI,0BAA0B,MAAM,CAAC,kBAAkB,EAAE,EAAE,CAAC;iBACtE;gBAED,OAAO,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;aACxB;iBAAM;gBACH,OAAO,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC,UAAU,CAAC,IAAI,gCAAgC,CAAC,CAAC;aACxE;SACJ;QAED,IAAI,iBAAiB;YACjB,iBAAiB,CAAC,MAAM,GAAG,CAAC;YAC5B,OAAO,CAAC,kBAAkB,GAAG,CAAC,EAChC;;YAEE,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,iBAAiB,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;gBAC/C,IAAI,IAAI,CAAC,KAAK,EAAE;oBACZ,OAAO,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC,UAAU,CAAC,IAAI,oBAAoB,iBAAiB,CAAC,CAAC,CAAC,CAAC,OAAO,EAAE,CAAC,IAAI,SAAS,OAAO,CAAC,kBAAkB,UAAU,CAAC,CAAC;iBAC5I;gBACD,iBAAiB,CAAC,CAAC,CAAC,CAAC,UAAU,EAAE,CAAC;gBAClC,iBAAiB,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,OAAO,CAAC,kBAAkB,CAAC,CAAC;aAC5D;;YAGD,IAAI,IAAI,CAAC,KAAK,EAAE;gBACZ,OAAO,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC,UAAU,CAAC,IAAI,mBAAmB,MAAM,CAAC,OAAO,EAAE,CAAC,IAAI,SAAS,OAAO,CAAC,kBAAkB,UAAU,CAAC,CAAC;aAC7H;YACD,MAAM,CAAC,UAAU,EAAE,CAAC;YACpB,MAAM,CAAC,MAAM,CAAC,OAAO,CAAC,kBAAkB,CAAC,CAAC;SAC7C;aAAM;;YAEH,IAAI,CAAC,OAAO,EAAE,CAAC;YAEf,MAAM,CAAC,kBAAkB,CAAC,CAAC,CAAC,CAAC;SAChC;;QAGD,IAAI,OAAO,CAAC,IAAI,EAAE;YACd,MAAM,CAAC,OAAO,CAAC,UAAU,EAAE,QAAQ,CAAC,CAAC;SACxC;aAAM;YACH,MAAM,CAAC,OAAO,CAAC,QAAQ,EAAE,CAAC,CAAC,CAAC;SAC/B;;QAGD,MAAM,CAAC,iBAAiB,GAAG,IAAI,CAAC;QAEhC,IAAI,OAAO,CAAC,gBAAgB,IAAI,CAAC,EAAE;YAC/B,MAAM,CAAC,WAAW,CAAC,OAAO,CAAC,gBAAgB,CAAC,CAAC;SAChD;aAAM;YACH,MAAM,CAAC,qBAAqB,CAAC,CAAC,CAAC,CAAC;SACnC;;QAGD,IAAI,OAAO,CAAC,mBAAmB,IAAI,CAAC,EAAE;YAClC,OAAO,CAAC,mBAAmB,GAAG,KAAK,CAAC,OAAO,CAAC,mBAAmB,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;YACvE,MAAM,CAAC,IAAI,GAAG,WAAW,CAAC,OAAO,CAAC,mBAAmB,EAAE,CAAC,EAAE,MAAM,CAAC,OAAO,EAAE,CAAC,QAAQ,CAAC,CAAC;SACxF;;QAGD,MAAM,CAAC,IAAI,EAAE,CAAC;QAEd,IAAI,CAAC,cAAc,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;KACnC;IAED,OAAO;QACH,IAAI,CAAC,OAAO,EAAE,CAAC;QAEf,KAAK,MAAM,CAAC,QAAQ,EAAE,IAAI,CAAC,IAAI,IAAI,CAAC,MAAM,EAAE;YACxC,MAAM,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC,KAAK,EAAE,CAAC;YACpD,MAAM,CAAC,IAAI,EAAE,CAAC;YAEd,IAAI,CAAC,cAAc,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;SACnC;KACJ;IAED,OAAO;QACH,IAAI,IAAI,CAAC,KAAK,EAAE;YACZ,OAAO,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC,UAAU,CAAC,IAAI,aAAa,IAAI,CAAC,cAAc,CAAC,KAAK,WAAW,CAAC,CAAC;SACzF;QAED,KAAK,IAAI,CAAC,GAAG,IAAI,CAAC,cAAc,CAAC,KAAK,GAAG,CAAC,EAAE,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,EAAE;YACrD,MAAM,MAAM,GAAG,IAAI,CAAC,cAAc,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC;YACjD,MAAM,CAAC,IAAI,EAAE,CAAC;YACd,IAAI,CAAC,cAAc,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;SACtC;KACJ;IAED,QAAQ;QACJ,KAAK,CAAC,QAAQ,EAAE,CAAC;QAEjB,IAAI,IAAI,CAAC,QAAQ,EAAE;YACf,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;SAC/C;KACJ;IAED,YAAY;QACR,KAAK,CAAC,YAAY,EAAE,CAAC;KACxB;IAEO,aAAa,CAAC,CAAkB;QACpC,MAAM,SAAS,GAAG,CAAoB,CAAC;QAEvC,IAAI,IAAI,CAAC,KAAK,EAAE;YACZ,OAAO,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC,UAAU,CAAC,IAAI,cAAc,SAAS,CAAC,MAAM,CAAC,OAAO,EAAE,CAAC,IAAI,OAAO,CAAC,CAAC;SAC5F;QAED,IAAI,CAAC,eAAe,CAAC,MAAM,CAAC;YACxB,QAAQ,EAAE,SAAS,CAAC,MAAM,CAAC,OAAO,EAAE,CAAC,IAAI;SAC5C,CAAC,CAAC;KACN;IAEO,iBAAiB,CAAC,CAAkB;QACxC,MAAM,WAAW,GAAG,CAAwB,CAAC;QAE7C,IAAI,IAAI,CAAC,KAAK,EAAE;YACZ,OAAO,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC,UAAU,CAAC,IAAI,cAAc,WAAW,CAAC,MAAM,CAAC,OAAO,EAAE,CAAC,IAAI,WAAW,CAAC,CAAC;SAClG;QAED,IAAI,CAAC,mBAAmB,CAAC,MAAM,CAAC;YAC5B,QAAQ,EAAE,WAAW,CAAC,MAAM,CAAC,OAAO,EAAE,CAAC,IAAI;SAC9C,CAAC,CAAC;KACN;IAEO,mBAAmB,CAAC,IAAmB,EAAE,IAA+B;QAC5E,MAAM,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC;QAC5C,IAAI,MAAM,CAAC,SAAS,EAAE,IAAI,MAAM,CAAC,IAAI,KAAK,IAAI,EAAE;YAC5C,OAAO,IAAI,CAAC;SACf;QACD,OAAO,KAAK,CAAC;KAChB;IAED,SAAS;QACL,KAAK,CAAC,SAAS,EAAE,CAAC;QAElB,IAAI,CAAC,OAAO,EAAE,CAAC;QAEf,IAAI,CAAC,eAAe,CAAC,OAAO,EAAE,CAAC;QAC/B,IAAI,CAAC,mBAAmB,CAAC,OAAO,EAAE,CAAC;QAEnC,IAAI,CAAC,MAAM,CAAC,mBAAmB,CAAC,MAAM,EAAE,IAAI,CAAC,aAAa,CAAC,CAAC;QAC5D,IAAI,CAAC,MAAM,CAAC,mBAAmB,CAAC,UAAU,EAAE,IAAI,CAAC,iBAAiB,CAAC,CAAC;QAEpE,IAAI,CAAC,MAAM,CAAC,aAAa,EAAE,CAAC;QAC5B,IAAI,CAAC,MAAM,CAAC,WAAW,CAAC,IAAI,CAAC,MAAM,CAAC,OAAO,EAAE,CAAC,CAAC;QAC/C,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC;QAEnB,IAAI,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC;KACvB;;;MCzZQ,aAAc,SAAQ,SAAS;IAIxC,SAAS,CAAC,OAA8B;QACpC,KAAK,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC;QAEzB,IAAI,CAAC,IAAI,GAAG,OAAO,CAAC,IAAI,CAAC;KAC5B;IAED,QAAQ,CAAC,UAAsB;QAC3B,KAAK,CAAC,QAAQ,CAAC,UAAU,CAAC,CAAC;QAE3B,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;KAClC;IAED,OAAO;QACH,KAAK,CAAC,OAAO,EAAE,CAAC;KACnB;IAED,SAAS;QACL,KAAK,CAAC,SAAS,EAAE,CAAC;QAElB,IAAI,CAAC,UAAU,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;KACrC;;;AC3BL,MAAM,YAAY,GAAa,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,CAAC,CAAC;MAElC,oBAAoB;IAM7B,YAAY,QAA2B;QAFvC,oBAAe,GAAmC,IAAI,QAAQ,EAAE,CAAC;QAG7D,IAAI,CAAC,SAAS,GAAG,QAAQ,CAAC;QAE1B,IAAI,CAAC,eAAe,GAAG,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QACvD,IAAI,CAAC,qBAAqB,GAAG,IAAI,CAAC,qBAAqB,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAEnE,IAAI,CAAC,SAAS,CAAC,gBAAgB,CAAC,QAAQ,EAAE,IAAI,CAAC,eAAe,CAAC,CAAC;QAChE,IAAI,CAAC,SAAS,CAAC,gBAAgB,CAAC,cAAc,EAAE,IAAI,CAAC,qBAAqB,CAAC,CAAC;;QAG5E,IAAI,CAAC,OAAO,GAAG,QAAQ,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;QAC7C,QAAQ,CAAC,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;QACxC,IAAI,CAAC,OAAO,CAAC,EAAE,GAAG,wBAAwB,CAAC;QAE3C,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,QAAQ,GAAG,OAAO,CAAC;QACtC,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,KAAK,GAAG,GAAG,CAAC;QAC/B,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,MAAM,GAAG,GAAG,CAAA;QAC/B,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,QAAQ,GAAG,OAAO,CAAC;QACtC,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,QAAQ,GAAG,KAAK,CAAC;QACpC,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,eAAe,GAAG,MAAM,CAAC;QAC5C,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,KAAK,GAAG,MAAM,CAAC;QAClC,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,UAAU,GAAG,aAAa,CAAC;QAC9C,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,OAAO,GAAG,KAAK,CAAC;QACnC,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,QAAQ,GAAG,MAAM,CAAC;QAErC,IAAI,CAAC,UAAU,CAAC,aAAa,CAAC,CAAC;QAC/B,IAAI,CAAC,aAAa,CAAC,aAAa,CAAC,CAAC;QAClC,IAAI,CAAC,UAAU,EAAE,CAAC;QAClB,IAAI,CAAC,UAAU,CAAC,gBAAgB,CAAC,CAAC;QAClC,IAAI,CAAC,WAAW,CAAC,gBAAgB,EAAE,CAAC,MAAM;YACtC,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;SAC/C,CAAC,CAAC;QACH,IAAI,CAAC,UAAU,EAAE,CAAC;QAClB,IAAI,CAAC,UAAU,CAAC,gBAAgB,CAAC,CAAC;QAClC,IAAI,CAAC,WAAW,CAAC,gBAAgB,EAAE,CAAC,MAAM;YACtC,MAAM,GAAG,GAAG,MAAM,CAAC,KAAK,EAAE,CAAC,cAAc,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC;YAC7D,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,QAAQ,CAAC,cAAc,CAAC,GAAG,CAAC,CAAC;SACtD,CAAC,CAAC;QACH,IAAI,CAAC,UAAU,EAAE,CAAC;QAClB,IAAI,CAAC,UAAU,CAAC,aAAa,CAAC,CAAC;QAC/B,IAAI,CAAC,WAAW,CAAC,aAAa,EAAE,CAAC,MAAM;YACnC,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;SAC5C,CAAC,CAAC;QACH,IAAI,CAAC,UAAU,EAAE,CAAC;QAClB,IAAI,CAAC,UAAU,CAAC,gBAAgB,CAAC,CAAC;QAClC,IAAI,CAAC,aAAa,CAAC;YACf;gBACK,IAAI,EAAE,WAAW;gBACjB,QAAQ,EAAE,CAAC,CAAC;oBACT,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,WAAW,CAAC,CAAC;iBACtC;aACL;YACD;gBACK,IAAI,EAAE,QAAQ;gBACd,QAAQ,EAAE,CAAC,CAAC;oBACT,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;iBACnC;aACL;YACD;gBACK,IAAI,EAAE,OAAO;gBACb,QAAQ,EAAE,CAAC,CAAC;oBACT,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC;iBAClC;aACL;SACJ,CAAC,CAAC;QACH,IAAI,CAAC,UAAU,EAAE,CAAC;QAClB,IAAI,CAAC,UAAU,CAAC,iBAAiB,CAAC,CAAC;QACnC,IAAI,CAAC,aAAa,CAAC;YACf;gBACK,IAAI,EAAE,OAAO;gBACb,QAAQ,EAAE,CAAC,CAAC;oBACT,IAAI,CAAC,SAAS,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC;iBACnC;aACL;YACD;gBACK,IAAI,EAAE,OAAO;gBACb,QAAQ,EAAE,CAAC,CAAC;oBACT,IAAI,CAAC,SAAS,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC;iBACnC;aACL;SACJ,CAAC,CAAC;QACH,IAAI,CAAC,UAAU,CAAC,MAAM,CAAC,CAAC;QACxB,IAAI,CAAC,UAAU,CAAC,iBAAiB,EAAE,CAAC,CAAC;YACjC,IAAI,CAAC,eAAe,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;SACrC,CAAC,CAAC;QAEH,IAAI,CAAC,OAAO,EAAE,CAAC;KAClB;IAEO,UAAU,CAAC,KAAa;QAC5B,MAAM,QAAQ,GAAG,QAAQ,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;QAC/C,IAAI,CAAC,OAAO,CAAC,WAAW,CAAC,QAAQ,CAAC,CAAC;QAEnC,QAAQ,CAAC,KAAK,CAAC,eAAe,GAAG,MAAM,CAAC;QACxC,QAAQ,CAAC,KAAK,CAAC,KAAK,GAAG,MAAM,CAAC;QAC9B,QAAQ,CAAC,KAAK,CAAC,SAAS,GAAG,MAAM,CAAC;QAClC,QAAQ,CAAC,KAAK,CAAC,aAAa,GAAG,KAAK,CAAC;QACrC,QAAQ,CAAC,KAAK,CAAC,OAAO,GAAG,KAAK,CAAC;QAC/B,QAAQ,CAAC,KAAK,CAAC,SAAS,GAAG,YAAY,CAAC;QACxC,QAAQ,CAAC,WAAW,GAAG,KAAK,CAAC;KAChC;IAEO,UAAU,CAAC,MAAe;QAC9B,MAAM,QAAQ,GAAG,QAAQ,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;QAC/C,IAAI,CAAC,OAAO,CAAC,WAAW,CAAC,QAAQ,CAAC,CAAC;QAEnC,QAAQ,CAAC,KAAK,CAAC,MAAM,GAAG,MAAM,aAAN,MAAM,cAAN,MAAM,GAAI,MAAM,CAAC;KAC5C;IAEO,aAAa,CAAC,EAAU;QAC5B,MAAM,WAAW,GAAG,QAAQ,CAAC,aAAa,CAAC,GAAG,CAAC,CAAC;QAChD,IAAI,CAAC,OAAO,CAAC,WAAW,CAAC,WAAW,CAAC,CAAC;QACtC,WAAW,CAAC,EAAE,GAAG,EAAE,CAAC;QAEpB,WAAW,CAAC,KAAK,CAAC,SAAS,GAAG,YAAY,CAAC;QAC3C,WAAW,CAAC,KAAK,CAAC,MAAM,GAAG,iBAAiB,CAAC;KAChD;IAEO,iBAAiB,CAAC,EAAU,EAAE,IAAY;QAC9C,MAAM,WAAW,GAAG,QAAQ,CAAC,aAAa,CAAC,IAAI,EAAE,EAAE,CAAqB,CAAC;QACzE,IAAI,WAAW,EAAE;YACb,WAAW,CAAC,WAAW,GAAG,IAAI,CAAC;SAClC;KACJ;IAEO,UAAU,CAAC,IAAY,EAAE,QAAiC;QAC9D,MAAM,QAAQ,GAAG,QAAQ,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC;QAClD,IAAI,CAAC,OAAO,CAAC,WAAW,CAAC,QAAQ,CAAC,CAAC;QAEnC,QAAQ,CAAC,KAAK,CAAC,KAAK,GAAG,MAAM,CAAC;QAC9B,QAAQ,CAAC,KAAK,CAAC,QAAQ,GAAG,MAAM,CAAC;QAEjC,QAAQ,CAAC,WAAW,GAAG,IAAI,CAAC;QAC5B,QAAQ,CAAC,OAAO,GAAG,CAAC,CAAC,KAAK,QAAQ,CAAC,CAAC,CAAC,CAAC;KACzC;IAEO,aAAa,CAAC,OAA8D;QAChF,MAAM,KAAK,GAAG,QAAQ,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;QAC5C,IAAI,CAAC,OAAO,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC;QAChC,KAAK,CAAC,KAAK,CAAC,OAAO,GAAG,MAAM,CAAC;QAC7B,KAAK,CAAC,KAAK,CAAC,aAAa,GAAG,KAAK,CAAC;QAElC,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,OAAO,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;YACrC,MAAM,MAAM,GAAG,OAAO,CAAC,CAAC,CAAC,CAAC;YAE1B,MAAM,QAAQ,GAAG,QAAQ,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC;YAClD,KAAK,CAAC,WAAW,CAAC,QAAQ,CAAC,CAAC;YAE5B,QAAQ,CAAC,KAAK,CAAC,KAAK,GAAG,MAAM,CAAC;YAC9B,QAAQ,CAAC,KAAK,CAAC,QAAQ,GAAG,MAAM,CAAC;YAEjC,QAAQ,CAAC,WAAW,GAAG,MAAM,CAAC,IAAI,CAAC;YACnC,QAAQ,CAAC,OAAO,GAAG,CAAC,CAAC,KAAK,MAAM,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC;SAChD;KACJ;IAEO,WAAW,CAAC,EAAU,EAAE,QAAmC;QAC/D,MAAM,QAAQ,GAAG,QAAQ,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;QAC/C,IAAI,CAAC,OAAO,CAAC,WAAW,CAAC,QAAQ,CAAC,CAAC;QACnC,QAAQ,CAAC,EAAE,GAAG,EAAE,CAAC;QAEjB,QAAQ,CAAC,KAAK,CAAC,OAAO,GAAG,MAAM,CAAC;QAChC,QAAQ,CAAC,KAAK,CAAC,aAAa,GAAG,KAAK,CAAC;QAErC,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,YAAY,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;YAC1C,MAAM,KAAK,GAAG,YAAY,CAAC,CAAC,CAAC,CAAC;YAE9B,MAAM,OAAO,GAAG,QAAQ,CAAC,aAAa,CAAC,OAAO,CAAC,CAAC;YAChD,QAAQ,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC;YAC9B,OAAO,CAAC,OAAO,GAAG,KAAK,CAAC;YACxB,OAAO,CAAC,WAAW,GAAG,GAAG,KAAK,CAAC,WAAW,EAAE,GAAG,CAAC;YAEhD,MAAM,OAAO,GAAG,QAAQ,CAAC,aAAa,CAAC,OAAO,CAAC,CAAC;YAChD,QAAQ,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC;YAC9B,OAAO,CAAC,IAAI,GAAG,QAAQ,CAAC;YACxB,OAAO,CAAC,QAAQ,GAAG,MAAM,QAAQ,CAAC,IAAI,CAAC,WAAW,CAAC,EAAE,CAAC,CAAC,CAAC;YACxD,OAAO,CAAC,KAAK,CAAC,KAAK,GAAG,MAAM,CAAC;YAC7B,OAAO,CAAC,EAAE,GAAG,KAAK,CAAC;YACnB,OAAO,CAAC,IAAI,GAAG,KAAK,CAAC;SACxB;KACJ;IAEO,WAAW,CAAC,EAAU;QAC1B,MAAM,QAAQ,GAAG,QAAQ,CAAC,aAAa,CAAC,IAAI,EAAE,EAAE,CAAC,CAAC;QAClD,IAAI,QAAQ,EAAE;YACV,MAAM,MAAM,GAAG,IAAI,OAAO,EAAE,CAAC;YAC7B,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,YAAY,CAAC,MAAM,EAAE,CAAC,EAAE,EAAG;gBAC3C,MAAM,KAAK,GAAG,YAAY,CAAC,CAAC,CAAC,CAAC;gBAE9B,MAAM,OAAO,GAAG,QAAQ,CAAC,aAAa,CAAC,IAAI,KAAK,EAAE,CAAqB,CAAC;gBACxE,MAAM,CAAC,YAAY,CAAC,CAAC,EAAE,MAAM,CAAC,UAAU,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC,CAAC;aAC5D;YAED,OAAO,MAAM,CAAC;SACjB;QAED,OAAO,IAAI,CAAC;KACf;IAEO,eAAe,CAAC,EAAU,EAAE,MAAe;QAC/C,MAAM,QAAQ,GAAG,QAAQ,CAAC,aAAa,CAAC,IAAI,EAAE,EAAE,CAAC,CAAC;QAClD,IAAI,QAAQ,EAAE;YACV,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,YAAY,CAAC,MAAM,EAAE,CAAC,EAAE,EAAG;gBAC3C,MAAM,KAAK,GAAG,YAAY,CAAC,CAAC,CAAC,CAAC;gBAE9B,MAAM,OAAO,GAAG,QAAQ,CAAC,aAAa,CAAC,IAAI,KAAK,EAAE,CAAqB,CAAC;gBACxE,OAAO,CAAC,KAAK,GAAG,MAAM,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;aACrD;SACJ;KACJ;IAED,OAAO;QACH,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE;YACf,OAAO;SACV;QAED,IAAI,CAAC,iBAAiB,CAAC,aAAa,EAAE,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;QAClE,IAAI,CAAC,eAAe,CAAC,gBAAgB,EAAE,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC;QACvE,IAAI,CAAC,eAAe,CAAC,gBAAgB,EAAE,IAAI,OAAO,CAC9C,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC,GAAG,SAAS,CAAC,OAAO,EACpD,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC,GAAG,SAAS,CAAC,OAAO,EACpD,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC,GAAG,SAAS,CAAC,OAAO,CACvD,CAAC,CAAC;QACH,IAAI,CAAC,eAAe,CAAC,aAAa,EAAE,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;KACpE;IAEO,eAAe;QACnB,IAAI,CAAC,OAAO,EAAE,CAAC;KAClB;IAEO,qBAAqB;QACzB,IAAI,CAAC,OAAO,EAAE,CAAC;KAClB;IAED,OAAO;QACH,IAAI,CAAC,SAAS,CAAC,mBAAmB,CAAC,QAAQ,EAAE,IAAI,CAAC,eAAe,CAAC,CAAC;QACnE,IAAI,CAAC,SAAS,CAAC,mBAAmB,CAAC,cAAc,EAAE,IAAI,CAAC,qBAAqB,CAAC,CAAC;QAC/E,IAAI,IAAI,CAAC,OAAO,EAAE;YACd,IAAI,CAAC,OAAO,CAAC,MAAM,EAAE,CAAC;YACtB,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC;SACvB;KACJ;;;ICtPY,cAuGhB;AAvGD,WAAiB,aAAa;IAC1B,IAAI,SAA4B,CAAC;IACjC,IAAI,IAA0B,CAAC;IAC/B,IAAI,UAAmB,CAAC;IAEX,sBAAQ,GAAuB,IAAI,QAAQ,EAAE,CAAC;IAC9C,sBAAQ,GAAuB,IAAI,QAAQ,EAAE,CAAC;IAC9C,yBAAW,GAAU,IAAI,KAAK,EAAE,CAAC;IACjC,uBAAS,GAAU,IAAI,KAAK,EAAE,CAAC;IAC/B,4BAAc,GAAuB,IAAI,QAAQ,EAAE,CAAC;IAEjE,SAAgB,MAAM,CAAC,QAAkB,EAAE,eAAiC;QACxE,IAAI,SAAS,IAAI,IAAI,EAAE;YACnB,MAAM,EAAE,CAAC;SACZ;QAED,MAAM,eAAe,GAAG,eAAe,aAAf,eAAe,cAAf,eAAe,GAAI,eAAe,CAAC,aAAa,CAAC;QACzE,IAAI,CAAC,eAAe,EAAE;YAClB,OAAO,CAAC,KAAK,CAAC,6EAA6E,CAAC,CAAC;YAC7F,OAAO;SACV;QACD,IAAI,CAAC,QAAQ,CAAC,aAAa,CAAC,UAAU,EAAE;YACpC,OAAO,CAAC,KAAK,CAAC,uFAAuF,CAAC,CAAC;YACvG,OAAO;SACV;QAED,SAAS,GAAG,IAAI,iBAAiB,CAC7B,eAAe,CAAC,MAAM,EACtB,QAAQ,CAAC,aAAa,CAAC,UAAU,CACpC,CAAC;QAEF,SAAS,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC;QAC3B,SAAS,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC;QAC5B,SAAS,CAAC,OAAO,CAAC,WAAW,CAAC,CAAC;QAE/B,SAAS,CAAC,gBAAgB,CAAC,QAAQ,EAAE,cAAc,CAAC,CAAC;QACrD,SAAS,CAAC,gBAAgB,CAAC,WAAW,EAAE,iBAAiB,CAAC,CAAC;QAC3D,SAAS,CAAC,gBAAgB,CAAC,SAAS,EAAE,eAAe,CAAC,CAAC;QACvD,SAAS,CAAC,gBAAgB,CAAC,cAAc,EAAE,oBAAoB,CAAC,CAAC;;QAIjE,MAAM,KAAK,GAAG,eAAe,CAAC,QAAQ,CAAC,CAAC;QACxC,KAAK,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC;QAErB,IAAI,GAAG,IAAI,oBAAoB,CAAC,SAAS,CAAC,CAAC;QAC3C,IAAI,CAAC,eAAe,CAAC,WAAW,CAAC,gBAAgB,CAAC,CAAC;KACtD;IApCe,oBAAM,SAoCrB,CAAA;IAED,SAAgB,MAAM;QAClB,IAAI,IAAI,EAAE;YACN,IAAI,CAAC,eAAe,CAAC,cAAc,CAAC,gBAAgB,CAAC,CAAC;YACtD,IAAI,CAAC,OAAO,EAAE,CAAC;YACf,IAAI,GAAG,IAAI,CAAC;SACf;QAED,IAAI,SAAS,EAAE;YACX,SAAS,CAAC,mBAAmB,CAAC,QAAQ,EAAE,cAAc,CAAC,CAAC;YACxD,SAAS,CAAC,mBAAmB,CAAC,WAAW,EAAE,iBAAiB,CAAC,CAAC;YAC9D,SAAS,CAAC,mBAAmB,CAAC,SAAS,EAAE,eAAe,CAAC,CAAC;YAC1D,SAAS,CAAC,mBAAmB,CAAC,cAAc,EAAE,oBAAoB,CAAC,CAAC;;YAIpE,SAAS,CAAC,MAAM,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC;YACnC,SAAS,CAAC,MAAM,EAAE,CAAC;YACnB,SAAS,CAAC,OAAO,EAAE,CAAC;YACpB,SAAS,GAAG,IAAI,CAAC;SACpB;KACJ;IApBe,oBAAM,SAoBrB,CAAA;IAED,SAAgB,iBAAiB;QAC7B,IAAI,SAAS,EAAE;YACX,OAAO,SAAS,CAAC,MAAM,CAAC;SAC3B;aAAM;YACH,OAAO,IAAI,CAAC;SACf;KACJ;IANe,+BAAiB,oBAMhC,CAAA;IAED,SAAgB,WAAW;QACvB,OAAO,UAAU,CAAC;KACrB;IAFe,yBAAW,cAE1B,CAAA;IAED,SAAS,gBAAgB;QACrB,MAAM,EAAE,CAAC;KACZ;IAED,SAAS,cAAc;KACtB;IAED,SAAS,oBAAoB;QACzB,cAAA,cAAc,CAAC,MAAM,CAAC,iBAAiB,EAAE,CAAC,CAAC;KAC9C;IAED,SAAS,iBAAiB;QACtB,UAAU,GAAG,IAAI,CAAC;QAClB,cAAA,WAAW,CAAC,MAAM,EAAE,CAAC;KACxB;IAED,SAAS,eAAe;QACpB,UAAU,GAAG,KAAK,CAAC;QACnB,cAAA,SAAS,CAAC,MAAM,EAAE,CAAC;KACtB;AACL,CAAC,EAvGgB,aAAa,KAAb,aAAa;;MCUjB,wBAAyB,SAAQ,SAAS;IAEnD,IAAI,cAAc;QACd,MAAM,QAAQ,GAAe,EAAE,CAAC;QAChC,YAAY,CAAC,IAAI,CAAC,UAAU,EAAE,CAAC,GAAG,KAAK,QAAQ,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC;QAC3D,OAAO,QAAQ,CAAC;KACnB;IAED,SAAS,CAAC,OAAyC;QAC/C,KAAK,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC;KAC5B;IAED,QAAQ,CAAC,UAAsB;QAC3B,KAAK,CAAC,QAAQ,CAAC,UAAU,CAAC,CAAC;KAC9B;IAED,SAAS;QACL,KAAK,CAAC,SAAS,EAAE,CAAC;QAElB,QAAQ,CAAC,kBAAkB,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC;KACjD;IAED,WAAW;QACP,KAAK,CAAC,WAAW,EAAE,CAAC;QAEpB,QAAQ,CAAC,kBAAkB,CAAC,cAAc,CAAC,IAAI,CAAC,CAAC;KACpD;IAED,OAAO;QACH,KAAK,CAAC,OAAO,EAAE,CAAC;KACnB;IAED,cAAc,CAAC,KAAyB;KACvC;IAED,aAAa,CAAC,KAAwB;KACrC;IAED,aAAa,CAAC,KAAwB;KACrC;IAED,WAAW,CAAC,KAAsB;KACjC;IAED,cAAc,CAAC,KAAyB;QACpC,aAAa,CAAC,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;KACzC;IAED,QAAQ;QACJ,KAAK,CAAC,QAAQ,EAAE,CAAC;KACpB;IAED,YAAY;QACR,KAAK,CAAC,YAAY,EAAE,CAAC;KACxB;IAED,SAAS;QACL,KAAK,CAAC,SAAS,EAAE,CAAC;QAElB,IAAI,aAAa,CAAC,iBAAiB,EAAE,KAAK,IAAI,CAAC,UAAU,EAAE;YACvD,aAAa,CAAC,MAAM,EAAE,CAAC;SAC1B;QAED,QAAQ,CAAC,kBAAkB,CAAC,cAAc,CAAC,IAAI,CAAC,CAAC;KACpD;;;ACpEL;;;MAGa,oBAAqB,SAAQ,SAAS;IAAnD;;;;;QAII,WAAM,GAAY,IAAI,OAAO,EAAE,CAAC;;;;QAKhC,kBAAa,GAAG,IAAI,CAAC;QAErB,YAAO,GAAY,IAAI,CAAC;QACxB,YAAO,GAAY,IAAI,CAAC;QAExB,gBAAW,GAAG,GAAG,CAAC;QAClB,gBAAW,GAAG,GAAG,CAAC;QAClB,gBAAW,GAAG,GAAG,CAAC;QAClB,gBAAW,GAAG,GAAG,CAAC;QAElB,YAAO,GAAG,CAAC,KAAK,CAAC;QACjB,YAAO,GAAG,KAAK,CAAC;QAChB,YAAO,GAAG,CAAC,IAAI,CAAC;QAChB,YAAO,GAAG,IAAI,CAAC;QAEf,mBAAc,GAAG,GAAG,CAAC;QACrB,mBAAc,GAAG,GAAG,CAAC;QAErB,YAAO,GAAG,GAAG,CAAC;QACd,YAAO,GAAG,IAAI,CAAC;QAEf,uBAAkB,GAAY,KAAK,CAAC;QAE5B,YAAO,GAAoB,IAAI,CAAC;QAChC,kBAAa,GAAY,IAAI,CAAC;QAC9B,iBAAY,GAAY,IAAI,CAAC;QAC7B,gBAAW,GAAY,KAAK,CAAC;QAC7B,eAAU,GAAY,KAAK,CAAC;QAC5B,OAAE,GAAW,CAAC,CAAC;QACf,OAAE,GAAW,CAAC,CAAC;QACf,kBAAa,GAAW,CAAC,CAAC;QAC1B,eAAU,GAAY,KAAK,CAAC;QAC5B,uBAAkB,GAAY,IAAI,OAAO,EAAE,CAAC;QAC5C,sBAAiB,GAAY,IAAI,OAAO,EAAE,CAAC;QAC3C,wBAAmB,GAAW,CAAC,CAAC;KA6P3C;IA3PG,IAAI,YAAY,KAAc,OAAO,IAAI,CAAC,aAAa,CAAC,EAAE;IAC1D,IAAI,YAAY,CAAC,KAAc;QAC3B,IAAI,CAAC,aAAa,GAAG,KAAK,CAAC;QAE3B,IAAI,CAAC,IAAI,CAAC,YAAY,EAAE;YACpB,IAAI,CAAC,UAAU,GAAG,KAAK,CAAC;YACxB,IAAI,CAAC,WAAW,GAAG,KAAK,CAAC;YACzB,IAAI,CAAC,UAAU,GAAG,KAAK,CAAC;YACxB,IAAI,CAAC,kBAAkB,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;YAClC,IAAI,CAAC,iBAAiB,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;YACjC,IAAI,CAAC,mBAAmB,GAAG,CAAC,CAAC;SAChC;KACJ;IAED,IAAI,WAAW,KAAc,OAAO,IAAI,CAAC,YAAY,CAAC,EAAE;IACxD,IAAI,WAAW,CAAC,KAAc;QAC1B,IAAI,CAAC,YAAY,GAAG,KAAK,CAAC;QAE1B,IAAI,CAAC,IAAI,CAAC,YAAY,EAAE;YACpB,IAAI,CAAC,UAAU,GAAG,KAAK,CAAC;YACxB,IAAI,CAAC,mBAAmB,GAAG,CAAC,CAAC;SAChC;KACJ;IAED,IAAI,MAAM,KAAsB,OAAO,IAAI,CAAC,OAAO,CAAC,EAAE;IACtD,IAAI,UAAU,KAAc,OAAO,IAAI,CAAC,WAAW,CAAC,EAAE;IACtD,IAAI,SAAS,KAAc,OAAO,IAAI,CAAC,UAAU,CAAC,EAAE;IAEpD,SAAS,CAAC,OAAqC;QAC3C,KAAK,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC;QAEzB,IAAI,CAAC,OAAO,GAAG,gBAAgB,CAAC,OAAO,CAAC,eAAe,EAAE,IAAI,CAAC,CAAC;KAClE;IAED,QAAQ,CAAC,UAAsB;QAC3B,KAAK,CAAC,QAAQ,CAAC,UAAU,CAAC,CAAC;QAE3B,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE;;YAEf,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,UAAU,CAAC,YAAY,CAAC,eAAe,CAAC,CAAC;SAChE;QAED,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE;YACf,OAAO,CAAC,KAAK,CAAC,yIAAyI,CAAC,CAAC;SAC5J;KACJ;IAED,SAAS;QACL,KAAK,CAAC,SAAS,EAAE,CAAC;KACrB;IAED,WAAW;QACP,KAAK,CAAC,WAAW,EAAE,CAAC;KACvB;IAED,OAAO;QACH,KAAK,CAAC,OAAO,EAAE,CAAC;KACnB;IAED,QAAQ,CAAC,CAAU,EAAE,CAAU;QAC3B,IAAI,GAAG,GAAG,KAAK,CAAC;QAChB,IAAI,OAAO,CAAC,KAAK,QAAQ,EAAE;YACvB,IAAI,CAAC,EAAE,GAAG,CAAC,CAAC;YACZ,GAAG,GAAG,IAAI,CAAC;SACd;QACD,IAAI,OAAO,CAAC,KAAK,QAAQ,EAAE;YACvB,IAAI,CAAC,EAAE,GAAG,CAAC,CAAC;YACZ,GAAG,GAAG,IAAI,CAAC;SACd;QACD,IAAI,GAAG,EAAE;YACL,IAAI,CAAC,aAAa,EAAE,CAAC;SACxB;KACJ;IAED,oBAAoB,CAAC,QAAiB,EAAE,SAAkB;QACtD,IAAI,GAAG,GAAG,KAAK,CAAC;QAChB,IAAI,OAAO,SAAS,KAAK,QAAQ,EAAE;YAC/B,IAAI,CAAC,EAAE,GAAG,CAAC,EAAE,GAAG,SAAS,CAAC;YAC1B,GAAG,GAAG,IAAI,CAAC;SACd;QACD,IAAI,OAAO,QAAQ,KAAK,QAAQ,EAAE;YAC9B,IAAI,CAAC,EAAE,GAAG,CAAC,QAAQ,CAAC;YACpB,GAAG,GAAG,IAAI,CAAC;SACd;QACD,IAAI,GAAG,EAAE;YACL,IAAI,CAAC,aAAa,EAAE,CAAC;SACxB;KACJ;IAED,QAAQ;QACJ,OAAO;YACH,CAAC,EAAE,IAAI,CAAC,EAAE;YACV,CAAC,EAAE,IAAI,CAAC,EAAE;SACb,CAAA;KACJ;IAED,eAAe,CAAC,IAAY;QACxB,IAAI,GAAG,KAAK,CAAC,IAAI,EAAE,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,OAAO,CAAC,CAAC;QAE/C,IAAI,IAAI,CAAC,aAAa,KAAK,IAAI,EAAE;YAC7B,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC;YAC1B,IAAI,CAAC,aAAa,EAAE,CAAC;SACxB;KACJ;IAED,eAAe;QACX,OAAO,IAAI,CAAC,aAAa,CAAC;KAC7B;IAEO,eAAe;QACnB,IAAI,CAAC,IAAI,CAAC,YAAY,EAAE;YACpB,OAAO;SACV;QAED,MAAM,KAAK,GAAG,QAAQ,CAAC,KAAK,CAAC;QAE7B,IAAI,KAAK,CAAC,gBAAgB,KAAK,SAAS,CAAC,KAAK,IAAI,KAAK,CAAC,YAAY,CAAC,CAAC,CAAC,EAAE;YACrE,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC;YACvB,IAAI,CAAC,WAAW,GAAG,KAAK,CAAC;YACzB,IAAI,CAAC,kBAAkB,CAAC,IAAI,CAAC,KAAK,CAAC,iBAAiB,CAAC,CAAC,CAAC,CAAC,CAAC;SAC5D;aAAM,IAAI,KAAK,CAAC,gBAAgB,KAAK,SAAS,CAAC,KAAK,IAAI,KAAK,CAAC,kBAAkB,CAAC,CAAC,CAAC,EAAE;YAClF,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC;YACvB,IAAI,CAAC,WAAW,GAAG,KAAK,CAAC;YACzB,IAAI,CAAC,kBAAkB,CAAC,IAAI,CAAC,KAAK,CAAC,iBAAiB,EAAE,CAAC,CAAC;SAC3D;QAED,IAAI,IAAI,CAAC,UAAU,IAAI,CAAC,IAAI,CAAC,WAAW,EAAE;;YAEtC,IAAI,YAAY,GAAW,GAAG,CAAC;YAC/B,IAAI,QAAiB,CAAC;YACtB,IAAI,KAAK,CAAC,gBAAgB,KAAK,SAAS,CAAC,KAAK,EAAE;gBAC5C,QAAQ,GAAG,KAAK,CAAC,iBAAiB,CAAC,CAAC,CAAC,CAAC;aACzC;iBAAM;gBACH,QAAQ,GAAG,KAAK,CAAC,iBAAiB,EAAE,CAAC;aACxC;YAED,YAAY,GAAG,IAAI,CAAC,kBAAkB,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC;YAE5D,IAAI,YAAY,IAAI,IAAI,CAAC,aAAa,EAAE;gBACpC,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC;gBACxB,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;aACzC;SACJ;QAED,IAAI,KAAK,CAAC,gBAAgB,KAAK,SAAS,CAAC,KAAK,IAAI,KAAK,CAAC,UAAU,CAAC,CAAC,CAAC,EAAE;YACnE,IAAI,CAAC,UAAU,GAAG,KAAK,CAAC;YACxB,IAAI,CAAC,WAAW,GAAG,KAAK,CAAC;YACzB,IAAI,CAAC,kBAAkB,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;SACrC;aAAM,IAAI,KAAK,CAAC,gBAAgB,KAAK,SAAS,CAAC,KAAK,IAAI,KAAK,CAAC,gBAAgB,CAAC,CAAC,CAAC,EAAE;YAChF,IAAI,CAAC,UAAU,GAAG,KAAK,CAAC;YACxB,IAAI,CAAC,WAAW,GAAG,KAAK,CAAC;YACzB,IAAI,CAAC,kBAAkB,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;SACrC;QAED,IAAI,IAAI,CAAC,WAAW,EAAE;YAClB,MAAM,aAAa,GAAG,CAAC,IAAI,CAAC,SAAS,KAAK,IAAI,CAAC,SAAS,IAAI,IAAI,CAAC,kBAAkB,CAAC,CAAC;YAErF,IAAI,KAAK,CAAC,gBAAgB,KAAK,SAAS,CAAC,KAAK,IAAI,KAAK,CAAC,YAAY,CAAC,CAAC,CAAC,EAAE;gBACrE,IAAI,aAAa,EAAE;oBACf,MAAM,KAAK,GAAG,IAAI,CAAC,iBAAiB,CAAC,KAAK,EAAE,CAAC,GAAG,CAAC,KAAK,CAAC,iBAAiB,CAAC,CAAC,CAAC,CAAC,CAAC;oBAC7E,IAAI,CAAC,EAAE,KAAK,KAAK,CAAC,CAAC,GAAG,IAAI,CAAC,WAAW,CAAC,CAAC;oBACxC,IAAI,CAAC,EAAE,KAAK,KAAK,CAAC,CAAC,GAAG,IAAI,CAAC,WAAW,CAAC,CAAC;iBAC3C;gBACD,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,KAAK,CAAC,iBAAiB,CAAC,CAAC,CAAC,CAAC,CAAC;aAC3D;iBAAM,IAAI,KAAK,CAAC,gBAAgB,KAAK,SAAS,CAAC,KAAK,IAAI,KAAK,CAAC,kBAAkB,CAAC,CAAC,CAAC,EAAE;gBAClF,IAAI,aAAa,EAAE;oBACf,MAAM,KAAK,GAAG,IAAI,CAAC,iBAAiB,CAAC,KAAK,EAAE,CAAC,GAAG,CAAC,KAAK,CAAC,iBAAiB,EAAE,CAAC,CAAC;oBAC5E,IAAI,CAAC,EAAE,KAAK,KAAK,CAAC,CAAC,GAAG,IAAI,CAAC,WAAW,CAAC,CAAC;oBACxC,IAAI,CAAC,EAAE,KAAK,KAAK,CAAC,CAAC,GAAG,IAAI,CAAC,WAAW,CAAC,CAAC;iBAC3C;gBACD,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,KAAK,CAAC,iBAAiB,EAAE,CAAC,CAAC;aAC1D;SACJ;KACJ;IAEO,aAAa;QACjB,IAAI,CAAC,IAAI,CAAC,YAAY,EAAE;YACpB,OAAO;SACV;QACD,IAAI,CAAC,IAAI,CAAC,YAAY,EAAE;YACpB,OAAO;SACV;QAED,MAAM,KAAK,GAAG,QAAQ,CAAC,KAAK,CAAC;QAE7B,IAAI,SAAS,GAAW,CAAC,CAAC;QAE1B,IAAI,KAAK,CAAC,gBAAgB,KAAK,SAAS,CAAC,KAAK,IAAI,KAAK,CAAC,aAAa,EAAE,KAAK,CAAC,EAAE;YAC3E,MAAM,IAAI,GAAG,KAAK,CAAC,iBAAiB,CAAC,CAAC,CAAC,CAAC;YACxC,MAAM,IAAI,GAAG,KAAK,CAAC,iBAAiB,CAAC,CAAC,CAAC,CAAC;YACxC,MAAM,QAAQ,GAAG,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC;YAEvC,IAAI,KAAK,CAAC,YAAY,CAAC,CAAC,CAAC,EAAE;;gBAEvB,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC;;gBAGvB,IAAI,CAAC,mBAAmB,GAAG,QAAQ,CAAC;aACvC;iBAAM;gBACH,SAAS,IAAI,CAAC,IAAI,CAAC,mBAAmB,GAAG,QAAQ,IAAI,IAAI,CAAC,cAAc,CAAC,CAAC;gBAC1E,IAAI,CAAC,mBAAmB,GAAG,QAAQ,CAAC;aACvC;SACJ;aAAM,IAAI,KAAK,CAAC,gBAAgB,KAAK,SAAS,CAAC,KAAK,IAAI,KAAK,CAAC,aAAa,EAAE,EAAE;YAC5E,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC;YACvB,SAAS,IAAI,KAAK,CAAC,YAAY,EAAE,CAAC,KAAK,CAAC,CAAC,GAAG,IAAI,CAAC,cAAc,CAAC,CAAC;SACpE;aAAM;YACH,IAAI,CAAC,UAAU,GAAG,KAAK,CAAC;YACxB,IAAI,CAAC,mBAAmB,GAAG,CAAC,CAAC;SAChC;QAED,IAAI,SAAS,KAAK,CAAC,EAAE;YACjB,IAAI,CAAC,aAAa,GAAG,KAAK,CAAC,IAAI,CAAC,aAAa,GAAG,SAAS,EAAE,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,OAAO,CAAC,CAAC;SAC1F;KACJ;IAEO,aAAa;QACjB,IAAI,CAAC,EAAE,GAAG,aAAa,CAAC,IAAI,CAAC,EAAE,EAAE,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,OAAO,CAAC,CAAC;QAC7D,IAAI,CAAC,EAAE,GAAG,aAAa,CAAC,IAAI,CAAC,EAAE,EAAE,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,OAAO,CAAC,CAAC;QAE7D,IAAI,IAAI,CAAC,OAAO,EAAE;YACd,MAAM,QAAQ,GAAG,aAAa,CAC1B,IAAI,CAAC,MAAM,EACX,IAAI,CAAC,aAAa,EAClB,IAAI,OAAO,CACP,IAAI,CAAC,OAAO,GAAG,CAAC,IAAI,CAAC,EAAE,GAAG,IAAI,CAAC,EAAE,EACjC,IAAI,CAAC,OAAO,GAAG,CAAC,IAAI,CAAC,EAAE,GAAG,IAAI,CAAC,EAAE,CACpC,CACJ,CAAC;YAEF,IAAI,CAAC,OAAO,CAAC,UAAU,CAAC,QAAQ,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;YAChD,IAAI,CAAC,OAAO,CAAC,UAAU,CAAC,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;SAC/C;KACJ;IAED,QAAQ;QACJ,KAAK,CAAC,QAAQ,EAAE,CAAC;QAEjB,IAAI,CAAC,QAAQ,CAAC,WAAW,EAAE,IAAI,CAAC,aAAa,CAAC,WAAW,EAAE,IAAI,IAAI,CAAC,MAAM,EAAE;YACxE,IAAI,CAAC,eAAe,EAAE,CAAC;YACvB,IAAI,CAAC,aAAa,EAAE,CAAC;YACrB,IAAI,CAAC,aAAa,EAAE,CAAC;SACxB;KACJ;IAED,YAAY;QACR,KAAK,CAAC,YAAY,EAAE,CAAC;KACxB;IAED,SAAS;QACL,KAAK,CAAC,SAAS,EAAE,CAAC;KACrB;;;ACpTL;;;;MAIa,KAAK;IAOd,YAAY,YAAe;QACvB,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC,MAAM,CAAC,YAAY,CAAC,CAAC;QAC1C,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,MAAM,EAAE,YAAY,CAAC,CAAC;KAC1D;IAPD,IAAI,SAAS;QACT,OAAO,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,MAAM,CAAC;KAC1C;;;;;IAWD,GAAG,CAAoB,OAAgB,EAAE,GAAG,KAAU;QAClD,KAAK,GAAG,IAAI,CAAC,iBAAiB,CAAC,KAAK,CAAC,CAAC;QAEtC,KAAK,MAAM,IAAI,IAAI,KAAK,EAAE;YACtB,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,GAAG,OAAe,CAAC;SACvC;KACJ;;;;IAKD,aAAa,CAAC,KAAa;QACvB,MAAM,IAAI,GAAG,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;QACtC,IAAI,KAAK,IAAI,CAAC,IAAI,KAAK,GAAG,IAAI,CAAC,MAAM,EAAE;YACnC,OAAO,IAAI,CAAC,KAAK,CAAC,CAAC;SACtB;QAED,OAAO,CAAC,KAAK,CAAC,iBAAiB,KAAK,0BAA0B,IAAI,CAAC,MAAM,GAAG,CAAC,GAAG,CAAC,CAAC;QAClF,OAAO,SAAS,CAAC;KACpB;;;;;;IAOD,MAAM,CAAoB,GAAG,KAAU;QACnC,KAAK,GAAG,IAAI,CAAC,iBAAiB,CAAC,KAAK,CAAC,CAAC;QAEtC,KAAK,MAAM,IAAI,IAAI,KAAK,EAAE;YACtB,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,CAAS,CAAC;SAClD;KACJ;;;;;IAMD,IAAI,CAAoB,GAAG,KAAU;QACjC,KAAK,GAAG,IAAI,CAAC,iBAAiB,CAAC,KAAK,CAAC,CAAC;QAEtC,KAAK,MAAM,IAAI,IAAI,KAAK,EAAE;YACtB,IAAI,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,EAAE;gBACnB,OAAO,IAAI,CAAC;aACf;SACJ;QAED,OAAO,KAAK,CAAC;KAChB;;;;;IAMD,KAAK,CAAoB,GAAG,KAAU;QAClC,KAAK,GAAG,IAAI,CAAC,iBAAiB,CAAC,KAAK,CAAC,CAAC;QAEtC,KAAK,MAAM,IAAI,IAAI,KAAK,EAAE;YACtB,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,EAAE;gBACpB,OAAO,KAAK,CAAC;aAChB;SACJ;QAED,OAAO,IAAI,CAAC;KACf;;;;;IAMD,GAAG,CAAoB,GAAG,KAAU;QAChC,KAAK,GAAG,IAAI,CAAC,iBAAiB,CAAC,KAAK,CAAC,CAAC;QAEtC,KAAK,MAAM,IAAI,IAAI,KAAK,EAAE;YACtB,IAAI,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,EAAE;gBACnB,OAAO,KAAK,CAAC;aAChB;SACJ;QAED,OAAO,IAAI,CAAC;KACf;IAED,IAAI,CAAoB,GAAG,KAAU;QACjC,KAAK,GAAG,IAAI,CAAC,iBAAiB,CAAC,KAAK,CAAC,CAAC;QACtC,MAAM,cAAc,GAAG,IAAI,GAAG,CAAU,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC;;QAGlE,KAAK,MAAM,IAAI,IAAI,KAAK,EAAE;YACtB,IAAI,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,EAAE;gBACnB,cAAc,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;aAC/B;iBAAM;;gBAEH,OAAO,KAAK,CAAC;aAChB;SACJ;;QAGD,KAAK,MAAM,IAAI,IAAI,cAAc,EAAE;YAC/B,IAAI,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,EAAE;;gBAEnB,OAAO,KAAK,CAAC;aAChB;SACJ;;QAGD,OAAO,IAAI,CAAC;KACf;IAEO,iBAAiB,CAAoB,KAAU;QACnD,IAAI,CAAC,KAAK,IAAI,KAAK,CAAC,MAAM,KAAK,CAAC,EAAE;;YAE9B,KAAK,GAAG,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAQ,CAAC;SAC3C;QAED,OAAO,KAAK,CAAC;KAChB;IAED,QAAQ;QACJ,OAAO,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;KACtC;;;MC5IQ,OAAO;IAuBhB,YAAY,IAAY,EAAE,aAAyC;;;;QAlBnE,eAAU,GAAG,IAAI,KAAK,CAAC;YACnB,WAAW,EAAE,KAAK;YAClB,UAAU,EAAE,KAAK;SACpB,CAAC,CAAC;;;;QAKH,uBAAkB,GAAY,KAAK,CAAC;QAK5B,gBAAW,GAAW,CAAC,CAAC;QACxB,eAAU,GAAa,EAAE,CAAC;QAK9B,IAAI,CAAC,oBAAoB,GAAG,aAAa,CAAC;QAC1C,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC;QACrB,IAAI,CAAC,KAAK,GAAG,EAAE,CAAC;;QAGhB,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;YAClC,MAAM,CAAC,GAAG,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC;YACnC,IAAI,MAAM,CAAC,SAAS,CAAC,CAAC,CAAC,EAAE;gBACrB,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE;oBAChB,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;iBACvB;qBAAM;oBACH,OAAO,CAAC,KAAK,CAAC,aAAa,CAAC,kCAAkC,CAAC,CAAC;iBACnE;aACJ;iBAAM;gBACH,OAAO,CAAC,KAAK,CAAC,aAAa,CAAC,6FAA6F,CAAC,CAAC;aAC9H;SACJ;QACD,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAC7C,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QACnD,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAE/C,QAAQ,CAAC,IAAI,CAAC,gBAAgB,CAAC,SAAS,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC;QAC3D,QAAQ,CAAC,IAAI,CAAC,gBAAgB,CAAC,YAAY,EAAE,IAAI,CAAC,aAAa,CAAC,CAAC;QACjE,QAAQ,CAAC,IAAI,CAAC,gBAAgB,CAAC,UAAU,EAAE,IAAI,CAAC,WAAW,CAAC,CAAC;KAChE;IA3BD,IAAI,IAAI,KAAa,OAAO,IAAI,CAAC,QAAQ,CAAC,EAAE;IA6BpC,UAAU,CAAC,KAAoB;QACnC,IAAI,CAAC,KAAK,CAAC,MAAM,IAAI,IAAI,CAAC,kBAAkB,EAAE;YAC1C,QAAQ,KAAK,CAAC,GAAG;gBACb,KAAK,GAAG;oBACJ,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC;oBAClB,MAAM;gBACV,KAAK,GAAG;oBACJ,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC;oBAClB,MAAM;gBACV,KAAK,GAAG;oBACJ,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC;oBAClB,MAAM;gBACV,KAAK,GAAG;oBACJ,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC;oBAClB,MAAM;gBACV,KAAK,GAAG;oBACJ,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC;oBAClB,MAAM;aACb;SACJ;KACJ;IAEO,aAAa,CAAC,KAAiB;QACnC,IAAI,CAAC,WAAW,GAAG,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC;QAExC,IAAI,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,aAAa,CAAC,EAAE;YACrC,OAAO,CAAC,GAAG,CAAC,iCAAiC,IAAI,CAAC,WAAW,EAAE,CAAC,CAAC;SACpE;KACJ;IAEO,WAAW,CAAC,KAAiB;QACjC,IAAI,KAAK,CAAC,OAAO,CAAC,MAAM,GAAG,IAAI,CAAC,WAAW,EAAE;YACzC,IAAI,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,aAAa,CAAC,EAAE;gBACrC,OAAO,CAAC,GAAG,CAAC,iCAAiC,IAAI,CAAC,WAAW,EAAE,CAAC,CAAC;aACpE;YAED,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;YACjC,IAAI,CAAC,WAAW,GAAG,CAAC,CAAC;SACxB;KACJ;IAEO,SAAS,CAAC,UAAkB;QAChC,IAAI,UAAU,GAAG,CAAC,EAAE;YAChB,OAAO;SACV;QAED,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;QAEjC,IAAI,IAAI,CAAC,UAAU,CAAC,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC,MAAM,EAAE;YAC5C,IAAI,CAAC,UAAU,CAAC,MAAM,CAAC,CAAC,EAAE,IAAI,CAAC,UAAU,CAAC,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC;SACzE;QAED,IAAI,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,YAAY,CAAC,EAAE;YACpC,OAAO,CAAC,GAAG,CAAC,mBAAmB,IAAI,CAAC,QAAQ,mBAAmB,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC,CAAC;SACrG;QAED,IAAI,IAAI,CAAC,UAAU,CAAC,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC,MAAM,EAAE;;YAE5C,IAAI,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,YAAY,CAAC,EAAE,CAEvC;YACD,OAAO;SACV;QAED,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,UAAU,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;YAC7C,IAAI,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC,IAAI,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE;;gBAErC,OAAO;aACV;SACJ;;QAGD,IAAI,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,YAAY,CAAC,EAAE;YACpC,OAAO,CAAC,GAAG,CAAC,aAAa,IAAI,CAAC,QAAQ,aAAa,CAAC,CAAC;SACxD;QAED,IAAI,CAAC,UAAU,GAAG,EAAE,CAAC;QACrB,IAAI,CAAC,oBAAoB,CAAC,IAAI,CAAC,CAAC;KACnC;IAED,OAAO;QACH,IAAI,CAAC,oBAAoB,GAAG,IAAI,CAAC;QAEjC,QAAQ,CAAC,IAAI,CAAC,mBAAmB,CAAC,SAAS,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC;QAC9D,QAAQ,CAAC,IAAI,CAAC,mBAAmB,CAAC,YAAY,EAAE,IAAI,CAAC,aAAa,CAAC,CAAC;QACpE,QAAQ,CAAC,IAAI,CAAC,mBAAmB,CAAC,UAAU,EAAE,IAAI,CAAC,WAAW,CAAC,CAAC;KACnE;;;MCpIQ,kBAAkB;IAa3B;QATQ,aAAQ,GAAY,KAAK,CAAC;QAU9B,IAAI,CAAC,OAAO,GAAG,QAAQ,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC;QAEhD,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;KAC1C;IAVD,IAAI,YAAY,KAAmB,OAAO,IAAI,CAAC,aAAa,CAAA,EAAE;;IAE9D,IAAI,MAAM,KAAwB,OAAO,IAAI,CAAC,OAAO,CAAA,EAAE;;IAEvD,IAAI,OAAO,KAAc,OAAO,IAAI,CAAC,QAAQ,CAAC,EAAE;;;;;IAWhD,KAAK,CAAC,OAAmC;QACrC,IAAI,IAAI,CAAC,QAAQ,EAAE;YACf,MAAM,IAAI,KAAK,CAAC,GAAG,IAAI,CAAC,WAAW,CAAC,IAAI,sEAAsE,CAAC,CAAC;SACnH;QAED,IAAI,CAAC,aAAa,GAAG,OAAO,CAAC,YAAY,CAAC;QAC1C,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC;QAErB,IAAI,CAAC,aAAa,GAAG,qBAAqB,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;KAC5D;IAEO,OAAO;QACX,IAAI,IAAI,CAAC,QAAQ,IAAI,IAAI,CAAC,aAAa,IAAI,IAAI,CAAC,aAAa,CAAC,SAAS,EAAE,EAAE;YACvE,MAAM,KAAK,GAAG,IAAI,CAAC,aAAa,CAAC,eAAe,EAAE,CAAC;YACnD,IAAI,CAAC,OAAO,CAAC,KAAK,GAAG,KAAK,CAAC,UAAU,CAAC;YACtC,IAAI,CAAC,OAAO,CAAC,MAAM,GAAG,KAAK,CAAC,WAAW,CAAC;YACxC,MAAM,GAAG,GAAG,IAAI,CAAC,OAAO,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC;YAC1C,GAAG,CAAC,SAAS,CAAC,KAAK,EAAE,CAAC,EAAE,CAAC,EAAE,IAAI,CAAC,OAAO,CAAC,KAAK,EAAE,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;YAEpE,IAAI,CAAC,kBAAkB,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;SACzC;QAED,IAAI,CAAC,aAAa,GAAG,qBAAqB,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;KAC5D;IAES,kBAAkB,CAAC,MAAyB;;KAErD;IAED,IAAI;QACA,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC;QAC1B,IAAI,CAAC,QAAQ,GAAG,KAAK,CAAC;QAEtB,IAAI,OAAO,IAAI,CAAC,aAAa,KAAK,QAAQ,EAAE;YACxC,oBAAoB,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;SAC5C;KACJ;IAED,OAAO;QACH,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC;QAC1B,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC;KACvB;;;MClEQ,oBAAqB,SAAQ,kBAAkB;IAMxD;QACI,KAAK,EAAE,CAAC;;;;QAHZ,gBAAW,GAAqB,IAAI,QAAQ,EAAE,CAAC;KAI9C;IAED,KAAK,CAAC,OAAmC;QACrC,KAAK,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC;KACxB;IAES,kBAAkB,CAAC,MAAyB;QAClD,KAAK,CAAC,kBAAkB,CAAC,MAAM,CAAC,CAAC;QAEjC,MAAM,GAAG,GAAG,MAAM,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC;QACpC,MAAM,SAAS,GAAG,GAAG,CAAC,YAAY,CAAC,CAAC,EAAE,CAAC,EAAE,MAAM,CAAC,KAAK,EAAE,MAAM,CAAC,MAAM,CAAC,CAAC;QACtE,MAAM,IAAI,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,EAAE,SAAS,CAAC,KAAK,EAAE,SAAS,CAAC,MAAM,EAAE;YACjE,iBAAiB,EAAE,YAAY;SAClC,CAAC,CAAC;QAEH,IAAI,IAAI,EAAE;YACN,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;SACtC;KACJ;IAED,IAAI;QACA,KAAK,CAAC,IAAI,EAAE,CAAC;KAChB;IAED,OAAO;QACH,KAAK,CAAC,OAAO,EAAE,CAAC;QAEhB,IAAI,CAAC,WAAW,CAAC,kBAAkB,EAAE,CAAC;KACzC;;;MCnCiB,KAAK;IAcvB,YAAY,EAAM,EAAE,YAAuC;QACvD,IAAI,CAAC,GAAG,GAAG,EAAE,CAAC;QACd,IAAI,CAAC,aAAa,GAAG,YAAY,CAAC;KACrC;;;;IAVD,IAAI,EAAE,KAAS,OAAO,IAAI,CAAC,GAAG,CAAA,EAAE;;;;IAKhC,IAAI,YAAY,KAAgC,OAAO,IAAI,CAAC,aAAa,CAAA,EAAE;CAW9E;MAQY,YAAY;IAqCrB,YAAY,IAAY;;;;;;;;QA7BxB,eAAU,GAAW,CAAC,CAAC;QAGf,YAAO,GAAgC,IAAI,GAAG,EAAE,CAAC;QACjD,iBAAY,GAA+B,EAAE,CAAC;QAsBtD,iBAAY,GAAiB,IAAI,QAAQ,EAAE,CAAC;QAC5C,gBAAW,GAAiB,IAAI,QAAQ,EAAE,CAAC;QAGvC,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC;KACrB;;;;IAjBD,IAAI,IAAI,KAAa,OAAO,IAAI,CAAC,KAAK,CAAC,EAAE;;;;IAKzC,IAAI,YAAY,KAAyB,OAAO,IAAI,CAAC,SAAS,CAAC,EAAE;;;;IAKjE,IAAI,kBAAkB,KAA+B,OAAO,IAAI,CAAC,eAAe,CAAC,EAAE;;;;IAYnF,KAAK,CAAC,eAAmB;QACrB,IAAI,IAAI,CAAC,OAAO,EAAE;YACd,OAAO;SACV;QAED,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC;QAEpB,IAAI,CAAC,YAAY,CAAC,eAAe,CAAC,CAAC;QACnC,IAAI,CAAC,MAAM,EAAE,CAAC;KACjB;;;;IAKD,KAAK;QACD,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE;YACf,OAAO;SACV;QAED,IAAI,CAAC,OAAO,GAAG,KAAK,CAAC;KACxB;;;;IAKD,MAAM;QACF,IAAI,IAAI,CAAC,OAAO,EAAE;YACd,OAAO;SACV;QAED,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC;QACpB,IAAI,CAAC,MAAM,EAAE,CAAC;KACjB;;;;IAKD,QAAQ,CAAC,KAAyB;QAC9B,IAAI,IAAI,CAAC,OAAO,EAAE;YACd,MAAM,IAAI,KAAK,CAAC,6DAA6D,CAAC,CAAC;SAClF;QAED,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,EAAE,EAAE,KAAK,CAAC,CAAC;KACrC;;;;IAKD,kBAAkB,CAAC,WAAe,EAAE,OAAgB,EAAE,WAAe;QACjE,IAAI,IAAI,CAAC,OAAO,EAAE;YACd,MAAM,IAAI,KAAK,CAAC,wEAAwE,CAAC,CAAC;SAC7F;QAED,MAAM,UAAU,GAAG,EAAE,WAAW,EAAE,OAAO,EAAE,WAAW,EAAE,CAAC;QAEzD,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,WAAW,CAAC,EAAE;YAChC,MAAM,IAAI,KAAK,CAAC,mCAAmC,WAAW,oDAAoD,CAAC,CAAC;SACvH;QAED,MAAM,YAAY,GAAY,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,CAAC,IAAI,OAAO,CAAC,CAAC,EAAE,UAAU,CAAC,CAAC,CAAC;QAClF,IAAI,CAAC,YAAY,EAAE;YACf,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;SACtC;KACJ;;;;IAKD,QAAQ,CAAC,OAAW;QAChB,OAAO,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;KACpC;;;;IAKD,MAAM;QACF,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE;YACf,OAAO;SACV;QAED,IAAI,CAAC,YAAY,EAAE,CAAC;KACvB;;;;IAKD,gBAAgB,CAAC,OAAW;QACxB,IAAI,CAAC,YAAY,CAAC,OAAO,CAAC,CAAC;KAC9B;;;;IAKD,OAAO;QACH,KAAK,MAAM,CAAC,EAAE,EAAE,KAAK,CAAC,IAAI,IAAI,CAAC,OAAO,EAAE;YACpC,KAAK,CAAC,OAAO,EAAE,CAAC;SACnB;QAED,IAAI,CAAC,OAAO,GAAG,KAAK,CAAC;QACrB,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC;QACtB,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC;QAC3B,IAAI,CAAC,gBAAgB,GAAG,IAAI,CAAC;QAC7B,IAAI,CAAC,YAAY,GAAG,EAAE,CAAC;QACvB,IAAI,CAAC,OAAO,GAAG,IAAI,GAAG,EAAE,CAAC;QACzB,IAAI,CAAC,eAAe,GAAG,IAAI,CAAC;QAE5B,IAAI,CAAC,YAAY,CAAC,kBAAkB,EAAE,CAAC;QACvC,IAAI,CAAC,WAAW,CAAC,kBAAkB,EAAE,CAAC;KACzC;IAEO,YAAY,CAAC,OAAW;QAC5B,IAAI,CAAC,cAAc,GAAG,OAAO,CAAC;;QAG9B,IAAI,CAAC,gBAAgB,GAAG,CAAC,CAAC,CAAC;;QAG3B,IAAI,CAAC,YAAY,EAAE,CAAC;KACvB;IAEO,cAAc,CAAC,OAAgB;QACnC,IAAI,CAAC,IAAI,CAAC,YAAY,EAAE;YACpB,OAAO,IAAI,CAAC;SACf;QAED,MAAM,UAAU,GAAG,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,CAAC,OAAO,KAAK,OAAO,IAAI,CAAC,CAAC,WAAW,KAAK,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,CAAC;QAE7G,IAAI,CAAC,UAAU,EAAE;YACb,MAAM,IAAI,KAAK,CAAC,kBAAkB,IAAI,CAAC,KAAK,oCAAoC,IAAI,CAAC,SAAS,CAAC,EAAE,mBAAmB,OAAO,GAAG,CAAC,CAAC;SACnI;QAED,OAAO,UAAU,CAAC;KACrB;IAEO,YAAY;QAChB,IAAI,IAAI,CAAC,gBAAgB,KAAK,QAAQ,CAAC,IAAI,CAAC,UAAU,EAAE;YACpD,OAAO;SACV;QAED,IAAI,CAAC,gBAAgB,GAAG,QAAQ,CAAC,IAAI,CAAC,UAAU,CAAC;QAEjD,IAAI,IAAI,CAAC,cAAc,EAAE;YACrB,IAAI,IAAI,CAAC,SAAS,EAAE;gBAChB,IAAI,IAAI,CAAC,UAAU,IAAI,CAAC,EAAE;oBACtB,OAAO,CAAC,GAAG,CAAC,kBAAkB,IAAI,CAAC,KAAK,KAAK,IAAI,CAAC,SAAS,CAAC,EAAE,wBAAwB,QAAQ,CAAC,IAAI,CAAC,UAAU,EAAE,CAAC,CAAC;iBACrH;gBAED,IAAI,CAAC,SAAS,CAAC,WAAW,EAAE,CAAC;gBAC7B,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,CAAC;aAC9C;YAED,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;YACvD,IAAI,IAAI,CAAC,SAAS,EAAE;gBAChB,IAAI,IAAI,CAAC,UAAU,IAAI,CAAC,EAAE;oBACtB,OAAO,CAAC,GAAG,CAAC,kBAAkB,IAAI,CAAC,KAAK,KAAK,IAAI,CAAC,SAAS,CAAC,EAAE,yBAAyB,QAAQ,CAAC,IAAI,CAAC,UAAU,EAAE,CAAC,CAAC;iBACtH;gBAED,IAAI,CAAC,SAAS,CAAC,YAAY,EAAE,CAAC;gBAC9B,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,CAAC;aAC/C;iBAAM;gBACH,MAAM,IAAI,KAAK,CAAC,kBAAkB,IAAI,CAAC,KAAK,sBAAsB,IAAI,CAAC,cAAc,SAAS,CAAC,CAAC;aACnG;YAED,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC;SAC9B;QAED,IAAI,IAAI,CAAC,SAAS,EAAE;YAChB,IAAI,IAAI,CAAC,UAAU,IAAI,CAAC,EAAE;gBACtB,OAAO,CAAC,GAAG,CAAC,kBAAkB,IAAI,CAAC,KAAK,KAAK,IAAI,CAAC,SAAS,CAAC,EAAE,0BAA0B,QAAQ,CAAC,IAAI,CAAC,UAAU,EAAE,CAAC,CAAC;aACvH;YAED,MAAM,OAAO,GAAG,IAAI,CAAC,SAAS,CAAC,aAAa,EAAE,CAAC;YAE/C,IAAI,OAAO,EAAE;gBACT,MAAM,UAAU,GAAG,IAAI,CAAC,cAAc,CAAC,OAAO,CAAC,CAAC;gBAChD,IAAI,CAAC,eAAe,GAAG,UAAU,CAAC;gBAElC,IAAI,IAAI,CAAC,UAAU,IAAI,CAAC,EAAE;oBACtB,OAAO,CAAC,GAAG,CAAC,kBAAkB,IAAI,CAAC,KAAK,KAAK,IAAI,CAAC,SAAS,CAAC,EAAE,aAAa,OAAO,kBAAkB,UAAU,CAAC,WAAW,YAAY,QAAQ,CAAC,IAAI,CAAC,UAAU,EAAE,CAAC,CAAC;iBACrK;gBAED,IAAI,CAAC,YAAY,CAAC,UAAU,CAAC,WAAW,CAAC,CAAC;aAC7C;SACJ;KACJ;;;AChQL;;;;MAIa,iBAAiB;IAS1B,YAAY,KAAS;QARb,WAAM,GAAM,IAAI,CAAC;QACjB,eAAU,GAAM,IAAI,CAAC;;;;QAK7B,mBAAc,GAAuC,IAAI,QAAQ,EAAE,CAAC;QAGhE,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC;KACvB;;;;IAKD,IAAI,KAAK;QACL,OAAO,IAAI,CAAC,MAAM,CAAC;KACtB;IAED,IAAI,KAAK,CAAC,GAAM;QACZ,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,MAAM,EAAE,GAAG,CAAC,EAAE;YAC5B,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,MAAM,CAAC;YAC9B,IAAI,CAAC,MAAM,GAAG,GAAG,CAAC;YAElB,IAAI,CAAC,cAAc,CAAC,MAAM,CAAC;gBACvB,QAAQ,EAAE,IAAI,CAAC,MAAM;gBACrB,aAAa,EAAE,IAAI,CAAC,UAAU;aACjC,CAAC,CAAC;SACN;KACJ;;;;IAKD,IAAI,aAAa;QACb,OAAO,IAAI,CAAC,UAAU,CAAC;KAC1B;;;;IAKD,IAAI,QAAQ;QACR,QAAQ,IAAI,CAAC,MAAM,KAAK,IAAI,IAAI,IAAI,CAAC,MAAM,KAAK,SAAS,EAAE;KAC9D;;;ACpDL;;;;MAIsB,UAAU;IAoB5B,YAAY,IAAa,EAAE,aAAuB;QAC9C,IAAI,CAAC,IAAI,GAAG,gBAAgB,CAAC,IAAI,EAAE,cAAc,SAAS,CAAC,YAAY,EAAE,EAAE,CAAC,CAAC;QAC7E,IAAI,CAAC,aAAa,GAAG,gBAAgB,CAAC,aAAa,EAAE,IAAI,CAAC,CAAC;QAC3D,IAAI,CAAC,UAAU,GAAG,IAAI,GAAG,EAAmB,CAAC;KAChD;IARD,IAAI,QAAQ;QACR,OAAO,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC;KAC5B;;;;;IAYD,cAAc,CAAC,SAAkB;QAC7B,IAAI,IAAI,CAAC,KAAK;YAAE,OAAO;QAEvB,SAAS,GAAG,SAAS,IAAI,CAAC,CAAC;QAE3B,IAAI,CAAC,KAAK,GAAG,EAAE,CAAC;QAEhB,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,SAAS,EAAE,CAAC,EAAE,EAAE;YAChC,MAAM,GAAG,GAAG,IAAI,CAAC,gBAAgB,EAAE,CAAC;YACpC,MAAM,EAAE,GAAG,IAAI,CAAC,eAAe,CAAC,GAAG,CAAC,CAAC;YACrC,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,EAAE,EAAE,IAAI,CAAC,CAAC;YAE9B,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;SACxB;QAED,OAAO,IAAI,CAAC;KACf;;;;IAKD,QAAQ;QACJ,IAAI,CAAC,IAAI,CAAC,KAAK,EAAE;YACb,IAAI,CAAC,cAAc,EAAE,CAAC;SACzB;QAED,IAAI,GAAG,GAAM,IAAI,CAAC;QAElB,IAAI,IAAI,CAAC,KAAK,CAAC,MAAM,GAAG,CAAC,EAAE;YACvB,GAAG,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;YACpB,MAAM,CAAC,IAAI,CAAC,KAAK,EAAE,CAAC,IAAI,CAAC,KAAK,GAAG,CAAC,CAAC;SACtC;aAAM;YACH,IAAI,IAAI,CAAC,aAAa,EAAE;gBACpB,OAAO,CAAC,IAAI,CACR,cAAc,EACd,IAAI,CAAC,IAAI,EACT,kEAAkE,CACrE,CAAC;aACL;YACD,GAAG,GAAG,IAAI,CAAC,gBAAgB,EAAE,CAAC;YAC9B,MAAM,EAAE,GAAG,IAAI,CAAC,eAAe,CAAC,GAAG,CAAC,CAAC;YACrC,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,EAAE,EAAE,IAAI,CAAC,CAAC;SACjC;QAED,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC;QAEtB,OAAO,GAAG,CAAC;KACd;;;;;IAMD,OAAO,CAAC,GAAM;QACV,IAAI,CAAC,IAAI,CAAC,KAAK,EAAE;YACb,OAAO,CAAC,IAAI,CACR,iCAAiC,EACjC,GAAG,EACH,SAAS,EACT,IAAI,CAAC,IAAI,EACT,yCAAyC,CAC5C,CAAC;YACF,OAAO,KAAK,CAAC;SAChB;QAED,MAAM,EAAE,GAAG,IAAI,CAAC,eAAe,CAAC,GAAG,CAAC,CAAC;QACrC,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,EAAE,CAAC,EAAE;YAC1B,OAAO,CAAC,IAAI,CACR,iCAAiC,EACjC,GAAG,EACH,SAAS,EACT,IAAI,CAAC,IAAI,EACT,wCAAwC,CAC3C,CAAC;YACF,OAAO,KAAK,CAAC;SAChB;QAED,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;QACrB,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC;QAErB,OAAO,IAAI,CAAC;KACf;;;;IAKD,OAAO;QACH,IAAI,IAAI,CAAC,KAAK,EAAE;YACZ,KAAK,IAAI,CAAC,GAAG,IAAI,CAAC,KAAK,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,EAAE;gBAC7C,IAAI,GAAG,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;gBACxB,IAAI,GAAG,EAAE;oBACL,IAAI,CAAC,iBAAiB,CAAC,GAAG,CAAC,CAAC;iBAC/B;gBAED,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;aAC3B;SACJ;QAED,IAAI,CAAC,UAAU,CAAC,KAAK,EAAE,CAAC;KAC3B;;;AC5GL;;;;;;;;;;IAUiB,gBAiUhB;AAjUD,WAAiB,eAAe;;;;IAKjB,yBAAS,GAAiC,IAAI,GAAG,EAAE,CAAC;;;;;IAMpD,0BAAU,GAAW,CAAC,CAAC;IAEvB,yBAAS,GAAgB,EAAE,CAAC;;;;IAKvC,IAAI,aAAa,GAAqB,IAAI,GAAG,EAAE,CAAC;IAEhD,SAAS,OAAO,CAAC,SAAoB;QACjC,IAAI,MAAM,IAAI,SAAS,EAAE;YACrB,OAAO,SAAS,CAAC,IAAI,CAAC;SACzB;aAAM;YACH,IAAI,IAAI,GAAG,aAAa,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC;YACxC,IAAI,CAAC,IAAI,EAAE;gBACP,IAAI,GAAG,SAAS,CAAC,YAAY,EAAE,CAAC;gBAChC,aAAa,CAAC,GAAG,CAAC,SAAS,EAAE,IAAI,CAAC,CAAC;aACtC;YAED,OAAO,IAAI,CAAC;SACf;KACJ;IAED,SAAS,OAAO,CAAC,SAAoB;QACjC,IAAI,MAAM,IAAI,SAAS,EAAE;YACrB,OAAO,SAAS,CAAC,IAAI,CAAC;SACzB;aAAM,IAAI,SAAS,YAAY,QAAQ,EAAE;YACtC,OAAO,UAAU,CAAC;SACrB;aAAM;YACH,OAAO,SAAS,CAAC;SACpB;KACJ;IAED,SAAS,OAAO,CAAC,SAAoB;QACjC,IAAI,MAAM,IAAI,SAAS,EAAE;YACrB,OAAO,SAAS,CAAC,IAAI,CAAC;SACzB;aAAM,IAAI,SAAS,YAAY,QAAQ,EAAE;YACtC,OAAO,UAAU,CAAC;SACrB;aAAM;YACH,OAAO,cAAc,CAAC;SACzB;KACJ;;;;;IAMD,SAAS,cAAc,CAAC,KAAU,EAAE,UAAkC;QAClE,IAAI,CAAC,KAAK,EAAE;YACR,OAAO;SACV;;QAGD,IAAI,KAAK,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE;YACtB,KAAK,CAAC,OAAO,CAAC,QAAQ,IAAI,cAAc,CAAC,QAAQ,EAAE,UAAU,CAAC,CAAC,CAAC;YAChE,OAAO;SACV;QAED,IAAI,SAAS,IAAI,KAAK,IAAI,KAAK,YAAY,QAAQ,EAAE;YACjD,UAAU,CAAC,GAAG,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE,KAAK,CAAC,CAAC;SACzC;QAED,IAAI,KAAK,YAAY,QAAQ,EAAE;YAC3B,IAAI,KAAK,YAAY,IAAI,EAAE;gBACvB,cAAc,CAAC,KAAK,CAAC,QAAQ,EAAE,UAAU,CAAC,CAAC;gBAC3C,cAAc,CAAC,KAAK,CAAC,QAAQ,EAAE,UAAU,CAAC,CAAC;gBAE3C,IAAI,KAAK,YAAY,WAAW,EAAE;oBAC9B,cAAc,CAAC,KAAK,CAAC,QAAQ,EAAE,UAAU,CAAC,CAAC;iBAC9C;aACJ;YAED,cAAc,CAAC,KAAK,CAAC,QAAQ,EAAE,UAAU,CAAC,CAAC;SAC9C;aAAM,IAAI,KAAK,YAAY,QAAQ,EAAE;;YAElC,KAAK,MAAM,KAAK,IAAI,MAAM,CAAC,MAAM,CAAC,KAAK,CAAC,EAAE;gBACtC,IAAI,KAAK,YAAY,OAAO,EAAE;oBAC1B,cAAc,CAAC,KAAK,EAAE,UAAU,CAAC,CAAC;iBACrC;aACJ;;YAGD,IAAI,UAAU,IAAI,KAAK,EAAE;gBACrB,MAAM,QAAQ,GAAS,KAAM,CAAC,QAAQ,CAAC;gBACvC,KAAK,MAAM,OAAO,IAAI,MAAM,CAAC,MAAM,CAAC,QAAQ,CAAC,EAAE;oBAC3C,IAAI,OAAO,EAAE;wBACT,MAAM,YAAY,GAAS,OAAQ,CAAC,KAAK,CAAC;wBAC1C,IAAI,YAAY,YAAY,OAAO,IAAI,KAAK,CAAC,OAAO,CAAC,YAAY,CAAC,EAAE;4BAChE,cAAc,CAAC,YAAY,EAAE,UAAU,CAAC,CAAC;yBAC5C;qBACJ;iBACJ;aACJ;SACJ;KACJ;IAED,SAAgB,cAAc;QAC1B,MAAM,WAAW,GAAgB;YAC7B,QAAQ,EAAE,CAAC;YACX,QAAQ,EAAE,CAAC;YACX,QAAQ,EAAE,CAAC;YACX,OAAO,EAAE,CAAC;YACV,QAAQ,EAAE,CAAC;YACX,OAAO,EAAE,CAAC;SACb,CAAA;QAED,gBAAA,SAAS,CAAC,OAAO,CAAC,CAAC,QAAQ;YACvB,MAAM,KAAK,GAAG,QAAQ,CAAC,KAAK,CAAC;YAE7B,IAAI,KAAK,YAAY,QAAQ,EAAE;gBAC3B,WAAW,CAAC,QAAQ,EAAE,CAAC;aAC1B;iBAAM,IAAI,KAAK,YAAY,QAAQ,EAAE;gBAClC,WAAW,CAAC,QAAQ,EAAE,CAAC;aAC1B;iBAAM,IAAI,KAAK,YAAY,QAAQ,IAAI,KAAK,YAAY,cAAc,EAAE;gBACrE,WAAW,CAAC,QAAQ,EAAE,CAAC;aAC1B;iBAAM,IAAI,KAAK,YAAY,OAAO,EAAE;gBACjC,WAAW,CAAC,OAAO,EAAE,CAAC;aACzB;iBAAM,IAAI,KAAK,YAAY,QAAQ,EAAE;gBAClC,WAAW,CAAC,QAAQ,EAAE,CAAC;aAC1B;iBAAM;gBACH,WAAW,CAAC,OAAO,EAAE,CAAC;aACzB;SACJ,CAAC,CAAC;QAEH,OAAO,WAAW,CAAC;KACtB;IA7Be,8BAAc,iBA6B7B,CAAA;;;;;;IAOD,SAAgB,YAAY;QACxB,MAAM,QAAQ,GAAc;YACxB,cAAc,EAAE,EAAE;SACrB,CAAC;QAEF,gBAAA,SAAS,CAAC,OAAO,CAAC,CAAC,QAAQ;YACvB,QAAQ,CAAC,cAAc,CAAC,IAAI,CAAC;gBACzB,IAAI,EAAE,OAAO,CAAC,QAAQ,CAAC,KAAK,CAAC;gBAC7B,IAAI,EAAE,OAAO,CAAC,QAAQ,CAAC,KAAK,CAAC;gBAC7B,IAAI,EAAE,OAAO,CAAC,QAAQ,CAAC,KAAK,CAAC;gBAC7B,cAAc,EAAE,QAAQ,CAAC,cAAc;aAC1C,CAAC,CAAC;SACN,CAAC,CAAC;QAEH,gBAAA,SAAS,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;QAEzB,OAAO,QAAQ,CAAC;KACnB;IAjBe,4BAAY,eAiB3B,CAAA;IAED,SAAgB,cAAc;QAC1B,gBAAA,SAAS,GAAG,EAAE,CAAC;KAClB;IAFe,8BAAc,iBAE7B,CAAA;IAED,SAAgB,sBAAsB;QAClC,IAAI,gBAAA,SAAS,CAAC,MAAM,IAAI,CAAC,EAAE;YACvB,OAAO,eAAe,CAAC,gBAAA,SAAS,CAAC,gBAAA,SAAS,CAAC,MAAM,GAAG,CAAC,CAAC,EAAE,gBAAA,SAAS,CAAC,gBAAA,SAAS,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC;SAC5F;aAAM;YACH,OAAO,CAAC,IAAI,CAAC,4DAA4D,CAAC,CAAC;SAC9E;KACJ;IANe,sCAAsB,yBAMrC,CAAA;IAED,SAAgB,eAAe,CAAC,SAAoB,EAAE,SAAoB;QACtE,MAAM,IAAI,GAAG,KAAK,CAAC,IAAI,CAAC,IAAI,GAAG,CAAC,SAAS,CAAC,cAAc,CAAC,CAAC,CAAC;QAC3D,MAAM,IAAI,GAAG,KAAK,CAAC,IAAI,CAAC,IAAI,GAAG,CAAC,SAAS,CAAC,cAAc,CAAC,CAAC,CAAC;;QAG3D,MAAM,IAAI,GAAG,EAAE,CAAC;QAChB,KAAK,MAAM,KAAK,IAAI,IAAI,EAAE;YACtB,MAAM,MAAM,GAAG,IAAI,CAAC,IAAI,CAAC,IAAI,IAAI,IAAI,CAAC,IAAI,KAAK,KAAK,CAAC,IAAI,CAAC,CAAC;YAC3D,IAAI,CAAC,MAAM,EAAE;gBACT,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;aACpB;SACJ;QAED,OAAO,IAAI,CAAC;KACf;IAde,+BAAe,kBAc9B,CAAA;IAED,SAAgB,2BAA2B;QACvC,IAAI,gBAAA,SAAS,CAAC,MAAM,IAAI,CAAC,EAAE;YACvB,OAAO,oBAAoB,CAAC,gBAAA,SAAS,CAAC,gBAAA,SAAS,CAAC,MAAM,GAAG,CAAC,CAAC,EAAE,gBAAA,SAAS,CAAC,gBAAA,SAAS,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC;SACjG;aAAM;YACH,OAAO,CAAC,IAAI,CAAC,iEAAiE,CAAC,CAAC;SACnF;KACJ;IANe,2CAA2B,8BAM1C,CAAA;IAED,SAAgB,oBAAoB,CAAC,SAAoB,EAAE,SAAoB;QAC3E,MAAM,IAAI,GAAG,KAAK,CAAC,IAAI,CAAC,IAAI,GAAG,CAAC,SAAS,CAAC,cAAc,CAAC,CAAC,CAAC;QAC3D,MAAM,IAAI,GAAG,KAAK,CAAC,IAAI,CAAC,IAAI,GAAG,CAAC,SAAS,CAAC,cAAc,CAAC,CAAC,CAAC;;QAG3D,MAAM,SAAS,GAAG,EAAE,CAAC;QACrB,KAAK,MAAM,KAAK,IAAI,IAAI,EAAE;YACtB,MAAM,MAAM,GAAG,IAAI,CAAC,IAAI,CAAC,IAAI,IAAI,IAAI,CAAC,IAAI,KAAK,KAAK,CAAC,IAAI,CAAC,CAAC;YAC3D,IAAI,MAAM,EAAE;gBACR,SAAS,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;aACzB;SACJ;QAED,OAAO,SAAS,CAAC;KACpB;IAde,oCAAoB,uBAcnC,CAAA;;;;IAKD,SAAgB,KAAK,CAAC,KAAU;QAC5B,MAAM,UAAU,GAAG,IAAI,GAAG,EAAqB,CAAC;QAChD,cAAc,CAAC,KAAK,EAAE,UAAU,CAAC,CAAC;QAElC,IAAI,UAAU,IAAI,UAAU,CAAC,IAAI,GAAG,CAAC,EAAE;YACnC,UAAU,CAAC,OAAO,CAAC,CAAC,KAAK,EAAE,IAAI;gBAC3B,IAAI,QAAQ,GAAoB,gBAAA,SAAS,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;gBAEpD,IAAI,QAAQ,EAAE;oBACV,QAAQ,CAAC,cAAc,EAAE,CAAC;iBAC7B;qBAAM;oBACH,QAAQ,GAAG;wBACP,KAAK,EAAE,KAAK;wBACZ,cAAc,EAAE,CAAC;qBACpB,CAAC;oBAEF,gBAAA,SAAS,CAAC,GAAG,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE,QAAQ,CAAC,CAAC;iBAC3C;gBAED,IAAI,gBAAA,UAAU,IAAI,CAAC,EAAE;oBACjB,OAAO,CAAC,GAAG,CAAC,uCAAuC,KAAK,CAAC,WAAW,CAAC,IAAI,WAAW,OAAO,CAAC,KAAK,CAAC,eAAe,QAAQ,CAAC,cAAc,EAAE,CAAC,CAAC;iBAC/I;gBACD,IAAI,gBAAA,UAAU,IAAI,CAAC,EAAE;oBACjB,OAAO,CAAC,GAAG,CAAC,uCAAuC,IAAI,CAAC,SAAS,CAAC,cAAc,EAAE,CAAC,EAAE,CAAC,CAAC;iBAC1F;aACJ,CAAC,CAAC;SACN;KACJ;IA3Be,qBAAK,QA2BpB,CAAA;;;;IAKD,SAAgB,OAAO,CAAC,KAAU;QAC9B,MAAM,UAAU,GAAG,IAAI,GAAG,EAAqB,CAAC;QAChD,cAAc,CAAC,KAAK,EAAE,UAAU,CAAC,CAAC;QAElC,IAAI,UAAU,IAAI,UAAU,CAAC,IAAI,GAAG,CAAC,EAAE;YACnC,UAAU,CAAC,OAAO,CAAC,CAAC,KAAK,EAAE,IAAI;;;gBAG3B,MAAM,QAAQ,GAAG,gBAAA,SAAS,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;gBAErC,IAAI,QAAQ,EAAE;oBACV,IAAI,QAAQ,CAAC,cAAc,GAAG,CAAC,EAAE;wBAC7B,QAAQ,CAAC,cAAc,EAAE,CAAC;wBAE1B,IAAI,gBAAA,UAAU,IAAI,CAAC,EAAE;4BACjB,OAAO,CAAC,GAAG,CAAC,+DAA+D,KAAK,CAAC,WAAW,CAAC,IAAI,WAAW,OAAO,CAAC,KAAK,CAAC,eAAe,QAAQ,CAAC,cAAc,EAAE,CAAC,CAAC;yBACvK;qBACJ;oBAED,IAAI,QAAQ,CAAC,cAAc,IAAI,CAAC,EAAE;wBAC9B,IAAI,gBAAA,UAAU,IAAI,CAAC,EAAE;4BACjB,OAAO,CAAC,GAAG,CAAC,yCAAyC,KAAK,CAAC,WAAW,CAAC,IAAI,WAAW,OAAO,CAAC,KAAK,CAAC,EAAE,CAAC,CAAC;yBAC3G;wBAED,IAAI,KAAK,YAAY,QAAQ,EAAE;4BAC3B,IAAI,KAAK,CAAC,MAAM,EAAE;gCACd,KAAK,CAAC,MAAM,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;6BAC9B;yBACJ;wBAED,IAAI,SAAS,IAAI,KAAK,EAAE;4BACpB,KAAK,CAAC,OAAO,EAAE,CAAC;yBACnB;;wBAGD,gBAAA,SAAS,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;;wBAGvB,aAAa,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;wBAE5B,IAAI,gBAAA,UAAU,IAAI,CAAC,EAAE;4BACjB,OAAO,CAAC,GAAG,CAAC,uCAAuC,IAAI,CAAC,SAAS,CAAC,cAAc,EAAE,CAAC,EAAE,CAAC,CAAC;yBAC1F;qBACJ;iBACJ;aACJ,CAAC,CAAC;SACN;KACJ;IA/Ce,uBAAO,UA+CtB,CAAA;;;;IAKD,SAAgB,OAAO;QACnB,gBAAA,SAAS,CAAC,OAAO,CAAC,CAAC,QAAQ,EAAE,IAAI;YAC7B,MAAM,KAAK,GAAG,QAAQ,CAAC,KAAK,CAAC;YAE7B,OAAO,CAAC,KAAK,CAAC,CAAC;YACf,IAAI,KAAK,YAAY,QAAQ,EAAE;gBAC3B,IAAI,KAAK,CAAC,MAAM,EAAE;oBACd,KAAK,CAAC,MAAM,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;iBAC9B;aACJ;YAED,IAAI,SAAS,IAAI,KAAK,EAAE;gBACpB,KAAK,CAAC,OAAO,EAAE,CAAC;aACnB;SACJ,CAAC,CAAC;QAEH,gBAAA,SAAS,GAAG,IAAI,GAAG,EAAE,CAAC;QACtB,gBAAA,SAAS,GAAG,EAAE,CAAC;QACf,aAAa,GAAG,IAAI,GAAG,EAAE,CAAC;KAC7B;IAnBe,uBAAO,UAmBtB,CAAA;AACL,CAAC,EAjUgB,eAAe,KAAf,eAAe;;MCnCnB,YAAa,SAAQ,UAAoB;IAGlD,YACI,YAAsB,EACtB,IAAa,EACb,aAAuB;QAEvB,KAAK,CAAC,IAAI,EAAE,aAAa,CAAC,CAAC;QAE3B,IAAI,CAAC,aAAa,GAAG,YAAY,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;QAC9C,IAAI,CAAC,aAAa,CAAC,MAAM,GAAG,IAAI,CAAC;QAEjC,eAAe,CAAC,KAAK,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;KAC7C;IAES,WAAW,CAAC,GAAa;;KAElC;IAES,UAAU,CAAC,GAAa;QAC9B,IAAI,GAAG,CAAC,MAAM,EAAE;;YAEZ,GAAG,CAAC,MAAM,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;YACvB,GAAG,CAAC,MAAM,GAAG,IAAI,CAAC;SACrB;KACJ;IAES,gBAAgB;QACtB,MAAM,GAAG,GAAG,IAAI,CAAC,aAAa,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;QAC3C,eAAe,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;QAE3B,OAAO,GAAG,CAAC;KACd;IAES,eAAe,CAAC,GAAa;QACnC,OAAO,GAAG,CAAC,IAAI,CAAC;KACnB;IAES,iBAAiB,CAAC,GAAa;QACrC,eAAe,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;KAChC;;;ACvCL;;;;MAIa,eAAe;IAIxB,YAAY,iBAAwD;QAH5D,eAAU,GAAG,IAAI,GAAG,EAAa,CAAC;QAItC,IAAI,CAAC,UAAU,GAAG,iBAAiB,CAAC;KACvC;IAED,GAAG,CAAC,IAAY,EAAE,MAAqB;QACnC,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE;YAC5B,MAAM,QAAQ,GAAG,IAAI,IAAI,CAAC,UAAU,CAAC,IAAI,EAAE,MAAM,CAAC,CAAC;YACnD,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,QAAQ,CAAC,IAAI,EAAE,QAAQ,CAAC,CAAC;SAChD;KACJ;IAED,MAAM,CAAC,IAAY;QACf,IAAI,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE;YAC3B,MAAM,QAAQ,GAAG,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;YAC3C,QAAQ,CAAC,MAAM,EAAE,CAAC;YAClB,IAAI,CAAC,UAAU,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;SAChC;KACJ;IAED,GAAG,CAAC,IAAY;QACZ,OAAO,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;KACpC;IAED,KAAK;QACD,OAAO,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC;KAC/B;IAEK,GAAG,CAAC,IAAY;;YAClB,IAAI,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE;gBAC3B,MAAM,QAAQ,GAAG,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;gBAC3C,IAAI,CAAC,QAAQ,CAAC,MAAM,EAAE;oBAClB,MAAM,QAAQ,CAAC,IAAI,EAAE,CAAC;iBACzB;gBACD,OAAO,QAAQ,CAAC;aACnB;iBAAM;gBACH,MAAM,IAAI,KAAK,CAAC,2BAA2B,IAAI,EAAE,CAAC,CAAC;aACtD;SACJ;KAAA;IAED,MAAM,CAAC,IAAY;QACf,OAAO,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;KACpC;;;;IAKD,eAAe;QACX,IAAI,IAAI,CAAC,UAAU,CAAC,IAAI,GAAG,CAAC,EAAE;YAC1B,IAAI,MAAM,GAAG,CAAC,CAAC;YAEf,KAAK,MAAM,CAAC,YAAY,EAAE,QAAQ,CAAC,IAAI,IAAI,CAAC,UAAU,EAAE;gBACpD,MAAM,IAAI,QAAQ,CAAC,QAAQ,CAAC;aAC/B;YAED,OAAO,MAAM,GAAG,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC;SACxC;aAAM;YACH,OAAO,CAAC,CAAC;SACZ;KACJ;IAEK,OAAO;;YACT,IAAI,IAAI,CAAC,UAAU,CAAC,IAAI,GAAG,CAAC,EAAE;gBAC1B,MAAM,SAAS,GAAyB,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,MAAM,EAAE,CAAC,CAAC;gBAC7E,MAAM,OAAO,CAAC,GAAG,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC;aACnD;SACJ;KAAA;;;;IAKD,SAAS;QACL,IAAI,IAAI,CAAC,UAAU,CAAC,IAAI,GAAG,CAAC,EAAE;YAC1B,MAAM,SAAS,GAAyB,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,MAAM,EAAE,CAAC,CAAC;YAC7E,KAAK,IAAI,QAAQ,IAAI,SAAS,EAAE;gBAC5B,IAAI,CAAC,QAAQ,CAAC,MAAM,EAAE;oBAClB,OAAO,KAAK,CAAC;iBAChB;aACJ;YACD,OAAO,IAAI,CAAC;SACf;aAAM;YACH,OAAO,IAAI,CAAC;SACf;KACJ;;;;IAKD,SAAS;QACL,MAAM,GAAG,GAAG,IAAI,GAAG,EAAmB,CAAC;QAEvC,KAAK,MAAM,CAAC,YAAY,EAAE,QAAQ,CAAC,IAAI,IAAI,CAAC,UAAU,EAAE;YACpD,GAAG,CAAC,GAAG,CAAC,YAAY,EAAE,QAAQ,CAAC,MAAM,CAAC,CAAC;SAC1C;QAED,OAAO,GAAG,CAAC;KACd;IAED,OAAO;QACH,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC,QAAQ;YAC7B,QAAQ,CAAC,OAAO,EAAE,CAAC;SACtB,CAAC,CAAC;QAEH,IAAI,CAAC,UAAU,GAAG,IAAI,GAAG,EAAE,CAAC;KAC/B;;;AChHL;;;;;MAKsB,QAAQ;IAwB1B,YAAY,IAAY,EAAE,MAAS;QAvB3B,UAAK,GAAW,SAAS,CAAC;QAC1B,YAAO,GAAY,KAAK,CAAC;QACzB,iBAAY,GAA4B,IAAI,CAAC;QAC7C,YAAO,GAAM,IAAI,CAAC;QAEhB,cAAS,GAAW,CAAC,CAAC;QAmB5B,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC;KACrB;IAlBD,IAAI,IAAI;QACJ,OAAO,IAAI,CAAC,KAAK,CAAC;KACrB;IAED,IAAI,MAAM;QACN,OAAO,IAAI,CAAC,OAAO,CAAC;KACvB;IAED,IAAI,QAAQ;QACR,OAAO,IAAI,CAAC,SAAS,CAAC;KACzB;IAED,IAAI,MAAM;QACN,OAAO,IAAI,CAAC,OAAO,CAAC;KACvB;IAMK,IAAI;;YACN,IAAI;gBACA,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE;oBACf,IAAI,CAAC,IAAI,CAAC,YAAY,EAAE;wBACpB,IAAI,CAAC,YAAY,GAAG,IAAI,OAAO,CAAC,CAAC,OAAO;4BACpC,IAAI,CAAC,WAAW,EAAE,CAAC,IAAI,CAAC,CAAC,MAAM;gCAC3B,IAAI,CAAC,OAAO,GAAG,MAAM,CAAC;gCACtB,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC;gCACpB,IAAI,CAAC,SAAS,GAAG,CAAC,CAAC;gCACnB,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC;gCAEzB,OAAO,CAAC,IAAI,CAAC,CAAC;6BACjB,CAAC,CAAC;yBACN,CAAC,CAAC;qBACN;oBAED,OAAO,IAAI,CAAC,YAAY,CAAC;iBAC5B;qBAAM;oBACH,OAAO,IAAI,CAAC;iBACf;aACJ;YAAC,OAAM,KAAK,EAAE;gBACX,IAAI,CAAC,OAAO,GAAG,KAAK,CAAC;gBACrB,IAAI,CAAC,SAAS,GAAG,CAAC,CAAC;gBACnB,OAAO,CAAC,KAAK,CAAC,2BAA2B,IAAI,CAAC,IAAI,GAAG,CAAC,CAAC;gBACvD,OAAO,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;aACxB;SACJ;KAAA;IAED,MAAM;QACF,IAAI,IAAI,CAAC,OAAO,EAAE;YACd,IAAI,CAAC,aAAa,EAAE,CAAC;SACxB;QACD,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC;QACpB,IAAI,CAAC,SAAS,GAAG,CAAC,CAAC;KACtB;IAED,OAAO;QACH,IAAI,CAAC,MAAM,EAAE,CAAC;KACjB;;;MCnEQ,aAAc,SAAQ,QAA4B;IAI3D,YAAY,IAAY,EAAE,MAAoB;QAC1C,KAAK,CAAC,IAAI,EAAE,MAAM,CAAC,CAAC;QAEpB,IAAI,CAAC,IAAI,GAAG,MAAM,CAAC,GAAG,CAAC;QACvB,IAAI,CAAC,KAAK,GAAG,gBAAgB,CAAC,MAAM,CAAC,IAAI,EAAE,KAAK,CAAC,CAAC;KACrD;IAES,WAAW;QACjB,OAAO,IAAI,OAAO,EAAQ,CAAC,OAA8B,EAAE,MAAM;YAC7D,MAAM,IAAI,GAAG,IAAI,IAAI,CAAC;gBAClB,GAAG,EAAE,IAAI,CAAC,IAAI;gBACd,IAAI,EAAE,IAAI,CAAC,KAAK;gBAChB,MAAM,EAAE;oBACJ,OAAO,CAAC,IAAI,CAAC,CAAC;iBACjB;gBACD,WAAW,EAAE,CAAC,OAAe,EAAE,KAAU;oBACrC,MAAM,CAAC,KAAK,CAAC,CAAC;iBACjB;aACJ,CAAC,CAAC;SACN,EAAE,CAAC;KACP;IAES,aAAa;QACnB,IAAI,CAAC,MAAM,CAAC,MAAM,EAAE,CAAC;KACxB;;;MChCQ,UAAU;IAgBnB,YAAY,KAAe,EAAE,KAAsB;QAC/C,IAAI,CAAC,OAAO,GAAG,KAAK,CAAC;QACrB,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC;QACpB,eAAe,CAAC,KAAK,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;KACvC;;;;;;IAXD,IAAI,MAAM,KAAe,OAAO,IAAI,CAAC,OAAO,CAAC,EAAE;;;;IAK/C,IAAI,KAAK,KAAsB,OAAO,IAAI,CAAC,MAAM,CAAC,EAAE;;;;;;;;;;IAiBpD,KAAK,CAAC,eAAwB;QAC1B,IAAI,eAAe,EAAE;YACjB,MAAM,WAAW,GAAG,IAAI,CAAC,MAAM,CAAC,eAAe,CAAC,eAAe,CAAC,CAAC;YACjE,IAAI,WAAW,EAAE;;gBAEb,MAAM,KAAK,GAAG,aAAa,CAAC,KAAK,CAAC,WAAW,CAAa,CAAC;gBAC3D,KAAK,CAAC,IAAI,GAAG,GAAG,KAAK,CAAC,IAAI,UAAU,CAAC;gBACrC,OAAO,KAAK,CAAC;aAChB;iBAAM;gBACH,MAAM,IAAI,KAAK,CAAC,qCAAqC,eAAe,kBAAkB,IAAI,CAAC,OAAO,EAAE,CAAC,CAAC;aACzG;SACJ;aAAM;;YAEH,MAAM,KAAK,GAAG,aAAa,CAAC,KAAK,CAAC,IAAI,CAAC,OAAO,CAAa,CAAC;YAC5D,KAAK,CAAC,IAAI,GAAG,GAAG,KAAK,CAAC,IAAI,UAAU,CAAC;YACrC,OAAO,KAAK,CAAC;SAChB;KACJ;IAED,OAAO;QACH,eAAe,CAAC,OAAO,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;KACzC;;;MCvCQ,YAAa,SAAQ,QAAiC;IAQ/D,YAAY,IAAY,EAAE,MAAmB;QACzC,KAAK,CAAC,IAAI,EAAE,MAAM,CAAC,CAAC;QAEpB,IAAI,CAAC,QAAQ,GAAG,MAAM,CAAC,OAAO,CAAC;QAC/B,IAAI,CAAC,OAAO,GAAG,MAAM,CAAC,MAAM,CAAC;QAC7B,IAAI,CAAC,YAAY,GAAG,MAAM,CAAC,WAAW,CAAC;KAC1C;IAES,WAAW;QACjB,OAAO,IAAI,OAAO,CAAa,CAAC,OAAoC,EAAE,MAAM;YACxE,MAAM,cAAc,GAAG,IAAI,cAAc,EAAE,CAAC;YAE5C,cAAc,CAAC,cAAc,CAAC,CAAC,GAAG;gBAC9B,IAAI,GAAG,CAAC,UAAU,CAAC,OAAO,CAAC,EAAE;;oBAEzB,OAAO,GAAG,CAAC;iBACd;gBACD,IAAI,GAAG,CAAC,UAAU,CAAC,OAAO,CAAC,EAAE;;oBAEzB,OAAO,GAAG,CAAC;iBACd;;gBAGD,MAAM,QAAQ,GAAG,WAAW,CAAC,GAAG,CAAC,CAAC;gBAClC,MAAM,GAAG,GAAG,YAAY,CAAC,GAAG,CAAC,CAAC;gBAE9B,IAAI,QAAQ,KAAK,uBAAuB,IAAI,QAAQ,KAAK,oBAAoB,IAAI,QAAQ,KAAK,kBAAkB,EAAE;;oBAE9G,OAAO,GAAG,CAAC;iBACd;gBAED,IAAI,WAAW,GAAW,IAAI,CAAC;gBAE/B,IAAI,GAAG,KAAK,MAAM,IAAI,GAAG,KAAK,KAAK,EAAE;oBACjC,WAAW,GAAG,IAAI,CAAC,QAAQ,CAAC;iBAC/B;qBAAM,IAAI,GAAG,KAAK,KAAK,EAAE;oBACtB,IAAI,IAAI,CAAC,OAAO,EAAE;wBACd,WAAW,GAAG,IAAI,CAAC,OAAO,CAAC;qBAC9B;iBACJ;qBAAM;;oBAEH,IAAI,IAAI,CAAC,YAAY,EAAE;wBACnB,IAAI,aAAa,CAAC,IAAI,CAAC,YAAY,CAAC,EAAE;4BAClC,IAAI,CAAC,YAAY,CAAC,8BAA8B,EAAE;gCAC9C,OAAO,CAAC,IAAI,CAAC;;;iCAGZ,CAAC,CAAC;gCAEH,YAAY,CAAC,8BAA8B,GAAG,IAAI,CAAC;6BACtD;4BAED,WAAW,GAAG,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,CAAC,UAAU,KAAK,QAAQ,KAAK,WAAW,CAAC,UAAU,CAAC,CAAC,CAAC;yBAC9F;6BAAM;4BACH,MAAM,eAAe,GAAG,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,CAAC,EAAE,KAAK,QAAQ,KAAK,EAAE,CAAC,QAAQ,CAAC,CAAC;4BACjF,IAAI,eAAe,EAAE;gCACjB,WAAW,GAAG,eAAe,CAAC,WAAW,CAAC;6BAC7C;yBACJ;qBACJ;iBACJ;gBAED,IAAI,CAAC,WAAW,EAAE;oBACd,OAAO,CAAC,KAAK,CAAC,kBAAkB,IAAI,CAAC,IAAI,sCAAsC,GAAG,EAAE,CAAC,CAAC;iBACzF;gBAED,OAAO,WAAW,CAAC;aACtB,CAAC,CAAC;YAEH,MAAM,UAAU,GAAG,IAAI,UAAU,CAAC,cAAc,CAAC,CAAC;YAElD,IAAI,CAAC,YAAY,CAAC,YAAY,EAAE;gBAC5B,YAAY,CAAC,YAAY,GAAG,IAAI,WAAW,CAAC,cAAc,CAAC,CAAC;gBAC5D,YAAY,CAAC,YAAY,CAAC,cAAc,CAAC,eAAe,CAAC,CAAC;gBAC1D,YAAY,CAAC,YAAY,CAAC,gBAAgB,CAAC,EAAE,IAAI,EAAE,IAAI,EAAE,CAAC,CAAC;aAC9D;YACD,UAAU,CAAC,cAAc,CAAC,YAAY,CAAC,YAAY,CAAC,CAAC;YAErD,UAAU,CAAC,IAAI,CACX,IAAI,CAAC,QAAQ,EACb,CAAC,IAAI;gBACD,MAAM,MAAM,GAAG,IAAI,UAAU,CAAC,IAAI,CAAC,KAAK,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC;gBAC3D,OAAO,CAAC,MAAM,CAAC,CAAC;aACnB,EACD,CAAC,aAAa;gBACV,IAAI,CAAC,SAAS,GAAG,aAAa,CAAC,MAAM,GAAG,aAAa,CAAC,KAAK,CAAC;aAC/D,EACD,CAAC,UAAU;gBACP,OAAO,CAAC,KAAK,CAAC,kBAAkB,IAAI,CAAC,IAAI,WAAW,UAAU,EAAE,CAAC,CAAC;gBAClE,MAAM,CAAC,UAAU,CAAC,CAAC;aACtB,CACJ,CAAC;SACL,CAAC,CAAC;KACN;IAES,aAAa;QACnB,IAAI,CAAC,MAAM,CAAC,OAAO,EAAE,CAAC;KACzB;;AApGc,2CAA8B,GAAY,KAAK,CAAC;AAChD,yBAAY,GAAgB,IAAI,CAAC;AAsGpD,SAAS,aAAa,CAAC,KAAU;IAC7B,IAAI,KAAK,IAAI,KAAK,CAAC,OAAO,CAAC,KAAK,CAAC,IAAI,KAAK,CAAC,MAAM,GAAG,CAAC,EAAE;QACnD,IAAI,OAAO,KAAK,CAAC,CAAC,CAAC,KAAK,QAAQ,EAAE;YAC9B,OAAO,IAAI,CAAC;SACf;KACJ;IAED,OAAO,KAAK,CAAC;AACjB;;MC5Ha,eAAgB,SAAQ,QAAiC;IAKlE,YAAY,IAAY,EAAE,MAAsB;QAC5C,KAAK,CAAC,IAAI,EAAE,MAAM,CAAC,CAAC;QAEpB,IAAI,CAAC,IAAI,GAAG,MAAM,CAAC,GAAG,CAAC;QACvB,IAAI,CAAC,SAAS,GAAG,MAAM,CAAC,QAAQ,CAAC;QACjC,IAAI,CAAC,MAAM,GAAG,gBAAgB,CAAC,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC;KACrD;IAES,WAAW;QACjB,OAAO,IAAI,OAAO,EAAW,CAAC,OAAiC,EAAE,MAAM;YACnE,MAAM,MAAM,GAAG,IAAI,aAAa,EAAE,CAAC;YACnC,MAAM,CAAC,IAAI,CACP,IAAI,CAAC,IAAI,EACT,CAAC,OAAO;gBACJ,IAAI,IAAI,CAAC,SAAS,EAAE;oBAChB,OAAO,CAAC,QAAQ,GAAG,IAAI,CAAC,SAAS,CAAC;oBAClC,OAAO,CAAC,WAAW,GAAG,IAAI,CAAC;iBAC9B;gBAED,OAAO,CAAC,KAAK,GAAG,IAAI,CAAC,MAAM,GAAG,IAAI,GAAG,KAAK,CAAC;gBAC3C,OAAO,CAAC,WAAW,GAAG,IAAI,CAAC;gBAE3B,OAAO,CAAC,OAAO,CAAC,CAAC;aACpB,EACD,CAAC,aAAa;gBACV,IAAI,CAAC,SAAS,GAAG,aAAa,CAAC,MAAM,GAAG,aAAa,CAAC,KAAK,CAAC;aAC/D,EACD,CAAC,UAAU;gBACP,MAAM,CAAC,UAAU,CAAC,CAAC;aACtB,CACJ,CAAC;SACL,EAAE,CAAC;KACP;IAES,aAAa;QACnB,IAAI,CAAC,MAAM,CAAC,OAAO,EAAE,CAAC;KACzB;;;MC5CQ,aAAc,SAAQ,QAAwC;IAGvE,YAAY,IAAY,EAAE,MAAoB;QAC1C,KAAK,CAAC,IAAI,EAAE,MAAM,CAAC,CAAC;QAEpB,IAAI,CAAC,IAAI,GAAG,MAAM,CAAC,GAAG,CAAC;KAC1B;IAES,WAAW;QACjB,MAAM,UAAU,GAAG,CAAC,KAAiC;YACjD,IAAI,CAAC,SAAS,GAAG,KAAK,CAAC,MAAM,GAAG,KAAK,CAAC,KAAK,CAAC;SAC/C,CAAA;QACD,OAAO,SAAS,CAAC,IAAI,CAAC,IAAI,EAAE,UAAU,CAAC,CAAC;KAC3C;IAES,aAAa;KACtB;;;MCxBQ,gBAAgB;IASzB,YAAY,EAAU,EAAE,MAAc;QAFtC,UAAK,GAAW,CAAC,CAAC;QAGd,IAAI,CAAC,GAAG,GAAG,EAAE,CAAC;QACd,IAAI,CAAC,OAAO,GAAG,MAAM,CAAC;KACzB;IARD,IAAI,EAAE,KAAa,OAAO,IAAI,CAAC,GAAG,CAAC,EAAE;IACrC,IAAI,MAAM,KAAa,OAAO,IAAI,CAAC,OAAO,CAAC,EAAE;CAQhD;MAOY,mBAAmB;IAAhC;QAEY,iBAAY,GAAG,IAAI,GAAG,EAA4B,CAAC;KAqC9D;IAnCG,iBAAiB,CAAC,MAA8B;QAC5C,IAAI,CAAC,GAAG,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC;QACzC,IAAI,CAAC,CAAC,EAAE;YACJ,CAAC,GAAG,IAAI,gBAAgB,CAAC,MAAM,CAAC,EAAE,EAAE,MAAM,CAAC,MAAM,CAAC,CAAC;YACnD,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC,MAAM,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC;SACvC;QAED,OAAO,CAAC,CAAC;KACZ;IAED,oBAAoB,CAAC,EAAU;QAC3B,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC;KAChC;IAED,oBAAoB;QAChB,IAAI,CAAC,YAAY,GAAG,IAAI,GAAG,EAAE,CAAC;KACjC;IAED,qBAAqB;QACjB,IAAI,IAAI,CAAC,YAAY,CAAC,IAAI,KAAK,CAAC,EAAE;YAC9B,OAAO,CAAC,CAAC;SACZ;QAED,IAAI,IAAI,GAAG,CAAC,CAAC;QACb,IAAI,IAAI,GAAG,CAAC,CAAC;QAEb,KAAK,MAAM,CAAC,EAAE,EAAE,CAAC,CAAC,IAAI,IAAI,CAAC,YAAY,EAAE;YACrC,IAAI,IAAI,CAAC,CAAC,KAAK,GAAG,CAAC,CAAC,MAAM,CAAC;YAC3B,IAAI,IAAI,CAAC,CAAC,MAAM,CAAC;SACpB;QAED,MAAM,IAAI,GAAG,IAAI,GAAG,IAAI,CAAC;QACzB,OAAO,IAAI,CAAC;KACf;;;AClDL;;;IAGiB,aA8DhB;AA9DD,WAAiB,YAAY;IAEZ,kBAAK,GAAG,IAAI,eAAe,CAAC,aAAa,CAAC,CAAC;IAC3C,iBAAI,GAAG,IAAI,eAAe,CAAC,YAAY,CAAC,CAAC;IACzC,qBAAQ,GAAG,IAAI,eAAe,CAAC,eAAe,CAAC,CAAC;IAChD,mBAAM,GAAG,IAAI,eAAe,CAAC,aAAa,CAAC,CAAC;;;;IAKzD,SAAsB,gBAAgB;;YAClC,MAAM,OAAO,CAAC,GAAG,CAAC;gBACd,aAAA,KAAK,CAAC,OAAO,EAAE;gBACf,aAAA,IAAI,CAAC,OAAO,EAAE;gBACd,aAAA,QAAQ,CAAC,OAAO,EAAE;gBAClB,aAAA,MAAM,CAAC,OAAO,EAAE;aACnB,CAAC,CAAC;SACN;KAAA;IAPqB,6BAAgB,mBAOrC,CAAA;IAED,SAAgB,WAAW;QACvB,MAAM,WAAW,GAAG,IAAI,mBAAmB,EAAE,CAAC;QAE9C,MAAM,aAAa,GAAG,WAAW,CAAC,iBAAiB,CAAC,EAAE,EAAE,EAAE,OAAO,EAAE,MAAM,EAAE,aAAA,KAAK,CAAC,KAAK,EAAE,EAAE,CAAC,CAAC;QAC5F,aAAa,CAAC,KAAK,GAAG,aAAA,KAAK,CAAC,eAAe,EAAE,CAAC;QAE9C,MAAM,YAAY,GAAG,WAAW,CAAC,iBAAiB,CAAC,EAAE,EAAE,EAAE,MAAM,EAAE,MAAM,EAAE,aAAA,IAAI,CAAC,KAAK,EAAE,EAAE,CAAC,CAAC;QACzF,YAAY,CAAC,KAAK,GAAG,aAAA,IAAI,CAAC,eAAe,EAAE,CAAC;QAE5C,MAAM,eAAe,GAAG,WAAW,CAAC,iBAAiB,CAAC,EAAE,EAAE,EAAE,UAAU,EAAE,MAAM,EAAE,aAAA,QAAQ,CAAC,KAAK,EAAE,EAAE,CAAC,CAAC;QACpG,eAAe,CAAC,KAAK,GAAG,aAAA,QAAQ,CAAC,eAAe,EAAE,CAAC;QAEnD,MAAM,aAAa,GAAG,WAAW,CAAC,iBAAiB,CAAC,EAAE,EAAE,EAAE,QAAQ,EAAE,MAAM,EAAE,aAAA,MAAM,CAAC,KAAK,EAAE,EAAE,CAAC,CAAC;QAC9F,aAAa,CAAC,KAAK,GAAG,aAAA,MAAM,CAAC,eAAe,EAAE,CAAC;QAE/C,OAAO,WAAW,CAAC,qBAAqB,EAAE,CAAC;KAC9C;IAhBe,wBAAW,cAgB1B,CAAA;;;;IAKD,SAAgB,SAAS;QACrB,aAAA,KAAK,CAAC,OAAO,EAAE,CAAC;QAChB,aAAA,IAAI,CAAC,OAAO,EAAE,CAAC;QACf,aAAA,QAAQ,CAAC,OAAO,EAAE,CAAC;QACnB,aAAA,MAAM,CAAC,OAAO,EAAE,CAAC;KACpB;IALe,sBAAS,YAKxB,CAAA;;;;IAKD,SAAgB,eAAe;QAC3B,OAAO,CAAC,cAAc,CAAC,4CAA4C,CAAC,CAAC;QACrE,OAAO,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;QACrB,OAAO,CAAC,GAAG,CAAC,aAAA,KAAK,CAAC,SAAS,EAAE,CAAC,CAAC;QAC/B,OAAO,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;QACpB,OAAO,CAAC,GAAG,CAAC,aAAA,IAAI,CAAC,SAAS,EAAE,CAAC,CAAC;QAC9B,OAAO,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC;QACxB,OAAO,CAAC,GAAG,CAAC,aAAA,QAAQ,CAAC,SAAS,EAAE,CAAC,CAAC;QAClC,OAAO,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;QACtB,OAAO,CAAC,GAAG,CAAC,aAAA,MAAM,CAAC,SAAS,EAAE,CAAC,CAAC;QAChC,OAAO,CAAC,QAAQ,EAAE,CAAC;KACtB;IAXe,4BAAe,kBAW9B,CAAA;AACL,CAAC,EA9DgB,YAAY,KAAZ,YAAY;;ACV7B;;;SAIgB,UAAU,CAAC,CAAS;IAChC,OAAO,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC;AAC3C,CAAC;SAEe,WAAW,CAAC,CAAS;IACjC,OAAO,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC;AACvC,CAAC;SAEe,aAAa,CAAC,CAAS;IACnC,OAAO,EAAE,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE,GAAG,CAAC,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,CAAC;AAC5C,CAAC;SAEe,WAAW,CAAC,CAAS;IACjC,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;AACrB,CAAC;SAEe,YAAY,CAAC,CAAS;IAClC,OAAO,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC,CAAC;AAClC,CAAC;SAEe,cAAc,CAAC,CAAS;IACpC,OAAO,CAAC,GAAG,GAAG,GAAG,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,GAAG,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC,GAAG,CAAC,CAAC;AACrE,CAAC;SAEe,WAAW,CAAC,CAAS;IACjC,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;AAC7B,CAAC;SAEe,YAAY,CAAC,CAAS;IAClC,OAAO,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC,CAAC;AAClC,CAAC;SAEe,cAAc,CAAC,CAAS;IACpC,OAAO,CAAC,GAAG,GAAG,GAAG,EAAE,GAAG,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,GAAG,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC,GAAG,CAAC,CAAC;AAC9E,CAAC;SAEe,UAAU,CAAC,CAAS;IAChC,OAAO,CAAC,GAAG,IAAI,CAAC,IAAI,CAAC,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;AAC7C,CAAC;SAEe,WAAW,CAAC,CAAS;IACjC,OAAO,IAAI,CAAC,IAAI,CAAC,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;AAC7C,CAAC;SAEe,aAAa,CAAC,CAAS;IACnC,OAAO,CAAC,GAAG,GAAG;UACR,CAAC,CAAC,GAAG,IAAI,CAAC,IAAI,CAAC,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC;UAC3C,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,GAAG,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;AAC3D,CAAC;SAEe,aAAa,CAAC,CAAS;IACnC,MAAM,EAAE,GAAG,CAAC,CAAC,GAAG,IAAI,CAAC,EAAE,IAAI,CAAC,CAAC;IAE7B,OAAO,CAAC,KAAK,CAAC;UACR,CAAC;UACD,CAAC,KAAK,CAAC;cACH,CAAC;cACD,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,EAAE,GAAG,CAAC,GAAG,EAAE,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,GAAG,EAAE,GAAG,KAAK,IAAI,EAAE,CAAC,CAAC;AAC1E,CAAC;SAEe,cAAc,CAAC,CAAS;IACpC,MAAM,EAAE,GAAG,CAAC,CAAC,GAAG,IAAI,CAAC,EAAE,IAAI,CAAC,CAAC;IAE7B,OAAO,CAAC,KAAK,CAAC;UACR,CAAC;UACD,CAAC,KAAK,CAAC;cACH,CAAC;cACD,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,EAAE,GAAG,CAAC,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,GAAG,EAAE,GAAG,IAAI,IAAI,EAAE,CAAC,GAAG,CAAC,CAAC;AACxE,CAAC;SAEe,gBAAgB,CAAC,CAAS;IACtC,MAAM,EAAE,GAAG,CAAC,CAAC,GAAG,IAAI,CAAC,EAAE,IAAI,GAAG,CAAC;IAE/B,OAAO,CAAC,KAAK,CAAC;UACR,CAAC;UACD,CAAC,KAAK,CAAC;cACH,CAAC;cACD,CAAC,GAAG,GAAG;kBACH,EAAE,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,EAAE,GAAG,CAAC,GAAG,EAAE,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,GAAG,CAAC,GAAG,MAAM,IAAI,EAAE,CAAC,CAAC,GAAG,CAAC;kBAClE,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,EAAE,GAAG,CAAC,GAAG,EAAE,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,GAAG,CAAC,GAAG,MAAM,IAAI,EAAE,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;AACzF,CAAC;SAEe,UAAU,CAAC,CAAS;IAChC,OAAO,CAAC,GAAG,CAAC,CAAC;AACjB,CAAC;SAEe,WAAW,CAAC,CAAS;IACjC,OAAO,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC;AACjC,CAAC;SAEe,aAAa,CAAC,CAAS;IACnC,OAAO,CAAC,GAAG,GAAG,GAAG,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,GAAG,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC,GAAG,CAAC,CAAC;AACjE,CAAC;SAEe,WAAW,CAAC,CAAS;IACjC,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;AACzB,CAAC;SAEe,YAAY,CAAC,CAAS;IAClC,OAAO,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC,CAAC;AAClC,CAAC;SAEe,cAAc,CAAC,CAAS;IACpC,OAAO,CAAC,GAAG,GAAG,GAAG,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,GAAG,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC,GAAG,CAAC,CAAC;AACzE,CAAC;SAEe,UAAU,CAAC,CAAS;IAChC,OAAO,CAAC,KAAK,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,EAAE,GAAG,CAAC,GAAG,EAAE,CAAC,CAAC;AAClD,CAAC;SAEe,WAAW,CAAC,CAAS;IACjC,OAAO,CAAC,KAAK,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,EAAE,GAAG,CAAC,CAAC,CAAC;AAClD,CAAC;SAEe,aAAa,CAAC,CAAS;IACnC,OAAO,CAAC,KAAK,CAAC;UACR,CAAC;UACD,CAAC,KAAK,CAAC;cACH,CAAC;cACD,CAAC,GAAG,GAAG;kBACH,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,EAAE,GAAG,CAAC,GAAG,EAAE,CAAC,GAAG,CAAC;kBAC5B,CAAC,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,EAAE,GAAG,CAAC,GAAG,EAAE,CAAC,IAAI,CAAC,CAAC;AACtD,CAAC;SAEe,UAAU,CAAC,CAAS;IAChC,MAAM,EAAE,GAAG,OAAO,CAAC;IACnB,MAAM,EAAE,GAAG,EAAE,GAAG,CAAC,CAAC;IAElB,OAAO,EAAE,GAAG,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,EAAE,GAAG,CAAC,GAAG,CAAC,CAAC;AACvC,CAAC;SAEe,WAAW,CAAC,CAAS;IACjC,MAAM,EAAE,GAAG,OAAO,CAAC;IACnB,MAAM,EAAE,GAAG,EAAE,GAAG,CAAC,CAAC;IAElB,OAAO,CAAC,GAAG,EAAE,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC,GAAG,EAAE,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC,CAAC;AACjE,CAAC;SAEe,aAAa,CAAC,CAAS;IACnC,MAAM,EAAE,GAAG,OAAO,CAAC;IACnB,MAAM,EAAE,GAAG,EAAE,GAAG,KAAK,CAAC;IAEtB,OAAO,CAAC,GAAG,GAAG;UACR,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC,IAAI,CAAC,EAAE,GAAG,CAAC,IAAI,CAAC,GAAG,CAAC,GAAG,EAAE,CAAC,IAAI,CAAC;UAClD,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC,IAAI,CAAC,EAAE,GAAG,CAAC,KAAK,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,GAAG,EAAE,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;AAC3E,CAAC;SAEe,YAAY,CAAC,CAAS;IAClC,OAAO,CAAC,GAAG,aAAa,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC;AACpC,CAAC;SAEe,aAAa,CAAC,CAAS;IACnC,MAAM,EAAE,GAAG,MAAM,CAAC;IAClB,MAAM,EAAE,GAAG,IAAI,CAAC;IAEhB,IAAI,CAAC,GAAG,CAAC,GAAG,EAAE,EAAE;QACZ,OAAO,EAAE,GAAG,CAAC,GAAG,CAAC,CAAC;KACrB;SAAM,IAAI,CAAC,GAAG,CAAC,GAAG,EAAE,EAAE;QACnB,OAAO,EAAE,IAAI,CAAC,IAAI,GAAG,GAAG,EAAE,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC;KAC1C;SAAM,IAAI,CAAC,GAAG,GAAG,GAAG,EAAE,EAAE;QACrB,OAAO,EAAE,IAAI,CAAC,IAAI,IAAI,GAAG,EAAE,CAAC,GAAG,CAAC,GAAG,MAAM,CAAC;KAC7C;SAAM;QACH,OAAO,EAAE,IAAI,CAAC,IAAI,KAAK,GAAG,EAAE,CAAC,GAAG,CAAC,GAAG,QAAQ,CAAC;KAChD;AACL,CAAC;SAEe,eAAe,CAAC,CAAS;IACrC,OAAO,CAAC,GAAG,GAAG;UACR,CAAC,CAAC,GAAG,aAAa,CAAC,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC;UAClC,CAAC,CAAC,GAAG,aAAa,CAAC,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,CAAC;AAC7C;;AC7KA;;;;MAIa,SAAS;;;;IAQlB;QANQ,eAAU,GAAW,IAAI,CAAC;QAC1B,cAAS,GAAW,IAAI,CAAC;QAM7B,IAAI,CAAC,KAAK,EAAE,CAAC;KAChB;;;;IAKD,KAAK;QACD,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,GAAG,EAAE,CAAC;QAC7B,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC;KACzB;;;;IAKD,IAAI;QACA,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,GAAG,EAAE,CAAC;KAC/B;;;;IAKD,KAAK;QACD,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC;QACvB,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC;KACzB;;;;IAKD,OAAO;;QACH,IAAI,IAAI,CAAC,UAAU,EAAE;YACjB,MAAM,OAAO,SAAG,IAAI,CAAC,SAAS,mCAAI,IAAI,CAAC,GAAG,EAAE,CAAC;YAC7C,OAAO,OAAO,GAAG,IAAI,CAAC,UAAU,CAAC;SACpC;aAAM;YACH,OAAO,CAAC,CAAC;SACZ;KACJ;;;;;"}