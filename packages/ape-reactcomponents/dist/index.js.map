{"version":3,"file":"index.js","sources":["../../../node_modules/style-inject/dist/style-inject.es.js","../src/three-container/ThreeContainer.tsx","../src/ar-button/ARButton.tsx","../src/overlay/Overlay.tsx","../src/device-camera-feed/DeviceCameraFeed.tsx"],"sourcesContent":["function styleInject(css, ref) {\n  if ( ref === void 0 ) ref = {};\n  var insertAt = ref.insertAt;\n\n  if (!css || typeof document === 'undefined') { return; }\n\n  var head = document.head || document.getElementsByTagName('head')[0];\n  var style = document.createElement('style');\n  style.type = 'text/css';\n\n  if (insertAt === 'top') {\n    if (head.firstChild) {\n      head.insertBefore(style, head.firstChild);\n    } else {\n      head.appendChild(style);\n    }\n  } else {\n    head.appendChild(style);\n  }\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = css;\n  } else {\n    style.appendChild(document.createTextNode(css));\n  }\n}\n\nexport default styleInject;\n","import React, { Component } from \"react\";\nimport './ThreeContainer.css';\n\ninterface IThreeContainerProps {\n    webglCanvas: HTMLCanvasElement;\n}\n\nexport class ThreeContainer extends Component<IThreeContainerProps> {\n\n    private _parentRef: React.RefObject<HTMLDivElement>;\n\n    constructor(props: IThreeContainerProps) {\n        super(props); \n\n        this._parentRef = React.createRef();\n    }\n\n    componentDidMount(): void {\n        if (this.props.webglCanvas) {\n            this._parentRef.current.appendChild(this.props.webglCanvas);\n        }\n    }\n\n    render() {\n        return (\n            <div className=\"three-canvas-parent\" ref={this._parentRef}>\n            </div>\n        );\n    }\n}","import React, { Component } from \"react\";\nimport \"./ARButton.css\";\nimport { APEngine } from '@yeti-cgi/ape';\n\ndeclare type ARButtonMode = 'start ar' | 'not supported' | 'not available' | 'need https';\n\nexport interface IARButtonState {\n    mode: ARButtonMode;\n}\n\n/**\n * This is a port of ARButton.js from Three JS to a React component.\n */\nexport class ARButton extends Component<{}, IARButtonState> {\n\n    private _currentSession: any = null;\n\n    constructor(props: any) {\n        super(props);\n\n        this.state = { \n            mode: null\n        };\n\n        this.onClick = this.onClick.bind(this);\n        this._onSessionStarted = this._onSessionStarted.bind(this);\n        this._onSessionEnded = this._onSessionEnded.bind(this);\n    }\n\n    componentDidMount() {\n        const nav = navigator as any;\n        if ('xr' in nav) {\n            nav.xr.isSessionSupported('immersive-ar')\n                .then((supported: any) => {\n                    this.setState({ mode: supported ? 'start ar' : 'not supported' });\n                })\n                .catch((error: any) => {\n                    this.setState({ mode: 'not supported' });\n                });\n        } else {\n            if (window.isSecureContext === false) {\n                this.setState({ mode: 'need https' });\n            } else {\n                this.setState({ mode: 'not available' });\n            }\n        }\n    }\n\n    private _onSessionStarted(session: any) {\n        session.addEventListener('end', this._onSessionEnded);\n\n        APEngine.webglRenderer.xr.setReferenceSpaceType('local');\n        APEngine.webglRenderer.xr.setSession(session);\n\n        this._currentSession = session;\n    }\n\n    private _onSessionEnded() {\n        this._currentSession.removeEventListener('end', this._onSessionEnded);\n        this._currentSession = null;\n    }\n\n    onClick() {\n        if (this.state.mode === 'start ar') {\n            if (this._currentSession === null) {\n                const nav = navigator as any;\n                nav.xr.requestSession('immersive-ar',\n                    { requiredFeatures: [ 'local', 'hit-test' ]\n                })\n                .then(this._onSessionStarted);\n            } else {\n                this._currentSession.end();\n            }\n        } else {\n            window.open('https://immersiveweb.dev/');\n        }\n    }\n\n    render() {\n        if (this.state.mode === null) {\n            return null;\n        }\n\n        let buttonText: string;\n        let buttonClass: string;\n\n        if (this.state.mode === 'start ar') {\n            buttonText = 'START AR';\n            buttonClass = 'arButton start';\n        } else if (this.state.mode === 'not supported') {\n            buttonText = 'AR NOT SUPPORTED';\n            buttonClass = 'arButton disabled';\n        } else if (this.state.mode === 'need https') {\n            buttonText = 'WEBXR NEEDS HTTPS';\n            buttonClass = 'arButton disabled';\n        } else if (this.state.mode === 'not available') {\n            buttonText = 'WEBXR NOT AVAILABLE';\n            buttonClass = 'arButton disabled';\n        } else {\n            throw new Error(`[ARButton] Component does not implement ARButtonMode ${this.state.mode}`);\n        }\n\n        return (\n            <button className={buttonClass} onClick={this.onClick}>{buttonText}</button>\n        );\n    }\n}","import React, { Component } from \"react\";\n\ninterface IOverlayProps {\n    /**\n     * Color of the overlay\n     */\n    color?: string;\n\n    /**\n     * Callback made when the overlay is clicked.\n     */\n    onClick?: () => void;\n}\n\nexport class Overlay extends Component<IOverlayProps> {\n\n    constructor(props: IOverlayProps) {\n        super(props);\n    }\n\n    render() {\n        const style: React.CSSProperties = {\n            position: 'fixed',\n            top: '0px',\n            left: '0px',\n            width: '100%',\n            height: '100%',\n            backgroundColor: this.props.color ?? 'rgba(0,0,0,0.5)'\n        };\n        return (\n            <div id='overlay' \n                style={style}\n                onClick={() => {\n                    if (this.props.onClick) {\n                        this.props.onClick();\n                    }\n                }} \n            />\n        );\n    }\n}","import React, { Component } from \"react\";\nimport { DeviceCamera } from \"@yeti-cgi/ape\";\n\ninterface IDeviceCameraFeedProps {\n    /**\n     * The Device Camera to use as input for video feed rendering.\n     */\n    deviceCamera: DeviceCamera,\n    className?: string;\n}\n\nexport class DeviceCameraFeed extends Component<IDeviceCameraFeedProps> {\n\n    private _canvasRef: React.RefObject<HTMLCanvasElement>;\n    private _tickHandleId: number;\n\n    constructor(props: IDeviceCameraFeedProps) {\n        super(props);\n\n        this.tick = this.tick.bind(this);\n\n        this._canvasRef = React.createRef<HTMLCanvasElement>();\n    }\n\n    componentDidMount() {\n        // Start doing update ticks now that component is mounted and refs are obtained.\n        this.tick();\n    }\n\n    componentWillUnmount() {\n        cancelAnimationFrame(this._tickHandleId);\n    }\n\n    tick() {\n        // Request for next animation frame for tick.\n        this._tickHandleId = requestAnimationFrame(this.tick);\n        \n        // Must have current reference to canvas element.\n        if (!this._canvasRef.current) {\n            return;\n        }\n        \n        // Device camera must be playing.\n        if (!this.props.deviceCamera || !this.props.deviceCamera.isPlaying()) {\n            return;\n        }\n\n        // Change canvas dimensions to match video.\n        const canvas = this._canvasRef.current;\n        const video = this.props.deviceCamera.getVideoElement();\n        canvas.width = video.videoWidth;\n        canvas.height = video.videoHeight;\n\n        // Draw video onto canvas 2d context.\n        const ctx = canvas.getContext('2d');\n        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);\n    }\n\n    render() {\n        \n        var style:React.CSSProperties = {};\n        if (!this.props.className) {\n            style = {\n                position: 'fixed',\n                width: '100%',\n                top: '50%',\n                left: '50%',\n                transform: 'translate(-50%, -50%)'\n            };\n        }\n\n        return (\n            <canvas style={style} ref={this._canvasRef} className={this.props.className} />\n        );\n    }\n}"],"names":[],"mappings":"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"}